(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61702300","chunk-0c51ea96","chunk-e557ef9e","chunk-362cc4ab","chunk-01a27526","chunk-a04a608e","chunk-524e071e","chunk-76fb5b9c","chunk-a04a608e","chunk-e557ef9e","chunk-0fec5636","chunk-3d128b8f","chunk-0950fc2f","chunk-c7b1b1f0","chunk-62495c08","chunk-42391c95","chunk-72e72170","chunk-c47b85c2","chunk-2cc43f66","chunk-0693ce46","chunk-ec3ff1d6","chunk-021cd653","chunk-ccd9324a","chunk-524e071e","chunk-cf5f982e","chunk-3345997a","chunk-65151992","chunk-3cfd74ee","chunk-591e494d","chunk-2d0ba8aa","chunk-2d22d5d2"],{"0534":function(e,t,a){},"0743":function(e,t,a){},"0989":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"taskDetailsPana",staticStyle:{padding:"20px"}},[t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("工单信息")]),t("a-descriptions",{attrs:{title:"",bordered:""}},[t("a-descriptions-item",{attrs:{label:"工单编号"}},[e._v(" "+e._s(e.workOrderInfo.orderCode)+" ")]),t("a-descriptions-item",{attrs:{label:"工单类型"}},[e._v(" "+e._s(e.workOrderInfo.orderType_dictText)+" ")]),t("a-descriptions-item",{attrs:{label:"工单名称"}},[e._v(" "+e._s(e.workOrderInfo.orderName)+" ")]),t("a-descriptions-item",{attrs:{label:"作业班组"}},[e._v(" "+e._s(e.workOrderInfo.groupName)+" ")]),t("a-descriptions-item",{attrs:{label:"线路"}},[e._v(" "+e._s(e.workOrderInfo.lineName)+" ")]),t("a-descriptions-item",{attrs:{label:"车号"}},[e._v(" "+e._s(e.workOrderInfo.trainNo)+" ")]),t("a-descriptions-item",{attrs:{label:"开始日期"}},[e._v(" "+e._s(e.workOrderInfo.startTime)+" ")]),t("a-descriptions-item",{attrs:{label:"结束日期"}},[e._v(" "+e._s(e.workOrderInfo.finishTime)+" ")])],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("任务信息")]),t("a-descriptions",{attrs:{title:"",bordered:""}},["outsources"===e.type?t("a-descriptions-item",{attrs:{label:"任务编码"}},[e._v(" "+e._s(e.taskInfo.taskNo)+" ")]):t("a-descriptions-item",{attrs:{label:"任务序号"}},[e._v(" "+e._s(e.taskInfo.taskNo)+" ")]),t("a-descriptions-item",{attrs:{label:"重要工序"}},[e._v(" "+e._s(1===e.taskInfo.important?"是":"否")+" ")]),"outsources"===e.type?t("a-descriptions-item",{attrs:{label:"是否委外"}},[e._v(" "+e._s(0===e.taskInfo.outTask?"否":1===e.taskInfo.outTask?"委外送修":"委外接收")+" ")]):t("a-descriptions-item",{attrs:{label:"是否委外"}},[e._v(" "+e._s(1===e.taskInfo.outsource?"是":"否")+" ")]),t("a-descriptions-item",{attrs:{label:"任务名称"}},[e._v(" "+e._s(e.taskInfo.taskName)+" ")]),t("a-descriptions-item",{attrs:{label:"作业手段"}},[e._v(" "+e._s(e.taskInfo.method_dictText)+" ")]),t("a-descriptions-item",{attrs:{label:"作业部件"}},[e._v(" "+e._s(e.taskInfo.assetTypeName)+" ")]),t("a-descriptions-item",{attrs:{label:"预计工时"}},[e._v(" "+e._s(e.taskInfo.workTime)+" ")]),"outsources"===e.type?t("a-descriptions-item",{attrs:{label:"任务描述"}},[e._v(" "+e._s(e.taskInfo.taskContent)+" ")]):t("a-descriptions-item",{attrs:{label:"任务描述"}},[e._v(" "+e._s(e.taskInfo.remark)+" ")])],1)],1)])},o=[],i={props:{workOrderInfo:{type:Object,default:{}},taskInfo:{type:Object,default:{}},type:String},name:"orderOrTaskDetail"},n=i,s=(a("542f"),a("2877")),l=Object(s["a"])(n,r,o,!1,null,"c70f6d0c",null);t["default"]=l.exports},"0c88":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"监修设备"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["assetTypeName",e.validatorRules.outinDetailId],expression:"['assetTypeName', validatorRules.outinDetailId]",modifiers:{trim:!0}}],ref:"myOutinDetailSelect",attrs:{placeholder:"交接明细",open:!1,showArrow:!0},on:{focus:e.openOutinDetailModal}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"合同"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["contractId"],expression:"['contractId']",modifiers:{trim:!0}}],attrs:{triggerChange:!0,placeholder:"请选择合同",dictCode:"bu_contract_info,contract_name,id,status<>2"}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆"}},[t("j-dict-select-seach-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["trainNo",e.validatorRules.trainNo],expression:"['trainNo', validatorRules.trainNo]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,placeholder:"请选择车辆",dictCode:"bu_train_info,train_no,train_no"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"派遣人员"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["dispatchUserName",e.validatorRules.dispatchUserId],expression:"['dispatchUserName', validatorRules.dispatchUserId]"}],ref:"myUserSelect",attrs:{placeholder:"请选择人员",open:!1,showArrow:!0},on:{focus:e.openUserSelectModal}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"人员联系方式"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["userPhone"],expression:"['userPhone']",modifiers:{trim:!0}}],attrs:{placeholder:"请输入联系方式"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"派遣班组"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["dispatchGroupId",e.validatorRules.dispatchGroupId],expression:"['dispatchGroupId', validatorRules.dispatchGroupId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,placeholder:"请选择派遣班组",dictCode:e.dictGroupStr},on:{change:e.selectDispatchGroup}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"派往公司"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["supplierName",e.validatorRules.supplierId],expression:"['supplierName', validatorRules.supplierId]"}],ref:"mySupplierSelect",attrs:{disabled:e.hasSupplierId,placeholder:"请选择厂商",open:!1,showArrow:!0},on:{focus:e.openSupplierModal}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"公司联系方式"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["supplierPhone"],expression:"['supplierPhone']",modifiers:{trim:!0}}],attrs:{placeholder:"请输入联系方式"}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"联系地址"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["supplierAddress"],expression:"['supplierAddress']",modifiers:{trim:!0}}],attrs:{placeholder:"请输入联系地址"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"任务名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["taskContent",e.validatorRules.taskContent],expression:"['taskContent', validatorRules.taskContent]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入任务名称"}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"出派时间"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["dispatchDate",e.validatorRules.dispatchDate],expression:"['dispatchDate', validatorRules.dispatchDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入出派时间"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"返回时间"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["returnDate",e.validatorRules.returnDate],expression:"['returnDate', validatorRules.returnDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入返回时间"}})],1)],1)],1)],1)],1),t("outin-detail-select",{ref:"outinDetailForm",attrs:{multiple:!1,billType:0},on:{ok:e.addTarget}}),t("supplier-list",{ref:"supplierModal",attrs:{multiple:!1},on:{ok:e.supplierSelect}}),t("user-list",{ref:"userSelectModal",attrs:{"dep-id":e.dispatchGroupId,multiple:!1},on:{ok:e.userSelect}})],1)},o=[],i=a("ca00"),n=a("d214"),s=a("86a0"),l=a("769e"),c=a("c1df"),u=a.n(c),d=a("b245"),f=a("6e22"),m=a.n(f),h=a("61f7");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return g(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(g(t={},r,(function(){return this})),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,g(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,g(d,"constructor",c),g(c,"constructor",l),l.displayName="GeneratorFunction",g(c,o,"GeneratorFunction"),g(d),g(d,o,"Generator"),g(d,r,(function(){return this})),g(d,"toString",(function(){return"[object Generator]"})),(p=function(){return{w:i,m:f}})()}function g(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}g=function(e,t,a,r){function i(t,a){g(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},g(e,t,a,r)}function b(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function v(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){b(i,r,o,n,s,"next",e)}function s(e){b(i,r,o,n,s,"throw",e)}n(void 0)}))}}var y={name:"SuperviseItemForm",props:{assetId:{type:String,default:null},businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1}},components:{OutinDetailSelect:s["default"],SupplierList:l["default"],UserList:d["default"]},data:function(){return{confirmLoading:!1,dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",treeData:[],title:"操作",visible:!1,dispatchGroupId:"",model:{},dispatchUserId:"",outinDetailId:"",outinNo:"",assetTypeId:"",supplierName:"",supplierId:"",hasSupplierId:!1,labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:15}},queryParam:{category:null,name:"",objTypeId:"",status:null,id:"",pageNo:1,pageSize:10},form:this.$form.createForm(this),validatorRules:{outinDetailId:{rules:[{required:!0,message:"请选择交接明细!"}]},assetTypeId:{rules:[{required:!0,message:"请选择部件!"}]},trainNo:{rules:[{required:!0,message:"请选择车辆!"}]},dispatchUserId:{rules:[{required:!0,message:"请选择派遣人员!"}]},dispatchGroupId:{rules:[{required:!0,message:"请选择派遣班组!"}]},supplierId:{rules:[{required:!0,message:"请选择派往公司!"}]},taskContent:{rules:[{required:!0,message:"请输入任务内容!"},{max:64,message:"输入长度不能超过64字符!"}]},dispatchDate:{rules:[{required:!0,message:"请输入出派时间!"}]},returnDate:{rules:[{required:!0,message:"请输入返回时间!"}]}}}},mounted:function(){this.businessKey&&this.loadById(this.businessKey)},methods:{loadById:function(e){var t=this;Object(n["bb"])(e).then((function(e){if(e.success){var a=Object.assign({},e.result);t.edit(a)}else t.$message.warn("查询监修记录失败");t.$emit("loaded")}))},openUserSelectModal:function(){this.$refs.userSelectModal.showModal(),this.$refs.myUserSelect.blur()},userSelect:function(e){Object(i["e"])(e)||(this.dispatchUserId=e[0].id,this.form.setFieldsValue({dispatchUserName:e[0].realname,userPhone:e[0].phone,dispatchGroupId:e[0].departId}))},selectDispatchGroup:function(e,t){t&&(this.dispatchGroupId=t.value,this.form.setFieldsValue({dispatchUserName:"",userPhone:""}))},checkPhone:function(e,t,a){Object(i["e"])(t)||m()(t)||Object(h["c"])(t)?a():a("请输入正确的号码！")},checkEmail:function(e,t,a){Object(i["e"])(t)||Object(h["a"])(t)?a():a("请输入正确的邮箱！")},handleCategory:function(e){this.category=e},openModal:function(){switch(this.category){case"1":break;case"2":this.$refs.selectModal.showModal();break;case"3":this.$refs.MaterialModalForm.showModal();break;default:break}this.$refs.mySelect.blur()},addTarget:function(e){Object(i["e"])(e)||(this.outinDetailId=e[0].id,this.assetTypeId=e[0].assetTypeId,this.supplierId=e[0].supplierId,this.hasSupplierId=!Object(i["e"])(this.supplierId),this.form.setFieldsValue({assetTypeName:e[0].assetName,trainNo:e[0].trainNo,contractId:e[0].contractId,supplierName:e[0].supplierName,supplierPhone:e[0].supplierPhone,supplierAddress:e[0].supplierAddress}))},changeStatus:function(e){this.status=e},openSupplierModal:function(){this.$refs.supplierModal.showModal(),this.$refs.mySupplierSelect.blur()},supplierSelect:function(e){var t=this;Object(i["e"])(e)||(this.$nextTick((function(){t.form.setFieldsValue({supplierName:e[0].name,supplierPhone:e[0].contactPhone,supplierAddress:e[0].address})})),this.supplierId=e[0].id)},openOutinDetailModal:function(){this.$refs.outinDetailForm.showModal(),this.$refs.myOutinDetailSelect.blur()},findList:function(){var e=v(p().m((function e(t){var a=this;return p().w((function(e){while(1)switch(e.n){case 0:return this.queryParam.id=t,e.n=1,Object(n["P"])(this.queryParam).then((function(e){var t=e.result.records;t&&(a.outinNo=t[0].outinNo)}));case 1:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onSupplierChange:function(e){var t=this;this.queryParam.id=e,Object(n["eb"])(this.queryParam).then((function(e){var a=e.result.records;a&&t.form.setFieldsValue({supplierPhone:a[0].contactPhone,supplierAddress:a[0].address})}))},add:function(){this.edit({})},edit:function(){var e=v(p().m((function e(t){var a=this;return p().w((function(e){while(1)switch(e.n){case 0:if(this.form.resetFields(),this.model=Object.assign({},t),this.visible=!0,!t.id){e.n=2;break}return this.outinDetailId=t.outinDetailId,this.supplierId=t.supplierId,this.hasSupplierId=!Object(i["e"])(this.supplierId),e.n=1,this.findList(this.outinDetailId);case 1:this.assetTypeId=t.assetTypeId,this.dispatchUserId=t.dispatchUserId;case 2:this.$nextTick((function(){a.form.setFieldsValue({assetTypeName:a.model.assetTypeName,trainNo:a.model.trainNo,contractId:a.model.contractId,supplierPhone:a.model.supplierPhone,supplierAddress:a.model.supplierAddress,dispatchUserName:a.model.dispatchUserName,userPhone:a.model.userPhone,dispatchGroupId:a.model.dispatchGroupId,supplierName:a.model.supplierName,taskContent:a.model.taskContent,dispatchDate:u()(a.model.dispatchDate||void 0),returnDate:u()(a.model.returnDate||void 0)})}));case 3:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),validate:function(){var e=this;return new Promise((function(t,a){e.form.validateFields((function(e,a){e||t()}))}))},save:function(e){var t=this,a=this;a.form.validateFields((function(r,o){if(!r){a.confirmLoading=!0;var i,s=Object.assign(a.model,o,{dispatchDate:u()(o.dispatchDate).format("YYYY-MM-DD"),returnDate:u()(o.returnDate).format("YYYY-MM-DD"),outinDetailId:t.outinDetailId,assetTypeId:t.assetTypeId,supplierId:t.supplierId,dispatchUserId:t.dispatchUserId});i=a.model.id?Object(n["C"])(s):Object(n["g"])(s),i.then((function(r){r.success?t.fromFlow?a.$emit("ok",e):a.$emit("ok"):t.fromFlow?(e.res=r,a.$emit("fail",e)):a.$emit("fail")})).finally((function(){a.confirmLoading=!1}))}}))}}},k=y,w=a("2877"),I=Object(w["a"])(k,r,o,!1,null,"3a4d2da4",null);t["default"]=I.exports},"0e7b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障代码选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"请输入编码和描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 82px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",height:"auto",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkMethod}:{},"tree-config":{lazy:!1,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"fltCode",align:"left","header-align":"center",title:"故障代码",width:"260","tree-node":""}}),t("vxe-table-column",{attrs:{field:"fltLevel_dictText",title:"类型",width:"150"}}),t("vxe-table-column",{attrs:{field:"fltName",title:"代码描述",align:"left","header-align":"center"}})],1)],1)])},o=[],i=a("b47d"),n=a("ca00"),s=a("a396");function l(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=c(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return n=e.done,e},e:function(e){s=!0,i=e},f:function(){try{n||null==a.return||a.return()}finally{if(s)throw i}}}}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var d={name:"FaultCodeList",components:{FaultCategoryList:s["default"]},props:{multiple:{type:Boolean,default:!0},type:{type:String,default:""}},data:function(){return{categoryCode:"",queryParam:{searchText:""},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(e){this.visible=!0,this.queryParam.categoryId=e,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["bb"])(this.queryParam).then((function(t){t.success?(e.tableData=e.listToTreeList(t.result),e.$nextTick((function(){e.tableData.length&&e.$refs.listTable.setTreeExpand(e.tableData.find((function(e){return e.children})),!0)}))):e.$message.error(t.message)}))},loadChildrenMethod:function(e){var t=e.row;return Object(i["cb"])({code:t.fltCode}).then((function(e){return e.success?((e.result||[]).forEach((function(e){e.children=[]})),e.result||[]):[]}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.categoryCode="",this.queryParam.searchText="",this.queryParam.categoryId=""},openSelectTypeModal:function(){this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur()},addCategoryTarget:function(e){Object(n["e"])(e)?this.queryParam.categoryId="":(this.queryParam.categoryId=e[0].id,this.categoryCode=e[0].categoryCode)},checkMethod:function(e){var t=e.row;return"unit"!=this.type||3==t.fltLevel},listToTreeList:function(e){if(!e||!e.length)return[];var t,a={},r=l(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;a[o.fltCode]=o}}catch(n){r.e(n)}finally{r.f()}for(var i=0;i<e.length;i++)e[i].parentCode&&a[e[i].parentCode]&&(a[e[i].parentCode].children||(a[e[i].parentCode].children=[]),a[e[i].parentCode].children.push(e[i]),e.splice(i,1),i--);return e.sort((function(e,t){return e.fltCode-t.fltCode})),e}}},f=d,m=(a("191b"),a("2877")),h=Object(m["a"])(f,r,o,!1,null,"e6e31b9e",null);t["default"]=h.exports},"13f1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{ref:"locationModalRef",class:{"na-footer-none":2===e.modeType},attrs:{title:"库位选择",width:"80%",bodyStyle:{height:"70vh"},visible:e.visible,centered:!0,confirmLoading:e.confirmLoading,closable:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"库位选择"}},[t("a-checkbox-group",{attrs:{name:"checkboxgroup",options:e.options},on:{change:e.findList},model:{value:e.warehouseLevelList,callback:function(t){e.warehouseLevelList=t},expression:"warehouseLevelList"}})],1)],1),t("a-col",{attrs:{md:12}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 66px)"},attrs:{id:"location_table_main"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto","show-overflow":"tooltip",data:e.tableData,"tree-config":{key:"warehouseId",children:"children",expandAll:!0},"radio-config":{highlight:!0,trigger:"row"},"row-class-name":e.setRowClass},on:{"update:data":function(t){e.tableData=t},"cell-click":e.onCurrentChange}},[1===e.modeType?t("vxe-table-column",{attrs:{type:"radio",width:"40px"}}):e._e(),t("vxe-table-column",{attrs:{field:"sourceLocationName",width:"200",title:"所属组织","header-align":"center",align:"left","tree-node":""}}),t("vxe-table-column",{attrs:{width:"80",field:"warehouseLevel",title:"库位级别",formatter:e.formatLevel}}),t("vxe-table-column",{attrs:{width:"120",field:"materialTypeCode",title:"物资编码"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"130","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"tradeNo",width:"200",title:"所属批次"}}),t("vxe-table-column",{attrs:{width:"80",field:"amount",title:"当前库存"}}),t("vxe-table-column",{attrs:{width:"80",field:"usableAmount",title:"可用库存"}}),t("vxe-table-column",{attrs:{width:"160",field:"usedDetailInfo",title:"占用详情","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{width:"80",field:"price",title:"价格"}}),t("vxe-table-column",{attrs:{width:"80",field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialType_dictText",title:"物料分类"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialAttr_dictText",title:"物料属性"}}),t("vxe-table-column",{attrs:{field:"spec",title:"物料描述","min-width":"100","header-align":"center",align:"left"}})],1)],1):e._e()])},o=[],i=a("c54ca");function n(e){return u(e)||c(e)||l(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){if(e){if("string"==typeof e)return d(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,t):void 0}}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function u(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var f={name:"LocationList",props:{multiple:{type:Boolean,default:!1},modeType:{type:Number,default:1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,tableData:[],selectMaterialTypeId:"",warehouseLevelList:[],options:[{label:"三级库",value:3},{label:"四级库",value:4}]}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0}))},created:function(){},methods:{showModal:function(e,t,a){this.visible=!0,this.selectMaterialTypeId=e,this.findList(t,a)},findList:function(e,t){var a=this;Object(i["yb"])({warehouseLevelList:this.warehouseLevelList,materialTypeId:this.selectMaterialTypeId,applyDetailId:e,assignDetailId:t}).then((function(e){e.success&&(a.tableData=[],a.tableData=a.buildTree(e.result),a.$nextTick((function(){a.$refs.listTable.setAllTreeExpand(!0)})))}))},buildTree:function(e){var t=e.reduce((function(e,t,a){return e[t.warehouseId]=a,e}),{}),a=[];return e.forEach((function(r){if(null===r.parentId)a.push(r);else{var o=e[t[r.parentId]];o?o.children=[].concat(n(o.children||[]),[r]):a.push(r)}})),a},formatLevel:function(e){var t=e.cellValue,a=parseInt(t);return a-1},handleOk:function(){var e=this.$refs.listTable.getRadioRecord();e.children?this.$message.warn("该库位还有下级库位，请选择下级库位！"):(this.$emit("ok",e?[e]:[]),this.visible=!1)},saveOk:function(){this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},close:function(){this.visible=!1,Object.assign(this.$data,this.$options.data())},openPalletModal:function(){this.$refs.palletSelect.blur()},openlocationModal:function(){this.$refs.materialToolsModal.showModal(),this.$refs.locationSelect.blur()},onCurrentChange:function(e){var t=e.row,a=e.$event;2===this.modeType&&(t.children&&t.children.length&&!/vxe-tree--node-btn/.test(a.target.className)?this.$refs.listTable.setTreeExpand([t],!this.$refs.listTable.isTreeExpandByRow(t)):(this.$emit("ok",[t]),this.visible=!1))},setRowClass:function(e){e.row;return 2===this.modeType?"mode-type-choose":""}}},m=f,h=(a("1892"),a("2877")),p=Object(h["a"])(m,r,o,!1,null,null,null);t["default"]=p.exports},1892:function(e,t,a){"use strict";a("9424")},1898:function(e,t,a){"use strict";a("5f10")},"190e":function(e,t,a){"use strict";a("c984")},"191b":function(e,t,a){"use strict";a("d4ad")},"1ea4":function(e,t,a){},"20c7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,centered:"",width:600,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"开口项名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["recordName",e.validatorRules.recordName],expression:"['recordName', validatorRules.recordName]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入"}})],1)],1),t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路"}},[t("line-select-list",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId",e.validatorRules.lineId],expression:"['lineId', validatorRules.lineId]"}],on:{change:e.changeLine}})],1)],1),t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆"}},[t("j-dict-select-seach-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["trainNo",e.validatorRules.trainNo],expression:"['trainNo', validatorRules.trainNo]"}],attrs:{triggerChange:!0,dictCode:e.dictCodeStr}})],1)],1),t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{field:"orderId",labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属工单"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderName",e.validatorRules.orderId],expression:"['orderName', validatorRules.orderId]",modifiers:{trim:!0}}],ref:"myOrderSelect",attrs:{"allow-clear":"",placeholder:"请选择工单",open:!1,showArrow:!0},on:{change:e.clearVal,dropdownVisibleChange:e.chooseWorkOrder}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"工单任务"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderTaskId",e.validatorRules.orderTaskId],expression:"[ 'orderTaskId', validatorRules.orderTaskId ]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,placeholder:"请选择工单任务",dictCode:e.dictCodeStrOrder}})],1)],1),t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"是否处理"}},[t("a-switch",{on:{change:e.handleChange},model:{value:e.isStatus,callback:function(t){e.isStatus=t},expression:"isStatus"}})],1)],1),t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"备注说明"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["recordDesc",e.validatorRules.recordDesc],expression:"['recordDesc', validatorRules.recordDesc]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入"}})],1)],1)],1)],1),t("work-order-select",{ref:"workOrderSelect",on:{ok:e.onSelectOrder}})],1)],1)},o=[],i=(a("c1df"),a("b7b4")),n=a("5633"),s=a("673e"),l={name:"OpenItemModal",components:{LineSelectList:n["default"],WorkOrderSelect:s["default"]},data:function(){return{isStatus:!1,status:"",dictCodeStr:"bu_train_info,train_no,train_no",dictCodeStrOrder:"",title:"操作",visible:!1,model:{},labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:13}},isClose:!1,confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{recordName:{rules:[{required:!0,message:"请输入开口项名称!"},{max:32,message:"输入长度不能超过32字符!"}]},orderId:{rules:[{required:!0,message:"请选择所属工单!"}]},orderName:{rules:[]},lineId:{rules:[{required:!0,message:"请选择线路!"}]},trainNo:{rules:[{required:!0,message:"请选择车辆!"}]},orderTaskId:{rules:[{required:!0,message:"请选择工单任务!"}]},recordDesc:{rules:[{max:500,message:"输入长度不能超过500字符!"}]},status:{rules:[{required:!0,message:"请选择处理状态!"}]}}}},created:function(){},methods:{changeOrder:function(e){this.dictCodeStrOrder=e?"bu_work_order_task,task_name,id,order_id='"+e+"'":"bu_work_order_task,task_name,id"},changeLine:function(e){this.dictCodeStr=e?"bu_train_info,train_no,train_no,line_id="+e:"bu_train_info,train_no,train_no"},handleChange:function(e){var t=e?1:0;this.status=t},changeClose:function(e){this.isClose=e},add:function(e,t,a){e&&this.changeOrder(e),this.edit({orderId:e,orderTaskId:t,recordDesc:a})},edit:function(e){var t=this;e.id?this.isClose=!(!e["close"]||1!=e["close"]):this.isClose=!1,this.model=Object.assign({},e),this.visible=!0;var a=!!this.model.status;this.model.status=a,this.isStatus=this.model.status,this.changeOrder(this.model.orderId),this.$nextTick((function(){t.form.getFieldDecorator("orderName",{rules:t.validatorRules.orderName}),t.form.setFieldsValue({recordName:t.model.recordName,orderId:t.model.orderId,orderName:t.model.orderName,groupId:t.model.groupId,trainNo:t.model.trainNo,orderTaskId:t.model.orderTaskId,lineId:t.model.lineId,recordDesc:t.model.recordDesc})}))},handleOk:function(){var e=this;e.form.validateFields((function(t,a){if(!t){e.confirmLoading=!0,e.model.orderId||(e.model.orderId=""),a.orderTaskId||(a.orderTaskId="");var r,o=Object.assign(e.model,a);o["status"]=e.isStatus?1:0,r=e.model.id?Object(i["k"])(o):Object(i["a"])(o),r.then((function(t){t.success?(e.$message.success(t.message),e.$emit("ok"),e.close()):e.$message.error("保存失败")})).catch((function(t){e.$message.error("保存异常")})).finally((function(){e.confirmLoading=!1}))}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},clearVal:function(e){e||(this.model.orderId=null,this.model.orderTaskId=null,this.form.setFieldsValue({orderName:null,orderTaskId:null}))},chooseWorkOrder:function(){this.$refs.workOrderSelect.showModal()},onSelectOrder:function(e){e.length>0&&(this.form.setFieldsValue({orderName:e[0].orderName,orderTaskId:null}),this.model.orderId=e[0].id,this.changeOrder(e[0].id))}}},c=l,u=a("2877"),d=Object(u["a"])(c,r,o,!1,null,"a23e45b2",null);t["default"]=d.exports},"260f":function(e,t,a){},"2a71":function(e,t,a){"use strict";a("30f7")},"2eb4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"备料确认-".concat(e.selectInfo?e.selectInfo.materialTypeName:"","物资"),width:"90%",bodyStyle:{height:"70vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[e.readonly?e._e():t("div",{staticClass:"table-page-search-wrapper",staticStyle:{position:"relative","z-index":"100"}},[t("a-form",{attrs:{form:e.form,layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{labelCol:{span:10},wrapperCol:{span:14},label:"来源库位"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["sourceLocationName",e.validatorRules.sourceLocationName],expression:"['sourceLocationName', validatorRules.sourceLocationName]"}],ref:"locationSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:e.openlocationModal}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"发放数量"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount",e.validatorRules.amount],expression:"['amount', validatorRules.amount]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入数量",max:e.locationMaxAmount}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"存放托盘"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["palletName",e.validatorRules.palletName],expression:"['palletName', validatorRules.palletName]"}],ref:"palletSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择托盘",open:!1},on:{change:e.palletNameChange,dropdownVisibleChange:function(t){return e.openPalletModal()}}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加")]),t("span",{staticStyle:{color:"red","margin-left":"15px"}},[e._v(e._s("总量: ".concat(e.selectInfo?e.selectInfo.amount:0,";")))]),t("span",{staticStyle:{color:"red","margin-left":"5px"}},[e._v(e._s("差额：".concat(e.calcAmount)))])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 62px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",height:"auto","keep-source":"",data:e.tableData,"edit-config":e.readonly?null:{trigger:"click",mode:"cell"}},on:{"edit-actived":e.onEditActive,"edit-closed":e.onEditClosed}},[t("vxe-table-column",{attrs:{title:"物资编码"}},[e._v(" "+e._s(e.selectInfo?e.selectInfo.materialTypeCode:"")+" ")]),t("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位"}}),t("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘"}}),t("vxe-table-column",{attrs:{field:"amount",title:"发放数量",align:"center","edit-render":{name:"$input",props:{type:"number"}}}}),e.readonly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.isMustApply?e._e():t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.handleDel(r)}}},[e._v("删除")])]}}],null,!1,3925414073)})],1)],1):e._e(),t("LocationList",{ref:"locationModal",on:{ok:e.onSelectLocation}}),t("PalletList",{ref:"palletModal",on:{ok:e.onSelectPallet}})],1)},o=[],i=a("13f1"),n=a("9f49"),s={name:"ApplyDistributionModal",components:{LocationList:i["default"],PalletList:n["default"]},props:{readonly:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,selectInfo:null,form:this.$form.createForm(this),chooseType:2,cellLocationName:"",cellPalletName:"",locationMaxAmount:0,queryParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},tableData:[],delDataList:[],delRecordList:[],validatorRules:{sourceLocationName:{rules:[{required:!0,message:"请选择所属库位!"}]},locationName:{rules:[]},palletId:{rules:[{required:!0,message:"请选择托盘!"}]},palletName:{rules:[{required:!1,message:"请选择托盘!"}]},amount:{rules:[{required:!0,message:"请输入数量!"}]}},isMustApply:!1}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0})),this.selectInfo||this.close()},computed:{calcAmount:function(){return this.getAmount()}},watch:{},methods:{getAmount:function(){if(!this.selectInfo)return 0;var e=0;return this.tableData.forEach((function(t){e+=Number(t.amount)})),this.selectInfo.amount-e},showModal:function(e){var t=this;this.selectInfo=e,this.tableData=[],e.assignDetailList.forEach((function(e){t.tableData.push(JSON.parse(JSON.stringify(e)))})),this.queryParam.materialTypeId=this.selectInfo.materialTypeId,this.queryParam.applyDetailId=this.selectInfo.id,this.queryParam.amount=this.calcAmount,this.visible=!0,this.$nextTick((function(){t.locationMaxAmount=t.calcAmount,t.form.getFieldDecorator("amount"),t.form.setFieldsValue({amount:t.calcAmount})}))},handleOk:function(){var e=this;if(!this.isMustApply)return 0===this.calcAmount?(this.$emit("ok",this.tableData),void this.close()):void this.$confirm({content:"物料差额分配未完成，是否退出？",onOk:function(){e.$emit("ok",e.tableData),e.close()}});this.close()},handleAdd:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var r=0;if(e.tableData.forEach((function(e){r+=Number(e.amount)})),e.tableData.find((function(t){return t.sourceLocationName===e.queryParam.sourceLocationName})))return e.$message.warn("".concat(e.queryParam.sourceLocationName,"来源库位的记录已存在")),void e.$refs.listTable.setActiveCell(e.tableData.find((function(t){return t.sourceLocationName===e.queryParam.sourceLocationName})),"amount");if(0===e.locationMaxAmount)return void e.$message.warn("".concat(e.queryParam.sourceLocationName,"来源库位的库存量不足"));if(r+a.amount>Number(e.selectInfo.amount))return void e.$message.warn("选择的实际数量超过了发放数量");e.queryParam.amount=a.amount,e.tableData.push(JSON.parse(JSON.stringify(e.queryParam)))}}))},handleDel:function(e){var t=this;this.tableData.splice(this.tableData.findIndex((function(t){return t===e})),1),this.queryParam.amount=this.calcAmount,this.$nextTick((function(){t.locationMaxAmount=t.calcAmount,t.form.getFieldDecorator("amount"),t.form.setFieldsValue({amount:t.calcAmount})}))},handleCancel:function(){this.$emit("cancel"),this.close()},close:function(){this.visible=!1},openPalletModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.curRow=e,this.$refs.palletModal.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName),this.$refs.palletSelect.blur()},openlocationModal:function(e){e&&(this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,null,null),this.$refs.locationSelect.blur())},onSelectLocation:function(e){if(this.curRow)this.curRow&&(this.curRow.palletName=e[0].warehouseName,this.curRow.locationWbs=e[0].warehouseWbs,this.curRow.sourceLocationName=e[0].sourceLocationName,delete this.curRow);else if(e.length>0){var t=0;this.tableData.forEach((function(a){a.locationWbs===e[0].warehouseWbs&&(t+=a.amount)})),this.locationMaxAmount=e[0].amount-t,this.locationMaxAmount<this.queryParam.amount&&this.form.setFieldsValue({amount:this.locationMaxAmount}),this.queryParam.locationName=e[0].warehouseName,this.queryParam.locationWbs=e[0].warehouseWbs,this.queryParam.sourceLocationName=e[0].sourceLocationName,this.queryParam.tradeNo=e[0].tradeNo,this.form.setFieldsValue({locationName:e[0].warehouseName,sourceLocationName:e[0].sourceLocationName})}},palletNameChange:function(e){e||(this.queryParam.palletId=void 0,this.queryParam.palletName=void 0)},onSelectPallet:function(e){this.curRow?delete this.curRow:e.length>0&&(this.queryParam.palletId=e[0].id,this.queryParam.palletName=e[0].name,this.form.setFieldsValue({palletName:e[0].name}))},onEditActive:function(e){var t=e.row;this.cellLocationName=t.locationName,this.cellPalletName=t.palletName},onEditClosed:function(e){var t=e.row,a=0;if(this.tableData.forEach((function(e){a+=Number(e.amount)})),a>Number(this.selectInfo.amount))return this.$refs.listTable.revertData(t),void this.$message.warn("选择的实际数量超过了发放数量")}}},l=s,c=a("2877"),u=Object(c["a"])(l,r,o,!1,null,null,null);t["default"]=u.exports},"30f7":function(e,t,a){},"310d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{title:"车辆设备选择",width:"80%",bodyStyle:{height:"83vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:"",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.close}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchQuery.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"名称或编码"},model:{value:e.queryParam.title,callback:function(t){e.$set(e.queryParam,"title",t)},expression:"queryParam.title"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"线路"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.changeLine},model:{value:e.lineId_A,callback:function(t){e.lineId_A=t},expression:"lineId_A"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"车辆"}},[t("j-dict-select-seach-tag",{attrs:{triggerChange:!0,dictCode:e.dictTrainStr},model:{value:e.trainNo_A,callback:function(t){e.trainNo_A=t},expression:"trainNo_A"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"状态"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,placeholder:"请选择状态",dictCode:"bu_valid_status"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.searchQuery}},[e._v("查询")])],1)],1)])],1)],1)],1),t("div",{staticClass:"tableHeight"},[t("vxe-table",{ref:"listTable",attrs:{border:"",resizable:"","row-id":"id",align:e.allAlign,height:"auto",data:e.tableData,"show-overflow":"tooltip","max-height":"100%","radio-config":{trigger:e.multiple?"default":"row",highlight:!0,checkMethod:e.checkRadioMethod},"checkbox-config":{trigger:e.multiple?"row":"default",highlight:!0,checkStrictly:!0,checkMethod:e.checkRadioMethod},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称","tree-node":"",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"code",title:"编码",width:"180"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",align:"center","header-align":"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("div",{style:{backgroundColor:e.statusColor[r.status+""],borderRadius:"4px"}},[e._v(" "+e._s(r.status_dictText)+" ")])]}}])}),t("vxe-table-column",{attrs:{field:"maximoAssetType",title:"maximo设备类型",width:"150",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"locationName",title:"位置",width:"400",align:"left","header-align":"center"}})],1)],1)])],1)},o=[],i=a("8fad"),n={props:{multiple:{type:Boolean,default:!0},trainNo:{type:[Number,String]},lineId:{type:[Number,String]}},data:function(){return{statusColor:{0:"#dedede",1:"#bad795"},dictTrainStr:"",trainNo_A:void 0,lineId_A:void 0,allAlign:"center",tableData:[],visible:!1,confirmLoading:!1,queryParam:{trainNo:"",searchText:"",status:1}}},created:function(){},methods:{changeLine:function(e,t){this.dictTrainStr="",e&&(this.dictTrainStr="bu_train_info,train_no,train_no,line_id="+e+"|train_struct_id")},checkRadioMethod:function(e){e.row;return!0},searchQuery:function(){this.findList()},loadChildrenMethod:function(e){var t=this,a=e.row,r={trainNo:this.trainNo_A,parentId:a.id,searchText:this.queryParam.searchText,status:this.queryParam.status};return new Promise((function(e){Object(i["Zb"])(r).then((function(a){a.success?e(a.result):t.$message.error("".concat(a.msg))}))}))},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),Array.from(e,(function(e,t){e.assetName=e.name})),this.$emit("ok",e),this.visible=!1},showModal:function(){this.visible=!0,this.lineId_A=this.lineId,this.trainNo_A=this.trainNo,this.findList()},close:function(){this.visible=!1},findList:function(){var e=this;this.queryParam.trainNo=this.trainNo_A,this.loading=!0,Object(i["Zb"])(this.queryParam).then((function(t){t.success&&(e.loading=!1,e.tableData=t.result)}))}}},s=n,l=(a("4677"),a("2877")),c=Object(l["a"])(s,r,o,!1,null,"3967f3d4",null);t["default"]=c.exports},"353a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",visible:e.visible,title:e.title,centered:"",bodyStyle:{height:"80vh"},confirmLoading:e.confirmLoading,destroyOnClose:!0,footer:null},on:{cancel:e.handleCancel}},[t("div",[t("iframe",{staticClass:"filename",staticStyle:{height:"calc(80vh - 25px)"},attrs:{src:e.filePath,width:"100%",frameborder:"0"}})])])},o=[],i=a("e2aa"),n={name:"DocPreviewModal",props:{title:{type:String,default:"文件预览"}},data:function(){return{visible:!1,confirmLoading:!1,filePath:""}},methods:{handleFilePath:function(e){var t=this;Object(i["c"])(e).then((function(e){if(e.success){var a=e.result;t.visible=!0,t.filePath=window._CONFIG["onlinePreviewDomainURL"]+"?url="+encodeURIComponent(a)}else t.$message.warning("查看文件失败")}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=n,l=(a("9216"),a("2877")),c=Object(l["a"])(s,r,o,!1,null,"484795fd",null);t["default"]=c.exports},"383b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"任务选择",centered:"",visible:e.visible,bodyStyle:{height:"70vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.tasks,"max-height":"100%","show-overflow":"ellipsis","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",title:"任务编号",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"任务名称",align:"left"}}),t("vxe-table-column",{attrs:{field:"workTime",title:"预计工时",align:"right",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskContent",title:"任务要求",align:"left"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left",width:"200"}})],1)],1)},o=[],i={name:"TaskSelectModal",props:{multiple:{type:Boolean,default:!1}},data:function(){return{visible:!1,tasks:[]}},methods:{showModal:function(e){this.tasks=e,this.visible=!0},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},n=i,s=a("2877"),l=Object(s["a"])(n,r,o,!1,null,"161bbc55",null);t["default"]=l.exports},"3c06":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{attrs:{"na-flex-height-full":""}},[4!==e.operator||e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("div",{style:"height: calc(100% - ".concat(4!==e.operator||e.readOnly?"4px":"45px",")")},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:e.staffArranges,"keep-source":!0,"show-overflow":"ellipsis","edit-rules":e.validRules,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.staffArranges=t}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{title:"工单任务",width:"250",align:"left","edit-render":{name:"input",enabled:4===e.operator&&1===e.curEditMode&&e.tasks.length>0}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.tasks.length>0?a.orderTaskName:e.selectTask.taskName)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange},model:{value:r.orderTaskId,callback:function(t){e.$set(r,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,3514004846)}):e._e(),t("vxe-table-column",{attrs:{field:"workstationName",width:"250",title:"工位",align:"left","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator&&1===e.curEditMode}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"stationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工位",open:!1},on:{focus:function(t){return e.openStationSelectModal(r)}},model:{value:r.workstationName,callback:function(t){e.$set(r,"workstationName",t)},expression:"row.workstationName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"userName",title:"安排人员",align:"left","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator&&1===e.curEditMode}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"userSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择人员",open:!1},on:{focus:function(t){return e.openSelectUser(r)}},model:{value:r.userName,callback:function(t){e.$set(r,"userName",t)},expression:"row.userName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"planWorkTime",title:"计划工时",align:"center","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator&&1===e.curEditMode}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.planWorkTime||"")+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:1e4,disabled:!e.isInputPlanTime},model:{value:r.planWorkTime,callback:function(t){e.$set(r,"planWorkTime",t)},expression:"row.planWorkTime"}})]}}])}),t("vxe-table-column",{attrs:{field:"workTime",title:"实际工时",align:"center","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.workTime||"")+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:1e4},model:{value:r.workTime,callback:function(t){e.$set(r,"workTime",t)},expression:"row.workTime"}})]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([4===e.operator?{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveMaterialRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelMaterialRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!1,size:"small"},on:{click:function(t){return t.stopPropagation(),e.editMaterialRowEvent(r)}}},[e._v("填写")])]]}}:null],null,!0)})],1)],1),t("work-station-list",{ref:"stationSelectModal",on:{ok:e.onSelectStation}}),t("user-list",{ref:"userSelectModal",attrs:{depId:e.groupId,multiple:!1},on:{ok:e.onSelectUser}})],1)},o=[],i=a("b9c3"),n=a("1158"),s=a("b245"),l={name:"TaskWorkTime",components:{UserList:s["default"],WorkStationList:n["default"]},props:{staffArranges:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0},workOrderId:{type:String,default:null}},watch:{selectTask:function(){this.refresh()}},data:function(){return{groupId:"",curEditMode:0,curRow:null,workStationDataList:[],isInputPlanTime:!0,validRules:{ordTskWkStationId:[{required:!0,message:"请选择任务",trigger:"manual"}],workstationName:[{required:!0,message:"请选择工位",trigger:"manual"}],userName:[{required:!0,message:"请选择人员",trigger:"manual"}],workTime:[{required:!0,message:"请输入实际工时",trigger:"manual"}]},workStations:[]}},created:function(){try{this.groupId=this.$store.state.user.info.departId}catch(e){}},mounted:function(){this.refresh()},methods:{refresh:function(){var e=this;try{var t=null;t=this.workOrderId?this.workOrderId:this.selectTask.orderId,t&&Object(i["S"])(t).then((function(t){t.success&&(e.workStations=t.result.workstations,e.staffArranges.length=0,e.workStations.forEach((function(t){e.selectTask?t.orderTaskId===e.selectTask.id&&t.staffArrangeList.forEach((function(t){e.staffArranges.push(t)})):t.staffArrangeList.forEach((function(t){e.staffArranges.push(t)}))})))}))}catch(a){}},checkIsAddStation:function(e){if(this.workStations){var t=this.workStations.find((function(t){return t.orderTaskId===e.orderTaskId}));t?(this.isInputPlanTime=!t.staffArrangeList.find((function(t){return t.workstationId===e.workstationId})),this.isInputPlanTime||(this.$refs.listTable.getActiveRecord().row.planWorkTime=t.workTime)):this.isInputPlanTime=!0}},getWorkStationName:function(e){var t=this.workStationDataList.find((function(t){return t.id===e.ordTskWkStationId}));return t?t.workstationName:""},editMaterialRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},saveMaterialRowEvent:function(e){var t=this;1===this.curEditMode&&this.staffArranges.find((function(t){return t.workstationId===e.workstationId&&t.userId===e.userId&&t.orderTaskId===e.orderTaskId}))?this.$message.warn("已经录入相同工位的员工工时"):this.$refs.listTable.validate(e,(function(a){a||(Object(i["ib"])([e]).then((function(a){a.success?(t.refresh(),t.$emit("ok")):(t.$refs.listTable.revertData(e),t.$message.error("保存失败"))})),t.$refs.listTable.clearActived(),t.curEditMode=0)}))},cancelMaterialRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},handleAdd:function(){var e=this;if(this.curEditMode=1,this.isInputPlanTime=!0,!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:""};this.selectTask?(Object.assign(t,{ordTskWkStationId:null,orderId:this.selectTask.orderId,orderTaskId:this.selectTask.id,userId:null,userName:null,planWorkTime:null,workTime:null,workstationId:null,workstationName:null,workstationNo:null}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"userName")}))):(Object.assign(t,{ordTskWkStationId:null,orderId:null,orderTaskId:null,userId:null,userName:null,planWorkTime:null,workTime:null,workstationId:null,workstationName:null,workstationNo:null}),this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveRow(a)})))}},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var a=[];t.map((function(t){e.staffArranges.map((function(e,r){t.id===e.id&&a.push(e.id)}))}));var r=new FormData;r.append("ids",a.toString()),Object(i["n"])(r).then((function(t){t.success?(a.forEach((function(t){e.staffArranges.map((function(a,r){t===a.id&&e.staffArranges.splice(r,1)}))})),e.$emit("ok"),e.$message.success("删除成功")):e.$message.error("删除失败")}))}}):this.$message.error("尚未选中任何数据!")},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.orderTaskId=this.tasks[t.key].id},onSelectStation:function(e){if(e&&e.length>0){var t=e[0];this.curRow.workstationId=t.id,this.curRow.workstationName=t.name,this.curRow.workstationNo=t.stationNo}else this.curRow.workstationId="",this.curRow.workstationName="",this.curRow.workstationNo="";this.checkIsAddStation(this.curRow)},openSelectUser:function(e){this.curRow=e,this.$refs.userSelectModal.showModal(),this.$refs.userSelect.blur()},onSelectUser:function(e){e.length&&(this.curRow.userId=e[0].id,this.curRow.userName=e[0].realname,this.$forceUpdate())},openStationSelectModal:function(e){this.curRow=e,this.$refs.stationSelectModal.showModal(),this.$refs.stationSelect.blur()},clearValidate:function(){this.$refs.listTable.clearValidate()}}},c=l,u=a("2877"),d=Object(u["a"])(c,r,o,!1,null,null,null);t["default"]=d.exports},"3cb5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障处理措施选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",bodyStyle:{height:"80vh"},destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"故障措施编码或者描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"分类"}},[t("a-select",{ref:"categoryIdSelect",attrs:{placeholder:"请选择所属分类",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(1)}},model:{value:e.categoryCode,callback:function(t){e.categoryCode=t},expression:"categoryCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"故障代码"}},[t("a-select",{ref:"faultCodeIdSelect",attrs:{placeholder:"请选择所属故障代码",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(2)}},model:{value:e.faultCode,callback:function(t){e.faultCode=t},expression:"faultCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"故障原因"}},[t("a-select",{ref:"faultReasonIdSelect",attrs:{placeholder:"请选择所属故障原因代码",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(3)}},model:{value:e.faultReasonCode,callback:function(t){e.faultReasonCode=t},expression:"faultReasonCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:2,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:"序号"}}),t("vxe-table-column",{attrs:{field:"solutionCode",title:"故障措施代码",width:"150"}}),t("vxe-table-column",{attrs:{field:"solutionDesc",title:"故障措施描述",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("fault-category-list",{ref:"categorySelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-code-list",{ref:"codeSelect",attrs:{multiple:!1},on:{ok:e.addCodeTarget}}),t("fault-reason-list",{ref:"reasonSelect",attrs:{multiple:!1},on:{ok:e.addReasonTarget}})],1)},o=[],i=a("b47d"),n=a("a396"),s=a("0e7b"),l=a("6034"),c=a("ca00"),u={name:"FaultSolutionList",components:{FaultCategoryList:n["default"],FaultCodeList:s["default"],FaultReasonList:l["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{categoryCode:"",faultCode:"",faultReasonCode:"",queryParam:{searchText:"",categoryId:"",faultCodeId:"",faultReasonId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(e){this.visible=!0,this.queryParam.faultReasonId=e,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["S"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.categoryCode="",this.faultCode="",this.faultReasonCode="",this.queryParam.searchText="",this.queryParam.categoryId="",this.queryParam.faultCodeId="",this.queryParam.faultReasonId=""},openSelectTypeModal:function(e){switch(e){case 1:this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur();break;case 2:this.$refs.codeSelect.showModal(),this.$refs.faultCodeIdSelect.blur();break;case 3:this.$refs.reasonSelect.showModal(),this.$refs.faultReasonIdSelect.blur();break;default:break}},addCategoryTarget:function(e){Object(c["e"])(e)?this.queryParam.categoryId="":(this.queryParam.categoryId=e[0].id,this.categoryCode=e[0].categoryCode)},addCodeTarget:function(e){Object(c["e"])(e)?this.queryParam.faultCodeId="":(this.queryParam.faultCodeId=e[0].id,this.faultCode=e[0].fltCode)},addReasonTarget:function(e){Object(c["e"])(e)?this.queryParam.faultReasonId="":(this.queryParam.faultReasonId=e[0].id,this.faultReasonCode=e[0].reasonCode)}}},d=u,f=(a("f02c"),a("2877")),m=Object(f["a"])(d,r,o,!1,null,"4d7ca708",null);t["default"]=m.exports},"3fdc":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{attrs:{"na-flex-height-full":""}},[e.isSelectDetaile?e._e():t("a-space",{staticStyle:{padding:"10px 0"}},[t("a-button",{on:{click:e.setCheckRecordTime}},[e._v("作业完成")]),t("a-button",{directives:[{name:"has",rawName:"v-has",value:"order:write:check:add",expression:"'order:write:check:add'"}],on:{click:e.openSetCheck}},[e._v("检查登记")]),t("a-button",{directives:[{name:"has",rawName:"v-has",value:"order:write:rectify:add",expression:"'order:write:rectify:add'"}],on:{click:e.openRectifyModal}},[e._v("添加整改")])],1),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"","auto-resize":"","max-height":"auto","row-id":"id",align:"center",data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"sortNo",title:"序号",align:"center",width:"60"}}),t("vxe-table-column",{attrs:{field:"title",title:"项点","header-align":"center",align:"left",width:"160"}}),t("vxe-table-column",{attrs:{field:"content",title:"检查内容","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"checkLevel",title:"等级",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkDesc",title:"检查情况",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkResult_dictText",title:"结果",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"workTime",title:"作业时间",align:"center",width:"115"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkMethod_dictText",title:"检查方式",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkUserName",title:"检查人",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkTime",title:"检查时间",align:"center",width:"115"}})],1)],1),t("a-modal",{attrs:{title:"检查",width:800,visible:e.visible,confirmLoading:e.confirmLoading,centered:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-form",{ref:"initForm",attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录名称"}},[t("a-row",{attrs:{gutter:10}},[t("a-col",{attrs:{span:14}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserName",e.validatorRules.checkUserName],expression:"['checkUserName', validatorRules.checkUserName]",modifiers:{trim:!0}}]})],1),t("a-col",{attrs:{span:10}},[t("a-button",{attrs:{type:"link"},on:{click:e.useCurrentUser}},[e._v("使用当前账号和密码")])],1)],1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录密码"}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserPwd",e.validatorRules.checkUserPwd],expression:"['checkUserPwd', validatorRules.checkUserPwd]",modifiers:{trim:!0}}]})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查方式"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["checkMethod",e.validatorRules.checkMethod],expression:"['checkMethod', validatorRules.checkMethod]"}],attrs:{triggerChange:"",placeholder:"请选择检查方式",dictCode:"bu_regu_method"}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查结果"}},[t("a-checkbox",{model:{value:e.checkResult,callback:function(t){e.checkResult=t},expression:"checkResult"}},[e._v(" 合格 ?")])],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查时间"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":{format:"HH:mm:ss",hideDisabledOptions:!0}},model:{value:e.checkQueryParam.checkTime,callback:function(t){e.$set(e.checkQueryParam,"checkTime",t)},expression:"checkQueryParam.checkTime"}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"结果描述"}},[t("a-textarea",{attrs:{"auto-size":{minRows:8,maxRows:8}},model:{value:e.checkQueryParam.checkDesc,callback:function(t){e.$set(e.checkQueryParam,"checkDesc",t)},expression:"checkQueryParam.checkDesc"}})],1)],1)],1),t("rectify-modal",{ref:"modalForm"}),t("WorkTimeModal",{ref:"workTimeModal",on:{ok:function(t){return e.findList()}}})],1)},o=[],i=a("5315"),n=a("7b165"),s=a("b9c3"),l=a("8fad"),c=a("c1df"),u=a.n(c);function d(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return f(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(f(t={},r,(function(){return this})),t),m=c.prototype=s.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,f(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=c,f(m,"constructor",c),f(c,"constructor",l),l.displayName="GeneratorFunction",f(c,o,"GeneratorFunction"),f(m),f(m,o,"Generator"),f(m,r,(function(){return this})),f(m,"toString",(function(){return"[object Generator]"})),(d=function(){return{w:i,m:h}})()}function f(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}f=function(e,t,a,r){function i(t,a){f(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},f(e,t,a,r)}function m(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function h(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){m(i,r,o,n,s,"next",e)}function s(e){m(i,r,o,n,s,"throw",e)}n(void 0)}))}}var p={name:"TaskCheckForm",components:{WorkTimeModal:n["default"],RectifyModal:i["default"]},props:{taskFormsList:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},workOrderInfo:{type:Object,default:function(){}},forms:{type:Array,default:function(){return[]}},modalType:{type:Number,default:0}},computed:{isSelectDetaile:function(){return 1===this.modalType}},mounted:function(){},data:function(){return{visible:!1,confirmLoading:!1,form:this.$form.createForm(this),labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:20}},labelCol2:{xs:{span:24},sm:{span:6}},wrapperCol2:{xs:{span:24},sm:{span:16}},validatorRules:{checkUserName:{rules:[{required:!0,message:"请输入登录名称!"}]},checkUserPwd:{rules:[{required:!0,message:"请输入密码!"}]},checkMethod:{rules:[{required:!0,message:"请选择!"}]}},tableData:[],queryParam:{formInstId:"",task2InstId:""},checkQueryParam:{checkUserName:"",checkUserPwd:"",itemIds:"",checkResult:1,checkDesc:"",checkMethod:null,checkTime:void 0},checkResult:!0}},methods:{findList:function(){var e=h(d().m((function e(t,a){var r=this;return d().w((function(e){while(1)switch(e.n){case 0:return a&&(this.queryParam.formInstId=a),t&&(this.queryParam.task2InstId=t),e.a(2,Object(s["s"])(this.queryParam).then((function(e){return e.success?r.tableData=e.result.sort((function(e,t){return e.sortNo-t.sortNo})):(r.$message.error(e.message),[])})))}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),findModelDetaile:function(e){var t=this;Object(l["lc"])({id:e.formObjId}).then((function(e){e.success?t.tableData=e.result.itemList.sort((function(e,t){return e.sortNo-t.sortNo})):t.$message.error(e.message)}))},setCheckRecordTime:function(){var e=this.$refs.listTable.getCheckboxRecords().map((function(e){return e.id}));e.length?this.$refs.workTimeModal.show(e):this.$message.warn("请选择作业项目")},openSetCheck:function(){var e=h(d().m((function e(){var t,a,r=this;return d().w((function(e){while(1)switch(e.n){case 0:return e.n=1,this.checkTaskCanSubmit(1);case 1:if(t=e.v,t.success){e.n=2;break}return this.$message.warn("".concat(t.formsName,"未完成，请检查！")),this.tabFormKey=this.taskFormsList.findIndex((function(e){return e==t.checkFomrs[0]})),this.$emit("taskFormNoWork",this.tabFormKey),e.a(2);case 2:a=this.$refs.listTable.getCheckboxRecords().map((function(e){return e.id})),a.length?(this.visible=!0,this.checkQueryParam.checkUserName="",this.checkQueryParam.checkUserPwd="",this.checkQueryParam.itemIds=a.join(","),this.checkQueryParam.checkResult=1,this.checkQueryParam.checkDesc="",this.checkQueryParam.type=null,this.isIgnore=!1,this.resultCheck=!0,this.$nextTick((function(){r.form.getFieldDecorator("resultDesc"),r.form.setFieldsValue({checkUserName:r.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~",checkDesc:"",type:null})}))):this.$message.warn("请选择作业项目");case 3:return e.a(2)}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleOk:function(){var e=this;this.form.validateFields((function(t,a){t||(Object.assign(e.checkQueryParam,a),e.checkQueryParam.checkResult=e.checkResult?1:0,e.checkQueryParam.checkTime?e.checkQueryParam.checkTime=u()(e.checkQueryParam.checkTime).format("YYYY-MM-DD HH:mm:ss"):e.checkQueryParam.checkTime=null,Object(s["Z"])(e.checkQueryParam).then((function(t){t.success?(e.$message.success("保存成功"),e.visible=!1,e.findList(),e.$emit("checkEnd")):e.$message.error(t.message)})))}))},handleCancel:function(){this.visible=!1},useCurrentUser:function(){var e=this;this.$nextTick((function(){e.form.setFieldsValue({checkUserName:e.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~"})}))},openRectifyModal:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords().map((function(e){return e.content}));t.length?Object(l["Nb"])({moduleCode:"JDXZG"}).then((function(a){a.success?(e.$refs.modalForm.addByRow({orderId:e.selectTask.orderId,orderName:e.workOrderInfo.orderName,depotId:e.workOrderInfo.depotId,orderTaskId:e.selectTask.id,remark:t.join(","),rectifyNo:a.result,groupId:e.workOrderInfo.groupId,lineId:e.workOrderInfo.lineId,lineName:e.workOrderInfo.lineName,trainNo:e.workOrderInfo.trainNo,groupName:e.workOrderInfo.groupName,status:"0"}),e.$refs.modalForm.title="新增"):e.$message.error(a.message)})):this.$message.warn("请选择作业项目")},onIgnoreChange:function(){var e=this;this.$nextTick((function(){e.form.resetFields("resultDesc")}))},checkTaskCanSubmit:function(){var e=h(d().m((function e(){var t,a,r,o=this,i=arguments;return d().w((function(e){while(1)switch(e.n){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:1,!0,a={success:!0,forms:[],records:[],checkFomrs:[]},r=[],0===this.selectTask.outTask&&(1===this.selectTask.taskType||3===this.selectTask.taskType||4===this.selectTask.taskType||5===this.selectTask.taskType)){e.n=1;break}return e.a(2,a);case 1:return this.taskFormsList.forEach((function(e){3===e.instType&&1===t&&r.push(Object(s["R"])({task2InstId:e.id,formInstId:e.formInstId,needCategory:!1,needChecks:!0,orderTaskId:o.selectTask.id}).then((function(e){return e.success&&e.result?(a.forms.push(e.result),e.result.detailList):(o.$message.error("获取表单作业明细失败"),[])}))),4===e.instType&&2===t&&r.push(Object(s["s"])({task2InstId:e.id,formInstId:e.formInstId}).then((function(e){return a.forms.push(e.element),e.success&&e.result?e.result:(o.$message.error("获取表单作业明细失败"),[])})))})),e.a(2,Promise.all(r).then((function(e){return e.forEach((function(e){if(1===t){for(var r=0;r<e.length;r++){var i=e[r];i.isIgnore&&1===i.isIgnore||i.selfCheck&&i.monitorCheck&&i.guarderCheck||(a.success=!1,!1,a.records.push(i))}if(a.forms.length>0){var n=[];a.records.forEach((function(e){n.find((function(t){return t.formInstId===e.workRecordId}))||n.push(o.taskFormsList.find((function(t){return t.formInstId===e.workRecordId})))})),a.checkFomrs=n,a.formsName=n.map((function(e){return"《".concat(e.formName,"》")})).toString()}}if(2===t){for(var s=0;s<e.length;s++){var l=e[s];l.checkUserId&&l.workTime||(a.success=!1,!1,a.records.push(l))}if(a.records.length>0){var c=[];a.records.forEach((function(e){c.find((function(t){return t.formInstId===e.checkId}))||c.push(o.taskFormsList.find((function(t){return t.formInstId===e.checkId})))})),a.checkFomrs=c,a.formsName=c.map((function(e){return"《".concat(e.formName,"》")})).toString()}}})),a})))}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getIDRecords:function(){return this.$refs.listTable.getCheckboxRecords().map((function(e){return e.id})).toString()}}},g=p,b=a("2877"),v=Object(b["a"])(g,r,o,!1,null,null,null);t["default"]=v.exports},"412f":function(e,t,a){},"41ca":function(e,t,a){"use strict";a("ae84")},4227:function(e,t,a){},4677:function(e,t,a){"use strict";a("412f")},"51c5":function(e,t,a){"use strict";a("e9d9")},"51cf":function(e,t,a){},5315:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("j-modal",{attrs:{title:e.title,centered:"",width:1100,visible:e.visible,confirmLoading:e.confirmLoading,fullscreen:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("div",{staticStyle:{width:"100%",overflow:"hidden"}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:23,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"任务名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["title",e.validatorRules.title],expression:"['title', validatorRules.title]",modifiers:{trim:!0}}],attrs:{allowClear:"",placeholder:"请输入"}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"编码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["rectifyNo",e.validatorRules.rectifyNo],expression:"['rectifyNo', validatorRules.rectifyNo]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改类型"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["rectifyType",e.validatorRules.rectifyType],expression:"['rectifyType', validatorRules.rectifyType]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_work_rectify_type"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"下发日期",width:"40"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["sendDate",e.validatorRules.sendDate],expression:"['sendDate', validatorRules.sendDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"责任班组"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["groupId",e.validatorRules.groupId],expression:"['groupId', validatorRules.groupId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictGroupStr},on:{change:e.changeGroup}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改状态"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["status",e.validatorRules.status],expression:"['status', validatorRules.status]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_work_rectify_status"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆段"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["depotId",e.validatorRules.depotId],expression:"['depotId', validatorRules.depotId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_mtr_depot,name,id"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路"}},[t("line-select-list",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId",e.validatorRules.lineId],expression:"['lineId', validatorRules.lineId]"}],on:{change:e.lineIdChange}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属车辆"}},[t("j-dict-select-seach-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["trainNo",e.validatorRules.trainNo],expression:"['trainNo', validatorRules.trainNo]"}],attrs:{triggerChange:"",dictCode:e.dictTrainStr}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"关联工单"}},[t("span",{on:{click:e.openOrderModel}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderName",e.validatorRules.orderName],expression:"['orderName', validatorRules.orderName]",modifiers:{trim:!0}}],ref:"myOrderSelect",attrs:{"allow-clear":"",placeholder:"请选择工单",open:!1,showArrow:!0},on:{change:e.orderNameChange}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改工位"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workstationId",e.validatorRules.workstationId],expression:"['workstationId', validatorRules.workstationId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictCodeStr}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改工序"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderTaskId",e.validatorRules.orderTaskId],expression:"['orderTaskId', validatorRules.orderTaskId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictCodeStrOrder}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:23,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"备注说明"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["remark",e.validatorRules.remark],expression:"['remark', validatorRules.remark]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入"}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:23,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"附件"}},[t("DocUpload",{ref:"upload",attrs:{"default-file-list":e.defaultFileList,"show-upload":!1,isFileEmpty:!0},on:{setBforeUploadStatus:e.setBforeUploadStatus,uploaded:e.successUploadFile,removed:e.onRemoveFile,uploadFail:e.uploadFail,setUpLoadingEndStatus:e.setUpLoadingEndStatus}})],1)],1)],1),t("a-divider",{staticStyle:{"font-size":"14px"},attrs:{orientation:"left"}},[e._v("已上传列表")]),t("vxe-table",{staticStyle:{"margin-top":"12px"},attrs:{border:"",data:e.annexList,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"}}},[t("div",{}),t("vxe-table-column",{attrs:{type:"seq",title:"序号",width:"50px","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"title",title:"文件名","header-align":"left",align:"left"}}),t("vxe-table-column",{attrs:{title:"操作",width:"160px","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row,o=a.rowIndex;return[t("a",{staticStyle:{"margin-right":"12px"},on:{click:function(t){return t.stopPropagation(),e.handleSeeing(r)}}},[e._v("查看")]),t("a",{on:{click:function(t){return t.stopPropagation(),e.handleDelete(r,o)}}},[e._v("删除")])]}}])})],1),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}})],1)],1)]),t("user-list",{ref:"UserModalForm",attrs:{multiple:!0},on:{ok:e.addTarget}}),t("work-order-select",{ref:"orderSelect",attrs:{"order-status":[2]},on:{ok:e.onSelectOrder}})],1)},o=[],i=a("b245"),n=a("c1df"),s=a.n(n),l=a("b7b4"),c=a("8fad"),u=a("ca00"),d=a("5371"),f=a("353a"),m=a("5633"),h=a("673e");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return g(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(g(t={},r,(function(){return this})),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,g(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,g(d,"constructor",c),g(c,"constructor",l),l.displayName="GeneratorFunction",g(c,o,"GeneratorFunction"),g(d),g(d,o,"Generator"),g(d,r,(function(){return this})),g(d,"toString",(function(){return"[object Generator]"})),(p=function(){return{w:i,m:f}})()}function g(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}g=function(e,t,a,r){function i(t,a){g(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},g(e,t,a,r)}function b(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function v(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){b(i,r,o,n,s,"next",e)}function s(e){b(i,r,o,n,s,"throw",e)}n(void 0)}))}}var y={name:"RectifyModal",props:{defaultFileList:{type:Array,default:function(){return[]}}},components:{UserList:i["default"],DocUpload:d["default"],DocPreviewModal:f["default"],LineSelectList:m["default"],WorkOrderSelect:h["default"]},data:function(){return{dictTrainStr:"",dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",fileList:[],annexList:[],rectifyId:"",filePath:"",fileName:"",status:!1,uploading:!1,dictCodeStr:"bu_mtr_workstation,name,id",dictCodeStrOrder:"",title:"整改项信息",visible:!1,model:{},saveFlag:!0,labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:13}},labelCol1:{xs:{span:24},sm:{span:2}},wrapperCol1:{xs:{span:24},sm:{span:22}},labelCol2:{xs:{span:24},sm:{span:2}},wrapperCol2:{xs:{span:24},sm:{span:19}},dutyUsername:"",dutyUserId:"",isClose:!1,confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{rectifyNo:{rules:[{required:!0,message:"请输入编号!"},{max:32,message:"输入长度不能超过32字符!"}]},rectifyType:{rules:[{required:!0,message:"请选择整改类型!"}]},orderName:{rules:[]},groupId:{rules:[{required:!0,message:"请选择责任班组!"}]},workstationId:{rules:[]},sendDate:{rules:[{required:!0,message:"请选择下发日期!"}]},status:{rules:[{required:!0,message:"请选择整改状态!"}]},lineId:{rules:[{required:!0,message:"请选择线路!"}]},trainNo:{rules:[{required:!0,message:"请选择车辆!"}]},depotId:{rules:[]},title:{rules:[{required:!0,message:"请输入整改标题!"},{max:32,message:"输入长度不能超过32字符!"}]},remark:{rules:[{max:255,message:"输入长度不能超过255字符!"}]},orderTaskId:{rules:[]}},workOrderId:"",rectifyNo:""}},created:function(){},methods:{orderNameChange:function(e){e||(this.workOrderId="",this.form.setFieldsValue({orderTaskId:""}),this.changeOrder())},lineIdChange:function(e){this.form.setFieldsValue({trainNo:""}),this.dictTrainStr=e?"bu_train_info,train_no,train_no,line_id="+e:""},openOrderModel:function(){this.$refs.orderSelect.showModal()},onSelectOrder:function(e){Object(u["e"])(e)||(this.form.setFieldsValue({orderName:e[0].orderName}),this.workOrderId=e[0].id,this.changeOrder(e[0].id))},changeGroup:function(e){this.dictCodeStr=e?"bu_mtr_workstation,name,id,id in (select workstation_id from bu_group_workstation where group_id = '"+e+"')":"bu_mtr_workstation,name,id"},changeOrder:function(e){this.dictCodeStrOrder=e?"bu_work_order_task,task_name,id,order_id='"+e+"'":""},changeClose:function(e){this.isClose=e},add:function(){var e=v(p().m((function e(t,a,r,o){return p().w((function(e){while(1)switch(e.n){case 0:return e.n=1,this.getRectifyNo();case 1:t&&this.changeOrder(t),this.lineIdChange(),this.edit({orderId:t,orderTaskId:a,remark:r,rectifyNo:this.rectifyNo});case 2:return e.a(2)}}),e,this)})));function t(t,a,r,o){return e.apply(this,arguments)}return t}(),getRectifyNo:function(){var e=v(p().m((function e(){var t=this;return p().w((function(e){while(1)switch(e.n){case 0:return e.n=1,Object(l["u"])().then((function(e){t.rectifyNo=e.result}));case 1:return e.a(2)}}),e)})));function t(){return e.apply(this,arguments)}return t}(),addByRow:function(e){e.orderId&&(this.workOrderId=e.orderId,this.changeOrder(e.orderId)),this.edit(e)},edit:function(e){var t=this;this.confirmLoading=!1,e.id?(this.isClose=!(!e["close"]||1!=e["close"]),this.workOrderId=e.orderId,this.changeOrder(this.workOrderId),null!=e.annexList&&e.annexList.length>0&&(this.annexList=e.annexList)):this.isClose=!1,this.dutyUserId=e.dutyUserId||"",this.form.resetFields(),this.model=Object.assign({},e),this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue({rectifyNo:t.model.rectifyNo,rectifyType:t.model.rectifyType,groupId:t.model.groupId,workstationId:t.model.workstationId,lineId:t.model.lineId,status:t.model.status,sendDate:s()(t.model.sendDate||new Date,"YYYY-MM-DD"),depotId:t.model.depotId,title:t.model.title,remark:t.model.remark,orderTaskId:t.model.orderTaskId,orderName:t.model.orderName}),t.lineIdChange(t.model.lineId),t.form.setFieldsValue({trainNo:t.model.trainNo})}))},openuserModal:function(){this.$refs.UserModalForm.showModal(),this.$refs.myuserSelect.blur()},addTarget:function(e){e.length&&(this.dutyUsername=e[0].realname,this.dutyUserId=e[0].id),this.form.setFieldsValue({dutyUserName:this.dutyUsername})},successUploadFile:function(e){var t=this;!e||e.length<1||(e.map((function(e){Object.assign(e,{id:Object(u["p"])()})})),Object(c["d"])(e).then((function(a){a.success&&e.map((function(e){t.annexList.push({address:e.savepath,id:e.id,title:e.name,rectifyId:t.rectifyId})}))})))},uploadFail:function(e){this.confirmLoading=!1},onRemoveFile:function(e){},beginUpload:function(){this.confirmLoading=!0,this.$refs.upload.beginUpload()},setBforeUploadStatus:function(e){this.saveFlag=e},setUpLoadingEndStatus:function(e){this.saveFlag=e},handlePrivilege:function(){var e=v(p().m((function e(t,a){var r,o=this;return p().w((function(e){while(1)switch(e.n){case 0:return r={id:t,operation:a},e.n=1,Object(c["xc"])(r).then((function(e){o.status=e.result}));case 1:return e.a(2)}}),e)})));function t(t,a){return e.apply(this,arguments)}return t}(),handleSeeing:function(){var e=v(p().m((function e(t){return p().w((function(e){while(1)switch(e.n){case 0:return e.n=1,this.handlePrivilege(t.id,2);case 1:this.status?(this.fileName=t.title,this.$refs.docPreview.handleFilePath(t.address)):this.$message.error("您没有权限!");case 2:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleDelete:function(){var e=v(p().m((function e(t,a){var r;return p().w((function(e){while(1)switch(e.n){case 0:r=this,r.$confirm({title:"提示",content:"确定删除该条附件吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){r.annexList.splice(a,1)},onCancel:function(){}});case 1:return e.a(2)}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,r){if(!a){t.confirmLoading=!0;var o=Object.assign(t.model,r,{sendDate:s()(r.sendDate).format("YYYY-MM-DD HH:mm:ss"),orderId:e.workOrderId});t.model.id?t.rectifyId=t.model.id:t.rectifyId=null,e.beginUpload();var i=null;clearInterval(i),i=setInterval((function(){var e;t.saveFlag&&(o["annexList"]=t.annexList,o["id"]=t.rectifyId,o["dutyUserId"]=t.dutyUserId,e=t.model.id?Object(l["l"])(o):Object(l["b"])(o),e.then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok")):t.$message.warning(e.message)})).finally((function(){clearInterval(i),t.confirmLoading=!1,t.close()})))}),1e3)}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.fileList=[],this.annexList=[],this.visible=!1}}},k=y,w=a("2877"),I=Object(w["a"])(k,r,o,!1,null,"2bfc6fa6",null);t["default"]=I.exports},5371:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-row",{staticStyle:{"padding-bottom":"10px"},attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-upload",{attrs:{multiple:!0,"file-list":e.fileList,remove:e.handleRemove,"before-upload":e.beforeUpload,"default-file-list":e.defaultFileList}},[t("a-button",{staticClass:"border-primary-4"},[e._v("添加文件")])],1)],1)],1),t("a-row",[e.showUpload?t("a-col",{attrs:{span:5}},[t("a-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.beginUpload}},[e._v("上传至服务器")])],1):e._e(),t("a-col",{staticStyle:{color:"#cccccc"},attrs:{span:19}},[e._v("一次最多上传"+e._s(e.fileSize)+"个文件，且单个文件不能超过10MB")])],1)],1)},o=[],i=a("e2aa");function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var n=r&&r.prototype instanceof c?r:c,u=Object.create(n.prototype);return s(u,"_invoke",function(a,r,o){var i,n,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,n=0,s=e,f.n=a,l}};function m(a,r){for(n=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(s=i[(n=i[4])?5:(n=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(n=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,n=0))}if(o||a>1)return l;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),n=u,s=h;(t=n<2?e:s)||!d;){i||(n?n<3?(n>1&&(f.n=-1),m(n,s)):f.n=s:f.v=s);try{if(c=2,i){if(n||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,n<2&&(n=0)}else 1===n&&(t=i.return)&&t.call(i),n<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),n=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==l)break}catch(t){i=e,n=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),u}var l={};function c(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(s(t={},r,(function(){return this})),t),m=d.prototype=c.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,s(m,"constructor",d),s(d,"constructor",u),u.displayName="GeneratorFunction",s(d,o,"GeneratorFunction"),s(m),s(m,o,"Generator"),s(m,r,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),(n=function(){return{w:i,m:h}})()}function s(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}s=function(e,t,a,r){function i(t,a){s(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},s(e,t,a,r)}function l(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function c(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){l(i,r,o,n,s,"next",e)}function s(e){l(i,r,o,n,s,"throw",e)}n(void 0)}))}}var u={name:"DocUpload",props:{path:{type:String,default:""},fileSize:{type:Number,default:5},defaultFileList:{type:Array,default:[]},showUpload:{type:Boolean,default:!0},isFileEmpty:{type:Boolean,default:!1}},watch:{uploadFiles:{immediate:!1,handler:function(){var e=c(n().m((function e(t){return n().w((function(e){while(1)switch(e.n){case 0:if(t.length!==this.fileList.length){e.n=1;break}return e.n=1,this.$emit("uploaded",this.uploadFiles);case 1:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},data:function(){return{fileList:[],uploadFiles:[],isLoading:!1}},methods:{beforeUpload:function(e){var t=e.size/1024/1024<10;return t?(this.fileList.push(e),this.$emit("fileNum",this.fileList.length),this.$emit("setBforeUploadStatus",!1),!1):(this.$message.error("文件不得大于10MB!"),!1)},handleRemove:function(e){var t=this.fileList.indexOf(e),a=this.fileList.slice();a.splice(t,1),this.fileList=a,this.$emit("fileNum",this.fileList.length),this.$emit("removed",e)},beginUpload:function(){var e=this;return new Promise((function(t,a){var r=e.fileList,o=e.fileSize;if(!e.isFileEmpty&&0===r.length)return e.$emit("upLoadingEnd"),e.$message.warning("请选择要上传的文件"),void a();r.length>o?(e.$message.error("一次最多上传"+o+"个文件!"),a()):e.customRequest().then((function(){t()})).catch((function(e){a()}))}))},customRequest:function(){var e=this,t=this.fileList;if(t.length<1)return this.$emit("uploaded",[]),this.$emit("upLoadingEnd"),Promise.resolve();this.isLoading=!0;var a=[];return t.forEach((function(t){var r=new FormData;r.append("file",t),a.push(e.saveFile(r,t))})),Promise.all(a).finally((function(){e.isLoading=!1,e.$emit("upLoadingEnd")}))},saveFile:function(){var e=c(n().m((function e(t,a){var r=this;return n().w((function(e){while(1)switch(e.n){case 0:return e.a(2,Object(i["d"])(t,this.path).then((function(e){e.success?(r.getUploadData(a,e),r.$emit("setUpLoadingEndStatus",!0)):(r.$message.error(e.message),r.$emit("uploadFail",a))})))}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),getUploadData:function(e,t){var a=this.uploadFiles,r={name:e.name,type:this.handleFileName(e),fileSize:Math.round(e.size/1024),savepath:t.result};a.push(r)},handleFileName:function(e){var t=e.name.lastIndexOf("."),a=e.name.length,r=e.name.substring(t+1,a);return r}}},d=u,f=(a("9615"),a("2877")),m=Object(f["a"])(d,r,o,!1,null,"69990be1",null);t["default"]=m.exports},"53e7":function(e,t,a){"use strict";a("d5c3")},"542f":function(e,t,a){"use strict";a("1ea4")},"5bbd":function(e,t,a){},"5f10":function(e,t,a){},6034:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障原因选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",bodyStyle:{height:"80vh"},destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"请输入故障原因编码或者描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"所属分类"}},[t("a-input",{ref:"categoryIdSelect",attrs:{readonly:"",allowClear:"",placeholder:"请选择所属分类"},on:{click:function(t){return e.openSelectTypeModal(1)}},model:{value:e.categoryCode,callback:function(t){e.categoryCode=t},expression:"categoryCode"}},[t("a-icon",{attrs:{slot:"suffix",type:"ellipsis"},slot:"suffix"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"所属故障代码"}},[t("a-input",{ref:"faultCodeIdSelect",attrs:{readonly:"",allowClear:"",placeholder:"请选择所属故障代码"},on:{focus:function(t){return e.openSelectTypeModal(2)}},model:{value:e.faultCode,callback:function(t){e.faultCode=t},expression:"faultCode"}},[t("a-icon",{attrs:{slot:"suffix",type:"ellipsis"},slot:"suffix"})],1)],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:"序号"}}),t("vxe-table-column",{attrs:{field:"reasonCode",title:"故障原因代码",width:"150"}}),t("vxe-table-column",{attrs:{field:"reasonDesc",title:"故障原因描述",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("fault-category-list",{ref:"categorySelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-code-list",{ref:"codeSelect",attrs:{multiple:!1},on:{ok:e.addCodeTarget}})],1)},o=[],i=a("b47d"),n=a("a396"),s=a("0e7b"),l=a("ca00"),c={name:"FaultReasonList",components:{FaultCategoryList:n["default"],FaultCodeList:s["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{categoryCode:"",faultCode:"",queryParam:{searchText:"",categoryId:"",faultCodeId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},watch:{categoryCode:function(e,t){e||(this.queryParam.categoryId=null)},faultCode:function(e,t){e||(this.queryParam.faultCodeId=null)}},methods:{showModal:function(e){this.visible=!0,this.queryParam.faultCodeId=e,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["R"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.categoryCode="",this.faultCode="",this.queryParam.searchText="",this.queryParam.categoryId="",this.queryParam.faultCodeId=""},openSelectTypeModal:function(e){switch(e){case 1:this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur();break;case 2:this.$refs.codeSelect.showModal(),this.$refs.faultCodeIdSelect.blur();break;default:break}},addCategoryTarget:function(e){Object(l["e"])(e)?this.queryParam.categoryId="":(this.queryParam.categoryId=e[0].id,this.categoryCode=e[0].categoryCode)},addCodeTarget:function(e){Object(l["e"])(e)?this.queryParam.faultCodeId="":(this.queryParam.faultCodeId=e[0].id,this.faultCode=e[0].fltCode)}}},u=c,d=(a("ef2b0"),a("2877")),f=Object(d["a"])(u,r,o,!1,null,"ba47c754",null);t["default"]=f.exports},"607e":function(e,t,a){"use strict";a("c95b")},"60e2":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",title:"列计划选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"70vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"计划名称"}},[t("a-input",{attrs:{placeholder:"请输入计划名称或列车序号"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"线路"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId"],expression:"['lineId']"}],staticStyle:{width:"100%"},attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:4}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(100% - 55px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100% - 55px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"manual",mode:"row"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"planName",title:"计划名称",align:"left"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"所属线路",align:"left"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",align:"left"}}),t("vxe-table-column",{attrs:{field:"startDate",title:"开始日期",align:"left"}}),t("vxe-table-column",{attrs:{field:"finishDate",title:"完成日期",align:"left"}}),t("vxe-table-column",{attrs:{field:"progressStatus_dictText",title:"进度状态",align:"left"}}),t("vxe-table-column",{attrs:{field:"wfStatus",title:"审批状态",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("b9c3"),n={name:"TrainPlanList",props:{multiple:{type:Boolean,default:!1},trainNo:{type:String,default:""},progressStatusList:{type:Array,default:function(){return[]}}},data:function(){return{queryParam:{searchText:"",lineId:"",trainNo:"",status:"2",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,stationData:[]}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,this.progressStatusList.length&&(this.queryParam.progressStatusList=this.progressStatusList),this.trainNo&&(this.queryParam.trainNo=this.trainNo),Object(i["H"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=n,l=a("2877"),c=Object(l["a"])(s,r,o,!1,null,null,null);t["default"]=c.exports},"623c":function(e,t,a){"use strict";a("4227")},"673e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",title:"工单选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",bodyStyle:{height:"70vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"工单搜索"}},[t("a-input",{attrs:{placeholder:"请输入工单名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工单类型"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择工单类型",dictCode:"bu_order_type"},model:{value:e.queryParam.orderType,callback:function(t){e.$set(e.queryParam,"orderType",t)},expression:"queryParam.orderType"}})],1)],1),t("a-col",{attrs:{md:9,sm:24}},[t("a-form-item",{attrs:{label:"工单状态"}},[t("div",{staticClass:"autoWidth"},[t("j-multi-select-tag",{attrs:{placeholder:"请选择工单状态",dictCode:"bu_order_status"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)])],1),t("a-col",{attrs:{md:3,sm:24}},[t("a-form-item",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(70vh - 172px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 172px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"manual",mode:"row"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"作业车号",width:"100"}}),t("vxe-table-column",{attrs:{field:"groupName",title:"所属班组",width:"100"}}),t("vxe-table-column",{attrs:{field:"orderCode",title:"工单编号",width:"150"}}),t("vxe-table-column",{attrs:{field:"orderName",title:"工单名称",align:"left","min-width":"150"}}),t("vxe-table-column",{attrs:{field:"startTime",title:"计划开始",width:"150"}}),t("vxe-table-column",{attrs:{field:"finishTime",title:"计划结束",width:"150"}}),t("vxe-table-column",{attrs:{field:"orderStatus_dictText",title:"工单状态",width:"150"}}),t("vxe-table-column",{attrs:{field:"orderType_dictText",title:"工单类型",width:"150"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("f680"),n=a("b9c3"),s=a("c1df"),l=a.n(s),c={name:"WorkOrderSelect",components:{JMultiSelectTag:i["default"]},props:{multiple:{type:Boolean,default:!1},workGroupId:{type:String,default:""},planId:{type:String,default:""},orderType:{type:Number,default:null},orderStatus:{type:Array,default:function(){return[3,4,8]}},selectStatus:{type:Array,default:function(){return[]}}},data:function(){return{dateRange:[l()(new Date,"YYYY-MM-DD"),l()(new Date,"YYYY-MM-DD")],queryParam:{searchText:"",startDate:"",endDate:"",orderType:"",status:this.orderStatus.join(","),pageNo:1,pageSize:10,workGroupId:this.workGroupId,planId:this.planId},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,stationData:[]}},methods:{checkRadioMethod:function(e){var t=e.row;return!(this.selectStatus&&this.selectStatus.length>0)||this.selectStatus.indexOf(t.orderStatus)>-1},onDateChange:function(){this.dateRange[0]?this.queryParam.startDate=this.dateRange[0].format("YYYY-MM-DD"):this.queryParam.startDate=null,this.dateRange[1]?this.queryParam.endDate=this.dateRange[1].format("YYYY-MM-DD"):this.queryParam.endDate=null},showModal:function(){this.visible=!0,this.queryParam.planId=this.planId,this.queryParam.workGroupId=this.workGroupId,this.queryParam.orderType=this.orderType,this.findList()},findList:function(){var e=this;this.loading=!0,Object(n["T"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},u=c,d=(a("607e"),a("2877")),f=Object(d["a"])(u,r,o,!1,null,null,null);t["default"]=f.exports},6971:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:e.files,"edit-rules":e.validRules,"keep-source":!0,"show-overflow":"ellipsis","checkbox-config":{trigger:"row",highlight:e.getButtonShow(),range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.files=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),e.getButtonShow()?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e._e(),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input",enabled:!e.selectTask},width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.taskName)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:!0},on:{change:e.taskSelectChange},model:{value:r.taskId,callback:function(t){e.$set(r,"taskId",t)},expression:"row.taskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,1322267700)}):e._e(),t("vxe-table-column",{attrs:{field:"name",title:"文件名称",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-upload",{staticClass:"attachedUploadBtn",attrs:{"before-upload":e.beforeLedUpload,multiple:!1,"file-list":[],showUploadList:!1},on:{blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("a-select",{ref:"toolSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件",open:!1},model:{value:r.name,callback:function(t){e.$set(r,"name",t)},expression:"row.name"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)]}}])}),t("vxe-table-column",{attrs:{field:"type",title:"扩展名",width:"150px"}}),t("vxe-table-column",{attrs:{field:"fileSize",title:"文件大小(KB)",width:"150px"}}),t("vxe-table-column",{attrs:{field:"uid",title:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[r&&!e.$refs.listTable.isActiveByRow(r)?t("span",[t("a",{on:{click:function(t){return t.stopPropagation(),e.previewImage(r)}}},[e._v("查看")]),t("a",{staticStyle:{"margin-left":"6px"},on:{click:function(t){return t.stopPropagation(),e.handleDownload(r)}}},[e._v("下载")])]):t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]}}])})],1)],1),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.previewFileName}})],1)},o=[],i=a("e2aa"),n=a("b47d"),s=a("353a"),l=a("ca00");function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return u(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(u(t={},r,(function(){return this})),t),m=d.prototype=s.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=d,u(m,"constructor",d),u(d,"constructor",l),l.displayName="GeneratorFunction",u(d,o,"GeneratorFunction"),u(m),u(m,o,"Generator"),u(m,r,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),(c=function(){return{w:i,m:h}})()}function u(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}u=function(e,t,a,r){function i(t,a){u(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},u(e,t,a,r)}function d(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function f(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){d(i,r,o,n,s,"next",e)}function s(e){d(i,r,o,n,s,"throw",e)}n(void 0)}))}}var m={name:"TaskAttached",components:{DocPreviewModal:s["default"]},props:{files:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},workOrderId:{type:String,default:""},operator:{type:Number,default:0}},data:function(){return{curEditMode:1,curRow:null,previewFileName:"",validRules:{name:[{required:!0,message:"请选择文件",trigger:"manual"}]}}},methods:{getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||4===this.operator)},handleAdd:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:Object(l["p"])(),fileId:"",taskId:"",workOrderId:this.workOrderId,name:"",type:"",savepath:"",fileSize:""};this.selectTask?Object.assign(t,{taskId:this.selectTask.id,taskName:this.selectTask.taskName}):this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName,taskId:this.tasks[0].id}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"name")}))}},handleDel:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){var t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var a=Promise.resolve();t.map((function(t){a.then((function(){return Object(i["a"])(t.savepath).then((function(a){if(a.success){if(Object(l["e"])(t.id))return e.files.splice(e.files.findIndex((function(e){return e.savepath===t.savepath})),1);var r=new FormData;return r.append("ids",t.id),Object(n["A"])(r).then((function(a){a.success?(e.files.splice(e.files.findIndex((function(e){return e.savepath===t.savepath})),1),e.$emit("removeFile",t)):e.$message.error("文件删除失败")}))}return e.$message.error("文件删除失败")}))}))}))}}):this.$message.error("尚未选中任何数据!")}},handleDownload:function(){var e=f(c().m((function e(t){return c().w((function(e){while(1)switch(e.n){case 0:Object(i["b"])(t.savepath);case 1:return e.a(2)}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.files.map((function(a,r){e.id===a.id&&t.files.splice(r,1)}))},beforeLedUpload:function(e){var t=this;if(e.size/1024/1024>10)return this.$message.error("文件不得大于10MB!"),!1;var a=/([^\\/]+)\.([^\\/]+)/i;a.test(e.name);var r=RegExp.$1,o=RegExp.$2,n=new FormData,s=new File([e],"".concat(r).concat(this.$moment().format("YYYYMMDDhhmmss"),".").concat(o),{type:e.type});n.append("file",s);var l=this.$message.loading("文件上传中···",0);return Object(i["d"])(n,"/WorkOrder").then((function(a){t.$refs.listTable.getActiveRecord().row.name=r,t.$refs.listTable.getActiveRecord().row.type=o,t.$refs.listTable.getActiveRecord().row.savepath=a.result,t.$refs.listTable.getActiveRecord().row.fileSize=(e.size/1024).toFixed(0),l()})).catch((function(e){t.$message.error("文件上传失败，请联系管理员"),l()})),!1},previewImage:function(e){return this.previewFileName=e.name,this.$refs.docPreview.handleFilePath(e.savepath),!1},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=e?this.tasks[t.key].taskName:""},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else t.files.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0,t.$emit("addFile",e)}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),this.$refs.listTable.remove(e),this.curEditMode=0},getTaskName:function(e){return this.selectTask?this.selectTask.taskName:this.tasks.find((function(t){return t.id===e.taskId}))?this.tasks.find((function(t){return t.id===e.taskId})).taskName:""},clearValidate:function(){this.$refs.listTable.clearValidate()}}},h=m,p=(a("53e7"),a("2877")),g=Object(p["a"])(h,r,o,!1,null,null,null);t["default"]=g.exports},"6e22":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("41b2"),o=s(r),i=a("b24f"),n=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l=/iPhone/i,c=/iPod/i,u=/iPad/i,d=/\bAndroid(?:.+)Mobile\b/i,f=/Android/i,m=/\bAndroid(?:.+)SD4930UR\b/i,h=/\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,p=/Windows Phone/i,g=/\bWindows(?:.+)ARM\b/i,b=/BlackBerry/i,v=/BB10/i,y=/Opera Mini/i,k=/\b(CriOS|Chrome)(?:.+)Mobile/i,w=/Mobile(?:.+)Firefox\b/i;function I(e,t){return e.test(t)}function T(e){var t=e||("undefined"!==typeof navigator?navigator.userAgent:""),a=t.split("[FBAN");if("undefined"!==typeof a[1]){var r=a,o=(0,n["default"])(r,1);t=o[0]}if(a=t.split("Twitter"),"undefined"!==typeof a[1]){var i=a,s=(0,n["default"])(i,1);t=s[0]}var T={apple:{phone:I(l,t)&&!I(p,t),ipod:I(c,t),tablet:!I(l,t)&&I(u,t)&&!I(p,t),device:(I(l,t)||I(c,t)||I(u,t))&&!I(p,t)},amazon:{phone:I(m,t),tablet:!I(m,t)&&I(h,t),device:I(m,t)||I(h,t)},android:{phone:!I(p,t)&&I(m,t)||!I(p,t)&&I(d,t),tablet:!I(p,t)&&!I(m,t)&&!I(d,t)&&(I(h,t)||I(f,t)),device:!I(p,t)&&(I(m,t)||I(h,t)||I(d,t)||I(f,t))||I(/\bokhttp\b/i,t)},windows:{phone:I(p,t),tablet:I(g,t),device:I(p,t)||I(g,t)},other:{blackberry:I(b,t),blackberry10:I(v,t),opera:I(y,t),firefox:I(w,t),chrome:I(k,t),device:I(b,t)||I(v,t)||I(y,t)||I(w,t)||I(k,t)},any:null,phone:null,tablet:null};return T.any=T.apple.device||T.android.device||T.windows.device||T.other.device,T.phone=T.apple.phone||T.android.phone||T.windows.phone,T.tablet=T.apple.tablet||T.android.tablet||T.windows.tablet,T}var x=(0,o["default"])({},T(),{isMobile:T});t["default"]=x},7068:function(e,t,a){"use strict";a("51cf")},7616:function(e,t,a){},"769e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",title:"厂商选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"请输入名称"},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"修程类型"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_repair_program,name,id"},model:{value:e.queryParam.repairProgramId,callback:function(t){e.$set(e.queryParam,"repairProgramId",t)},expression:"queryParam.repairProgramId"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"所属线路"}},[t("line-select-list",{model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_effective"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:4,sm:8}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)])],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"name",title:"厂商名称","min-width":"140","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"shortName",title:"厂商简称","min-width":"120"}}),t("vxe-table-column",{attrs:{field:"category_dictText",title:"厂商类别",width:"80"}}),t("vxe-table-column",{attrs:{field:"repairProgramName",title:"所属修程",width:"8%"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"所属线路",width:"8%"}}),t("vxe-table-column",{attrs:{field:"contactName",title:"联系人员",width:"80"}}),t("vxe-table-column",{attrs:{field:"contactPhone",title:"联系电话",width:"100","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"email",title:"邮箱",width:"100","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"address",title:"地址","min-width":"120","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"appraise",title:"评分",width:"80","header-align":"center",align:"right"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}}),t("vxe-table-column",{attrs:{field:"remarks",title:"备注","min-width":"120","header-align":"center",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("d214"),n=a("5633"),s={name:"SupplierList",components:{LineSelectList:n["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{queryParam:{category:null,name:"",objTypeId:"",status:null,lineId:"",repairProgramId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["eb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.queryParam.searchText=""}}},l=s,c=(a("cc0c"),a("2877")),u=Object(c["a"])(l,r,o,!1,null,"2c33e9dc",null);t["default"]=u.exports},"7b165":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:500,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"作业时间"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":{format:"HH:mm:ss",hideDisabledOptions:!0}},model:{value:e.workTime,callback:function(t){e.workTime=t},expression:"workTime"}})],1)],1)],1)],1)],1)],1)},o=[],i=a("c1df"),n=a.n(i),s=a("b9c3"),l={name:"WorkTimeModal",data:function(){return{value:1,title:"作业完成",labelText:"作业时间",visible:!1,labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:15}},confirmLoading:!1,form:this.$form.createForm(this),ids:"",workTime:void 0}},created:function(){},methods:{show:function(e){this.form.resetFields(),this.ids=e,this.visible=!0},handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,r){if(!a){t.confirmLoading=!0;var o=new FormData;o.append("itemIds",t.ids),t.workTime&&(t.workTime=n()(t.workTime).format("YYYY-MM-DD HH:mm:ss"),o.append("workTime",t.workTime)),Object(s["ab"])(o).then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok")):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1,t.close()})),e.visible=!1}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},c=l,u=a("2877"),d=Object(u["a"])(c,r,o,!1,null,"3f50fa8e",null);t["default"]=d.exports},"7ba1":function(e,t,a){"use strict";a("5bbd")},"815e":function(e,t,a){},"86a0":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{staticStyle:{"max-height":"100%"},attrs:{width:"80%",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"交接"}},[t("a-input",{attrs:{placeholder:"请输入部件名或者编号"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"所属线路"}},[t("line-select-list",{model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"车辆"}},[t("j-dict-select-seach-tag",{attrs:{placeholder:"请选择",dictCode:" bu_train_info,train_no,id"},model:{value:e.queryParam.trainId,callback:function(t){e.$set(e.queryParam,"trainId",t)},expression:"queryParam.trainId"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(100vh - 380px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 400px)"},attrs:{border:"","max-height":"90%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","radio-config":{trigger:"row"},"edit-config":{trigger:"row",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"线路",width:"150"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",width:"100"}}),t("vxe-table-column",{attrs:{field:"outinNo",title:"单号",width:"150"}}),t("vxe-table-column",{attrs:{field:"assetName",title:"委外部件"}}),t("vxe-table-column",{attrs:{field:"assetNo",title:"部件编号",width:"150"}}),t("vxe-table-column",{attrs:{field:"contractNo",title:"合同编号",width:"200"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])],1)},o=[],i=a("d214"),n=a("5633"),s={name:"OutinDetailSelect",components:{LineSelectList:n["default"]},props:{multiple:{type:Boolean,default:!0},billType:{type:Number,default:null}},data:function(){return{queryParam:{searchText:"",lineId:"",trainId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,this.queryParam.billType=this.billType,Object(i["P"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=s,c=a("2877"),u=Object(c["a"])(l,r,o,!1,null,null,null);t["default"]=u.exports},8973:function(e,t,a){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function n(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=l(e,"string");return"symbol"==r(t)?t:t+""}function l(e,t){if("object"!=r(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var c=function(){function e(){o(this,e)}return n(e,[{key:"joinDistributionInfo",value:function(e){!e||e.length<1||Array.from(e,(function(e){e.sourceLocationAndPalletName="",Array.from(e.assignDetailList,(function(t){var a="";a+="".concat(t.ebsWhCode,"=>").concat(t.ebsWhChildCode," | ").concat(t.amount),t.palletName&&(a+=" | "+t.amount),t.tradeNo&&(a+=" ｜ 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=a+" \n"}))}))}}])}();t["a"]=new c},9216:function(e,t,a){"use strict";a("260f")},9424:function(e,t,a){},"94c2d":function(e,t,a){},9527:function(e,t,a){},9615:function(e,t,a){"use strict";a("94c2d")},"9f49":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{class:{"na-footer-none":2===e.modeType},attrs:{title:"托盘选择",width:"80%",bodyStyle:{height:"70vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"托盘编码"}},[t("a-input",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"物资类型"}},[t("a-select",{ref:"materialSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"请选择物料",open:!1},on:{change:e.clearMaterialChange,dropdownVisibleChange:e.openMaterialSelectModal},model:{value:e.materialTypeName,callback:function(t){e.materialTypeName=t},expression:"materialTypeName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){t.stopPropagation(),e.queryParam.typeId=""}},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"使用状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_pallet_use_status"},model:{value:e.queryParam.useStatus,callback:function(t){e.$set(e.queryParam,"useStatus",t)},expression:"queryParam.useStatus"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"托盘状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_valid_status"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:4}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 110px)"},attrs:{id:"pallet_table_main"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto",data:e.tableData,"show-overflow":"tooltip","radio-config":{highlight:!0,trigger:"row"},"row-class-name":e.setRowClass},on:{"cell-click":e.onCurrentChange}},[1===e.modeType?t("vxe-table-column",{attrs:{type:"radio",width:"60px"}}):e._e(),t("vxe-table-column",{attrs:{field:"code",title:"托盘编码"}}),t("vxe-table-column",{attrs:{field:"name",title:"托盘名称"}}),t("vxe-table-column",{attrs:{field:"materialTypeNames",title:"物资类型","min-width":"100",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"size",title:"尺寸"}}),t("vxe-table-column",{attrs:{field:"texture",title:"材质"}}),t("vxe-table-column",{attrs:{field:"useStatus_dictText",title:"使用状态",width:"120"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注"}})],1)],1):e._e(),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.page.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}}),t("material-list",{ref:"materialForm",attrs:{multiple:!1},on:{ok:e.onSelectMaterial}})],1)},o=[],i=a("c54ca"),n=a("7164"),s={name:"PalletList",components:{MaterialList:n["default"]},props:{multiple:{type:Boolean,default:!1},modeType:{type:Number,default:1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,tableData:[],selectMaterialTypeId:"",materialTypeName:"",queryParam:{pageNo:1,pageSize:10,searchText:"",typeId:null,useStatus:null,status:null},page:{totalResult:3}}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0}))},created:function(){},methods:{showModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.visible=!0,this.selectMaterialTypeId=e,this.materialTypeName=t,this.queryParam.typeId=e,this.findList()},findList:function(){var e=this;Object(i["mb"])(this.queryParam).then((function(t){t.success&&(e.tableData=t.result.records,e.page.totalResult=t.result.total)}))},handleOk:function(){var e=this,t=this.$refs.listTable.getRadioRecord();t&&t.useStatus?this.$confirm({content:"该托盘正在使用中，确认继续选择该托盘？",okText:"确定",cancelText:"取消",onOk:function(){e.$emit("ok",t?[t]:[]),e.visible=!1}}):(this.$emit("ok",t?[t]:[]),this.visible=!1)},saveOk:function(){this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},close:function(){this.visible=!1},openMaterialSelectModal:function(e){e&&(this.$refs.materialForm.showModal(),this.$refs.materialSelect.blur())},clearMaterialChange:function(e){e||(this.queryParam.typeId=null,this.materialTypeName=null)},onSelectMaterial:function(e){e.length&&(this.queryParam.typeId=e[0].id,this.materialTypeName=e[0].name)},onCurrentChange:function(e){var t=e.row;e.$event;2===this.modeType&&(this.$emit("ok",[t]),this.visible=!1)},setRowClass:function(){return 2===this.modeType?"mode-type-choose":""}}},l=s,c=(a("b0c8"),a("2877")),u=Object(c["a"])(l,r,o,!1,null,null,null);t["default"]=u.exports},a396:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障分类选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"请输入故障分类编码或者描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:"序号"}}),t("vxe-table-column",{attrs:{field:"categoryCode",title:"故障分类编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"categoryDesc",title:"故障分类描述",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("b47d"),n={name:"FaultCategoryList",props:{multiple:{type:Boolean,default:!0}},data:function(){return{queryParam:{searchText:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["O"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.queryParam.searchText=""}}},s=n,l=(a("2a71"),a("2877")),c=Object(l["a"])(s,r,o,!1,null,"124b546c",null);t["default"]=c.exports},a4db:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:e.title,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"搜索"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"分类"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_tools_type",disabledArray:e.canSelectType},model:{value:e.queryParam.category1,callback:function(t){e.$set(e.queryParam,"category1",t)},expression:"queryParam.category1"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":e.onCellClick}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别",width:"150"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"150"}}),e.batch?t("vxe-table-column",{attrs:{field:"num",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}):e._e()],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("c54ca"),n={name:"ToolTypeSelect",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:function(){return[4,5,6]}},batch:{type:Boolean,default:!1}},data:function(){return{title:"工器具类型选择",queryParam:{type:"2",searchText:"",category1:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.category1=this.canSelectType[0]),this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["Cb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"num",1)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},checkRadioMethod:function(e){var t=e.row;return!this.canSelectType||-1!==this.canSelectType.indexOf(t.category1)},onCellClick:function(e){var t=e.row,a=e.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([t],!0)}}},s=n,l=(a("7ba1"),a("2877")),c=Object(l["a"])(s,r,o,!1,null,"df2d4508",null);t["default"]=c.exports},a6da:function(e,t,a){e.exports=a.p+"img/code.77bdebfa.png"},a6df:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:800,visible:e.visible,confirmLoading:e.confirmLoading,centered:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticStyle:{padding:"0px 20px"}},[t("a-form-model",{ref:"outPartForm",attrs:{model:e.modalInfo,rules:e.modalRules,"label-col":{span:5},"wrapper-col":{span:18}}},[t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"线路",prop:"lineId"}},[t("j-dict-select-tag",{attrs:{disabled:"",triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.onLineChange},model:{value:e.modalInfo.lineId,callback:function(t){e.$set(e.modalInfo,"lineId",t)},expression:"modalInfo.lineId"}})],1),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"车号",prop:"trainNo"}},[t("j-dict-select-seach-tag",{attrs:{disabled:"",triggerChange:!0,dictCode:e.dictTrainStr},model:{value:e.modalInfo.trainNo,callback:function(t){e.$set(e.modalInfo,"trainNo",t)},expression:"modalInfo.trainNo"}})],1),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"设备选择",prop:"turnoverAssetId"}},[t("div",{on:{click:e.selectAsset}},[t("a-select",{ref:"assetSelect",attrs:{placeholder:"请选择送修设备","allow-clear":"",open:!1,showArrow:!0},model:{value:e.modalInfo.assetName,callback:function(t){e.$set(e.modalInfo,"assetName",t)},expression:"modalInfo.assetName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"外观状态",prop:"facadeStatus"}},[t("a-select",{model:{value:e.modalInfo.facadeStatus,callback:function(t){e.$set(e.modalInfo,"facadeStatus",t)},expression:"modalInfo.facadeStatus"}},[t("a-select-option",{attrs:{value:"0"}},[e._v(" 无问题 ")]),t("a-select-option",{attrs:{value:"1"}},[e._v(" 有问题 ")])],1)],1),"1"===e.modalInfo.facadeStatus?t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"外观描述",prop:"facadeDesc"}},[t("a-input",{model:{value:e.modalInfo.facadeDesc,callback:function(t){e.$set(e.modalInfo,"facadeDesc",t)},expression:"modalInfo.facadeDesc"}})],1):e._e(),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"工装状态",prop:"mixtoolStatus"}},[t("a-select",{model:{value:e.modalInfo.mixtoolStatus,callback:function(t){e.$set(e.modalInfo,"mixtoolStatus",t)},expression:"modalInfo.mixtoolStatus"}},[t("a-select-option",{attrs:{value:"0"}},[e._v(" 无问题 ")]),t("a-select-option",{attrs:{value:"1"}},[e._v(" 有问题 ")])],1)],1),"1"===e.modalInfo.mixtoolStatus?t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"工装描述",prop:"mixtoolDesc"}},[t("a-input",{model:{value:e.modalInfo.mixtoolDesc,callback:function(t){e.$set(e.modalInfo,"mixtoolDesc",t)},expression:"modalInfo.mixtoolDesc"}})],1):e._e(),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"备注",prop:"remark"}},[t("a-textarea",{attrs:{"auto-size":{minRows:3,maxRows:6},placeholder:"请输入备注信息"},model:{value:e.modalInfo.remark,callback:function(t){e.$set(e.modalInfo,"remark",t)},expression:"modalInfo.remark"}})],1)],1)],1),t("out-asset-list",{ref:"assetSelectModal",on:{ok:e.onSelectAsset}})],1)},o=[],i=a("ca00"),n=a("a821"),s={name:"OutPartModal",components:{OutAssetList:n["default"]},props:{title:{type:String,default:"部件添加"},lineId:{type:String,default:""},trainNo:{type:String,default:""},existAssets:{type:Array,default:function(){return[]}}},data:function(){return{visible:!1,confirmLoading:!1,modalInfo:{turnoverAssetId:"",facadeStatus:"0",mixtoolStatus:"0",fault:"0",remark:""},modalRules:{turnoverAssetId:[{required:!0,message:"请选择部件"}],facadeStatus:[{required:!0,message:"请选择外观状态"}],mixtoolStatus:[{required:!0,message:"请选择工装状态"}]},dictTrainStr:"",structureId:"",labelCol:{span:3},wrapperCol:{span:20}}},methods:{showModal:function(e){this.structureId=e,this.visible=!0,this.modalInfo.lineId=this.lineId,this.lineId&&(this.dictTrainStr="bu_train_info,train_no,id,line_id="+this.lineId),this.modalInfo.trainNo=this.trainNo,this.modalInfo.assetName="",this.modalInfo.turnoverAssetId="",this.modalInfo.remark=""},onLineChange:function(e,t){this.dictTrainStr=t?"bu_train_info,train_no,id,line_id="+t.value:""},handleOk:function(){var e=this;this.$refs.outPartForm.validate((function(t){if(t){if(e.checkAssetIsExist(e.modalInfo.turnoverAssetId))return void e.$message.warning("你选择的设备已经存在委外设备列表中,不能重复添加");e.$emit("ok",e.modalInfo),e.close()}}))},checkAssetIsExist:function(e){var t=this.existAssets.filter((function(t){return t.turnoverAssetId===e}));return t.length>0},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},selectAsset:function(){this.$refs.assetSelectModal.showModal(this.modalInfo.trainNo),this.$refs.assetSelect.blur()},onSelectAsset:function(e){if(e&&e.length>0){var t=e[0];this.modalInfo.id=Object(i["p"])(),this.modalInfo.outinId="",this.modalInfo.assetNo=t.assetNo,this.modalInfo.assetName=t.assetName,this.modalInfo.amount=t.amount,this.modalInfo.assetTypeId=t.assetTypeId,this.modalInfo.assetTypeName=t.assetTypeName,this.modalInfo.trainNo=t.trainNo,this.modalInfo.turnoverAssetId=t.turnoverAssetId,this.modalInfo.facadeStatus=t.facadeStatus,this.modalInfo.facadeStatus_dictText="1"===this.modalInfo.facadeStatus?"有问题":"无问题",this.modalInfo.facadeDesc=t.facadeDesc,this.modalInfo.mixtoolStatus=t.mixtoolStatus,this.modalInfo.mixtoolStatus_dictText="1"===this.modalInfo.mixtoolStatus?"有问题":"无问题",this.modalInfo.mixtoolDesc=t.mixtoolDesc,this.modalInfo.fault=t.fault,this.modalInfo.fault_dictText="1"===this.modalInfo.fault?"是":"否",this.modalInfo.returnStatus=1,this.modalInfo.returnStatus_dictText="是",this.modalInfo.returnTime=t.returnTime,this.modalInfo.delayReason=t.delayReason,this.modalInfo.remark=t.remark,this.modalInfo.outDetailId=t.outDetailId,this.modalInfo.qualityDate=t.qualityDate,this.modalInfo.qualityDay=t.qualityDay,this.$forceUpdate()}}}},l=s,c=a("2877"),u=Object(c["a"])(l,r,o,!1,null,"411b84f8",null);t["default"]=u.exports},a821:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:"委外设备选择",visible:e.visible,confirmLoading:e.loading,cancelText:"关闭",destroyOnClose:!0,centered:"",bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"设备名称"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码",allowClear:""},model:{value:e.queryParam.assetName,callback:function(t){e.$set(e.queryParam,"assetName",t)},expression:"queryParam.assetName"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"ellipsis","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"assetNo",title:"部件编号"}}),t("vxe-table-column",{attrs:{field:"assetName",title:"部件名称"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"所属线路"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"所属车辆"}}),t("vxe-table-column",{attrs:{field:"outinNo",title:"出厂单编号"}}),t("vxe-table-column",{attrs:{field:"outinName",title:"出厂单编号"}}),t("vxe-table-column",{attrs:{field:"transferDate",title:"移交日期"}}),t("vxe-table-column",{attrs:{field:"contractNo",title:"所属合同编号"}}),t("vxe-table-column",{attrs:{field:"contractName",title:"所属合同名称"}}),t("vxe-table-column",{attrs:{field:"remark",title:"出厂备注"}})],1)],1)])},o=[],i=a("b9c3"),n={name:"OutAssetList",props:{multiple:{type:Boolean,default:!1}},data:function(){return{visible:!1,loading:!1,queryParam:{assetTypeId:"",trainNo:"",assetName:""},allAlign:"center",totalResult:0,tableData:[]}},methods:{showModal:function(e){this.queryParam.trainNo=e,this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["y"])(this.queryParam).then((function(t){t.success?(e.loading=!1,e.tableData=t.result):e.$message.error("查询设备失败")}))},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=n,l=a("2877"),c=Object(l["a"])(s,r,o,!1,null,"2cc8c558",null);t["default"]=c.exports},a9bc:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"myWorkContent"}},[t("na-splitter",{staticStyle:{height:"calc(100vh - 115px)"},attrs:{defaultSize:350},on:{resize:e.resizeSplitter}},[t("div",{staticStyle:{height:"100%","overflow-y":"hidden","overflow-x":"hidden","padding-right":"2px"},attrs:{slot:"left-panel"},slot:"left-panel"},[t("div",{staticClass:"titleBar bg-primary-1"},[e._v("任务搜索")]),t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:12}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",[t("j-dict-select-tag",{attrs:{dictCode:"bu_order_task_status",placeholder:"任务状态"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{wrapperCol:{span:24}}},[t("a-select",{ref:"myPlanSelect",staticStyle:{width:"100%"},attrs:{"allow-clear":"",placeholder:"请选择列计划",open:!1,showArrow:!0},on:{dropdownVisibleChange:e.openPlanModel,change:e.changePlanSelect},model:{value:e.queryParam.planName,callback:function(t){e.$set(e.queryParam,"planName",t)},expression:"queryParam.planName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{wrapperCol:{span:24}}},[t("a-select",{ref:"myOrderSelect",staticStyle:{width:"100%"},attrs:{"allow-clear":"",placeholder:"请选择工单",open:!1,showArrow:!0},on:{dropdownVisibleChange:e.openOrderModel,change:e.changeOrderSelect},model:{value:e.queryParam.orderName,callback:function(t){e.$set(e.queryParam,"orderName",t)},expression:"queryParam.orderName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",[t("a-input",{attrs:{placeholder:"请输入任务名称","allow-clear":""},model:{value:e.queryParam.taskName,callback:function(t){e.$set(e.queryParam,"taskName",t)},expression:"queryParam.taskName"}})],1)],1)],1),t("a-row",[t("a-form-item",[t("a-button",{attrs:{type:"primary",block:""},on:{click:e.loadTaskList}},[e._v("搜索")])],1)],1),t("a-row")],1)],1),t("div",{staticClass:"titleBar bg-primary-1"},[e._v("任务列表")]),t("div",{staticStyle:{padding:"10px"}},[!e.readOnly&&e.selectTask?t("a-button",{directives:[{name:"has",rawName:"v-has",value:"mywork:submittask",expression:"'mywork:submittask'"}],staticClass:"border-primary-6 bg-primary-2",attrs:{type:"dashed",block:"",loading:e.loading},on:{click:e.submitTask}},[e._v("任务提交")]):e._e()],1),t("div",{staticStyle:{height:"calc(100vh - 435px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 435px)"},attrs:{stripe:!0,border:"","row-id":"id",align:e.allAlign,data:e.tableDataTask,"max-height":"100%","show-overflow":"tooltip","radio-config":{trigger:"row",highlight:!0,reserve:!0}},on:{"radio-change":e.onTaskSelectChange}},[t("vxe-table-column",{attrs:{type:"radio",width:"35"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"任务名称",align:"left",width:"195"}}),t("vxe-table-column",{attrs:{field:"taskStatus_dictText",title:"状态",align:"left",width:"65"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",align:"left",width:"65"}}),t("vxe-table-column",{attrs:{field:"orderCode",title:"工单号",align:"left",width:"80"}}),t("vxe-table-column",{attrs:{field:"orderName",title:"工单名称",align:"left","header-align":"center",width:"165"}})],1)],1)]),t("div",{staticStyle:{"padding-left":"5px","padding-right":"3px",height:"calc(100% - 0px)"},attrs:{slot:"right-panel"},slot:"right-panel"},[!e.selectTask||0!==e.selectTask.outTask||1!==e.selectTask.taskType&&3!==e.selectTask.taskType&&4!==e.selectTask.taskType&&5!==e.selectTask.taskType?e._e():t("a-tabs",{staticStyle:{height:"calc(100% - 0px)"},attrs:{size:"small"},on:{change:e.onChangeTab},model:{value:e.curTabKey,callback:function(t){e.curTabKey=t},expression:"curTabKey"}},[t("a-tab-pane",{key:"1",staticStyle:{overflow:"auto"},attrs:{tab:"作业要求"}},[e.readed||e.readOnly?e._e():t("div",{staticStyle:{"padding-top":"25px","padding-left":"10px","padding-bottom":"15px","text-align":"center"}},[t("a-button",{staticStyle:{"border-color":"#cc0000","border-width":"2px"},attrs:{type:"dashed"},on:{click:e.onReadClick}},[e._v("我已阅读")]),t("span",{staticClass:"readTip"},[e._v(" <- 点我确认已阅读作业要求")])],1),t("div",{staticClass:"requireBox"},[t("div",{staticClass:"requireTitle"},[t("span",[e._v(" 安全预想")])]),e.requirement&&e.requirement.safetyExpectation?t("p",{staticClass:"safeContent",domProps:{innerHTML:e._s(e.requirement.safetyExpectation)}}):e._e()]),t("div",{staticClass:"requireBox",staticStyle:{"min-height":"auto"}},[t("div",{staticClass:"requireTitle"},[t("span",{staticStyle:{"border-color":"#00b8ff"}},[e._v(" 任务规程")])]),e.regus.length>0?t("TaskRegusView",{staticStyle:{"min-height":"162px"},attrs:{tableData:e.regus}}):t("div",{staticStyle:{height:"162px"}})],1),t("div",{staticClass:"requireBox"},[t("div",{staticClass:"requireTitle"},[t("span",{staticStyle:{"border-color":"#00b8ff"}},[e._v(" 作业指导书")])]),t("div",{ref:"bookStepDom",staticStyle:{padding:"15px"}})])]),t("a-tab-pane",{key:"2",attrs:{forceRender:!0,"na-flex-height-full":""}},[t("div",{staticClass:"badge-tab-pane",attrs:{slot:"tab"},slot:"tab"},[t("span",[e._v("作业表单")]),t("a-badge",{attrs:{hidden:0===e.formsBadge,count:e.formsBadge}})],1),e.taskFormsList&&e.taskFormsList.length>0?t("div",{attrs:{"na-flex-height-full":""}},[e.taskFormsList.length?t("a-tabs",{staticStyle:{"min-height":"45px"},attrs:{size:"small"},on:{change:e.selectForm},model:{value:e.tabFormKey,callback:function(t){e.tabFormKey=t},expression:"tabFormKey"}},e._l(e.taskFormsList,(function(a,r){return t("a-tab-pane",{key:r},[t("div",{staticClass:"badge-tab-pane",attrs:{slot:"tab"},slot:"tab"},[t("span",[e._v(e._s(a.formName))]),t("a-badge",{attrs:{hidden:0===e.getFormBadgeByRow(a),count:e.getFormBadgeByRow(a)}})],1)])})),1):e._e(),e.curForm&&4===e.curForm.instType?t("TaskCheckForm",{ref:"checkRecordForm",attrs:{taskFormsList:e.taskFormsList,selectTask:e.selectTask,workOrderInfo:e.workOrderInfo},on:{taskFormNoWork:e.onTaskFormNoWork,checkEnd:e.getFormsItem}}):e._e(),e.curForm&&3===e.curForm.instType?t("div",{attrs:{"na-flex-height-full":""}},[t("div",{staticClass:"buttonDiv"},[e.selectTask&&2!==e.selectTask.taskStatus?t("a-space",[t("a-button",{on:{click:function(t){return e.handleCheck(1,"自检")}}},[e._v("自检")]),t("a-button",{on:{click:function(t){return e.handleCheck(2,"互检")}}},[e._v("互检")]),t("a-button",{on:{click:function(t){return e.handleCheck(3,"专检")}}},[e._v("专检")]),t("a-button",{on:{click:e.createFault}},[e._v("故障提报")])],1):e._e()],1),e.curRecordForm&&e.curRecordForm.updown&&1===e.curRecordForm.updown?t("div",[t("table",{staticClass:"vxe-table--header",staticStyle:{width:"100%","margin-bottom":"5px"}},[t("tr",[t("th",{staticStyle:{width:"90px","text-align":"right"}},[e._v("原部件序列号:")]),t("td",[t("a-input",{staticStyle:{width:"100%"},attrs:{placeholder:"原部件序列号"},model:{value:e.curRecordForm.manufNo,callback:function(t){e.$set(e.curRecordForm,"manufNo",t)},expression:"curRecordForm.manufNo"}})],1),t("th",{staticStyle:{width:"120px","text-align":"right"}},[e._v("新部件序列号:")]),t("td",[t("a-input",{staticStyle:{width:"100%"},attrs:{placeholder:"新部件序列号"},model:{value:e.curRecordForm.manufNoUp,callback:function(t){e.$set(e.curRecordForm,"manufNoUp",t)},expression:"curRecordForm.manufNoUp"}})],1)])])]):e._e(),t("div",{style:{height:e.curRecordForm&&e.curRecordForm.updown&&1===e.curRecordForm.updown?"calc(100vh - 297px)":"calc(100vh - 258px)"}},[e.curRecordForm?t("vxe-table",{ref:"recordListTable",attrs:{stripe:!0,border:"","auto-resize":"","max-height":"auto","row-id":"id",align:e.allAlign,data:e.curRecordForm.detailList,"show-overflow":"tooltip","span-method":e.mergeRowMethod}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{type:"index",title:"序号",align:"center",width:"60"}}),t("vxe-table-column",{attrs:{field:"reguTitle",title:"作业项目",align:"center",width:"120"}}),t("vxe-table-column",{attrs:{field:"workContent",title:"检修内容",align:"left","min-width":"250"}}),t("vxe-table-column",{attrs:{field:"result_dictText",title:"结果",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[1===r.result?t("span",{staticStyle:{color:"red"}},[e._v("异常")]):e._e(),0===r.result&&(r.selfCheck||r.guarderCheck||r.monitorCheck)?t("span",{staticStyle:{color:"green"}},[e._v("正常")]):e._e()]}}],null,!1,403683291)}),t("vxe-table-column",{attrs:{field:"selfCheck",title:"自检",align:"center",width:"80"}}),t("vxe-table-column",{attrs:{field:"guarderCheck",title:"互检",align:"center",width:"80"}}),t("vxe-table-column",{attrs:{field:"monitorCheck",title:"专检",align:"center",width:"80"}}),t("vxe-table-column",{attrs:{field:"workInfo",title:"作业情况",align:"left","min-width":"120","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[1===r.isIgnore?t("span",[e._v(e._s(r.ignoreDesc))]):t("span",[e._v(e._s(r.workInfo))])]}}],null,!1,1821161590)}),t("vxe-table-column",{attrs:{field:"isIgnore_dictText",title:"忽略？",align:"center",width:"80"}})],1):e._e()],1)]):e._e(),e.curForm&&1===e.curForm.instType?t("div",{staticStyle:{height:"calc(100vh - 210px)",position:"relative"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showSheetSave,expression:"showSheetSave"}],staticStyle:{position:"absolute",top:"5px",left:"90px",width:"50px","z-index":"1000"}},[t("a-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return t.stopPropagation(),e.saveCustomForm.apply(null,arguments)}}},[t("a-icon",{attrs:{type:"save"}}),e._v("  保存")],1)],1),t("div",{staticStyle:{margin:"0px",padding:"0px",width:"100%",height:"calc(100% - 0px)"},attrs:{id:"sheet"}})]):e._e()],1):e._e(),e.taskFormsList.length?e._e():t("div",{staticStyle:{margin:"20px"}},[t("div",{staticStyle:{padding:"15px",color:"#cccccc"}},[e._v("该作业无须填写表单信息")]),e.readOnly?e._e():t("a-space",[t("a-button",{on:{click:e.createFault}},[e._v("提报故障")]),t("a-button",{on:{click:e.createOpenItem}},[e._v("设置为开口项")])],1)],1)]),t("a-tab-pane",{key:"4"},[t("div",{staticClass:"badge-tab-pane",attrs:{slot:"tab"},slot:"tab"},[t("span",[e._v("物料消耗")]),t("a-badge",{attrs:{hidden:0===e.materialBadge,count:e.materialBadge}})],1),t("div",{staticClass:"tableHeight",attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"MaterialListTable",attrs:{border:"","auto-resize":"","max-height":"auto",align:e.allAlign,data:e.materials,"keep-source":!0,"show-overflow":"ellipsis","row-style":e.checkMaterialShow,"edit-rules":e.materialInputValidRules,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.materials=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码",width:"15%","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.code)+" ")]}}],null,!1,1074601957)}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称",width:"15%","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}],null,!1,1805491503)}),t("vxe-table-column",{attrs:{field:"opType_dictText",title:"领用类型",width:"120px"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"15%","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.amount)+" ")]}}],null,!1,565112580)}),t("vxe-table-column",{attrs:{field:"actAmount",title:"实际消耗",align:"left","edit-render":{name:"$input",props:{type:"number"}}}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",align:"left",width:"15%","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}],null,!1,1773474126)}),t("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",align:"left","edit-render":{name:"$input",props:{type:"text"}}}}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.MaterialListTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveMaterialRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelMaterialRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!e.selectTask&&2===e.selectTask.taskStatus,size:"small"},on:{click:function(t){return t.stopPropagation(),e.editMaterialRowEvent(r)}}},[e._v("填写")])]]}}],null,!1,452940768)})],1)],1)]),t("a-tab-pane",{key:"5",attrs:{tab:"工器具"}},[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.onAddTool}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.onDelTool}},[e._v("删除")])],1)],1)],1)],1)],1),t("div",{staticClass:"tableHeight",style:"height: calc(100% - ".concat(e.readOnly?"4px":"40px",")")},[t("vxe-table",{ref:"ToolsListTable",attrs:{border:"","auto-resize":"","max-height":"auto",align:e.allAlign,data:e.tools,"show-overflow":"tooltip","checkbox-config":{highlight:!0,range:!0},"edit-rules":e.toolInputValidRules,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"工器具类型编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("div",{on:{click:function(t){return t.stopPropagation(),e.openToolTypeSelectModal(r)}}},[t("a-select",{ref:"toolTypeSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return t.stopPropagation(),e.openToolTypeSelectModal(r)}},slot:"suffixIcon"})],1)],1)]}}],null,!1,4163775647)}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称","edit-render":{name:"input"},align:"left","class-name":"allow-max-height"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}],null,!1,1805491503)}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}],null,!1,3749314421)}),t("vxe-table-column",{attrs:{field:"workRecordInstName",title:"关联表单","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.formSelectChange},model:{value:r.workRecordInstId,callback:function(t){e.$set(r,"workRecordInstId",t)},expression:"row.workRecordInstId"}},[e._l(e.taskFormsList,(function(a,r){return[3===a.instType?t("a-select-option",{key:r,attrs:{value:a.formInstId}},[e._v(" "+e._s(a.formName)+" ")]):e._e()]}))],2)]}}],null,!1,1712668766)}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.category1_dictText)+" ")]}}],null,!1,297620689)}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}],null,!1,1773474126)}),t("vxe-table-column",{attrs:{field:"assetCode",title:"出厂号(实际工具)",align:"left","edit-render":{name:"input"},formatter:e.serialNoFormatter},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("div",{on:{click:function(t){return t.stopPropagation(),e.openToolSelectModal(r)}}},[t("a-select",{ref:"toolSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},model:{value:r.assetCode,callback:function(t){e.$set(r,"assetCode",t)},expression:"row.assetCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return t.stopPropagation(),e.openToolSelectModal(r)}},slot:"suffixIcon"})],1)],1)]}}],null,!1,938827063)}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.ToolsListTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveToolRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelToolRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!e.selectTask&&2===e.selectTask.taskStatus,size:"small"},on:{click:function(t){return t.stopPropagation(),e.editToolRowEvent(r)}}},[e._v("填写")])]]}}],null,!1,2848076083)})],1)],1)],1),t("a-tab-pane",{key:"9",attrs:{tab:"作业工时"}},[t("TaskWorkTime",{attrs:{staffArranges:e.staffArranges,selectTask:e.selectTask,operator:4,"read-only":e.readOnly},on:{"update:staffArranges":function(t){e.staffArranges=t},"update:staff-arranges":function(t){e.staffArranges=t},"update:selectTask":function(t){e.selectTask=t},"update:select-task":function(t){e.selectTask=t}}})],1),t("a-tab-pane",{key:"7",attrs:{tab:"任务信息"}},[t("orderOrTaskDetail",{attrs:{workOrderInfo:e.workOrderInfo,taskInfo:e.taskInfo}})],1),t("a-tab-pane",{key:"8",attrs:{tab:"附件"}},[t("TaskAttached",{attrs:{files:e.attachedfiles,selectTask:e.selectTask},on:{"update:files":function(t){e.attachedfiles=t},addFile:e.onAddFile}})],1),t("a-tab-pane",{key:"10",attrs:{tab:"临时领料"}},[t("ReceiveMaterial",{attrs:{taskMaterials:e.materials,selectTask:e.selectTask,opType:2},on:{add:e.onReceiveMaterialAdd,edit:e.onReceiveMaterialEdit}})],1),t("a-tab-pane",{key:"11",attrs:{tab:"退还物料"}},[t("ReceiveMaterial",{attrs:{taskMaterials:e.materials,selectTask:e.selectTask,opType:3},on:{add:e.onReceiveMaterialAdd,edit:e.onReceiveMaterialEdit}})],1)],1),!e.selectTask||0===e.selectTask.outTask||6!==e.selectTask.taskType&&7!==e.selectTask.taskType?e._e():t("a-tabs",{staticStyle:{height:"calc(100% - 0px)"},attrs:{size:"small"},on:{change:e.onChangeTab},model:{value:e.curTabKey,callback:function(t){e.curTabKey=t},expression:"curTabKey"}},[e.selectTask&&2!==e.selectTask.taskStatus&&"2"===e.curTabKey?t("a-button",{staticStyle:{"margin-right":"10px"},attrs:{slot:"tabBarExtraContent",type:"primary",size:"small",loading:e.loading},on:{click:e.saveOutInInfo},slot:"tabBarExtraContent"},[e._v("保存")]):e._e(),t("a-tab-pane",{key:"1",staticStyle:{overflow:"auto"},attrs:{tab:"作业要求"}},[e.readed||e.readOnly?e._e():t("div",{staticStyle:{"padding-top":"25px","padding-left":"10px","padding-bottom":"15px","text-align":"center"}},[t("a-button",{staticStyle:{"border-color":"#cc0000","border-width":"2px"},attrs:{type:"dashed"},on:{click:e.onReadClick}},[e._v("我已阅读")]),t("span",{staticClass:"readTip"},[e._v(" <- 点我确认已阅读作业要求")])],1),t("div",{staticClass:"requireBox"},[t("div",{staticClass:"requireTitle"},[t("span",[e._v(" 安全预想")])]),e.requirement&&e.requirement.safetyExpectation?t("p",{staticClass:"safeContent"},[e._v(" "+e._s(e.requirement.safetyExpectation)+" ")]):e._e()])]),t("a-tab-pane",{key:"2",attrs:{tab:"作业填报"}},[t("div",{staticStyle:{padding:"10px",height:"100%","overflow-y":"auto"}},[e.selectTask&&1===e.selectTask.outTask?t("div",{staticStyle:{height:"calc(100% - 18px)"}},[t("div",{staticClass:"fieldset-wrapper"},[t("h4",{staticClass:"title"},[e._v("交接信息")]),t("a-form-model",{ref:"outInfoForm",attrs:{disabled:e.selectTask&&2!==e.selectTask.taskStatus,model:e.outModelInfo,"label-col":{span:6},"wrapper-col":{span:18},rules:e.outRules}},[t("a-row",[t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"交接单号",prop:"billNo"}},[t("a-input",{attrs:{placeholder:"交接单号",disabled:""},model:{value:e.outModelInfo.billNo,callback:function(t){e.$set(e.outModelInfo,"billNo",t)},expression:"outModelInfo.billNo"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"交接单名",prop:"outinName"}},[t("a-input",{attrs:{placeholder:"交接单名"},model:{value:e.outModelInfo.outinName,callback:function(t){e.$set(e.outModelInfo,"outinName",t)},expression:"outModelInfo.outinName"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"线路",prop:"lineId"}},[t("j-dict-select-tag",{ref:"lineSelect",attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.onLineChange},model:{value:e.outModelInfo.lineId,callback:function(t){e.$set(e.outModelInfo,"lineId",t)},expression:"outModelInfo.lineId"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"车号",prop:"trainNo"}},[t("j-dict-select-seach-tag",{attrs:{triggerChange:!0,dictCode:e.dictTrainStr},on:{select:e.onTrainSelect},model:{value:e.outModelInfo.trainNo,callback:function(t){e.$set(e.outModelInfo,"trainNo",t)},expression:"outModelInfo.trainNo"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"交接日期",prop:"transferDateM"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"交接日期"},model:{value:e.outModelInfo.transferDateM,callback:function(t){e.$set(e.outModelInfo,"transferDateM",t)},expression:"outModelInfo.transferDateM"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"工程师",prop:"engineerId"}},[t("div",{on:{click:function(t){return e.showUserModal(2)}}},[t("a-select",{ref:"userSelect2",attrs:{placeholder:"请选择人员",open:!1},model:{value:e.outModelInfo.engineerName,callback:function(t){e.$set(e.outModelInfo,"engineerName",t)},expression:"outModelInfo.engineerName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"作业班组",prop:"sendGroupId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:e.dictGroupStr},model:{value:e.outModelInfo.sendGroupId,callback:function(t){e.$set(e.outModelInfo,"sendGroupId",t)},expression:"outModelInfo.sendGroupId"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"移交人",prop:"transferUserId"}},[t("div",{on:{click:function(t){return e.showUserModal(1)}}},[t("a-select",{ref:"userSelect1",attrs:{placeholder:"请选择人员",open:!1},model:{value:e.outModelInfo.transferUserName,callback:function(t){e.$set(e.outModelInfo,"transferUserName",t)},expression:"outModelInfo.transferUserName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"接收厂商",prop:"supplierId"}},[t("a-select",{ref:"mySupplierSelectOut",attrs:{placeholder:"请选择厂商",open:!1,showArrow:!0},on:{focus:function(t){return e.openSupplierModal(1)}},model:{value:e.outModelInfo.supplierName,callback:function(t){e.$set(e.outModelInfo,"supplierName",t)},expression:"outModelInfo.supplierName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"接收人员",prop:"receiveUser"}},[t("a-input",{attrs:{placeholder:"接收人员"},model:{value:e.outModelInfo.receiveUser,callback:function(t){e.$set(e.outModelInfo,"receiveUser",t)},expression:"outModelInfo.receiveUser"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"所属合同",prop:"contractId"}},[t("j-dict-select-tag",{attrs:{"trigger-change":!0,dictCode:"bu_contract_info,contract_name,id,status<>2"},model:{value:e.outModelInfo.contractId,callback:function(t){e.$set(e.outModelInfo,"contractId",t)},expression:"outModelInfo.contractId"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"备注",prop:"remark"}},[t("a-input",{attrs:{placeholder:"备注"},model:{value:e.outModelInfo.remark,callback:function(t){e.$set(e.outModelInfo,"remark",t)},expression:"outModelInfo.remark"}})],1)],1)],1)],1)],1),t("div",{staticClass:"fieldset-wrapper"},[t("h4",{staticClass:"title"},[e._v("交接部件")]),e.selectTask&&2!==e.selectTask.taskStatus?t("div",{staticStyle:{"padding-bottom":"10px"}},[t("a-space",[t("a-button",{on:{click:e.onAddOutPart}},[e._v("添加")]),t("a-button",{on:{click:e.onDeleteOutPart}},[e._v("删除")])],1)],1):e._e(),t("vxe-table",{key:"outTable",ref:"outTable",attrs:{border:"",align:"center",data:e.outModelInfo.outinDetails,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",width:"100"}}),t("vxe-table-column",{attrs:{field:"assetName",title:"委外部件","min-width":"140"}}),t("vxe-table-column",{attrs:{field:"assetNo",title:"部件编号","min-width":"140",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"facadeStatus_dictText",title:"外观状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"mixtoolStatus_dictText",title:"工装状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"fault_dictText",title:"是否故障",width:"100"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","min-width":"160","header-align":"center",align:"left"}})],1)],1)]):e._e(),e.selectTask&&2===e.selectTask.outTask?t("div",{staticStyle:{height:"calc(100% - 18px)"}},[t("div",{staticClass:"fieldset-wrapper"},[t("h4",{staticClass:"title"},[e._v("交接信息")]),t("a-form-model",{ref:"inInfoForm",attrs:{model:e.inModelInfo,"label-col":{span:6},"wrapper-col":{span:18},rules:e.inRules}},[t("a-row",[t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"交接单号",prop:"billNo"}},[t("a-input",{attrs:{placeholder:"交接单号",disabled:""},model:{value:e.inModelInfo.billNo,callback:function(t){e.$set(e.inModelInfo,"billNo",t)},expression:"inModelInfo.billNo"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"交接单名",prop:"outinName"}},[t("a-input",{attrs:{placeholder:"交接单名"},model:{value:e.inModelInfo.outinName,callback:function(t){e.$set(e.inModelInfo,"outinName",t)},expression:"inModelInfo.outinName"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"线路",prop:"lineId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.onLineChange},model:{value:e.inModelInfo.lineId,callback:function(t){e.$set(e.inModelInfo,"lineId",t)},expression:"inModelInfo.lineId"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"车号",prop:"trainNo"}},[t("j-dict-select-seach-tag",{attrs:{triggerChange:!0,dictCode:e.dictTrainStr},on:{select:e.onTrainSelect},model:{value:e.inModelInfo.trainNo,callback:function(t){e.$set(e.inModelInfo,"trainNo",t)},expression:"inModelInfo.trainNo"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"接收日期",prop:"transferDate"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"交接日期"},model:{value:e.inModelInfo.transferDateM,callback:function(t){e.$set(e.inModelInfo,"transferDateM",t)},expression:"inModelInfo.transferDateM"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"工程师",prop:"engineerId"}},[t("div",{on:{click:function(t){return e.showUserModal(2)}}},[t("a-select",{ref:"userSelect2",attrs:{placeholder:"请选择人员",open:!1},model:{value:e.inModelInfo.engineerName,callback:function(t){e.$set(e.inModelInfo,"engineerName",t)},expression:"inModelInfo.engineerName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"作业班组",prop:"sendGroupId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:e.dictGroupStr},model:{value:e.inModelInfo.sendGroupId,callback:function(t){e.$set(e.inModelInfo,"sendGroupId",t)},expression:"inModelInfo.sendGroupId"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"接收人",prop:"receiveUser"}},[t("div",{on:{click:function(t){return e.showUserModal(1)}}},[t("a-select",{ref:"userSelect1",attrs:{placeholder:"请选择人员",open:!1},model:{value:e.inModelInfo.receiveUserName,callback:function(t){e.$set(e.inModelInfo,"receiveUserName",t)},expression:"inModelInfo.receiveUserName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"移交厂商",prop:"supplierId"}},[t("a-select",{ref:"mySupplierSelectIn",attrs:{placeholder:"请选择厂商",open:!1,showArrow:!0},on:{focus:function(t){return e.openSupplierModal(2)}},model:{value:e.inModelInfo.supplierName,callback:function(t){e.$set(e.inModelInfo,"supplierName",t)},expression:"inModelInfo.supplierName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"移交人员",prop:"transferUserId"}},[t("a-input",{attrs:{placeholder:"移交人员"},model:{value:e.inModelInfo.transferUserId,callback:function(t){e.$set(e.inModelInfo,"transferUserId",t)},expression:"inModelInfo.transferUserId"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"所属合同",prop:"contractId"}},[t("j-dict-select-tag",{attrs:{"trigger-change":!0,dictCode:"bu_contract_info,contract_name,id,status<>2"},model:{value:e.inModelInfo.contractId,callback:function(t){e.$set(e.inModelInfo,"contractId",t)},expression:"inModelInfo.contractId"}})],1)],1),t("a-col",{attrs:{span:11}},[t("a-form-model-item",{attrs:{label:"备注",prop:"remark"}},[t("a-input",{attrs:{placeholder:"备注"},model:{value:e.inModelInfo.remark,callback:function(t){e.$set(e.inModelInfo,"remark",t)},expression:"inModelInfo.remark"}})],1)],1)],1)],1)],1),t("div",{staticClass:"fieldset-wrapper"},[t("h4",{staticClass:"title"},[e._v("交接部件")]),e.selectTask&&2!==e.selectTask.taskStatus?t("div",{staticStyle:{"padding-bottom":"10px"}},[t("a-space",[t("a-button",{on:{click:e.onAddInPart}},[e._v("添加")]),t("a-button",{on:{click:e.onDeleteInPart}},[e._v("删除")])],1)],1):e._e(),t("vxe-table",{key:"inTable",ref:"inTable",attrs:{border:"",align:"center",data:e.inModelInfo.outinDetails,"edit-config":{trigger:"manual",mode:"row"},"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",width:"100"}}),t("vxe-table-column",{attrs:{field:"assetName",title:"委外部件","min-width":"140"}}),t("vxe-table-column",{attrs:{field:"assetNo",title:"部件编号","min-width":"140"}}),t("vxe-table-column",{attrs:{field:"facadeStatus_dictText",title:"外观状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"mixtoolStatus_dictText",title:"工装状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","min-width":"160","header-align":"center",align:"left"}})],1)],1)]):e._e()])]),t("a-tab-pane",{key:"9",attrs:{tab:"作业工时"}},[t("TaskWorkTime",{attrs:{staffArranges:e.staffArranges,selectTask:e.selectTask,operator:4},on:{"update:staffArranges":function(t){e.staffArranges=t},"update:staff-arranges":function(t){e.staffArranges=t},"update:selectTask":function(t){e.selectTask=t},"update:select-task":function(t){e.selectTask=t}}})],1),t("a-tab-pane",{key:"7",attrs:{tab:"任务信息"}},[t("orderOrTaskDetail",{attrs:{type:"outsources",workOrderInfo:e.workOrderInfo,taskInfo:e.selectTask}})],1),t("a-tab-pane",{key:"8",attrs:{tab:"附件"}},[t("TaskAttached",{attrs:{files:e.attachedfiles},on:{"update:files":function(t){e.attachedfiles=t},addFile:e.onAddFile}})],1)],1),e.selectTask&&2===e.selectTask.taskType&&0===e.selectTask.outTask?t("a-tabs",{staticStyle:{height:"calc(100% - 0px)"},attrs:{size:"small"},on:{change:e.onChangeTab},model:{value:e.curTabKey,callback:function(t){e.curTabKey=t},expression:"curTabKey"}},[e.selectTask&&2!==e.selectTask.taskStatus&&"2"===e.curTabKey?t("a-button",{staticStyle:{"margin-right":"10px"},attrs:{slot:"tabBarExtraContent",type:"primary",size:"small",loading:e.loading},on:{click:e.saveFaultInfo},slot:"tabBarExtraContent"},[e._v("保存")]):e._e(),t("a-tab-pane",{key:"1",staticStyle:{overflow:"auto"},attrs:{tab:"作业要求"}},[e.readed||e.readOnly?e._e():t("div",{staticStyle:{"padding-top":"25px","padding-left":"10px","padding-bottom":"15px","text-align":"center"}},[t("a-button",{staticStyle:{"border-color":"#cc0000","border-width":"2px"},attrs:{type:"dashed"},on:{click:e.onReadClick}},[e._v("我已阅读")]),t("span",{staticClass:"readTip"},[e._v(" <- 点我确认已阅读作业要求")])],1),t("div",{staticClass:"requireBox"},[t("div",{staticClass:"requireTitle"},[t("span",[e._v(" 安全预想")])]),e.requirement&&e.requirement.safetyExpectation?t("p",{staticClass:"safeContent"},[e._v(" "+e._s(e.requirement.safetyExpectation)+" ")]):e._e()])]),t("a-tab-pane",{key:"2",staticStyle:{"padding-top":"10px","padding-left":"5px"},attrs:{tab:"作业填报",forceRender:!0}},[e.selectTask&&2===e.selectTask.taskType&&0===e.selectTask.outTask?t("BreakdownFormItem",{ref:"breakdownForm",attrs:{"from-write-report":!0},on:{ok:e.onFaultSaveOk,fail:e.onFaultSaveFail}}):e._e()],1),t("a-tab-pane",{key:"4"},[t("div",{staticClass:"badge-tab-pane",attrs:{slot:"tab"},slot:"tab"},[t("span",[e._v("物料消耗")]),t("a-badge",{attrs:{hidden:0===e.materialBadge,count:e.materialBadge}})],1),t("div",{staticClass:"tableHeight",attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"MaterialListTable",attrs:{border:"","auto-resize":"","max-height":"auto",align:e.allAlign,data:e.materials,"keep-source":!0,"show-overflow":"tooltip","row-style":e.checkMaterialShow,"edit-rules":e.materialInputValidRules,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.materials=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码",width:"15%","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.code)+" ")]}}],null,!1,1074601957)}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称",width:"15%","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}],null,!1,1805491503)}),t("vxe-table-column",{attrs:{field:"opType_dictText",title:"领用类型",width:"120px"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"15%","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.amount)+" ")]}}],null,!1,565112580)}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",align:"left",width:"15%","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}],null,!1,1773474126)}),t("vxe-table-column",{attrs:{field:"actAmount",title:"实际消耗",align:"left","edit-render":{name:"$input",props:{type:"number"}}}}),t("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",align:"left","edit-render":{name:"$input",props:{type:"text"}}}}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.MaterialListTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveMaterialRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelMaterialRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!e.selectTask&&2===e.selectTask.taskStatus,size:"small"},on:{click:function(t){return t.stopPropagation(),e.editMaterialRowEvent(r)}}},[e._v("填写")])]]}}],null,!1,452940768)})],1)],1)]),t("a-tab-pane",{key:"5",attrs:{tab:"工器具"}},[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.onAddTool}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.onDelTool}},[e._v("删除")])],1)],1)],1)],1)],1),t("div",{staticClass:"tableHeight",style:"height: calc(100% - ".concat(e.readOnly?"4px":"40px",")")},[t("vxe-table",{ref:"ToolsListTable",attrs:{border:"","auto-resize":"","max-height":"auto",align:e.allAlign,data:e.tools,"show-overflow":"tooltip","checkbox-config":{highlight:!0,range:!0},"edit-rules":e.toolInputValidRules,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"工器具类型编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("div",{on:{click:function(t){return t.stopPropagation(),e.openToolTypeSelectModal(r)}}},[t("a-select",{ref:"toolTypeSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return t.stopPropagation(),e.openToolTypeSelectModal(r)}},slot:"suffixIcon"})],1)],1)]}}],null,!1,4163775647)}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称","edit-render":{name:"input"},align:"left","class-name":"allow-max-height"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}],null,!1,1805491503)}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}],null,!1,3749314421)}),t("vxe-table-column",{attrs:{field:"workRecordInstName",title:"关联表单","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.formSelectChange},model:{value:r.workRecordInstId,callback:function(t){e.$set(r,"workRecordInstId",t)},expression:"row.workRecordInstId"}},[e._l(e.curFormIndexList,(function(a,r){return[3===a.instType?t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.formIndex)+"-"+e._s(a.name)+" "+e._s(" -"+a.assetName)+" ")]):e._e()]}))],2)]}}],null,!1,201435342)}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.category1_dictText)+" ")]}}],null,!1,297620689)}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}],null,!1,1773474126)}),t("vxe-table-column",{attrs:{field:"assetCode",title:"出厂号(实际工具)",align:"left","edit-render":{name:"input"},formatter:e.serialNoFormatter},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("div",{on:{click:function(t){return t.stopPropagation(),e.openToolSelectModal(r)}}},[t("a-select",{ref:"toolSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},model:{value:r.assetCode,callback:function(t){e.$set(r,"assetCode",t)},expression:"row.assetCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return t.stopPropagation(),e.openToolSelectModal(r)}},slot:"suffixIcon"})],1)],1)]}}],null,!1,938827063)}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.ToolsListTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveToolRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelToolRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!e.selectTask&&2===e.selectTask.taskStatus,size:"small"},on:{click:function(t){return t.stopPropagation(),e.editToolRowEvent(r)}}},[e._v("填写")])]]}}],null,!1,2848076083)})],1)],1)],1),t("a-tab-pane",{key:"9",attrs:{tab:"作业工时"}},[t("TaskWorkTime",{attrs:{staffArranges:e.staffArranges,selectTask:e.selectTask,operator:4},on:{"update:staffArranges":function(t){e.staffArranges=t},"update:staff-arranges":function(t){e.staffArranges=t},"update:selectTask":function(t){e.selectTask=t},"update:select-task":function(t){e.selectTask=t}}})],1),t("a-tab-pane",{key:"7",attrs:{tab:"任务信息"}},[t("orderOrTaskDetail",{attrs:{type:"outsources",workOrderInfo:e.workOrderInfo,taskInfo:e.selectTask}})],1),t("a-tab-pane",{key:"8",attrs:{tab:"附件"}},[t("TaskAttached",{attrs:{files:e.attachedfiles},on:{"update:files":function(t){e.attachedfiles=t},addFile:e.onAddFile}})],1),t("a-tab-pane",{key:"10",attrs:{tab:"临时领料"}},[t("ReceiveMaterial",{attrs:{taskMaterials:e.materials,selectTask:e.selectTask,opType:2},on:{add:e.onReceiveMaterialAdd,edit:e.onReceiveMaterialEdit}})],1),t("a-tab-pane",{key:"11",attrs:{tab:"退还物料"}},[t("ReceiveMaterial",{attrs:{taskMaterials:e.materials,selectTask:e.selectTask,opType:3},on:{add:e.onReceiveMaterialAdd,edit:e.onReceiveMaterialEdit}})],1)],1):e._e(),e.selectTask&&0===e.selectTask.outTask&&8===e.selectTask.taskType?t("a-tabs",{staticStyle:{height:"calc(100% - 0px)"},attrs:{size:"small"},on:{change:e.onChangeTab},model:{value:e.curTabKey,callback:function(t){e.curTabKey=t},expression:"curTabKey"}},[e.selectTask&&2!==e.selectTask.taskStatus&&"2"===e.curTabKey?t("a-button",{staticStyle:{"margin-right":"10px"},attrs:{slot:"tabBarExtraContent",type:"primary",size:"small",loading:e.loading},on:{click:e.save8Task},slot:"tabBarExtraContent"},[e._v("保存")]):e._e(),t("a-tab-pane",{key:"1",staticStyle:{overflow:"auto"},attrs:{tab:"作业要求"}},[e.readed||e.readOnly?e._e():t("div",{staticStyle:{"padding-top":"25px","padding-left":"10px","padding-bottom":"15px","text-align":"center"}},[t("a-button",{staticStyle:{"border-color":"#cc0000","border-width":"2px"},attrs:{type:"dashed"},on:{click:e.onReadClick}},[e._v("我已阅读")]),t("span",{staticClass:"readTip"},[e._v(" <- 点我确认已阅读作业要求")])],1),t("div",{staticClass:"requireBox"},[t("div",{staticClass:"requireTitle"},[t("span",[e._v(" 安全预想")])]),e.requirement&&e.requirement.safetyExpectation?t("p",{staticClass:"safeContent"},[e._v(" "+e._s(e.requirement.safetyExpectation)+" ")]):e._e()])]),t("a-tab-pane",{key:"2",attrs:{tab:"作业填报",forceRender:!0}},[t("div",{staticStyle:{padding:"10px",height:"100%","overflow-y":"auto","overflow-x":"hidden","padding-top":"25px"}},[t("SuperviseItemForm",{ref:"superviseForm",on:{ok:e.onTask8SaveSuccess,fail:e.onTask8SaveFail}})],1)]),t("a-tab-pane",{key:"7",attrs:{tab:"任务信息"}},[t("orderOrTaskDetail",{attrs:{type:"outsources",workOrderInfo:e.workOrderInfo,taskInfo:e.selectTask}}),t("div",{staticStyle:{padding:"20px"}},[t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("工单信息")]),t("a-descriptions",{attrs:{title:"",bordered:""}},[t("a-descriptions-item",{attrs:{label:"工单编号"}},[e._v(" "+e._s(e.workOrderInfo.orderCode)+" ")]),t("a-descriptions-item",{attrs:{label:"工单类型"}},[e._v(" "+e._s(e.workOrderInfo.orderType_dictText)+" ")]),t("a-descriptions-item",{attrs:{label:"工单名称"}},[e._v(" "+e._s(e.workOrderInfo.orderName)+" ")]),t("a-descriptions-item",{attrs:{label:"作业班组"}},[e._v(" "+e._s(e.workOrderInfo.groupName)+" ")]),t("a-descriptions-item",{attrs:{label:"线路"}},[e._v(" "+e._s(e.workOrderInfo.lineName)+" ")]),t("a-descriptions-item",{attrs:{label:"车号"}},[e._v(" "+e._s(e.workOrderInfo.trainNo)+" ")]),t("a-descriptions-item",{attrs:{label:"开始日期"}},[e._v(" "+e._s(e.workOrderInfo.startTime)+" ")]),t("a-descriptions-item",{attrs:{label:"结束日期"}},[e._v(" "+e._s(e.workOrderInfo.finishTime)+" ")])],1)],1)])],1),t("a-tab-pane",{key:"8",attrs:{tab:"附件"}},[t("TaskAttached",{attrs:{files:e.attachedfiles},on:{"update:files":function(t){e.attachedfiles=t},addFile:e.onAddFile}})],1)],1):e._e()],1)]),t("train-plan-list",{ref:"planModalForm",on:{ok:e.onSelectPlan}}),t("work-order-select",{ref:"workOrderSelect",attrs:{workGroupId:e.curDepartId,orderStatus:[7]},on:{ok:e.onSelectOrder}}),t("check-modal",{ref:"checkModalForm",attrs:{title:e.checkModalTitle},on:{ok:e.onCheckRecord}}),t("task-submit-modal",{ref:"taskSubmitModal",on:{ok:e.onTaskSubmit}}),t("ToolsList",{ref:"toolModalForm",attrs:{multiple:!1,"can-select-type":[4,5,6]},on:{ok:e.onSelectTool}}),t("ToolTypeSelect",{ref:"toolTypeModalForm",attrs:{multiple:!1,"can-select-type":[4,5,6]},on:{ok:e.onSelectToolType}}),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}}),t("open-item-modal",{ref:"openItemModal"}),t("BreakdownModal",{ref:"breakdownModal",attrs:{showWorkStation:!0}}),t("material-list",{ref:"materialModalForm",attrs:{multiple:!1},on:{ok:e.onSelectMaterial}}),t("user-list",{ref:"tUserModalForm",attrs:{multiple:!1},on:{ok:e.onUserSelect}}),t("out-part-modal",{ref:"outPartModal",attrs:{lineId:e.outModelInfo.lineId,trainNo:e.outModelInfo.trainNo,"exist-assets":e.outModelInfo.outinDetails},on:{ok:e.onOutPartOk}}),t("in-part-modal",{ref:"inPartModal",attrs:{lineId:e.inModelInfo.lineId,trainNo:e.inModelInfo.trainNo,"exist-assets":e.outModelInfo.outinDetails},on:{ok:e.onInPartOk}}),t("supplier-list",{ref:"supplierModal",attrs:{multiple:!1},on:{ok:e.supplierSelect}})],1)},o=[],i=a("c1df"),n=a.n(i),s=a("2410"),l=a.n(s),c=a("60e2"),u=a("673e"),d=a("3c06"),f=a("3fdc"),m=a("d0f9"),h=a("e5b4"),p=a("a4db"),g=a("d425"),b=a("353a"),v=a("20c7"),y=a("ab7d"),k=a("7164"),w=a("b245"),I=a("d4bc"),T=a("a6df"),x=a("6971"),C=a("d0ca"),S=a("0c88"),M=a("ceed"),_=a("0989"),N=a("d888"),$=a("b9c3"),O=a("8fad"),P=a("e2aa"),R=a("e18e"),L=a("ca00"),D=a("769e"),j=a("b47d"),q=a("d214"),F=a("c54ca"),A=a("7268");function E(e){return Y(e)||G(e)||z(e)||U()}function U(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function z(e,t){if(e){if("string"==typeof e)return B(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?B(e,t):void 0}}function G(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Y(e){if(Array.isArray(e))return B(e)}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}function V(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return W(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(W(t={},r,(function(){return this})),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,W(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,W(d,"constructor",c),W(c,"constructor",l),l.displayName="GeneratorFunction",W(c,o,"GeneratorFunction"),W(d),W(d,o,"Generator"),W(d,r,(function(){return this})),W(d,"toString",(function(){return"[object Generator]"})),(V=function(){return{w:i,m:f}})()}function W(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}W=function(e,t,a,r){function i(t,a){W(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},W(e,t,a,r)}function K(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function J(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){K(i,r,o,n,s,"next",e)}function s(e){K(i,r,o,n,s,"throw",e)}n(void 0)}))}}var H={components:{NaSplitter:R["default"],BreakdownFormItem:C["default"],SuperviseItemForm:S["default"],TrainPlanList:c["default"],WorkOrderSelect:u["default"],checkModal:m["default"],taskSubmitModal:h["default"],ToolTypeSelect:p["default"],ToolsList:g["default"],DocPreviewModal:b["default"],OpenItemModal:v["default"],BreakdownModal:y["default"],MaterialList:k["default"],UserList:w["default"],OutPartModal:I["default"],InPartModal:T["default"],TaskAttached:x["default"],SupplierList:D["default"],TaskWorkTime:d["default"],TaskRegusView:M["default"],orderOrTaskDetail:_["default"],TaskCheckForm:f["default"],ReceiveMaterial:N["default"]},computed:{readOnly:function(){return this.selectTask&&2===this.selectTask.taskStatus},materialBadge:function(){if(!this.selectTask)return 0;if((0!==this.selectTask.outTask||1!==this.selectTask.taskType&&3!==this.selectTask.taskType&&4!==this.selectTask.taskType&&5!==this.selectTask.taskType)&&(2===this.selectTask.taskStatus||"2"!==this.curTabKey))return 0;if(this.materials&&this.materials.length){var e=0;return this.materials.forEach((function(t){0===t.actAmount&&0!==t.amount&&(1===t.opType||2===t.opType&&1===t.isGenOrder)&&e++})),e}return 0},formsBadge:function(){var e=0;return this.taskFormItemList.forEach((function(t){t.isIgnore&&1===t.isIgnore||t.selfCheck&&t.monitorCheck&&t.guarderCheck||e++})),this.checkFormItemList.forEach((function(t){t.checkUserId&&t.workTime||e++})),e}},data:function(){return{loading:!1,showSheetSave:!1,dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",readed:!1,curTabKey:"1",tabFormKey:0,toolInputValidRules:{taskName:[{required:!0,message:"请选择任务"}],code:[{required:!0,message:"请选择工器具"}],amount:[{required:!0,message:"数量必须填写"}],formName:[{validator:function(e){var t=e.row;if(6===t.category1&&!t.workRecordInstId)return new Error("计量器具必须指定一个记录表")}}],assetCode:[{validator:function(e){var t=e.row;if(6===t.category1&&!t.assetCode)return new Error("计量器具必须指定具体的工器具")}}]},materialInputValidRules:{taskName:[{required:!0,message:"请选择任务"}],code:[{required:!0,message:"请选择物料"}],amount:[{required:!0,message:"所需数量必须填写"}],actAmount:[{required:!0,message:"实际数量必须填写"}]},startDate:this.$moment(),tableDataTask:[],serialList:[],workOrderList:[],allAlign:"center",curToolEditMode:0,curMaterialEditMode:0,queryParam:{planId:null,planName:void 0,startDate:null,status:null,taskName:null,orderName:void 0,workOrderId:null,orderStatusList:[8],groupId:this.$store.getters.userInfo.departId},taskFormsList:[],taskFormItemList:[],checkFormItemList:[],defaultSelectTaskRow:"",selectTask:null,curFormIndex:0,curForm:null,curRecordForm:null,curOnlineForm:null,requirement:{},materials:[],tools:[],files:[],attachedfiles:[],staffArranges:[],regus:[],bookSteps:[],fileName:"",mustReplaces:[],workOrderInfo:{},taskInfo:{},curDepartId:this.$store.getters.userInfo.departId,defaultOptions:{container:"luckysheet",title:"sheet",column:26,row:50,lang:"zh",allowEdit:!0,showinfobar:!1,sheetFormulaBar:!1,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!1,showtoolbarConfig:{undoRedo:!0}},colNames:[],checkModalTitle:"自检",outModelInfo:{},inModelInfo:{},outRules:{billNo:[{required:!1,message:"请填写交接单号!"}],outinName:[{required:!0,message:"请填写交接单名称!"}],lineId:[{required:!0,message:"请选择线路!"}],trainNo:[{required:!0,message:"请选择车辆!"}],transferUserId:[{required:!0,message:"请选择移交人!"}],receiveUser:[{max:32,message:"不能超过32个字符!"}],transferDateM:[{required:!0,message:"请选择交接日期!"}],engineerId:[{required:!0,message:"请选择工程师!"}],sendGroupId:[{required:!0,message:"请选择作业班组!"}],supplierId:[{required:!0,message:"请选择接收厂商!"}],contractId:[{required:!0,message:"请选择所属合同!"}],remark:[{required:!1,max:200,message:"不能超过200个字符!"}]},inRules:{billNo:[{required:!1,message:"请填写交接单号!"}],outinName:[{required:!0,message:"请填写交接单名称!"}],lineId:[{required:!0,message:"请选择线路!"}],trainNo:[{required:!0,message:"请选择车辆!"}],receiveUser:[{required:!0,message:"请选择接收人!"}],transferUserId:[{max:32,message:"不能超过32个字符!"}],transferDateM:[{required:!0,message:"请选择交接日期!"}],engineerId:[{required:!0,message:"请选择工程师!"}],sendGroupId:[{required:!0,message:"请选择作业班组!"}],supplierId:[{required:!0,message:"请选择移交厂商!"}],contractId:[{required:!0,message:"请选择所属合同!"}],remark:[{required:!1,max:200,message:"不能超过200个字符!"}]},userSelectType:1,dictTrainStr:"",curSelectTrainStructId:"",supplierSelectType:1,superviseModel:null,bookStepContent:""}},created:function(){this.loadTaskList()},mounted:function(){for(var e=65;e<91;e++)this.colNames.push(String.fromCharCode(e))},methods:{moment:n.a,showAssetModal:function(){this.$refs.assetSelectModal.showModal(this.trainStructId)},onSelectAsset:function(e){Object(L["e"])(e)},saveFaultInfo:function(){this.loading=!0,this.$refs.breakdownForm.save()},onFaultSaveOk:function(){this.loading=!1},onFaultSaveFail:function(){this.loading=!1},openSupplierModal:function(e){1===e?(this.supplierSelectType=1,this.$refs.supplierModal.showModal(),this.$refs.mySupplierSelectOut.blur()):(this.supplierSelectType=2,this.$refs.supplierModal.showModal(),this.$refs.mySupplierSelectIn.blur())},supplierSelect:function(e){Object(L["e"])(e)||(1===this.supplierSelectType?(this.outModelInfo.supplierId=e[0].id,this.outModelInfo.supplierName=e[0].name,this.$refs.outInfoForm.validateField("supplierId")):(this.inModelInfo.supplierId=e[0].id,this.inModelInfo.supplierName=e[0].name,this.$refs.inInfoForm.validateField("supplierId")))},onChangeTab:function(e){this.readed||this.readOnly?(this.curTabKey=e,"2"===this.curTabKey&&0===this.selectTask.outTask&&this.loadCurForm(),this.saveAssetNo()):(this.curTabKey="1",this.$message.warning("请求先认真阅读作业要求"))},onReadClick:function(){var e=this;Object($["fb"])({safeAssumeId:this.requirement.safetyExpectationId,orderTaskId:this.selectTask.id}).then((function(t){if(t.success)for(var a=0;a<e.tableDataTask.length;a++)if(e.tableDataTask[a].id==e.selectTask.id){e.tableDataTask[a].taskStatus_dictText="已开始",e.tableDataTask[a].taskStatus=2;break}})),this.readed=!0},handleCheck:function(e,t){var a=this.$refs.recordListTable.getCheckboxRecords();if(a.length>0){var r=a.map((function(e,t){return e.id})).join(",");this.checkModalTitle=t,this.$refs.checkModalForm.showModal(r,e)}else this.$message.error("请选择要检查的作业记录明细!")},onCheckRecord:function(e){e.saveSuccess&&(this.loadRecordFormDetail(),this.getFormsItem())},openPlanModel:function(){this.$refs.planModalForm.showModal(),this.$refs.myPlanSelect.blur()},openOrderModel:function(){this.$refs.workOrderSelect.showModal(),this.$refs.myOrderSelect.blur()},onSelectPlan:function(e){this.queryParam.planId=e[0].id,this.queryParam.planName=e[0].planName},changePlanSelect:function(e){e||(this.queryParam.planId="")},onSelectOrder:function(e){this.queryParam.workOrderId=e[0].id,this.queryParam.orderName=e[0].orderName},changeOrderSelect:function(e){e||(this.queryParam.workOrderId="")},loadTaskList:function(){var e=this;this.selectTask=null,this.queryParam.startDate=this.startDate?n()(this.startDate).format("YYYY-MM-DD"):void 0,"admin"===this.$store.getters.userInfo.username?this.queryParam.groupId=null:this.queryParam.groupId=this.$store.getters.userInfo.departId,Object($["V"])(this.queryParam).then((function(t){t.success?(e.tableDataTask=t.result,e.tableDataTask&&e.tableDataTask.length>0&&(e.onTaskSelectChange({row:e.tableDataTask[0]}),e.$refs.listTable.setRadioRow(e.tableDataTask[0]))):e.$message.warning(t.message)}))},onTaskSelectChange:function(e){var t=this,a=e.row;this.saveAssetNo(),this.selectTask=a,this.readed=!1,this.curTabKey="1",this.taskFormItemList=[],this.checkFormItemList=[],this.$nextTick((function(){t.$refs.outInfoForm&&t.$refs.outInfoForm.clearValidate(),t.$refs.inInfoForm&&t.$refs.inInfoForm.clearValidate()})),this.getTaskInfo(this.selectTask.id),0===this.selectTask.outTask&&this.getTaskForms(this.selectTask.id),1===this.selectTask.outTask&&this.getOutTaskInfo(this.selectTask.id),2===this.selectTask.outTask&&this.getInTaskInfo(this.selectTask.id),2===this.selectTask.taskType&&0===this.selectTask.outTask&&this.$nextTick((function(){Object(j["P"])({id:t.selectTask.taskObjId}).then((function(e){var a=e.result;1!==a.status&&(a.status=1),t.$refs.breakdownForm.edit(a)}))})),8===this.selectTask.taskType&&0===this.selectTask.outTask&&this.loadSupervise()},getTaskInfo:function(e){var t=this;Object($["L"])(e).then((function(e){e.success&&(t.materials=e.result.materials,t.requirement=e.result.requirement,t.tools=e.result.tools,t.files=e.result.otherData,t.attachedfiles=e.result.annexList,t.regus=e.result.regus,t.bookSteps=e.result.bookSteps,t.mustReplaces=e.result.mustReplaces,t.staffArranges=e.result.staffArranges,t.taskInfo=e.result.task,t.workOrderInfo=e.result.workOrder,t.selectTask=e.result.task,t.setBookStepDom())}))},getOutTaskInfo:function(e){var t=this;Object($["z"])({id:e}).then((function(a){a.success&&(t.outModelInfo=a.result,t.outModelInfo.transferDate&&(t.outModelInfo.transferDateM=t.$moment(t.outModelInfo.transferDate)),t.outModelInfo.lineId&&(t.dictTrainStr="bu_train_info,train_no,train_no,line_id="+t.outModelInfo.lineId+"|train_struct_id"),Object($["L"])(e).then((function(e){e.success&&(t.taskInfo=e.result.task,t.workOrderInfo=e.result.workOrder,t.selectTask=e.result.task,t.outModelInfo.id||Object.assign(t.outModelInfo,{lineId:t.workOrderInfo.lineId,trainNo:t.workOrderInfo.trainNo,transferDateM:t.$moment(t.workOrderInfo.startTime),sendGroupId:t.workOrderInfo.groupId,workOrderId:t.workOrderInfo.id,orderTaskId:t.selectTask.id}))})))}))},getInTaskInfo:function(e){var t=this;Object($["z"])({id:e}).then((function(a){a.success&&(t.inModelInfo=a.result,t.inModelInfo.transferDate&&(t.inModelInfo.transferDateM=t.$moment(t.inModelInfo.transferDate)),t.inModelInfo.lineId&&(t.dictTrainStr="bu_train_info,train_no,train_no,line_id="+t.inModelInfo.lineId+"|train_struct_id"),Object($["L"])(e).then((function(e){e.success&&(t.taskInfo=e.result.task,t.workOrderInfo=e.result.workOrder,t.selectTask=e.result.task,t.inModelInfo.id||Object.assign(t.inModelInfo,{lineId:t.workOrderInfo.lineId,trainNo:t.workOrderInfo.trainNo,transferDateM:t.$moment(t.workOrderInfo.startTime),sendGroupId:t.workOrderInfo.groupId}))})))}))},getTaskForms:function(){var e=J(V().m((function e(t){var a=this;return V().w((function(e){while(1)switch(e.n){case 0:return this.curForm=null,this.taskFormsList=[],this.curFormIndex=0,e.a(2,Object($["K"])({taskId:t}).then((function(e){e.success&&(a.taskFormsList=e.result,a.getFormsItem(),a.selectForm(0))})))}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),selectForm:function(e){this.curFormIndex=e,this.saveAssetNo(),this.taskFormsList&&this.taskFormsList.length>0&&(this.curForm=this.taskFormsList[this.curFormIndex],this.loadCurForm())},getFormsItem:function(){var e=this;this.taskFormItemList=[],this.checkFormItemList=[],this.taskFormsList.forEach((function(t){3===t.instType?Object($["R"])({id:t.formInstId,needCategory:!1,needChecks:!0,orderTaskId:e.selectTask.id}).then((function(t){var a;t.success&&t.result?(a=e.taskFormItemList).push.apply(a,E(t.result.detailList)):e.$message.error("获取表单作业明细失败")})):4===t.instType&&Object($["s"])({id:t.formInstId}).then((function(t){var a;t.success&&t.result?(a=e.checkFormItemList).push.apply(a,E(t.result)):e.$message.error("获取表单作业明细失败")}))}))},getFormBadgeByRow:function(e){var t=0;return 3===e.instType?this.taskFormItemList.forEach((function(a){e.formInstId!==a.workRecordId||a.isIgnore&&1===a.isIgnore||a.selfCheck&&a.monitorCheck&&a.guarderCheck||t++})):4===e.instType&&this.checkFormItemList.forEach((function(a){e.formInstId!==a.checkId||a.checkUserId&&a.workTime||t++})),t},loadCurForm:function(){var e=this;if("2"===this.curTabKey&&this.taskFormsList&&0!==this.taskFormsList.length&&this.curForm){try{luckysheet.destroy()}catch(t){}3===this.curForm.instType&&this.loadRecordFormDetail(),1===this.curForm.instType&&this.loadOnlineFormDetail(),4===this.curForm.instType&&this.$nextTick((function(){e.$refs.checkRecordForm.findList(e.curForm.formInstId)}))}},loadRecordFormDetail:function(){var e=this,t={id:this.curForm.formInstId,needChecks:!0,needCategory:!1,orderTaskId:this.selectTask.id};Object($["R"])(t).then((function(t){t.success?e.curRecordForm=t.result:e.$message.error("获取作业记录表内容错误")})).catch((function(t){e.$message.error("获取作业记录表内容异常")}))},loadOnlineFormDetail:function(){var e=this,t={task2InstId:this.curForm.id,formInstId:this.curForm.formInstId,needValues:!1};Object($["Q"])(t).then((function(t){if(t.success){e.curOnlineForm=t.result;var a=null;if(e.curOnlineForm){if(e.curOnlineForm.result)try{a=JSON.parse(e.curOnlineForm.result)}catch(r){return void e.$message.error("转换表单填写结果异常")}Object(O["ub"])(e.curOnlineForm.formObjId).then((function(t){if(t.success){var r=JSON.parse(t.result);a&&(r.data=[],r.celldata=luckysheet.transToCellData(a)),e.initSheet(r)}else e.$message.error("获取表单模板数据失败")}))}else e.$message.error("获取作业表单数据失败")}else e.$message.error("获取记录表内容错误")})).catch((function(t){e.$message.error("获取记录表内容异常")}))},initSheet:function(e){var t=this,a=l()(this.defaultOptions);a.container="sheet",this.selectTask&&2===this.selectTask.taskStatus?(this.showSheetSave=!1,a.showtoolbarConfig={},e.config["authority"]&&(e.config["authority"]["allowRangeList"]=[])):this.showSheetSave=!0,a.data=[e],luckysheet.destroy(),luckysheet.create(a),setTimeout((function(){A["a"].setRangeConditionalOncell(t.curOnlineForm.formObjId,t.curOnlineForm.id)}),200),this.selectTask&&this.selectTask.taskStatus,luckysheet.setRangeShow("A1",{show:!1})},resizeSplitter:function(){var e=this;setTimeout((function(){e.curForm&&1===e.curForm.instType&&luckysheet.resize()}),100)},saveCustomForm:function(){var e=this,t=l()(this.curOnlineForm);t.result=JSON.stringify(luckysheet.getAllSheets()[0].data),t.writeDate=this.$moment().format("YYYY-MM-DD hh:mm:ss"),t.writeUserId=this.$store.getters.userInfo.id,t.writeGroupId=this.$store.getters.userInfo.departId,t.orderId=this.selectTask.orderId,t.orderTaskId=this.selectTask.id,Object($["bb"])(t).then((function(t){t.success?e.$message.success("保存成功"):e.$message.error("保存失败")})).catch((function(t){e.$message.error("保存异常")}))},checkMaterialList:function(){var e=J(V().m((function e(){var t;return V().w((function(e){while(1)switch(e.n){case 0:if(0===this.selectTask.outTask&&(1===this.selectTask.taskType||3===this.selectTask.taskType||4===this.selectTask.taskType||5===this.selectTask.taskType)||2!==this.selectTask.taskStatus&&"2"===this.curTabKey){e.n=1;break}return e.a(2,!0);case 1:return t=!0,this.materials.forEach((function(e){0===e.actAmount&&0!==e.amount&&(1===e.opType||2===e.opType&&1==e.isGenOrder)&&(t=!1)})),e.a(2,t)}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),checkTaskCanSubmit:function(){var e=J(V().m((function e(){var t,a,r,o=this,i=arguments;return V().w((function(e){while(1)switch(e.n){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:1,a={success:!0,forms:[],records:[],checkFomrs:[]},r=[],0===this.selectTask.outTask&&(1===this.selectTask.taskType||3===this.selectTask.taskType||4===this.selectTask.taskType||5===this.selectTask.taskType)){e.n=1;break}return e.a(2,a);case 1:return this.taskFormsList.forEach((function(e){3===e.instType&&1===t&&r.push(Object($["R"])({id:e.formInstId,needCategory:!1,needChecks:!0,orderTaskId:o.selectTask.id}).then((function(e){return e.success&&e.result?(a.forms.push(e.result),e.result.detailList):(o.$message.error("获取表单作业明细失败"),[])}))),4===e.instType&&2===t&&r.push(Object($["s"])({id:e.formInstId}).then((function(e){return a.forms.push(e.element),e.success&&e.result?e.result:(o.$message.error("获取表单作业明细失败"),[])})))})),e.a(2,Promise.all(r).then((function(e){return e.forEach((function(e){if(1===t){for(var r=0;r<e.length;r++){var i=e[r];i.isIgnore&&1===i.isIgnore||i.selfCheck&&i.monitorCheck&&i.guarderCheck||(a.success=!1,isOk=!1,a.records.push(i))}if(a.forms.length>0){var n=[];a.records.forEach((function(e){n.find((function(t){return t.formInstId===e.workRecordId}))||n.push(o.taskFormsList.find((function(t){return t.formInstId===e.workRecordId})))})),a.checkFomrs=n,a.formsName=n.map((function(e){return"《".concat(e.formName,"》")})).toString()}}if(2===t){for(var s=0;s<e.length;s++){var l=e[s];l.checkUserId&&l.workTime||(a.success=!1,isOk=!1,a.records.push(l))}if(a.records.length>0){var c=[];a.records.forEach((function(e){c.find((function(t){return t.formInstId===e.checkId}))||c.push(o.taskFormsList.find((function(t){return t.formInstId===e.checkId})))})),a.checkFomrs=c,a.formsName=c.map((function(e){return"《".concat(e.formName,"》")})).toString()}}})),a})))}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),submitTask:function(){var e=J(V().m((function e(){var t,a,r,o=this;return V().w((function(e){while(1)switch(e.n){case 0:if(this.saveAssetNo(),this.readed){e.n=1;break}return this.$message.warn("请先确认已阅读作业要求"),e.a(2);case 1:if(0!==this.selectTask.taskStatus){e.n=2;break}return this.$message.warn("请先确认已阅读作业要求，并完成填报操作"),e.a(2);case 2:return e.n=3,this.checkMaterialList();case 3:if(t=e.v,t){e.n=4;break}return this.$message.warn("物料消耗填报未完成，请检查！"),this.curTabKey="4",e.a(2);case 4:return e.n=5,this.checkTaskCanSubmit(1);case 5:if(a=e.v,a.success){e.n=6;break}return this.$message.warn("".concat(a.formsName,"未完成，请检查！")),this.curTabKey="2",this.tabFormKey=this.taskFormsList.findIndex((function(e){return e==a.checkFomrs[0]})),this.selectForm(this.tabFormKey),e.a(2);case 6:return e.n=7,this.checkTaskCanSubmit(2);case 7:if(r=e.v,r.success){e.n=8;break}return this.$message.warn("".concat(r.formsName,"未完成，请检查！")),this.curTabKey="2",this.tabFormKey=this.taskFormsList.findIndex((function(e){return e==r.checkFomrs[0]})),this.selectForm(this.tabFormKey),e.a(2);case 8:this.$confirm({content:"你确定提交该任务？",onOk:function(){if(8===o.selectTask.taskType){if(!o.superviseModel)return void o.$message.warn("你还没有保存监修申请，不能提交任务，请先保存监修申请信息");var e=o.superviseModel.id,t=o.superviseModel.orderTaskName+"[监修申请]",a={solutionCode:"WF_OUT_SUPERVISE",businessKey:e,title:t,variables:{}};o.$workflowApi.startSolution(a).then((function(e){e.success?o.submitTheTask():o.$message.error("提交失败")}))}else o.submitTheTask()}});case 9:return e.a(2)}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),submitTheTask:function(){var e=this,t={};t.taskId=this.selectTask.id,Object($["nb"])(t).then((function(t){if(t.success){e.$message.success(t.message);for(var a=0;a<e.tableDataTask.length;a++)if(e.tableDataTask[a].id==e.selectTask.id){e.tableDataTask[a].taskStatus_dictText="已完成",e.tableDataTask[a].taskStatus=2;break}}else e.$message.error(t.message?t.message:"提交失败")}))},onTaskSubmit:function(){this.loadTaskList()},saveAssetNo:function(){if(this.curRecordForm){var e={id:this.curRecordForm.id,manufNo:this.curRecordForm.manufNo,manufNoUp:this.curRecordForm.manufNoUp};Object($["eb"])(e).then((function(e){e.success}))}},onAddTool:function(){var e=this;if(!this.$refs.ToolsListTable.getActiveRecord()){this.curToolEditMode=1;var t={id:Object(L["p"])(),orderTaskId:""};this.selectTask&&Object.assign(t,{orderId:this.selectTask.orderId,orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}),this.$refs.ToolsListTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.ToolsListTable.setActiveCell(a,"code")}))}},editToolRowEvent:function(e){this.$refs.ToolsListTable.setActiveRow(e)},saveToolRowEvent:function(e){var t=this;this.$refs.ToolsListTable.validate(e,(function(a){a||Object($["gb"])(e).then((function(a){a.success?(1===t.curToolEditMode&&t.tools.push(e),t.$refs.ToolsListTable.clearActived(),t.curToolEditMode=0,t.$message.success("保存成功")):t.$message.error(a.message)})).catch((function(e){t.$message.error("保存工器具异常")}))}))},cancelToolRowEvent:function(e){this.$refs.ToolsListTable.clearActived(),1===this.curToolEditMode?this.$refs.ToolsListTable.remove(e):1===this.curToolEditMode&&this.$refs.ToolsListTable.revertData(e),this.curToolEditMode=0},onDelTool:function(){var e=this,t=this.$refs.ToolsListTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"数据？"),onOk:function(){var a=t.map((function(e,t){return e.id})),r=a.join(",");Object($["m"])({ids:r}).then((function(t){t.success?(a.map((function(t){e.tools.map((function(a,r){t===a.id&&e.tools.splice(r,1)}))})),e.$message.success("删除成功")):e.$message.error("删除失败")})).catch((function(t){e.$message.error("删除异常")}))}}):this.$message.error("尚未选中任何数据!")},onAddMaterial:function(){var e=this;if(!this.$refs.MaterialListTable.getActiveRecord()){this.curMaterialEditMode=1;var t={id:Object(L["p"])(),orderId:"",orderTaskId:""};this.selectTask&&Object.assign(t,{orderId:this.selectTask.orderId,orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}),this.$refs.MaterialListTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.MaterialListTable.setActiveCell(a,"code")}))}},editMaterialRowEvent:function(e){this.curMaterialEditMode=2,this.$refs.MaterialListTable.setActiveRow(e)},saveMaterialRowEvent:function(e){var t=this;this.$refs.MaterialListTable.validate(e,(function(a){a||F["fb"].call(t,{groupId:t.workOrderInfo.groupId,materialTypeId:e.materialTypeId}).then((function(a){a.success?e.actAmount>a.result?t.$message.warn("库存量不足,该物资当前班组库存量："+a.result):t.saveMaterialByRow(e):t.$message.error(res.message)}))}))},saveMaterialByRow:function(e){var t=this;Object($["cb"])(e).then((function(a){a.success?(t.$message.success("保存成功"),1===t.curMaterialEditMode&&t.materials.push(e),t.curMaterialEditMode=0,t.$refs.MaterialListTable&&t.$refs.MaterialListTable.clearActived()):t.$message.error("保存错误")})).catch((function(e){t.$message.error("保存异常")}))},cancelMaterialRowEvent:function(e){this.$refs.MaterialListTable.clearActived(),1===this.curMaterialEditMode?this.$refs.MaterialListTable.remove(e):2===this.curMaterialEditMode&&this.$refs.MaterialListTable.revertData(e),this.curMaterialEditMode=0},onDelMaterial:function(){var e=this,t=this.$refs.MaterialListTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"数据？"),onOk:function(){var a=t.map((function(e,t){return e.id})),r=a.join(",");Object($["j"])({ids:r}).then((function(t){t.success?(a.map((function(t){e.materials.map((function(a,r){t===a.id&&e.materials.splice(r,1)}))})),e.$message.success("删除成功")):e.$message.error("删除失败")})).catch((function(t){e.$message.error("删除异常")}))}}):this.$message.error("尚未选中任何数据!")},serialNoFormatter:function(e){var t=e.cellValue;return t||"无"},openToolSelectModal:function(e){this.curRow=e,this.$refs.toolModalForm.showModal(e.toolTypeId),this.$refs.toolSelect.blur()},openToolTypeSelectModal:function(e){this.curRow=e,this.$refs.toolTypeModalForm.showModal(),this.$refs.toolTypeSelect.blur()},onSelectTool:function(e){if(e&&e.length>0){var t=e[0];if(this.curRow.toolTypeId!==t.materialTypeId&&6!==t.category1)return void this.$message.error("你选择的工器具与需求类型不一样");this.curRow.toolId=t.id,this.curRow.assetCode=t.assetCode,this.$refs.ToolsListTable.validate(this.$refs.ToolsListTable.getActiveRecord().row,(function(e){}))}},onSelectToolType:function(e){if(e&&e.length>0){var t=e[0],a=0;if(this.tools.map((function(e){if(e.toolId===t.id)return a=1,!1})),1===a)return void this.$message.error("你选择的工器具已经在列表中存在，请选择其他工器具");this.curRow.code=t.code,this.curRow.toolTypeId=t.id,this.curRow.name=t.name,this.curRow.kind=t.kind,this.curRow.unit=t.unit,this.curRow.kind_dictText=t.kind_dictText,this.curRow.category1=t.category1,this.curRow.category1_dictText=t.category1_dictText,this.curRow.amount=t.num,this.curRow.toolId="",this.curRow.measure=6===t.category1?1:0}else this.curRow.code="",this.curRow.toolTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.category1="",this.curRow.category1_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.toolId="",this.curRow.measure="",this.curRow.assetCode="";this.$refs.ToolsListTable.validate(this.$refs.ToolsListTable.getActiveRecord().row,(function(e){}))},formSelectChange:function(e,t){var a=this.taskFormsList.filter((function(t){return t.formInstId===e}));a.length>0&&(this.$refs.ToolsListTable.getActiveRecord().row.workRecordInstName=a[0].formName,this.$refs.ToolsListTable.getActiveRecord().row.workRecordInstId=e,this.$refs.ToolsListTable.validate(this.$refs.ToolsListTable.getActiveRecord().row,(function(e){})))},openMaterialSelectModal:function(e){this.curRow=e,this.$refs.materialModalForm.showModal(),this.$refs.materialSelect.blur()},onSelectMaterial:function(e){if(e&&e.length>0){var t=e[0],a=0;if(this.materials.map((function(e){if(e.materialTypeId===t.id)return a=1,!1})),1===a)return void this.$message.error("你选择的物料已经在列表中存在，请选择其他物料");this.curRow.code=t.code,this.curRow.materialTypeId=t.id,this.curRow.name=t.name,this.curRow.kind=t.kind,this.curRow.unit=t.unit,this.curRow.kind_dictText=t.kind_dictText,this.curRow.category1=t.category1,this.curRow.category1_dictText=t.category1_dictText,this.curRow.amount=t.num,this.curRow.actAmount=0}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.category1="",this.curRow.category1_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.actAmount=0;this.$refs.MaterialListTable.validate(this.$refs.MaterialListTable.getActiveRecord().row,(function(e){}))},viewFile:function(e){this.fileName=e.fileName,this.$refs.docPreview.handleFilePath(e.savePath)},downFile:function(e){Object(P["b"])(e.savePath)},moreBtnClick:function(e){switch(e.key){case"1":this.createFault();break;case"2":this.createOpenItem();break;default:break}},createOpenItem:function(){if(this.taskFormsList&&this.taskFormsList>0){var e=this.$refs.recordListTable.getCheckboxRecords();if(e.length>0){var t=e.map((function(e,t){return e.workContent})).join(",");this.$refs.openItemModal.add(this.selectTask.orderId,this.selectTask.id,t)}else this.$message.error("请选择要设为开口先项的作业记录明细!")}else this.$refs.openItemModal.add(this.selectTask.orderId,this.selectTask.id,"")},createFault:function(){this.$refs.breakdownModal.setWorkStations(this.staffArranges),this.$refs.breakdownModal.edit({workOrderId:this.selectTask.orderId,orderTaskId:this.selectTask.id,formType:2,createType:2,happenTime:this.$moment().format("YYYY-MM-DD"),faultDesc:"",phase:1,status:1})},showUserModal:function(e){switch(this.userSelectType=e,this.$refs.tUserModalForm.showModal(),e){case 1:this.$refs.userSelect1.blur();break;case 2:this.$refs.userSelect2.blur();break}},onUserSelect:function(e){e.length&&(1===this.userSelectType&&(1===this.selectTask.outTask&&(this.outModelInfo.transferUserId=e[0].id,this.outModelInfo.transferUserName=e[0].realname,this.$refs.outInfoForm.validateField("transferUserId")),2===this.selectTask.outTask&&(this.inModelInfo.receiveUser=e[0].id,this.inModelInfo.receiveUserName=e[0].realname,this.$refs.inInfoForm.validateField("receiveUser"))),2===this.userSelectType&&(1===this.selectTask.outTask&&(this.outModelInfo.engineerId=e[0].id,this.outModelInfo.engineerName=e[0].realname,this.$refs.outInfoForm.validateField("engineerId")),2===this.selectTask.outTask&&(this.inModelInfo.engineerId=e[0].id,this.inModelInfo.engineerName=e[0].realname,this.$refs.outInfoForm.validateField("engineerId")))),this.$forceUpdate()},onLineChange:function(e,t){this.dictTrainStr=e?"bu_train_info,train_no,train_no,line_id="+e+"|train_struct_id":""},saveOutInInfo:function(){1===this.selectTask.outTask&&this.saveOutInfo(),2===this.selectTask.outTask&&this.saveInInfo()},loadSupervise:function(){var e=this,t={orderTaskId:this.selectTask.id,workOrderId:this.selectTask.orderId};Object(q["cb"])(t).then((function(t){if(t.success)e.superviseModel=t.result,e.$refs.superviseForm.edit(e.superviseModel);else{var a={orderTaskId:e.selectTask.id,workOrderId:e.selectTask.orderId,taskContent:e.selectTask.taskName,dispatchGroupId:e.workOrderInfo.groupId,trainNo:e.workOrderInfo.trainNo};e.$refs.superviseForm.edit(a)}}))},save8Task:function(){var e=this;this.$refs.superviseForm.validate().then((function(){e.$refs.superviseForm.save()}))},onTask8SaveSuccess:function(){this.$message.success("保存成功"),this.loadSupervise()},onTask8SaveFail:function(){this.$message.success("保存失败")},onAddOutPart:function(){this.outModelInfo.lineId&&this.outModelInfo.trainNo?(this.outModelInfo.outinDetails||(this.outModelInfo.outinDetails=[]),this.$refs.outPartModal.showModal(this.curSelectTrainStructId)):this.$message.warning("请先选择线路和车辆！")},onOutPartOk:function(e){this.outModelInfo.outinDetails.push(e)},onDeleteOutPart:function(){var e=this,t=this.$refs.outTable.getCheckboxRecords(),a=t.map((function(e){return e.id}));t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),onOk:function(){for(var t=e.outModelInfo.outinDetails.length-1;t>=0;t--){var r=e.outModelInfo.outinDetails[t];a.indexOf(r.id)>-1&&e.outModelInfo.outinDetails.splice(t,1)}}}):this.$message.error("尚未选中任何数据!")},saveOutInfo:function(){var e=this;this.$refs.outInfoForm.validate((function(t){if(t){if(!e.outModelInfo.outinDetails||e.outModelInfo.outinDetails.length<1)return void e.$message.warning("没有添加任何交接部件，请添加");e.outModelInfo.transferDate=e.outModelInfo.transferDateM.format("YYYY-MM-DD"),e.loading=!0,Object($["db"])(e.outModelInfo).then((function(t){t.success?e.$message.success("保存成功"):e.$message.error("保存失败")})).finally((function(){e.loading=!1}))}}))},onAddInPart:function(){this.inModelInfo.lineId&&this.inModelInfo.trainNo?(this.inModelInfo.outinDetails||(this.inModelInfo.outinDetails=[]),this.$refs.inPartModal.showModal(this.curSelectTrainStructId)):this.$message.warning("请先选择线路和车辆！")},onInPartOk:function(e){this.inModelInfo.outinDetails.push(JSON.parse(JSON.stringify(e)))},onDeleteInPart:function(){var e=this,t=this.$refs.inTable.getCheckboxRecords(),a=t.map((function(e){return e.id}));t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),onOk:function(){for(var t=e.inModelInfo.outinDetails.length-1;t>=0;t--){var r=e.inModelInfo.outinDetails[t];a.indexOf(r.id)>-1&&e.inModelInfo.outinDetails.splice(t,1)}}}):this.$message.error("尚未选中任何数据!")},saveInInfo:function(){var e=this;this.$refs.inInfoForm.validate((function(t){if(t){if(!e.inModelInfo.outinDetails||e.inModelInfo.outinDetails.length<1)return void e.$message.warning("没有添加任何交接部件，请添加");e.inModelInfo.transferDate=e.inModelInfo.transferDateM.format("YYYY-MM-DD"),e.loading=!0,Object($["db"])(e.inModelInfo).then((function(t){t.success?e.$message.success("保存成功"):e.$message.error("保存失败")})).finally((function(){e.loading=!1}))}}))},onTrainSelect:function(e,t){t&&(this.curSelectTrainStructId=t.extFields[0].train_struct_id)},onAddFile:function(e){var t=this;Object(j["l"])({deleteBefore:!0,orderId:this.workOrderInfo.id,taskId:this.taskInfo.id,annexList:E(this.attachedfiles)}).then((function(e){e.success||t.$message.error("上传文件失败")}))},mergeRowMethod:function(e){var t=e.row,a=e._rowIndex,r=e.column,o=e.visibleData,i=["reguTitle"],n=t[r.property];if(n&&i.includes(r.property)){var s=o[a-1],l=o[a+1];if(s&&s[r.property]===n)return{rowspan:0,colspan:0};var c=1;while(l&&l[r.property]===n)l=o[++c+a];if(c>1)return{rowspan:c,colspan:1}}},setBookStepDom:function(){var e="";this.bookSteps.forEach((function(t){e+="<h2>".concat(t.bookStepNo,'<span style="margin-left:15px;">').concat(t.bootStepTitle,"</span></h2>"),e+=t.bootStepContent})),e&&(this.$refs.bookStepDom.innerHTML=e)},onReceiveMaterialAdd:function(e){this.curMaterialEditMode=1,this.saveMaterialByRow(e)},onReceiveMaterialEdit:function(e){this.curMaterialEditMode=2,this.saveMaterialByRow(e)},checkMaterialShow:function(e){var t=e.row;if(1!==t.opType&&2!==t.opType||2===t.opType&&(!t.isGenOrder||0==t.isGenOrder))return"display: none;"},onTaskFormNoWork:function(e){this.tabFormKey=e,this.selectForm(e)}}},Q=H,Z=(a("ed12"),a("1898"),a("2877")),X=Object(Z["a"])(Q,r,o,!1,null,"3e6ca45c",null);t["default"]=X.exports},ab7d:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"故障编辑",width:"100%",centered:"",visible:e.visible,dialogClass:"fullDialog",confirmLoading:e.confirmLoading,cancelText:"关闭"},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticStyle:{height:"calc(100vh - 5px)","overflow-y":"auto"}},[e.visible?t("BreakdownFormItem",{ref:"breakdownForm",attrs:{fromWriteReport:e.fromWriteReport,workStationsList:e.workStationsList},on:{ok:e.onSaveOk,fail:e.onSaveFail,cancel:e.onSaveCancel}}):e._e()],1)])},o=[],i=a("d0ca"),n={name:"BreakdownModal",components:{BreakdownFormItem:i["default"]},props:{showWorkStation:{type:Boolean,default:!1},fromWriteReport:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,workStationsList:[]}},created:function(){},methods:{setWorkStations:function(e){var t=this;this.workStationsList.length=0,e.forEach((function(e){t.workStationsList.find((function(t){return t.workstationId===e.workstationId}))||t.workStationsList.push(e)}))},add:function(e,t,a){this.edit({workOrderId:e,orderTaskId:t,formType:a,createType:a})},edit:function(e){var t=this;this.visible=!0,this.$nextTick((function(){t.$refs.breakdownForm.edit(e)}))},handleOk:function(){this.confirmLoading=!0,this.$refs.breakdownForm.save()},onSaveOk:function(){this.confirmLoading=!1,this.visible=!1,this.$message.success("保存成功"),this.$emit("ok")},onSaveFail:function(){this.$message.error("保存失败"),this.confirmLoading=!1},onSaveCancel:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.confirmLoading=!1,this.visible=!1}}},s=n,l=(a("7068"),a("2877")),c=Object(l["a"])(s,r,o,!1,null,"12e1d6e2",null);t["default"]=c.exports},ae84:function(e,t,a){},b0c8:function(e,t,a){"use strict";a("815e")},b245:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"85%",title:"人员选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",bodyStyle:{height:"70vh"},destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-row",[t("a-col",{attrs:{md:4,sm:24}},[t("div",{staticStyle:{height:"calc(70vh - 20px)","border-right":"1px solid #e3e1e1","margin-right":"15px"}},[e.treeData&&e.treeData.length>0?t("a-tree",{staticClass:"limitHeight",attrs:{defaultSelectedKeys:[e.queryParam.depId],defaultExpandAll:!0,"tree-data":e.treeData},on:{select:e.onSelect}}):e._e()],1)]),t("a-col",{attrs:{md:20,sm:24}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"账号"}},[t("a-input",{attrs:{placeholder:"请输入用户账号"},model:{value:e.queryParam.username,callback:function(t){e.$set(e.queryParam,"username",t)},expression:"queryParam.username"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"真实名字"}},[t("a-input",{attrs:{placeholder:"请输入真实名字"},model:{value:e.queryParam.realname,callback:function(t){e.$set(e.queryParam,"realname",t)},expression:"queryParam.realname"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"手机号码"}},[t("a-input",{attrs:{placeholder:"请输入手机号码"},model:{value:e.queryParam.phone,callback:function(t){e.$set(e.queryParam,"phone",t)},expression:"queryParam.phone"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"角色"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"sys_role,role_name,id",placeholder:"选择角色"},model:{value:e.queryParam.roleId,callback:function(t){e.$set(e.queryParam,"roleId",t)},expression:"queryParam.roleId"}})],1)],1),t("a-col",{attrs:{md:2,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(70vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 130px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"manual",mode:"row"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"5%"}}):t("vxe-table-column",{attrs:{type:"radio",width:"5%"}}),t("vxe-table-column",{attrs:{field:"workNo",title:"工号",width:"100",align:"center"}}),t("vxe-table-column",{attrs:{field:"username",title:"用户账号",width:"150",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"realname",title:"用户名字",width:"100",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"roleNames",title:"角色","min-width":"180",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"sex_dictText",title:"性别",width:"80"}}),t("vxe-table-column",{attrs:{field:"phone",title:"手机号码",width:"120"}}),t("vxe-table-column",{attrs:{field:"orgCode",title:"部门",width:"120",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])],1)],1)},o=[],i=a("8fad"),n={name:"UserList",props:{multiple:{type:Boolean,default:!0},depId:{type:String,default:""}},data:function(){return{queryParam:{username:"",realname:"",phone:"",orgCode:"",roleId:void 0,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[]}},watch:{depId:function(e){this.$set(this.queryParam,"depId",e||"")}},mounted:function(){this.$set(this.queryParam,"depId",this.depId||"")},methods:{showModal:function(){this.visible=!0,this.findList(),this.getTreeList()},getTreeList:function(){var e=this;Object(i["pb"])().then((function(t){t.success&&(e.treeData=t.result)}))},onSelect:function(e,t){if(e.length){var a=t.node.dataRef;this.queryParam.depId=a.id,this.findList()}else this.queryParam.orgCode="",this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["jc"])(this.queryParam).then((function(t){e.loading=!1,t.success?(e.totalResult=t.result.total,e.tableData=t.result.records):e.$message.error("加载用户数据失败")})).catch((function(t){e.$message.error("加载用户数据异常")})).finally((function(){}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,Object.assign(this.$data,this.$options.data())}}},s=n,l=(a("f76d"),a("2877")),c=Object(l["a"])(s,r,o,!1,null,"4aa7956f",null);t["default"]=c.exports},b9c3:function(e,t,a){"use strict";a.d(t,"lb",(function(){return n})),a.d(t,"f",(function(){return s})),a.d(t,"i",(function(){return l})),a.d(t,"v",(function(){return c})),a.d(t,"b",(function(){return f})),a.d(t,"l",(function(){return m})),a.d(t,"p",(function(){return h})),a.d(t,"G",(function(){return p})),a.d(t,"c",(function(){return d})),a.d(t,"B",(function(){return b})),a.d(t,"k",(function(){return y})),a.d(t,"A",(function(){return v})),a.d(t,"x",(function(){return k})),a.d(t,"g",(function(){return w})),a.d(t,"E",(function(){return I})),a.d(t,"C",(function(){return T})),a.d(t,"M",(function(){return C})),a.d(t,"kb",(function(){return S})),a.d(t,"O",(function(){return _})),a.d(t,"N",(function(){return N})),a.d(t,"jb",(function(){return $})),a.d(t,"t",(function(){return P})),a.d(t,"d",(function(){return R})),a.d(t,"W",(function(){return L})),a.d(t,"X",(function(){return D})),a.d(t,"e",(function(){return j})),a.d(t,"o",(function(){return q})),a.d(t,"V",(function(){return E})),a.d(t,"R",(function(){return z})),a.d(t,"Q",(function(){return U})),a.d(t,"K",(function(){return V})),a.d(t,"L",(function(){return W})),a.d(t,"fb",(function(){return be})),a.d(t,"bb",(function(){return J})),a.d(t,"Y",(function(){return H})),a.d(t,"J",(function(){return Q})),a.d(t,"hb",(function(){return ie})),a.d(t,"U",(function(){return ne})),a.d(t,"eb",(function(){return Z})),a.d(t,"cb",(function(){return X})),a.d(t,"a",(function(){return ee})),a.d(t,"j",(function(){return ue})),a.d(t,"nb",(function(){return de})),a.d(t,"gb",(function(){return fe})),a.d(t,"m",(function(){return me})),a.d(t,"H",(function(){return ve})),a.d(t,"T",(function(){return Y})),a.d(t,"S",(function(){return F})),a.d(t,"mb",(function(){return A})),a.d(t,"z",(function(){return he})),a.d(t,"db",(function(){return pe})),a.d(t,"y",(function(){return ge})),a.d(t,"u",(function(){return u})),a.d(t,"F",(function(){return g})),a.d(t,"ob",(function(){return O})),a.d(t,"q",(function(){return M})),a.d(t,"D",(function(){return x})),a.d(t,"ib",(function(){return te})),a.d(t,"n",(function(){return ae})),a.d(t,"I",(function(){return K})),a.d(t,"P",(function(){return G})),a.d(t,"s",(function(){return se})),a.d(t,"Z",(function(){return le})),a.d(t,"ab",(function(){return ce})),a.d(t,"h",(function(){return re})),a.d(t,"w",(function(){return oe})),a.d(t,"r",(function(){return B}));var r=a("0fea"),o=a("4328"),i=a.n(o),n=function(e){return Object(r["j"])("/group/fault/info/submit",e)},s=function(e){return Object(r["j"])("/group/fault/info/cancel",e)},l=function(e){return Object(r["j"])("/group/fault/info/delete",e)},c=function(e){return Object(r["d"])("/group/fault/info/page",e)},u=function(e){return Object(r["d"])("/group/fault/info/get",e)},d=function(e){return Object(r["j"])("/group/safeassume/read/add",e)},f=function(e){return Object(r["j"])("/group/safeassume/add",e)},m=function(e){return Object(r["j"])("/group/safeassume/delete",e)},h=function(e){return Object(r["j"])("/group/safeassume/edit",e)},p=function(e){return Object(r["d"])("/group/safeassume/page",e)},g=function(e){return Object(r["d"])("/group/safeassume/get",e)},b=function(e){return Object(r["d"])("/group/turnoverchange/page",e)},v=function(e){return Object(r["d"])("/material/spare-part/get",e)},y=function(e){return Object(r["j"])("/group/turnoverchange/delete",e)},k=function(e){return Object(r["d"])("/group/measurealert/page",e)},w=function(e){return Object(r["j"])("/group/measurealert/close",e)},I=function(e){return Object(r["d"])("/group/spare-part/page",e)},T=function(e){return Object(r["d"])("/group/spare-part/get",e)},x=function(e){return Object(r["d"])("/produce/train/history/asset/use/page",e)},C=function(e){return Object(r["d"])("/group/toolequipment/page",e)},S=function(e){return Object(r["j"])("/group/toolequipment/setStatus",e)},M=function(e){return Object(r["d"])("/group/toolequipment/usage",e)},_=function(e){return Object(r["d"])("/group/tool/page",e)},N=function(e){return Object(r["d"])("/group/tool/get",e)},$=function(e){return Object(r["j"])("/group/tool/setDutyUser",e)},O=function(e){return Object(r["d"])("/group/tool/usage",e)},P=function(e){return Object(r["d"])("/group/information/basic",e)},R=function(e){return Object(r["j"])("/group/information/tools/add",e)},L=function(e){return Object(r["d"])("/group/information/workstation/page-related",e)},D=function(e){return Object(r["d"])("/group/information/workstation/page-unrelated",e)},j=function(e){return Object(r["j"])("/group/information/workstation/add",e)},q=function(e){return Object(r["j"])("/group/information/workstation/delete",e)},F=function(e){return Object(r["d"])("/workGroup/workOrder/relevanceInfo/".concat(e))},A=function(e){return Object(r["j"])("/workGroup/workOrder/submit-to-dispatcher",i.a.stringify(e))},E=function(e){return Object(r["d"])("/workGroup/workRecord/list",e)},U=function(e){return Object(r["d"])("/serialPlan/plan/forms/online-form/get",e)},z=function(e){return Object(r["d"])("/serialPlan/plan/forms/work-record/get",e)},G=function(e){return Object(r["d"])("/serialPlan/plan/forms/check-record/get",e)},Y=function(e){return Object(r["d"])("/workGroup/workOrder/page",e)},B=function(e){return Object(r["d"])("/workGroup/workOrder/apply/page",e)},V=function(e){return Object(r["d"])("/workGroup/workRecord/recordForm",e)},W=function(e){return Object(r["d"])("/workGroup/workRecord/relevanceInfo/".concat(e))},K=function(e){return Object(r["d"])("/workGroup/workRecord/relevanceInfo/bookSteps/".concat(e))},J=function(e){return Object(r["j"])("/workGroup/workRecord/save/form-result",e)},H=function(e){return Object(r["j"])("/workGroup/workRecord/check",e)},Q=function(e){return Object(r["j"])("/workGroup/workRecord/getTaskQRCode",e)},Z=function(e){return Object(r["j"])("/workGroup/workRecord/work-record/save-manufNo",i.a.stringify(e))},X=function(e){return Object(r["j"])("/workGroup/workRecord/save/material",e)},ee=function(e){return Object(r["j"])("/workGroup/workRecord/save/actMaterial",e)},te=function(e){return Object(r["j"])("/workGroup/workRecord/save/work-time",e)},ae=function(e){return Object(r["j"])("/workGroup/workRecord/arrange/delete",e)},re=function(e){return Object(r["j"])("/workGroup/workOrder/material/commit-temp-apply",e)},oe=function(e){return Object(r["d"])("/workGroup/workOrder/material/apply/list",e)},ie=function(e){return Object(r["j"])("/workGroup/workRecord/check/saveExcelData",e)},ne=function(e){return Object(r["d"])("/workGroup/workRecord/get/excelData/".concat(e))},se=function(e){return Object(r["d"])("/serialPlan/plan/forms/check-record/item/list",e)},le=function(e){return Object(r["j"])("/workGroup/workRecord/check-record/set-check",e)},ce=function(e){return Object(r["j"])("/workGroup/workRecord/check-record/set-time",e)},ue=function(e){return Object(r["j"])("/workGroup/workRecord/delete/material",i.a.stringify(e))},de=function(e){return Object(r["j"])("/workGroup/workRecord/submit-task",e)},fe=function(e){return Object(r["j"])("/workGroup/workRecord/save/tool",e)},me=function(e){return Object(r["j"])("/workGroup/workRecord/delete/tool",i.a.stringify(e))},he=function(e){return Object(r["d"])("/workGroup/workRecord/outsourceOutin",e)},pe=function(e){return Object(r["j"])("/workGroup/workRecord/save/outsourceOutin",e)},ge=function(e){return Object(r["d"])("/workGroup/workRecord/outin/not-returns",e)},be=function(e){return Object(r["j"])("/group/safeassume/read/add",i.a.stringify(e))},ve=function(e){return Object(r["d"])("/serialPlan/plan/page",e)}},c95b:function(e,t,a){},c984:function(e,t,a){},cc0c:function(e,t,a){"use strict";a("cdfd")},ccb3:function(e,t,a){},cdfd:function(e,t,a){},ceed:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bodyWrapper",staticStyle:{padding:"8px",display:"flex","flex-direction":"column"}},[t("div",{staticClass:"table-page-body-wrapper",staticStyle:{height:"auto"}},[t("div",{staticClass:"table-body-context"},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.tableData,"show-overflow":"tooltip"}},[t("vxe-table-column",{attrs:{field:"no",title:"序号",width:"60"}}),t("vxe-table-column",{attrs:{field:"title",title:"名称","min-width":"160",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"method_dictText",title:"维保手段",width:"120"}}),t("vxe-table-column",{attrs:{field:"qualityLevel_dictText",title:"质保等级",width:"100"}}),t("vxe-table-column",{attrs:{field:"requirement",title:"技术要求","min-width":"120",align:"left","header-align":"center"}})],1)],1)])])},o=[],i={name:"TaskRegusView",props:["tableData"],data:function(){return{visible:!1,dictTrainStr:""}},mounted:function(){},methods:{}},n=i,s=(a("e1e2"),a("2877")),l=Object(s["a"])(n,r,o,!1,null,"8422c7fc",null);t["default"]=l.exports},d0ca:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{height:"calc(100% - 0px)","overflow-y":"auto"}},[t("a-form-model",{ref:"form",staticStyle:{"margin-top":"10px"},attrs:{model:e.faultModel,rules:e.formRules}},[t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("故障信息")]),t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"列计划",prop:"planName"}},[t("div",{on:{click:e.openPlanModel}},[t("a-select",{ref:"myPlanSelect",attrs:{"allow-clear":"",placeholder:"请选择列计划",open:!1,showArrow:!0,triggerChange:!0},on:{change:e.changePlanSelect},model:{value:e.faultModel.planName,callback:function(t){e.$set(e.faultModel,"planName",t)},expression:"faultModel.planName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路",prop:"lineId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.changeLine},model:{value:e.faultModel.lineId,callback:function(t){e.$set(e.faultModel,"lineId",t)},expression:"faultModel.lineId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆",prop:"trainNo"}},[t("j-dict-select-seach-tag",{attrs:{triggerChange:!0,dictCode:e.dictTrainStr},on:{focus:e.handleSysFocus,change:e.handleTrainNo},model:{value:e.faultModel.trainNo,callback:function(t){e.$set(e.faultModel,"trainNo",t)},expression:"faultModel.trainNo"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"发现阶段",prop:"phase"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_fault_phase"},model:{value:e.faultModel.phase,callback:function(t){e.$set(e.faultModel,"phase",t)},expression:"faultModel.phase"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"发现时间",prop:"happenTime"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm","show-time":{format:"HH:mm",hideDisabledOptions:!0}},on:{change:function(t){e.faultModel.reportTime=void 0,e.handleModel.solutionTime=void 0,e.faultModel.solutionTime=void 0,e.reportTimeKey++,e.solutionTimeKey++}},model:{value:e.faultModel.happenTime,callback:function(t){e.$set(e.faultModel,"happenTime",t)},expression:"faultModel.happenTime"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障工位",prop:"workStationName"}},[t("a-select",{ref:"workStationSelect",attrs:{placeholder:"请选择故障工位",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(5)}},model:{value:e.faultModel.workStationName,callback:function(t){e.$set(e.faultModel,"workStationName",t)},expression:"faultModel.workStationName"}},[t("div",{attrs:{slot:"suffixIcon"},slot:"suffixIcon"},[e.faultModel.workStationName?t("a-icon",{staticStyle:{"padding-right":"3px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.clearValue(5)}}}):e._e(),t("a-icon",{attrs:{type:"ellipsis"}})],1)])],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"系统",prop:"sysId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,"dict-code":e.dictTrainSys},on:{change:e.changeLinesubsys,focus:e.handleSysFocus},model:{value:e.faultModel.sysId,callback:function(t){e.$set(e.faultModel,"sysId",t)},expression:"faultModel.sysId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障部件",prop:"faultAssetName"}},[t("a-select",{ref:"faultAssetSelect",attrs:{placeholder:"请选择",open:!1,showArrow:!0},on:{focus:e.showAssetModal},model:{value:e.faultModel.faultAssetName,callback:function(t){e.$set(e.faultModel,"faultAssetName",t)},expression:"faultModel.faultAssetName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"故障描述",prop:"faultDesc"}},[t("a-textarea",{attrs:{placeholder:"请输入内容"},model:{value:e.faultModel.faultDesc,callback:function(t){e.$set(e.faultModel,"faultDesc",t)},expression:"faultModel.faultDesc"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:{span:6},wrapperCol:{span:18},label:"其他属性"}},[t("a-row",[t("a-col",{attrs:{span:8}},[e._v(" 是否正线: "),t("a-switch",{model:{value:e.faultModel.faultOnline,callback:function(t){e.$set(e.faultModel,"faultOnline",t)},expression:"faultModel.faultOnline"}})],1),t("a-col",{attrs:{span:8}},[e._v(" 是否委外: "),t("a-switch",{model:{value:e.faultModel.outsource,callback:function(t){e.$set(e.faultModel,"outsource",t)},expression:"faultModel.outsource"}})],1)],1)],1)],1),e.faultModel.outsource?t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属厂商",prop:"outSupplierName"}},[t("a-select",{ref:"mySupplierSelect",attrs:{placeholder:"请选择厂商",triggerChange:!0,open:!1,showArrow:!0},on:{focus:e.openSupplierModal},model:{value:e.faultModel.outSupplierName,callback:function(t){e.$set(e.faultModel,"outSupplierName",t)},expression:"faultModel.outSupplierName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1):e._e()],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("提报信息")]),t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{ref:"reportGroupTag",attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"提报班组",prop:"reportGroupId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:e.dictGroupStr},model:{value:e.faultModel.reportGroupId,callback:function(t){e.$set(e.faultModel,"reportGroupId",t)},expression:"faultModel.reportGroupId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"提报人员",prop:"reportUserId"}},[t("a-select",{ref:"tmyuserSelect1",attrs:{placeholder:"请选择人员",open:!1},on:{focus:function(t){return e.showUserModal(1)}},model:{value:e.faultModel.reportUserName,callback:function(t){e.$set(e.faultModel,"reportUserName",t)},expression:"faultModel.reportUserName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.showUserModal(1)}},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"责任工程师",prop:"dutyEngineer"}},[t("a-select",{ref:"tmyuserSelect2",attrs:{placeholder:"请选择责任工程师",open:!1,showArrow:!0},on:{focus:function(t){return e.showUserModal(2)}},model:{value:e.faultModel.dutyEngineerName,callback:function(t){e.$set(e.faultModel,"dutyEngineerName",t)},expression:"faultModel.dutyEngineerName"}},[t("div",{attrs:{slot:"suffixIcon"},slot:"suffixIcon"},[e.faultModel.dutyEngineerName?t("a-icon",{staticStyle:{"padding-right":"3px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.clearValue(6)}}}):e._e(),t("a-icon",{attrs:{type:"ellipsis"}})],1)])],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{key:"reportTime"+e.reportTimeKey,attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"提报时间",prop:"reportTime"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{disabledDate:e.dateTimeDisabled1,disabledTime:e.disabledDateTime1,format:"YYYY-MM-DD HH:mm","show-time":!!e.faultModel.happenTime&&{format:"HH:mm",hideDisabledOptions:!0}},on:{change:function(t){e.handleModel.solutionTime=void 0,e.faultModel.solutionTime=void 0,e.solutionTimeKey++}},model:{value:e.faultModel.reportTime,callback:function(t){e.$set(e.faultModel,"reportTime",t)},expression:"faultModel.reportTime"}})],1)],1)],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("处理信息")]),t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理状态",prop:"status"}},[t("a-radio-group",{attrs:{name:"radioGroup",disabled:e.fromWriteReport},on:{change:e.changeFaultStatus},model:{value:e.faultModel.status,callback:function(t){e.$set(e.faultModel,"status",t)},expression:"faultModel.status"}},[t("a-radio",{attrs:{value:0}},[e._v(" 未处理")]),t("a-radio",{attrs:{value:1}},[e._v(" 已处理")]),t("a-radio",{attrs:{value:3}},[e._v(" 遗留故障")])],1)],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障代码",prop:"faultCodeId"}},[t("a-select",{ref:"faultCodeIdSelect",attrs:{placeholder:"请选择所属故障代码",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(2)}},model:{value:e.faultModel.faultCodeCodeDes,callback:function(t){e.$set(e.faultModel,"faultCodeCodeDes",t)},expression:"faultModel.faultCodeCodeDes"}},[t("div",{attrs:{slot:"suffixIcon"},slot:"suffixIcon"},[e.faultModel.faultCodeId?t("a-icon",{staticStyle:{"padding-right":"3px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.clearValue(2)}}}):e._e(),t("a-icon",{attrs:{type:"ellipsis"}})],1)])],1)],1),e.faultModel.status>0&&4!==e.faultModel.status?t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障等级",prop:"faultLevel"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_fault_level"},model:{value:e.faultModel.faultLevel,callback:function(t){e.$set(e.faultModel,"faultLevel",t)},expression:"faultModel.faultLevel"}})],1)],1):e._e()],1),e.faultModel.status>0&&4!==e.faultModel.status?t("a-row",[t("a-col",{directives:[{name:"show",rawName:"v-show",value:e.faultModel.faultCodeId,expression:"faultModel.faultCodeId"}],attrs:{span:24}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"代码详情"}},[e.getFaultdetailLoading?t("a-icon",{attrs:{type:"loading"}}):t("a-space",[e._l(e.getFaultdetailList,(function(a,r){return t("span",{key:r,staticStyle:{color:"#c1c1c1"}},[e._v("故障"+e._s(a.fltLevel_dictText)+"："+e._s(a.fltCode)+"-"+e._s(a.fltName)+"；")])})),t("span",{staticStyle:{color:"#c1c1c1"}},[e._v("故障部件："+e._s(e.faultModel.faultCodeCode)+"-"+e._s(e.faultModel.faultCodeCodeDes)+"；")])],2)],1)],1)],1):e._e(),e.faultModel.status>0&&4!==e.faultModel.status?t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{key:"solutionTime"+e.solutionTimeKey+e.reportTimeKey,attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理时间",prop:"solutionTime"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{disabledDate:e.dateTimeDisabled2,disabledTime:e.disabledDateTime2,format:"YYYY-MM-DD HH:mm","show-time":!!e.faultModel.reportTime&&{format:"HH:mm",hideDisabledOptions:!0}},on:{change:e.datePickerChange},model:{value:e.handleModel.solutionTime,callback:function(t){e.$set(e.handleModel,"solutionTime",t)},expression:"handleModel.solutionTime"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"原因描述",prop:"reasonDesc"}},[t("a-textarea",{attrs:{placeholder:"请输入内容"},model:{value:e.faultModel.reasonDesc,callback:function(t){e.$set(e.faultModel,"reasonDesc",t)},expression:"faultModel.reasonDesc"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"措施描述",prop:"solutionDesc"}},[t("a-textarea",{attrs:{placeholder:"请输入内容"},model:{value:e.faultModel.solutionDesc,callback:function(t){e.$set(e.faultModel,"solutionDesc",t)},expression:"faultModel.solutionDesc"}})],1)],1)],1):e._e(),e.faultModel.status>0&&4!==e.faultModel.status?t("a-row",[t("a-col",{attrs:{span:8}},[e.faultModel.status>0&&4!==e.faultModel.status?t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理结果",prop:"handleStatus"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_handlestatus"},model:{value:e.faultModel.handleStatus,callback:function(t){e.$set(e.faultModel,"handleStatus",t)},expression:"faultModel.handleStatus"}})],1):e._e()],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理班组",prop:"solutionGroupId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:e.dictGroupStr},model:{value:e.faultModel.solutionGroupId,callback:function(t){e.$set(e.faultModel,"solutionGroupId",t)},expression:"faultModel.solutionGroupId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理人员",prop:"solutionUserId"}},[t("a-select",{ref:"tmyuserSelect3",attrs:{placeholder:"请选择处理人员",open:!1},on:{focus:function(t){return e.showUserModal(3)}},model:{value:e.handleModel.solutionUserName,callback:function(t){e.$set(e.handleModel,"solutionUserName",t)},expression:"handleModel.solutionUserName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1)],1):e._e()],1),t("div",{staticClass:"clearfix"},[t("a-row",[t("a-col",{attrs:{span:12}},[t("DocUpload",{ref:"upload",attrs:{"default-file-list":e.defaultFileList,"show-upload":!1,isFileEmpty:!0},on:{uploaded:e.successUploadFile,removed:e.onRemoveFile,uploadFail:e.uploadFail}})],1)],1),t("a-row",[t("a-divider",{staticStyle:{"font-size":"14px"},attrs:{orientation:"left"}},[e._v("已上传列表")]),t("vxe-table",{staticStyle:{"margin-top":"12px"},attrs:{data:e.annexList,"show-overflow":"tooltip","show-header":!1,"edit-config":{trigger:"manual",mode:"row"}}},[t("div",{}),t("vxe-table-column",{attrs:{type:"index",title:"序号",width:"50px","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"name",title:"文件名","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"annexType_dictText",title:"附件类型",width:"120px","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{title:"操作",width:"160px","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row,o=a.rowIndex;return[t("a",{staticStyle:{"margin-right":"12px"},on:{click:function(t){return t.stopPropagation(),e.handleSeeing(r)}}},[e._v("查看")]),t("a",{on:{click:function(t){return t.stopPropagation(),e.handleDelete(r,o)}}},[e._v("删除")])]}}])})],1)],1)],1)]),t("train-plan-list",{ref:"planModalForm",on:{ok:e.onSelectPlan}}),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}}),t("user-list",{ref:"tUserModalForm",attrs:{"dep-id":1===e.userSelectType?e.faultModel.reportGroupId:3===e.userSelectType?e.faultModel.solutionGroupId:"",multiple:!1},on:{ok:e.onUserSelect}}),t("fault-category-list",{ref:"categorySelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-code-list",{ref:"codeSelect",attrs:{type:"unit",multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-reason-list",{ref:"reasonSelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-solution-list",{ref:"solutionSelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("work-station-list",{ref:"stationSelectModal",on:{ok:e.onSelectStation}}),t("CarDeviceSelectNew",{ref:"assetSelect",attrs:{canSelectType:[3,4],trainNo:e.faultModel.trainNo,lineId:e.faultModel.lineId,multiple:!1},on:{ok:e.addFaultAsset}}),t("supplier-list",{ref:"supplierModal",attrs:{multiple:!1},on:{ok:e.supplierSelect}})],1)},o=[],i=a("c1df"),n=a.n(i),s=a("8fad"),l=a("b245"),c=a("b47d"),u=a("ca00"),d=a("5371"),f=a("a396"),m=a("0e7b"),h=a("6034"),p=a("3cb5"),g=a("769e"),b=a("1158"),v=a("353a"),y=a("310d"),k=a("60e2"),w=a("2f62");function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function T(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return x(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(x(t={},r,(function(){return this})),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,x(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,x(d,"constructor",c),x(c,"constructor",l),l.displayName="GeneratorFunction",x(c,o,"GeneratorFunction"),x(d),x(d,o,"Generator"),x(d,r,(function(){return this})),x(d,"toString",(function(){return"[object Generator]"})),(T=function(){return{w:i,m:f}})()}function x(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}x=function(e,t,a,r){function i(t,a){x(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},x(e,t,a,r)}function C(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function S(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){C(i,r,o,n,s,"next",e)}function s(e){C(i,r,o,n,s,"throw",e)}n(void 0)}))}}function M(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?M(Object(a),!0).forEach((function(t){N(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function N(e,t,a){return(t=$(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $(e){var t=O(e,"string");return"symbol"==I(t)?t:t+""}function O(e,t){if("object"!=I(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var P={name:"BreakdownFormItem",components:{UserList:l["default"],DocUpload:d["default"],FaultCategoryList:f["default"],FaultCodeList:m["default"],FaultReasonList:h["default"],FaultSolutionList:p["default"],SupplierList:g["default"],DocPreviewModal:v["default"],WorkStationList:b["default"],CarDeviceSelectNew:y["default"],TrainPlanList:k["default"]},props:{workStationsList:{type:Array,default:function(){return[]}},fromWriteReport:{type:Boolean,default:!1}},data:function(){return{getFaultdetailLoading:!1,getFaultdetailList:[],solutionTimeKey:0,reportTimeKey:0,dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",defaultFileList:[],annexList:[],fileList:[],filePath:"",fileName:"",status:!1,saveFlag:!0,uploading:!1,value:1,faultModel:{planName:void 0,planId:void 0,reportTime:void 0,happenTime:void 0,solutionTime:void 0,reasonDesc:void 0,solutionDesc:void 0,workStationName:void 0},handleModel:{solutionTime:void 0},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}},labelCol2:{xs:{span:24},sm:{span:2}},wrapperCol2:{xs:{span:24},sm:{span:21}},labelCol3:{xs:{span:24},sm:{span:13}},wrapperCol3:{xs:{span:24},sm:{span:11}},userSelectType:1,dictTrainStr:"",dictCodefaultcode:"bu_fault_code,fault_code,id",dictCodesubsys:"",dictTrainSys:"",confirmLoading:!1,trainStructId:"",faultCodeLevelList:[],formRules:{faultSn:[],categoryId:[{required:!1,message:"请选择故障分类!",trigger:"change"}],faultCodeId:[{required:!0,message:"请选择故障代码!",trigger:"change"}],faultLevel:[{required:!0,message:"请选择故障等级!",trigger:"change"}],workStationName:[{required:!1,message:"请选择故障工位!",trigger:"change"}],happenTime:[{required:!0,message:"请选择故障发现时间!"}],lineId:[{required:!0,message:"请选择所属线路!",trigger:"change"}],trainNo:[{required:!0,message:"请选择车辆!",trigger:"change"}],sysId:[{required:!0,message:"请选择所属系统!",trigger:"change"}],faultAssetName:[{required:!0,message:"请选择部件!",trigger:"change"}],faultDesc:[{required:!0,message:"请填写故障描述!",trigger:"change"},{max:249,message:"输入长度不能超过249字符!"}],phase:[{required:!0,message:"请选择发现阶段!"}],outSupplierName:[{required:!0,message:"请选择厂商!",trigger:"change"}],planName:[{required:!0,message:"请选择列计划!",trigger:"change"}],faultOnline:[],hasDuty:[],outsource:[],reportGroupId:[{required:!0,message:"请选择提报班组!",trigger:"change"}],reportUserId:[{required:!0,message:"请选择提报人员",trigger:"change"}],dutyEngineer:[],status:[],closeTime:[],handleStatus:[{required:!0,message:"请选择处理结果!",trigger:"change"}],faultReasonId:[{required:!0,message:"请选择故障原因!",trigger:"change"}],faultSolutionId:[{required:!0,message:"请选择处理措施!",trigger:"change"}],reasonDesc:[{required:!0,message:"请输入原因描述!",trigger:"change"},{max:249,message:"输入长度不能超过249字符!"}],solutionDesc:[{required:!0,message:"请输入措施描述!",trigger:"change"},{max:249,message:"输入长度不能超过249字符!"}],reportTime:[{required:!0,message:"请选择提报时间!",trigger:"change"}],solutionTime:[{required:!0,message:"请选择故障处理时间!",trigger:"change"}],solutionGroupId:[{required:!0,message:"请选择处理班组!",trigger:"change"}],solutionUserId:[{required:!0,message:"请选择处理人员!",trigger:"change"}],closeUserId:[]},reason:{categoryId:"",faultCodeId:""},solution:{categoryId:"",faultCodeId:"",faultReasonId:""},reasonList:[],solutionList:[],faultId:"",formType:"",faultType:"",assetTypeData:[],isWriteSave:!1}},computed:_({},Object(w["d"])(["user"])),created:function(){this.fromWriteReport&&(this.formRules.categoryId[0].required=!0,this.formRules.faultCodeId[0].required=!0,this.formRules.faultLevel[0].required=!0,this.formRules.workStationName[0].required=!0)},methods:{onSelectPlan:function(e){this.faultModel.planName=e[0].planName,this.faultModel.planId=e[0].id,this.faultModel.lineId=e[0].lineId,this.faultModel.trainNo=e[0].trainNo,this.changeLine(e[0].lineId),this.$refs.form.validateField("planName"),this.$refs.form.validateField("lineId"),this.$refs.form.validateField("trainNo")},changePlanSelect:function(e){e||(this.faultModel.planName="",this.faultModel.planId="",this.$refs.form.validateField("planName"))},openPlanModel:function(){this.$refs.planModalForm.showModal()},getFaultCodeLevel:function(e){var t=this;Object(c["ab"])({id:e}).then((function(e){e.success&&e.result&&t.$set(t.faultModel,"faultLevel",e.result.levelValue)}))},getFaultdetail:function(e){var t=this;this.getFaultdetailLoading=!0,Object(c["db"])({code:e}).then((function(e){e.success&&e.result.length&&(t.getFaultdetailList=e.result.filter((function(e){return 0!==e.fltLevel&&3!==e.fltLevel}))),t.getFaultdetailLoading=!1})).catch((function(e){t.getFaultdetailLoading=!1}))},range:function(e,t){for(var a=[],r=e;r<t;r++)a.push(r);return a},dateTimeDisabled1:function(e){var t=n()(this.faultModel.happenTime).format("YYYY-MM-DD");return!this.faultModel.happenTime||e<=n()(t)},dateTimeDisabled2:function(e){var t=n()(this.faultModel.reportTime).format("YYYY-MM-DD");return!this.faultModel.reportTime||e<=n()(t)},disabledDateTime1:function(){var e,t,a=this,r=n()(this.faultModel.happenTime),o=n()(this.faultModel.reportTime);return r.format("YYYY-MM-DD")!==o.format("YYYY-MM-DD")?(e=0,t=0):(e=this.faultModel.happenTime?n()(r).get("hours"):0,t=this.faultModel.happenTime?n()(r).get("minutes")+1:0),{disabledHours:function(){return a.range(0,e)},disabledMinutes:function(){return a.range(0,t)}}},disabledDateTime2:function(){var e,t,a=this,r=n()(this.faultModel.reportTime),o=n()(this.handleModel.solutionTime);return r.format("YYYY-MM-DD")!==o.format("YYYY-MM-DD")?(e=0,t=0):(e=this.faultModel.reportTime?n()(r).get("hours"):0,t=this.faultModel.reportTime?n()(r).get("minutes")+1:0),{disabledHours:function(){return a.range(0,e)},disabledMinutes:function(){return a.range(0,t)}}},handleSysFocus:function(){this.faultModel.lineId||this.$message.warn("请先选择线路!")},handleAssetFocus:function(){this.faultModel.trainNo||this.$message.warn("请先选择车辆!")},handleTrainNo:function(e,t){t.extFields&&(this.trainStructId=t.extFields[0].train_struct_id)},showAssetModal:function(){this.faultModel.trainNo?(this.$refs.assetSelect.showModal(),this.$refs.faultAssetSelect.blur()):this.$message.warn("请先选择车辆!")},openSelectTypeModal:function(e){switch(this.faultType=e,e){case 1:this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur();break;case 2:this.$refs.codeSelect.showModal(),this.$refs.faultCodeIdSelect.blur();break;case 3:this.$refs.reasonSelect.showModal(),this.$refs.faultReasonIdSelect.blur();break;case 4:this.$refs.solutionSelect.showModal(),this.$refs.faultSolutionIdSelect.blur();break;case 5:this.$refs.stationSelectModal.showModal(),this.$refs.workStationSelect.blur();break}},addFaultAsset:function(e){Object(u["e"])(e)||(this.faultModel.trainStructureId=e[0].structDetailId,this.faultModel.faultAssetName=e[0].assetName,this.faultModel.faultAssetId=e[0].id,this.$refs.form.validateField("faultAssetName"))},addCategoryTarget:function(e){e.length&&(1===this.faultType&&(this.faultModel.categoryId=e[0].id,this.faultModel.categoryCode=e[0].categoryCode,this.faultModel.categoryCodeDes=e[0].categoryDesc,this.faultModel.faultLevel&&(this.faultModel.faultLevel=""),this.$refs.form.validateField("categoryId")),2===this.faultType&&(this.faultModel.faultCodeId=e[0].id,this.faultModel.faultCodeCode=e[0].fltCode,this.faultModel.faultCodeCodeDes=e[0].fltName,this.faultModel.faultLevel&&(this.faultModel.faultLevel=""),this.$refs.form.validateField("faultCodeId"),this.getFaultCodeLevel(this.faultModel.faultCodeId),this.getFaultdetail(this.faultModel.faultCodeId)),3===this.faultType&&(this.faultModel.faultReasonId=e[0].id,this.faultModel.faultReasonCode=e[0].reasonCode,this.$set(this.faultModel,"reasonDesc",e[0].reasonDesc),this.$refs.form.validateField("faultReasonId"),this.$refs.form.validateField("reasonDesc")),4===this.faultType&&(this.faultModel.faultSolutionId=e[0].id,this.faultModel.faultSolutionCode=e[0].solutionCode,this.$set(this.faultModel,"solutionDesc",e[0].solutionDesc),this.$refs.form.validateField("faultSolutionId"),this.$refs.form.validateField("solutionDesc")))},clearValue:function(e){1===e&&(this.faultModel.categoryId="",this.faultModel.categoryCode="",this.faultModel.categoryCodeDes=""),2===e&&(this.faultModel.faultCodeId="",this.faultModel.faultCodeCode="",this.faultModel.faultCodeCodeDes=""),5===e&&(this.faultModel.workStationId="",this.faultModel.workStationName=""),6===e&&(this.faultModel.dutyEngineerName="",this.faultModel.dutyEngineer="")},successUploadFile:function(e){var t=this;e.map((function(e){Object.assign(e,{id:Object(u["p"])()})})),e&&e.length>0?(e.map((function(e){var a={annexType:1,fileId:e.id,type:e.type,fileSize:e.fileSize,name:e.name,savepath:e.savepath};t.annexList.push(a)})),this.saveFaultInfo()):this.saveFaultInfo()},saveFaultInfo:function(){var e=this,t=Object.assign({},this.faultModel,{happenTime:n()(this.faultModel.happenTime).format("YYYY-MM-DD HH:mm:ss"),reportTime:n()(this.faultModel.reportTime).format("YYYY-MM-DD HH:mm:ss"),closeTime:this.faultModel.closeTime?n()(this.faultModel.closeTime).format("YYYY-MM-DD HH:mm:ss"):null,faultOnline:this.faultModel.faultOnline?1:0,hasDuty:0,outsource:this.faultModel.outsource?1:0});this.handleModel.solutionTime=n()(this.handleModel.solutionTime).format("YYYY-MM-DD HH:mm:ss"),t.status>0&&4!==t.status?t.handleRecordList=[Object.assign({},this.handleModel,{faultReasonId:this.faultModel.faultReasonId,faultSolutionId:this.faultModel.faultSolutionId,reasonDesc:this.faultModel.reasonDesc,solutionDesc:this.faultModel.solutionDesc,solutionGroupId:this.faultModel.solutionGroupId})]:t.handleRecordList=[];var a=null;t["annexList"]=this.annexList,this.faultModel.id?a=Object(c["F"])(t):(t["id"]=this.faultId,a=Object(c["b"])(t)),a.then((function(t){t.success?(e.isWriteSave=!0,e.$emit("ok")):e.$emit("fail")})).catch((function(t){e.$emit("fail")})).finally((function(){}))},setBforeUploadStatus:function(e){this.saveFlag=e},setUpLoadingEndStatus:function(e){this.saveFlag=e},uploadFail:function(e){this.$emit("fail")},onRemoveFile:function(e){},beginUpload:function(){this.confirmLoading=!0,this.$refs.upload.beginUpload()},handlePrivilege:function(){var e=S(T().m((function e(t,a){var r,o=this;return T().w((function(e){while(1)switch(e.n){case 0:return r={id:t,operation:a},e.n=1,Object(s["xc"])(r).then((function(e){o.status=e.result}));case 1:return e.a(2)}}),e)})));function t(t,a){return e.apply(this,arguments)}return t}(),handleSeeing:function(){var e=S(T().m((function e(t){return T().w((function(e){while(1)switch(e.n){case 0:this.fileName=t.name,this.$refs.docPreview.handleFilePath(t.savepath);case 1:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleDelete:function(){var e=S(T().m((function e(t,a){var r;return T().w((function(e){while(1)switch(e.n){case 0:r=this,r.$confirm({title:"提示",content:"确定删除该条附件吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){r.annexList.splice(a,1)},onCancel:function(){}});case 1:return e.a(2)}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),add:function(e,t,a){this.edit({workOrderId:e,orderTaskId:t,formType:a,createType:a})},edit:function(e){var t={faultOnline:!1,hasDuty:!1,outsource:!1,status:0,reportUserName:"",reportUserId:"",dutyEngineer:"",dutyEngineerName:"",closeUserId:"",closeUserName:"",categoryId:"",categoryCode:"",categoryCodeDes:"",faultCodeId:"",faultCodeCode:"",faultReasonId:"",faultReasonCode:"",faultSolutionId:"",faultSolutionCode:"",solutionUserId:"",solutionUserName:"",faultAssetId:"",reportGroupId:"",outSupplierId:"",outSupplierName:"",sysId:"",subSysId:"",trainNo:"",lineId:"",faultAssetName:"",trainStructureId:"",happenTime:"",workStationId:"",workStationName:"",solutionTime:"",solutionGroupId:"",solutionDesc:"",reasonDesc:"",reportTime:"",planName:"",planId:""};e.workStationName=e.workstationName,this.faultModel=Object.assign(t,e),this.faultModel.categoryCode&&(this.isWriteSave=!0),this.faultModel.reportTime&&(this.faultModel.reportTime=this.$moment(this.faultModel.reportTime)),this.faultModel.faultCodeId&&this.getFaultdetail(this.faultModel.faultCodeId),this.faultModel.happenTime&&(this.faultModel.happenTime=this.$moment(this.faultModel.happenTime)),Object(u["e"])(this.faultModel.handleRecordList)||(this.handleModel=this.faultModel.handleRecordList[0],this.faultModel=Object.assign(this.faultModel,{faultReasonId:this.handleModel.faultReasonId,faultSolutionId:this.handleModel.faultSolutionId,reasonDesc:this.handleModel.reasonDesc,solutionDesc:this.handleModel.solutionDesc,solutionGroupId:this.handleModel.solutionGroupId,faultSolutionCode:this.handleModel.faultSolutionCode,faultReasonCode:this.handleModel.faultReasonCode,solutionUserId:this.handleModel.solutionUserId,solutionUserName:this.handleModel.solutionUserName,solutionTime:this.handleModel.solutionTime})),Object(u["e"])(e)||(this.faultModel=Object.assign(this.faultModel,{faultOnline:1===e.faultOnline,hasDuty:1===e.hasDuty,outsource:1===e.outsource}),e.annexList&&(this.annexList=e.annexList)),2===e.formType&&(""===this.faultModel.reportUserName&&""===this.faultModel.reportUserId&&this.$store.getters.userInfo.departIsGroup&&(this.faultModel.reportUserName=this.$store.getters.userInfo.realname,this.faultModel.reportUserId=this.$store.getters.userInfo.id),Object(u["e"])(this.faultModel.reportGroupId)&&this.$store.getters.userInfo.departIsGroup&&this.$set(this.faultModel,"reportGroupId",this.$store.getters.userInfo.departId)),this.workStationsList.length>0&&(this.faultModel.workStationId=this.workStationsList[0].workstationId,this.faultModel.workStationName=this.workStationsList[0].workstationName),this.formType=e.formType,this.faultModel.submitStatus||(this.faultModel.submitStatus=1===this.formType?1:0),this.changeFaultStatus()},handleChange:function(e){var t=e.file;t.status},changeFaultStatus:function(){(2===this.formType&&0!==this.faultModel.status||this.fromWriteReport)&&(this.faultModel.solutionGroupId&&""!==this.faultModel.solutionGroupId||!this.$store.getters.userInfo.departIsGroup||(this.faultModel.solutionGroupId=this.$store.getters.userInfo.departId),this.handleModel.solutionUserId&&this.faultModel.solutionUserName||!this.$store.getters.userInfo.departIsGroup||(this.faultModel.solutionUserName=this.$store.getters.userInfo.realname,this.faultModel.solutionUserId=this.$store.getters.userInfo.id,this.handleModel.solutionUserName=this.$store.getters.userInfo.realname,this.handleModel.solutionUserId=this.$store.getters.userInfo.id))},changeClose:function(e){this.isClose=e},showUserModal:function(e){switch(this.userSelectType=e,this.$refs.tUserModalForm.showModal(),e){case 1:this.$refs.tmyuserSelect1.blur();break;case 2:this.$refs.tmyuserSelect2.blur();break;case 3:this.$refs.tmyuserSelect3.blur();break;case 4:this.$refs.tmyuserSelect4.blur();break}},onUserSelect:function(e){e.length&&(1===this.userSelectType&&(this.faultModel.reportUserName=e[0].realname,this.faultModel.reportUserId=e[0].id,this.$refs.form.validateField("reportUserId")),2===this.userSelectType&&(this.faultModel.dutyEngineerName=e[0].realname,this.faultModel.dutyEngineer=e[0].id,this.$refs.form.validateField("dutyEngineer")),3===this.userSelectType&&(this.handleModel.solutionUserName=e[0].realname,this.handleModel.solutionUserId=e[0].id,this.faultModel.solutionUserName=e[0].realname,this.faultModel.solutionUserId=e[0].id,this.$refs.form.validateField("solutionUserId")),4===this.userSelectType&&(this.faultModel.closeUserName=e[0].realname,this.faultModel.closeUserId=e[0].id,this.$forceUpdate(),this.$refs.form.validateField("closeUserId")),this.$forceUpdate())},datePickerChange:function(e){this.handleModel.solutionTime=e,this.faultModel.solutionTime=e,this.$refs.form.validateField("solutionTime")},openSupplierModal:function(){this.$refs.supplierModal.showModal(),this.$refs.mySupplierSelect.blur()},supplierSelect:function(e){Object(u["e"])(e)||(this.faultModel.outSupplierName=e[0].name,this.faultModel.outSupplierId=e[0].id,this.$refs.form.validateField("outSupplierName"))},changeLine:function(e,t){this.dictTrainStr="",e&&(this.dictTrainStr="bu_train_info,train_no,train_no,line_id="+e+"|train_struct_id",this.dictTrainSys="bu_train_asset_type,name,id,struct_type=1 and parent_id is null and train_type_id=(select train_type_id from bu_mtr_line where line_id="+e+" )")},changeLinesubsys:function(e,t){this.dictCodesubsys="",!0!==t&&(this.faultModel.subSysId=null,this.faultModel.faultAssetId=null),e&&(this.dictCodesubsys="bu_train_asset_type,name,id,struct_type=2 and parent_id='"+e+"'")},save:function(){var e=this,t=this;this.$refs.form.validate((function(a){a?(t.faultModel.id?t.faultId=t.faultModel.id:t.faultId=Object(u["p"])(),e.beginUpload()):(e.$message.warn("请填写必须填写的信息"),e.$emit("cancel"))}))},check:function(){var e=this;return new Promise((function(t,a){e.$refs.form.validate((function(r){r?e.isWriteSave?t(!0):a("你还有没有保存故障信息, 请先保存故障信息"):a("请填写必须填写的信息")}))}))},onSelectStation:function(e){e&&e.length>0&&(this.faultModel.workStationId=e[0].id,this.faultModel.workStationName=e[0].name,this.$refs.form.validateField("workStationName"))}}},R=P,L=(a("d6d3"),a("2877")),D=Object(L["a"])(R,r,o,!1,null,"0aeefc58",null);t["default"]=D.exports},d0f9:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:800,visible:e.visible,confirmLoading:e.confirmLoading,centered:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-row",[t("a-col",{attrs:{md:18}},[t("div",[t("a-form",{ref:"initForm",attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录名称"}},[t("a-row",{attrs:{gutter:10}},[t("a-col",{attrs:{span:14}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserName",e.validatorRules.checkUserName],expression:"['checkUserName', validatorRules.checkUserName]",modifiers:{trim:!0}}]})],1),t("a-col",{attrs:{span:10}},[t("a-button",{attrs:{type:"link"},on:{click:e.useCurrentUser}},[e._v("使用当前账号和密码")])],1)],1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录密码"}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserPwd",e.validatorRules.checkUserPwd],expression:"['checkUserPwd', validatorRules.checkUserPwd]",modifiers:{trim:!0}}]})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查结果"}},[t("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["exp",{initialValue:!1}],expression:"['exp', { initialValue: false }]",modifiers:{trim:!0}}]},[e._v(" 异常")]),t("a-checkbox",{on:{change:e.onIgnoreChange},model:{value:e.isIgnore,callback:function(t){e.isIgnore=t},expression:"isIgnore"}},[e._v(" 忽略")])],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"同检人员"}},[t("a-select",{ref:"userSelect",attrs:{placeholder:"请选择人员",open:!1,showArrow:!0,allowClear:""},on:{change:e.clearTogetherCheckUserNames,dropdownVisibleChange:function(t){return e.openSelectUser()}},model:{value:e.togetherCheckUserNames,callback:function(t){e.togetherCheckUserNames=t},expression:"togetherCheckUserNames"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"结果描述"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["resultDesc",{initialValue:"",rules:[{required:e.isIgnore,message:"请输入忽略原因!"}]}],expression:"[\n                'resultDesc',\n                { initialValue: '', rules: [{ required: isIgnore, message: '请输入忽略原因!' }] },\n              ]",modifiers:{trim:!0}}],attrs:{"auto-size":{minRows:8,maxRows:8}}})],1)],1)],1)]),t("a-col",{attrs:{md:6}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("div",{staticStyle:{margin:"30px 10px 20px","text-align":"center"}},[t("a-spin",{attrs:{spinning:e.qrLoading}},[e.imageBase64Url?t("img",{staticClass:"QRcode",attrs:{src:e.imageBase64Url,alt:""}}):t("img",{staticClass:"QRcode",attrs:{src:a("a6da"),alt:""}})])],1),t("div",{staticStyle:{"text-align":"center"}},[e._v("通过APP扫码确认")])])],1)],1),t("UserList",{ref:"userSelectModal",attrs:{multiple:!0},on:{ok:e.onSelectUser}})],1)},o=[],i=a("b9c3"),n=a("b245"),s=a("986e"),l={name:"SheetItemModal",components:{UserList:n["default"]},props:["title","formInstId","workRecordType"],data:function(){return{detailIds:"",checkType:-1,colIndex:0,value:1,status:1,switchCheck:!0,visible:!1,model:{},labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:18}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{checkUserName:{rules:[{required:!0,message:"请输入登录名称!"}]},checkUserPwd:{rules:[{required:!0,message:"请输入密码!"}]},checkResult:{rules:[{required:!0,message:"选择检查结果!"}]}},isIgnore:!1,qrLoading:!1,imageBase64Url:"",togetherCheckUserIds:"",togetherCheckUserNames:""}},mounted:function(){var e=this;s["a"].$on("topic",(function(t){e.$message.success(t.msgTxt);var a=Object.assign(e.model);a.detailIds=1===e.workRecordType?e.detailIds:e.detailIds.join(","),a.result=a.exp?0:1,a.isIgnore=e.isIgnore?1:0,a.type=e.checkType,a.workRecordId=e.formInstId,a.colIndex=e.colIndex,a.workRecordType=e.workRecordType,a.detailIds=e.detailIds,e.$emit("scan",{saveSuccess:!0,data:a}),e.close()}))},methods:{add:function(){this.edit({})},getTaskQRCode:function(e){var t=this;this.qrLoading=!0,Object(i["J"])({formDetails:"string"===typeof this.detailIds?this.detailIds:this.detailIds.join(","),checkType:this.checkType,colIndex:this.colIndex,formInstId:e.formInstId,formType:e.instType,fromBy:"PC",orderId:e.workOrderId,targetType:"TASK",taskId:e.workOrderTaskId,workRecordType:e.workRecordType}).then((function(e){t.qrLoading=!1,e.success&&(t.imageBase64Url=e.result.base64)}))},showModal:function(e,t){var a=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;this.imageBase64Url="",this.detailIds=e,this.checkType=t,this.colIndex=r,this.getTaskQRCode(o),this.form.resetFields(),this.isIgnore=!1,this.visible=!0,1===this.checkType&&this.$nextTick((function(){a.form.setFieldsValue({checkUserName:a.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~"})})),this.$nextTick((function(){a.form.setFieldsValue({exp:"",resultDesc:""})}))},useCurrentUser:function(){var e=this;this.$nextTick((function(){e.form.setFieldsValue({checkUserName:e.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~"})}))},clearTogetherCheckUserNames:function(e){e||(this.togetherCheckUserIds="",this.togetherCheckUserNames="")},openSelectUser:function(){this.$refs.userSelectModal.showModal(),this.$refs.userSelect.blur()},onSelectUser:function(e){if(e.length){var t="",a="";e.forEach((function(e,r,o){t+=e.realname,a+=e.id,r<o.length-1&&(t+=",",a+=",")})),this.togetherCheckUserIds=a,this.togetherCheckUserNames=t}},handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,r){if(!a){var o=Object.assign(t.model,r);o.detailIds=1===e.workRecordType?e.detailIds:e.detailIds.join(","),o.result=o.exp?0:1,o.isIgnore=e.isIgnore?1:0,o.type=e.checkType,o.workRecordId=e.formInstId,o.colIndex=e.colIndex,o.workRecordType=e.workRecordType,o.togetherCheckUserIds=e.togetherCheckUserIds,o.togetherCheckUserNames=e.togetherCheckUserNames,Object(i["Y"])(o).then((function(a){a.success?(t.$message.success(a.message),o.detailIds=e.detailIds,a.result&&(o.checkUserInfo=a.result),t.$emit("ok",{saveSuccess:!0,data:o}),t.close()):t.$message.error(a.message)})).finally((function(){}))}}))},handleCancel:function(){this.close()},onIgnoreChange:function(){var e=this;this.$nextTick((function(){e.form.resetFields("resultDesc")}))},close:function(){this.$emit("close"),this.visible=!1}}},c=l,u=(a("fb4f"),a("2877")),d=Object(u["a"])(c,r,o,!1,null,"0804228c",null);t["default"]=d.exports},d214:function(e,t,a){"use strict";a.d(t,"h",(function(){return o})),a.d(t,"D",(function(){return i})),a.d(t,"eb",(function(){return n})),a.d(t,"r",(function(){return s})),a.d(t,"b",(function(){return l})),a.d(t,"w",(function(){return c})),a.d(t,"H",(function(){return u})),a.d(t,"I",(function(){return p})),a.d(t,"k",(function(){return d})),a.d(t,"c",(function(){return g})),a.d(t,"x",(function(){return b})),a.d(t,"l",(function(){return y})),a.d(t,"K",(function(){return v})),a.d(t,"a",(function(){return k})),a.d(t,"v",(function(){return w})),a.d(t,"j",(function(){return T})),a.d(t,"F",(function(){return I})),a.d(t,"J",(function(){return f})),a.d(t,"G",(function(){return m})),a.d(t,"t",(function(){return h})),a.d(t,"Q",(function(){return x})),a.d(t,"u",(function(){return C})),a.d(t,"db",(function(){return N})),a.d(t,"q",(function(){return $})),a.d(t,"bb",(function(){return O})),a.d(t,"cb",(function(){return P})),a.d(t,"C",(function(){return _})),a.d(t,"g",(function(){return M})),a.d(t,"P",(function(){return S})),a.d(t,"X",(function(){return D})),a.d(t,"ab",(function(){return q})),a.d(t,"f",(function(){return F})),a.d(t,"p",(function(){return j})),a.d(t,"jb",(function(){return L})),a.d(t,"kb",(function(){return R})),a.d(t,"Z",(function(){return E})),a.d(t,"e",(function(){return U})),a.d(t,"A",(function(){return z})),a.d(t,"n",(function(){return G})),a.d(t,"m",(function(){return B})),a.d(t,"O",(function(){return K})),a.d(t,"Y",(function(){return J})),a.d(t,"V",(function(){return Q})),a.d(t,"gb",(function(){return Z})),a.d(t,"hb",(function(){return X})),a.d(t,"L",(function(){return ee})),a.d(t,"ib",(function(){return te})),a.d(t,"B",(function(){return A})),a.d(t,"y",(function(){return V})),a.d(t,"d",(function(){return W})),a.d(t,"z",(function(){return H})),a.d(t,"W",(function(){return ae})),a.d(t,"o",(function(){return Y})),a.d(t,"fb",(function(){return re})),a.d(t,"i",(function(){return oe})),a.d(t,"E",(function(){return ie})),a.d(t,"s",(function(){return ne})),a.d(t,"M",(function(){return se})),a.d(t,"N",(function(){return le})),a.d(t,"S",(function(){return ce})),a.d(t,"T",(function(){return ue})),a.d(t,"U",(function(){return de})),a.d(t,"R",(function(){return fe}));var r=a("0fea"),o=function(e){return Object(r["j"])("/outsource/supplier/add",e)},i=function(e){return Object(r["j"])("/outsource/supplier/edit",e)},n=function(e){return Object(r["d"])("/outsource/supplier/page",e)},s=function(e){return Object(r["j"])("/outsource/supplier/delete",e)},l=function(e){return Object(r["j"])("/outsource/contractInfo/add",e)},c=function(e){return Object(r["j"])("/outsource/contractInfo/edit",e)},u=function(e){return Object(r["d"])("/outsource/contractInfo/page",e)},d=function(e){return Object(r["j"])("/outsource/contractInfo/delete",e)},f=function(e){return Object(r["d"])("/outsource/contractInfo/monitor",e)},m=function(e){return Object(r["d"])("/outsource/contract/annex/list",e)},h=function(e){return Object(r["j"])("/outsource/contract/annex/delete",e)},p=function(e){return Object(r["d"])("/outsource/contractInfo/price",e)},g=function(e){return Object(r["j"])("/outsource/contractPay/add",e)},b=function(e){return Object(r["j"])("/outsource/contractPay/edit",e)},v=function(e){return Object(r["d"])("/outsource/contractPay/page",e)},y=function(e){return Object(r["j"])("/outsource/contractPay/delete",e)},k=function(e){return Object(r["j"])("/outsource/contractBakMoney/add",e)},w=function(e){return Object(r["j"])("/outsource/contractBakMoney/edit",e)},I=function(e){return Object(r["d"])("/outsource/contractBakMoney/page",e)},T=function(e){return Object(r["j"])("/outsource/contractBakMoney/delete",e)},x=function(e){return Object(r["d"])("/outsource/outin/page",e)},C=function(e){return Object(r["j"])("/outsource/outin/delete",e)},S=function(e){return Object(r["d"])("/outsource/outin/page/detail",e)},M=function(e){return Object(r["j"])("/outsource/supervise/add",e)},_=function(e){return Object(r["j"])("/outsource/supervise/edit",e)},N=function(e){return Object(r["d"])("/outsource/supervise/page",e)},$=function(e){return Object(r["j"])("/outsource/supervise/delete",e)},O=function(e){return Object(r["d"])("/outsource/supervise/get",{id:e})},P=function(e){return Object(r["d"])("/outsource/supervise/get-by-order",e)},R=function(e){return Object(r["d"])("/outsource/perform/vendor/tree",e)},L=function(e){return Object(r["j"])("/outsource/perform/delayReason",e)},D=function(e){return Object(r["d"])("/outsource/perform/page",e)},j=function(e){return Object(r["j"])("/outsource/perform/delete/resource",e)},q=function(e){return Object(r["d"])("/outsource/perform/resource",e)},F=function(e){return Object(r["j"])("/outsource/perform/resource/add",e)},A=function(e){return Object(r["j"])("/outsource/perform/resource/edit",e)},E=function(e){return Object(r["d"])("/outsource/rateing/page",e)},U=function(e){return Object(r["j"])("/outsource/rateing/add",e)},z=function(e){return Object(r["j"])("/outsource/rateing/edit",e)},G=function(e){return Object(r["j"])("/outsource/rateing/delete",e)},Y=function(e){return Object(r["j"])("/outsource/rateing/delete/attachment",e)},B=function(e){return Object(r["j"])("/outsource/otherSource/delete",e)},V=function(e){return Object(r["j"])("/outsource/otherSource/edit",e)},W=function(e){return Object(r["j"])("/outsource/otherSource/add",e)},K=function(e){return Object(r["d"])("/outsource/otherSource/page",e)},J=function(e){return Object(r["d"])("/outsource/quality/page",e)},H=function(e){return Object(r["j"])("/outsource/quality/edit",e)},Q=function(e){return Object(r["d"])("/outsource/part/page",e)},Z=function(e){return Object(r["d"])("/outsource/fault/countFault",e)},X=function(e){return Object(r["d"])("/outsource/fault/countFaultGroupBySystem",e)},ee=function(e){return Object(r["d"])("/outsource/fault/page",e)},te=function(e){return Object(r["j"])("/outsource/fault/countFaultGroupByPhaseAndSystem",e)},ae=function(e){return Object(r["d"])("/outsource/contractPay/page",e)},re=function(e){return Object(r["d"])("/training/record/page",e)},oe=function(e){return Object(r["j"])("/training/record/add",e)},ie=function(e){return Object(r["j"])("/training/record/edit",e)},ne=function(e){return Object(r["j"])("/training/record/delete",e)},se=function(e){return Object(r["d"])("/base/finance/project/list",e)},le=function(e){return Object(r["d"])("/base/finance/task/list",e)},ce=function(e){return Object(r["d"])("/outsource/cost/listCost",e)},ue=function(e){return Object(r["d"])("/outsource/cost/detail",e)},de=function(e){return Object(r["d"])("/outsource/cost/part",e)},fe=function(e){return Object(r["d"])("/outsource/cost/asset",e)}},d425:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:"工器具选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工器具名称"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工器具分类"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择工器具分类",dictCode:"bu_tools_type",disabled:e.canSelectType&&1===e.canSelectType.length},model:{value:e.queryParam.toolType,callback:function(t){e.$set(e.queryParam,"toolType",t)},expression:"queryParam.toolType"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工班"}},[t("j-dict-select-tag",{attrs:{dictCode:"sys_depart,depart_name,id,org_category=4",placeholder:"请选择工班"},model:{value:e.queryParam.groupId,callback:function(t){e.$set(e.queryParam,"groupId",t)},expression:"queryParam.groupId"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","cell-class-name":e.cellClassName,"radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"工器具类型编码"}}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称"}}),t("vxe-table-column",{attrs:{field:"model",title:"规格型号"}}),t("vxe-table-column",{attrs:{field:"assetCode",title:"资产编码"}}),t("vxe-table-column",{attrs:{field:"serialNo",title:"出厂编号"}}),t("vxe-table-column",{attrs:{field:"toolType_dictText",title:"类别"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"groupName",title:"所属班组"}}),t("vxe-table-column",{attrs:{field:"nextCheckTime",title:"下次送检",width:"100"}}),t("vxe-table-column",{attrs:{field:"isOverTime",title:"是否逾期",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getIsOverTimeStatus(a))+" ")]}}])}),t("vxe-table-column",{attrs:{field:"isOverTimeDays",title:"逾期天数",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getIsOverTimeDays(a))+" ")]}}])})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("c54ca"),n={name:"ToolsList",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:null},groupId:{type:String,default:null}},data:function(){return{queryParam:{searchText:"",toolType:"6",groupId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.toolType=this.canSelectType[0]+""),this.groupId&&(this.queryParam.groupId=this.groupId),e&&(this.queryParam.materialTypeId=e),this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["Db"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"num",1)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.queryParam.materialTypeId=this.$options.data().queryParam.materialTypeId,this.visible=!1},checkRadioMethod:function(e){var t=e.row;return!this.canSelectType||this.canSelectType.indexOf(t.toolType)>-1},getIsOverTimeStatus:function(e){if(e.nextCheckTime){var t=this.$moment(new Date).format("YYYY-MM-DD"),a=this.$moment(e.nextCheckTime).diff(t,"day");return a<0?"是":"否"}return"否"},cellClassName:function(e){var t=e.row,a=(e.rowIndex,e.column),r=(e.columnIndex,["nextCheckTime","isOverTime","isOverTimeDays"]);if(r.includes(a.property)&&t.nextCheckTime){var o=this.$moment(new Date).format("YYYY-MM-DD"),i=this.$moment(t.nextCheckTime).diff(o,"day");if("nextCheckTime"===a.property){if(i<=0)return"table-cell-bg-red";if(i>0&&i<=15)return"table-cell-bg-yellow"}if("isOverTime"===a.property&&i<0)return"table-cell-bg-red";if("isOverTimeDays"===a.property&&i<0)return"table-cell-bg-red"}},getIsOverTimeDays:function(e){if(e.nextCheckTime){var t=this.$moment(new Date).format("YYYY-MM-DD"),a=this.$moment(e.nextCheckTime).diff(t,"day");if(a<0)return Math.abs(a)}return""}}},s=n,l=(a("623c"),a("2877")),c=Object(l["a"])(s,r,o,!1,null,"8f25e80a",null);t["default"]=c.exports},d4ad:function(e,t,a){},d4bc:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:800,visible:e.visible,confirmLoading:e.confirmLoading,centered:"",destroyOnClose:!0,cancelText:"关闭"},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticStyle:{padding:"0px 20px"}},[t("a-form-model",{ref:"outPartForm",attrs:{model:e.modalInfo,rules:e.modalRules}},[t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"线路",prop:"lineId"}},[t("j-dict-select-tag",{attrs:{disabled:"",triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.onLineChange},model:{value:e.modalInfo.lineId,callback:function(t){e.$set(e.modalInfo,"lineId",t)},expression:"modalInfo.lineId"}})],1),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"车号",prop:"trainNo"}},[t("j-dict-select-seach-tag",{attrs:{disabled:"",triggerChange:!0,dictCode:e.dictTrainStr},model:{value:e.modalInfo.trainNo,callback:function(t){e.$set(e.modalInfo,"trainNo",t)},expression:"modalInfo.trainNo"}})],1),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"设备选择",prop:"turnoverAssetId"}},[t("div",{on:{click:e.selectAsset}},[t("a-select",{ref:"assetSelect",attrs:{placeholder:"请选择送修设备","allow-clear":"",open:!1,showArrow:!0},model:{value:e.modalInfo.assetName,callback:function(t){e.$set(e.modalInfo,"assetName",t)},expression:"modalInfo.assetName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"外观状态",prop:"facadeStatus"}},[t("a-select",{model:{value:e.modalInfo.facadeStatus,callback:function(t){e.$set(e.modalInfo,"facadeStatus",t)},expression:"modalInfo.facadeStatus"}},[t("a-select-option",{attrs:{value:"0"}},[e._v(" 无问题 ")]),t("a-select-option",{attrs:{value:"1"}},[e._v(" 有问题 ")])],1)],1),"1"===e.modalInfo.facadeStatus?t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"外观描述",prop:"facadeDesc"}},[t("a-input",{model:{value:e.modalInfo.facadeDesc,callback:function(t){e.$set(e.modalInfo,"facadeDesc",t)},expression:"modalInfo.facadeDesc"}})],1):e._e(),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"工装状态",prop:"mixtoolStatus"}},[t("a-select",{model:{value:e.modalInfo.mixtoolStatus,callback:function(t){e.$set(e.modalInfo,"mixtoolStatus",t)},expression:"modalInfo.mixtoolStatus"}},[t("a-select-option",{attrs:{value:"0"}},[e._v(" 无问题 ")]),t("a-select-option",{attrs:{value:"1"}},[e._v(" 有问题 ")])],1)],1),"1"===e.modalInfo.mixtoolStatus?t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"工装描述",prop:"mixtoolDesc"}},[t("a-input",{model:{value:e.modalInfo.mixtoolDesc,callback:function(t){e.$set(e.modalInfo,"mixtoolDesc",t)},expression:"modalInfo.mixtoolDesc"}})],1):e._e(),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"存在故障",prop:"fault"}},[t("a-select",{model:{value:e.modalInfo.fault,callback:function(t){e.$set(e.modalInfo,"fault",t)},expression:"modalInfo.fault"}},[t("a-select-option",{attrs:{value:"0"}},[e._v(" 不存在 ")]),t("a-select-option",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,value:"1"}},[e._v(" 存在 ")])],1)],1),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"备注",prop:"remark"}},[t("a-textarea",{attrs:{"auto-size":{minRows:3,maxRows:6},placeholder:"请输入备注信息"},model:{value:e.modalInfo.remark,callback:function(t){e.$set(e.modalInfo,"remark",t)},expression:"modalInfo.remark"}})],1)],1)],1),t("CarDeviceSelectNew",{ref:"assetSelectModal",attrs:{trainNo:e.modalInfo.trainNo,lineId:e.modalInfo.lineId,multiple:!1},on:{ok:e.onSelectAsset}})],1)},o=[],i=a("ca00"),n=a("310d"),s={name:"OutPartModal",components:{CarDeviceSelectNew:n["default"]},props:{title:{type:String,default:"部件添加"},lineId:{type:String,default:""},trainNo:{type:String,default:""},existAssets:{type:Array,default:function(){return[]}}},data:function(){return{visible:!1,confirmLoading:!1,modalInfo:{turnoverAssetId:"",facadeStatus:"0",mixtoolStatus:"0",fault:"0",remark:""},modalRules:{turnoverAssetId:[{required:!0,message:"请选择部件"}],facadeStatus:[{required:!0,message:"请选择外观状态"}],mixtoolStatus:[{required:!0,message:"请选择工装状态"}],fault:[{required:!0,message:"请选择是否存在故障"}]},dictTrainStr:"",structureId:"",labelCol:{span:3},wrapperCol:{span:20}}},methods:{showModal:function(e){this.structureId=e,this.visible=!0,this.modalInfo.lineId=this.lineId,this.lineId&&(this.dictTrainStr="bu_train_info,train_no,id,line_id="+this.lineId),this.modalInfo.trainNo=this.trainNo,this.modalInfo.assetName="",this.modalInfo.turnoverAssetId="",this.modalInfo.remark=""},onLineChange:function(e,t){this.dictTrainStr=t?"bu_train_info,train_no,id,line_id="+t.value:""},handleOk:function(){var e=this;this.$refs.outPartForm.validate((function(t){if(t){if(e.checkAssetIsExist(e.modalInfo.turnoverAssetId))return void e.$message.warning("你选择的设备"+e.modalInfo.assetNo+"已经存在委外设备列表中,不能重复添加");e.$emit("ok",Object.assign({},e.modalInfo)),e.close()}}))},checkAssetIsExist:function(e){var t=this.existAssets.filter((function(t){return t.turnoverAssetId===e}));return t.length>0},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},selectAsset:function(){this.$refs.assetSelectModal.showModal(),this.$refs.assetSelect.blur()},onSelectAsset:function(e){if(e&&e.length>0){var t=e[0];this.modalInfo.id=Object(i["p"])(),this.modalInfo.assetTypeId=t.id,this.modalInfo.assetTypeName=t.assetName,this.modalInfo.turnoverAssetId=t.id,this.modalInfo.assetName=t.assetName,this.modalInfo.assetNo=t.code,this.modalInfo.facadeStatus_dictText="1"===this.modalInfo.facadeStatus?"有问题":"无问题",this.modalInfo.mixtoolStatus_dictText="1"===this.modalInfo.mixtoolStatus?"有问题":"无问题",this.modalInfo.fault_dictText="1"===this.modalInfo.fault?"是":"否",this.$forceUpdate()}}}},l=s,c=a("2877"),u=Object(c["a"])(l,r,o,!1,null,"745ed50c",null);t["default"]=u.exports},d5c3:function(e,t,a){},d6d3:function(e,t,a){"use strict";a("ccb3")},d888:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"test-class",style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[2!==e.operator&&3!==e.operator?t("div",{attrs:{"na-flex-height-full":""}},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")]),2===e.opType?t("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("提交领料申请")]):e._e(),2===e.opType?t("span",{staticStyle:{color:"#dbaaaa"}},[e._v("<- 提交领料申请后，将暂停作业填报，工单重新流转到物料员进行发料")]):e._e(),3===e.opType?t("span",{staticStyle:{color:"#dbaaaa"}},[e._v("<- 添加的退回物料，在工班长提交工单后，统一生成退料单提交给物料员")]):e._e()],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[2===e.opType?t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:e.taskMaterials,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"row-style":e.checkMaterialShow,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskMaterials=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(t){return e.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,166663900)}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}],null,!1,1805491503)}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type"},on:{select:e.onCategoryChange,blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:r.useCategory,callback:function(t){e.$set(r,"useCategory",t)},expression:"row.useCategory"}})]}}],null,!1,1274400700)}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}],null,!1,3749314421)}),t("vxe-table-column",{attrs:{field:"actAmount",title:"实际消耗"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}],null,!1,1773474126)}),t("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",align:"left","edit-render":{name:"$input",props:{type:"text"}}}}),e.getButtonShow()?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1):e._e(),3===e.opType?t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:e.taskMaterials,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"row-style":e.checkMaterialShow2,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskMaterials=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(t){return e.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,166663900)}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}],null,!1,1805491503)}),t("vxe-table-column",{attrs:{field:"amount",title:"退料数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:1e4},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}],null,!1,223652004)}),t("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}],null,!1,1773474126)}),e.getButtonShow()?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1):e._e()],1)],1):e._e(),t("material-list",{ref:"modalForm",attrs:{multiple:!1,mode:[1,2],"show-type-code":!0,typeCodeList:[2,3,-1]},on:{ok:e.onSelectMaterial}}),t("ReturnMaterialModal",{ref:"returnMaterialModal",on:{ok:e.onSelectReturnMaterial}}),t("task-select-modal",{ref:"taskSelectModal",on:{ok:e.onSelectTask}})],1)},o=[],i=a("7164"),n=a("383b"),s=a("ff09"),l=a("f6d0"),c=a("f9cc"),u=(a("c54ca"),a("b9c3"));function d(e){return p(e)||h(e)||m(e)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){if(e){if("string"==typeof e)return g(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?g(e,t):void 0}}function h(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function p(e){if(Array.isArray(e))return g(e)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return v(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(v(t={},r,(function(){return this})),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,v(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,v(d,"constructor",c),v(c,"constructor",l),l.displayName="GeneratorFunction",v(c,o,"GeneratorFunction"),v(d),v(d,o,"Generator"),v(d,r,(function(){return this})),v(d,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:i,m:f}})()}function v(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}v=function(e,t,a,r){function i(t,a){v(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},v(e,t,a,r)}function y(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function k(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){y(i,r,o,n,s,"next",e)}function s(e){y(i,r,o,n,s,"throw",e)}n(void 0)}))}}var w={name:"ReceiveMaterial",components:{TaskSelectModal:n["default"],MaterialList:i["default"],ApplyReadyComponent:s["default"],ApplyConfirmComponent:l["default"],ReturnMaterialModal:c["default"]},props:{taskMaterials:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},opType:{type:Number,default:2},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0},workOrderId:{type:String,default:null}},data:function(){return{curEditMode:0,curRow:null,validRules:{taskName:[{required:!0,message:"请选工单任务",trigger:"manual"}],code:[{required:!0,message:"请选择物料",trigger:"manual"}],useCategory_dictText:[{required:!0,message:"类别必须选择",trigger:"manual"}],amount:[{required:!0,message:"数量必须填写",trigger:"manual"}],actAmount:[{required:2===this.opType,message:"数量必须填写",trigger:"manual"}]},applyMaterialList:[],typeCodeList:[]}},mounted:function(){},methods:{onCategoryChange:function(e,t){var a=this.$refs.listTable.getActiveRecord();a.row.useCategory_dictText=t?t.title:void 0,this.$forceUpdate()},save:function(e){},saveOk:function(){this.$emit("ok")},saveFail:function(e){this.$emit("fail",e)},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||2===this.operator)},handleAdd:function(){var e=this;if(!this.$refs.listTable.getActiveRecord())if(this.curEditMode=1,3!==this.opType){this.applyMaterialList=[];var t={useCategory:null,opType:this.opType,isGenOrder:0,opType_dictText:2===this.opType?"临时新增":"退还物资"};this.selectTask&&Object.assign(t,{orderId:this.selectTask.orderId,orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"code")}))}else this.$refs.returnMaterialModal.showModal(this.selectTask.orderId)},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t=t.filter((function(t){return t.opType===e.opType})),t.find((function(t){return 1===t.isGenOrder&&2===e.opType}))?this.$message.warn("".concat(t.find((function(t){return 1===t.isGenOrder&&2===e.opType})).name,"物料已经生成单据，不能删除")):t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var a=t.map((function(e){return e.id}));Object(u["j"])({ids:a.join(",")}).then((function(t){t.success?(a.forEach((function(t){e.taskMaterials.map((function(a,r){t===a.id&&e.taskMaterials.splice(r,1)}))})),e.$emit("ok"),e.$message.success("删除成功")):e.$message.error("删除失败")}))}}):this.$message.error("尚未选中任何数据!")},handleSubmit:function(){var e=this,t=this.taskMaterials.filter((function(e){return 2===e.opType&&1===e.needDispatchin&&0===e.isGenOrder}));t.length?this.$confirm({content:"确认是否发起领料申请？",okText:"确定",cancelText:"取消",onOk:function(){var a=new FormData;a.append("orderId",e.selectTask.orderId),a.append("opType",2),Object(u["h"])(a).then((function(a){a.success?(e.$message.success("提交申请成功"),t.forEach((function(t){e.taskMaterials[e.taskMaterials.findIndex((function(e){return e==t}))]&&(e.taskMaterials[e.taskMaterials.findIndex((function(e){return e==t}))].isGenOrder=1,e.taskMaterials[e.taskMaterials.findIndex((function(e){return e==t}))].isGenOrder_dictText="是")})),e.$emit("submit")):e.$message.error(a.message)}))}}):this.$message.warn("没有新添加的物料明细，不能提交")},editRowEvent:function(e){this.curEditMode=2,3===this.opType?this.getAppleMaterialList():this.applyMaterialList=[],this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskMaterials.map((function(a,r){e.id===a.id&&t.taskMaterials.splice(r,1)}))},saveRowEvent:function(){var e=k(b().m((function e(t){var a=this;return b().w((function(e){while(1)switch(e.n){case 0:this.$refs.listTable.validate(t,(function(e){if(e)for(var r in e){var o=e[r];o.forEach((function(e){e.rule&&a.$message.error(e.rule.message)}))}else{if(3===a.opType&&a.applyMaterialList.find((function(e){return e.materialTypeId===t.materialTypeId})).amount<t.amount)return void a.$message.warn("退料数量不能大于领料数量");if(t.actAmount>t.amount)return void a.$message.error("实际消耗不能大于所需数量");a.$emit(1===a.curEditMode?"add":"edit",t),a.$refs.listTable.clearActived(),a.curEditMode=0}}));case 1:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getAppleMaterialList:function(){var e=this;this.applyMaterialList=[],Object(u["w"])({orderId:this.selectTask.orderId}).then((function(t){t.success?t.result.forEach((function(t){e.applyMaterialList=[].concat(d(e.applyMaterialList),d(t.detailList))})):e.$message.error("读取领用明细失败")}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openMaterialSelectModal:function(e){this.curRow=e,this.$refs.modalForm.showModal(),this.$refs.listTable.clearValidate()},onSelectMaterial:function(e){if(e&&e.length>0){var t=e[0];this.curRow.code=t.code,this.curRow.materialTypeId=t.id,this.curRow.name=t.name,this.curRow.kind=t.kind,this.curRow.unit=t.unit,this.curRow.kind_dictText=t.kind_dictText,2===this.opType&&-1!==t.category1&&(this.curRow.useCategory=t.category1?t.category1:null,this.curRow.useCategory_dictText=t.category1?t.category1_dictText:""),this.curRow.amount=t.num,this.curRow.actAmount=0,this.curRow.needDispatchin=1,this.curRow.needDispatchin_dictText="是"}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory="",this.curRow.useCategory_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.actAmount=0,this.curRow.actAmount=0,this.curRow.needDispatchin=1,this.curRow.needDispatchin_dictText="是"},onSelectReturnMaterial:function(e){var t=this,a=[];e.forEach((function(e){if(t.taskMaterials.find((function(t){return t.materialTypeId===e.materialTypeId&&3===t.opType})))t.$message.warn("".concat(e.materialTypeName,"物资已存在"));else{var r={useCategory:null,isGenOrder:0,opType:t.opType,opType_dictText:"退还物资"};t.selectTask&&Object.assign(r,{orderId:t.selectTask.orderId,orderTaskId:t.selectTask.id,taskName:t.selectTask.taskName}),Object.assign(r,{code:e.materialTypeCode,materialTypeId:e.materialTypeId,name:e.materialTypeName,unit:e.materialTypeUnit,useCategory:e.useCategory,useCategory_dictText:e.useCategory_dictText,amount:e.num,actAmount:0,planAmount:0,needDispatchin:0}),a.push(Object(u["cb"])(r).then((function(e){return e.success?r:(t.$message.error("保存错误"),null)})).catch((function(e){return t.$message.error("保存异常"),null})))}})),a.length&&Promise.all(a).then((function(e){t.$message.success("执行成功"),t.$emit("addReturnMateriles",e.filter((function(e){return e})))}))},openTaskSelectModal:function(e){this.curRow=e,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(e){if(e&&e.length>0){var t=e[0];this.curRow.orderTaskId=t.id,this.curRow.taskName=t.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[t.key].taskName},clearValidate:function(){this.$refs.listTable.clearValidate()},checkMaterialShow:function(e){var t=e.row;return t.opType!==this.opType||0===t.needDispatchin||1===t.isGenOrder?"display: none;":void 0},checkMaterialShow2:function(e){var t=e.row;if(t.opType!==this.opType)return"display: none;"}}},I=w,T=(a("41ca"),a("2877")),x=Object(T["a"])(I,r,o,!1,null,"489bc3d2",null);t["default"]=x.exports},e1e2:function(e,t,a){"use strict";a("0534")},e5b4:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"任务提交",width:600,visible:e.visible,centered:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"作业人数"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["renshu",e.validatorRules.renshu],expression:"['renshu', validatorRules.renshu]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,max:9999},on:{change:e.renshuChange}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"人均工时"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workTime",e.validatorRules.worktime],expression:"['workTime', validatorRules.worktime]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,max:9999},on:{change:e.worktimeChange}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"总计工时"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workTimeSum",e.validatorRules.sumtime],expression:"['workTimeSum', validatorRules.sumtime]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,max:99999999999}})],1)],1)],1)},o=[],i=a("b9c3"),n={name:"taskSubmitModal",data:function(){return{visible:!1,taskId:null,labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:18}},form:this.$form.createForm(this),validatorRules:{renshu:{initialValue:0,rules:[{required:!0,message:"请输入人数!"}]},worktime:{initialValue:0,rules:[{required:!0,message:"请输入人均工时!"}]},sumtime:{initialValue:0,rules:[{required:!0,message:"请输入总计工时"}]}}}},methods:{showModal:function(e){this.taskId=e,this.form.resetFields(),this.visible=!0},renshuChange:function(e){var t=this.form.getFieldValue("workTime");this.form.setFieldsValue({workTimeSum:e*t})},worktimeChange:function(e){var t=this.form.getFieldValue("renshu");this.form.setFieldsValue({workTimeSum:t*e})},handleOk:function(){var e=this;this.form.validateFields((function(t,a){t||e.$confirm({content:"你确定提交该任务？",onOk:function(){var t=Object.assign({},a);t.taskId=e.taskId,Object(i["nb"])(t).then((function(t){t.success?(e.$message.success(t.message),e.$emit("ok"),e.close()):e.$message.error("保存错误")}))}})}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=n,l=a("2877"),c=Object(l["a"])(s,r,o,!1,null,"5f5fa5f1",null);t["default"]=c.exports},e9d9:function(e,t,a){},ed12:function(e,t,a){"use strict";a("f57b")},ee46:function(e,t,a){},ef2b0:function(e,t,a){"use strict";a("7616")},f02c:function(e,t,a){"use strict";a("ee46")},f57b:function(e,t,a){},f680:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return"checkbox"==e.tagType?t("a-checkbox-group",{attrs:{value:e.arrayValue,disabled:e.disabled},on:{change:e.onChange}},e._l(e.dictOptions,(function(a,r){return t("a-checkbox",{key:r,attrs:{value:a.value}},[e._v(e._s(a.text||a.label))])})),1):"select"==e.tagType?t("a-select",{attrs:{value:e.arrayValue,disabled:e.disabled,mode:"multiple",placeholder:e.placeholder,getPopupContainer:function(e){return e.parentNode},allowClear:""},on:{change:e.onChange}},e._l(e.dictOptions,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.value}},[t("span",{staticStyle:{display:"inline-block",width:"100%"},attrs:{title:a.text||a.label}},[e._v(" "+e._s(a.text||a.label)+" ")])])})),1):e._e()},o=[],i=a("4ec3");function n(e){return u(e)||c(e)||l(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){if(e){if("string"==typeof e)return d(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,t):void 0}}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function u(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var f={name:"JMultiSelectTag",props:{dictCode:String,placeholder:String,disabled:Boolean,value:String,type:String,options:Array},data:function(){return{dictOptions:[],tagType:"",arrayValue:this.value?this.value.split(","):[]}},created:function(){this.type&&"list_multi"!==this.type?this.tagType=this.type:this.tagType="select"},watch:{options:function(e){this.setCurrentDictOptions(e)},dictCode:{immediate:!0,handler:function(){this.initDictData()}},value:function(e){this.arrayValue=e?this.value.split(","):[]}},methods:{initDictData:function(){var e=this;if(this.options&&this.options.length>0)this.dictOptions=n(this.options);else{if(Object(i["u"])(this.dictCode))return void(this.dictOptions=Object(i["u"])(this.dictCode));Object(i["f"])(this.dictCode,null).then((function(t){t.success&&(e.dictOptions=t.result)}))}},onChange:function(e){this.$emit("change",e.join(","))},setCurrentDictOptions:function(e){this.dictOptions=e},getCurrentDictOptions:function(){return this.dictOptions}},model:{prop:"value",event:"change"}},m=f,h=a("2877"),p=Object(h["a"])(m,r,o,!1,null,null,null);t["default"]=p.exports},f6d0:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.fromFlow?e._e():t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden","margin-bottom":"8px"}},[t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:e.save}},[e._v("确认领用")]),t("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.close}},[e._v("关闭")])],1)])],1),t("div",{staticStyle:{height:"calc(70vh - 45px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,range:!0}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),t("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"确认状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}})],1)],1),t("ApplyDistributionModal",{ref:"distributionModal",attrs:{dataList:e.distributionTableList},on:{ok:e.onSuccess}})],1)},o=[],i=a("c54ca"),n=a("2eb4"),s=a("8973");function l(e){return f(e)||d(e)||u(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){if(e){if("string"==typeof e)return m(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?m(e,t):void 0}}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e){if(Array.isArray(e))return m(e)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var h={name:"ApplyConfirmComponent",components:{ApplyDistributionModal:n["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:null}},data:function(){return{tableData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{orderId:"",status:[1]}}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:{edit:function(e){this.queryParam.orderId=e,this.findList()},findList:function(){var e=this;this.tableData=[],Object(i["bb"])(this.queryParam).then((function(t){t.success?(e.tableData=[].concat(l(e.tableData),l(t.result)),s["a"].joinDistributionInfo(e.tableData)):e.$message.error("加载数据失败"),e.$emit("loaded")}))},save:function(e){var t=this;if(this.tableData&&this.tableData.length>0){var a=this.tableData.map((function(e,t){return e.id}));if(0===a.length)return this.$message.warn("没有要确认领料的物资，无法继续！"),void this.$emit("fail",{message:"没有要确认领料的物资，无法继续！"});var r={fromType:2,ids:a.join(",")};Object(i["j"])(r).then((function(e){e.success?t.$emit("ok"):t.$emit("fail",e)})).catch((function(e){t.$message.error("保存异常"),t.$emit("fail",{message:"保存异常！"})}))}else this.$emit("ok")},close:function(){this.$emit("close")},openDistribution:function(e){this.$refs.distributionModal.showModal(e)},onSuccess:function(){var e=this;this.tableData.forEach((function(t){t.receive=0,e.distributionTableList.forEach((function(e){e.applyDetailId===t.id&&(t.receive+=Number(e.amount))}))}))}}},p=h,g=a("2877"),b=Object(g["a"])(p,r,o,!1,null,"1c988508",null);t["default"]=b.exports},f76d:function(e,t,a){"use strict";a("9527")},f9cc:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"97%",title:"物料选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticStyle:{height:"calc(80vh - 186px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 186px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":e.onCellClick}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物料编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物料名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"150"}}),t("vxe-table-column",{attrs:{field:"receive",title:"领用数量",width:"150"}}),t("vxe-table-column",{attrs:{field:"num",title:"退还数量",width:"200","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入数量",min:1,max:r.receive},model:{value:r.num,callback:function(t){e.$set(r,"num",t)},expression:"row.num"}})]}}])})],1)],1)])},o=[],i=a("b098"),n=a("5633"),s=a("b9c3");function l(e){return f(e)||d(e)||u(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){if(e){if("string"==typeof e)return m(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?m(e,t):void 0}}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e){if(Array.isArray(e))return m(e)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var h={name:"ReturnMaterialModal",components:{JTreeSelect:i["default"],LineSelectList:n["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{hiddenType:[],dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",dictCodeStrWork:"bu_mtr_workstation,name,id",queryParam:{type:"1",category1:"",searchText:"",attr:null,warehouseId:"",materialTypeCodeList:[],pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},created:function(){},methods:{showModal:function(e){var t=this;this.loading=!0,this.tableData=[],Object(s["w"])({orderId:e}).then((function(e){e.success?(e.result.forEach((function(e){e.detailList.map((function(e){return e.num=1,e})),t.tableData=[].concat(l(t.tableData),l(e.detailList))})),t.loading=!1,t.visible=!0):t.$message.error("读取领用明细失败")}))},handleOk:function(){var e=[];e=this.$refs.listTable.getCheckboxRecords(),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.tabIndex="1"},onCellClick:function(e){var t=e.row,a=e.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([t],!0)}}},p=h,g=(a("190e"),a("2877")),b=Object(g["a"])(p,r,o,!1,null,"63189a6c",null);t["default"]=b.exports},fb4f:function(e,t,a){"use strict";a("0743")},ff09:function(e,t,a){"use strict";a.r(t);var r,o=function(){var e=this,t=e._self._c;return t("div",[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"right",overflow:"hidden","margin-bottom":"8px"}},[t("a-space",[e.isDistribution?e._e():t("a-button",{staticClass:"iconBtn",attrs:{loading:e.confirmLoading,disabled:e.records.length<1},on:{click:e.autoArrange}},[e._v("自动安排库位")]),e.isDistribution?e._e():t("a-button",{staticClass:"iconBtn",attrs:{loading:e.confirmLoading,disabled:e.records.length<1},on:{click:e.arrangePan}},[e._v("批量设置托盘")])],1)],1)])],1),e.isDistribution?e._e():t("div",{staticStyle:{height:"calc(70vh - 45px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,trigger:"row",range:!0}},on:{"checkbox-change":e.checkboxChange,"checkbox-all":e.checkboxChange}},[t("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),t("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{title:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("a",{on:{click:function(t){return t.stopPropagation(),e.openDistribution(r)}}},[e._v("发放管理")])]}}],null,!1,768125003)})],1)],1),e.isDistribution?t("div",{staticClass:"panel-main",staticStyle:{height:"calc(70vh - 45px)"}},[t("div",{staticClass:"panel-left"},[t("vxe-table",{ref:"materialTable",attrs:{border:"",height:"auto","keep-source":"",data:e.tableData,"radio-config":{highlight:!0,trigger:"row",range:!0,checkMethod:function(){return 0===e.curEditMode}}},on:{"radio-change":e.onRadioChange,"cell-click":e.onMaterialCellClick}},[t("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",width:"160",title:"物资编码"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"名称"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"80"}}),t("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"80"}})],1)],1),t("div",{staticClass:"panel-right"},[t("div",{staticClass:"ant-alert ant-alert-info",staticStyle:{"margin-bottom":"16px"}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.addDetail}},[e._v("添加发放库位")]),t("a-button",{on:{click:e.closeDistribution}},[e._v("关闭")]),t("span",{staticStyle:{color:"red","margin-left":"15px"}},[e._v(e._s("总量: ".concat(e.selectInfo?e.selectInfo.amount:0,";")))]),t("span",{staticStyle:{color:"red","margin-left":"5px"}},[e._v(e._s("差额：".concat(e.calcAmount)))])],1)],1),t("div",{staticStyle:{height:"calc(100% - 62px)"}},[t("vxe-table",{ref:"distributionTable",attrs:{border:"",height:"auto","keep-source":"",data:e.tableDistributionData,"edit-rules":e.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[t("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"locationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:function(t){return e.openlocationModal(r)}},model:{value:r.sourceLocationName,callback:function(t){e.$set(r,"sourceLocationName",t)},expression:"row.sourceLocationName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,325071706)}),t("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择托盘",open:!1},on:{dropdownVisibleChange:function(t){return e.openPalletModal()}},model:{value:r.palletName,callback:function(t){e.$set(r,"palletName",t)},expression:"row.palletName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,3015230497)}),t("vxe-table-column",{attrs:{field:"tradeNo",title:"所属批次",width:"270","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[r.needChooseTradeNo?t("div",[t("a-select",{staticStyle:{width:"100%"},on:{change:function(t){return e.tradeNoCHange(r)}},model:{value:r.tradeNo,callback:function(t){e.$set(r,"tradeNo",t)},expression:"row.tradeNo"}},e._l(r.tradeNoChoiceList,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.tradeNo}},[e._v(" "+e._s(a.tradeNo)+"    "+e._s(a.price)+" ")])})),1)],1):t("div",[e._v(" "+e._s(r.tradeNo)+" ")])]}}],null,!1,2270284966)}),t("vxe-table-column",{attrs:{field:"amount",title:"发放数量",width:"120",align:"center","edit-render":{name:"$input",props:{type:"number",min:0}}}}),t("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center","show-overflow":!1},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[r&&!e.$refs.distributionTable.isActiveByRow(r)?t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑 ")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.handleDel(r)}}},[e._v("删除")])],1):t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]}}],null,!1,743031837)})],1)],1)])]):e._e(),t("ApplyDistributionModal",{ref:"distributionModal",on:{ok:e.onSuccess}}),t("PalletList",{ref:"palletModal",attrs:{modeType:2},on:{ok:e.onSelectPallet}}),t("PalletList",{ref:"palletModal2",attrs:{modeType:2},on:{ok:e.onChoosePallet}}),t("LocationList",{ref:"locationModal",attrs:{modeType:2},on:{ok:e.onSelectLocation}})],1)},i=[],n=a("c54ca"),s=a("2eb4"),l=a("4ec3"),c=a("9f49"),u=a("13f1"),d=a("8973");function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function m(e,t,a){return(t=h(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function h(e){var t=p(e,"string");return"symbol"==f(t)?t:t+""}function p(e,t){if("object"!=f(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function g(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return b(c,"_invoke",function(a,r,o){var i,s,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,a){return i=t,s=0,l=e,f.n=a,n}};function m(a,r){for(s=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],m=f.p,h=i[2];a>3?(o=h===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=m&&((o=a<2&&m<i[1])?(s=0,f.v=r,f.n=i[1]):m<h&&(o=a<3||i[0]>r||r>h)&&(i[4]=a,i[5]=r,f.n=h,s=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==n)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(b(t={},r,(function(){return this})),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,b(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,b(d,"constructor",c),b(c,"constructor",l),l.displayName="GeneratorFunction",b(c,o,"GeneratorFunction"),b(d),b(d,o,"Generator"),b(d,r,(function(){return this})),b(d,"toString",(function(){return"[object Generator]"})),(g=function(){return{w:i,m:f}})()}function b(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}b=function(e,t,a,r){function i(t,a){b(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},b(e,t,a,r)}function v(e,t,a,r,o,i,n){try{var s=e[i](n),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function y(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){v(i,r,o,n,s,"next",e)}function s(e){v(i,r,o,n,s,"throw",e)}n(void 0)}))}}function k(e){return x(e)||T(e)||I(e)||w()}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){if(e){if("string"==typeof e)return C(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?C(e,t):void 0}}function T(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function x(e){if(Array.isArray(e))return C(e)}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var S={name:"ApplyReadyComponent",components:{ApplyDistributionModal:s["default"],PalletList:c["default"],LocationList:u["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!1},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:""}},data:function(){return{records:[],confirmLoading:!1,tableData:[],tableDistributionData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{status:[0],orderId:""},curRow:null,isDistribution:!1,selectInfo:{},addParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},curEditMode:0,validRules:{sourceLocationName:[{required:!0,message:"请选择库位",trigger:"manual"}],tradeNo:[{required:!0,message:"批次号不能为空",trigger:"manual"}],amount:[{required:!0,message:"请输入数量",trigger:"manual"}]}}},computed:{hasActiveRow:function(){return!!this.$refs.distributionTable.getActiveRecord()},calcAmount:function(){return this.getAmount()}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:(r={tradeNoCHange:function(e){var t=e.tradeNoChoiceList.filter((function(t){return t.tradeNo==e.tradeNo}));e.price=t[0].price},checkboxChange:function(e){this.records=e.records},edit:function(e){this.initDictData(),this.queryParam.orderId=e,this.findList()},findList:function(){var e=this;this.tableData=[],this.records=[],Object(n["bb"])(this.queryParam).then((function(t){t.success?(e.tableData=[].concat(k(e.tableData),k(t.result)),d["a"].joinDistributionInfo(e.tableData),e.distributionTableList=[]):e.$message.error("加载数据失败"),e.$emit("loaded")}))},autoArrange:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<=0?this.$message.warn("请先选择要进行自动安排的记录！"):this.$confirm({content:"将根据现有库存情况自动安排库位，并覆盖原有数据？",okText:"确定",cancelText:"取消",onOk:function(){var a={applyDetailIdList:[],type:0};t.forEach((function(e){a.applyDetailIdList.push(e.id)})),e.confirmLoading=!0,Object(n["k"])(a).then((function(a){if(a.success){var r=a.result.applyDetailList;e.$message.success(a.result.assignResultMessage),t.forEach((function(e){var t=r.find((function(t){return t.id===e.id}));t&&(t.sourceLocationAndPalletName="",t.assignDetailList.forEach((function(e){var a=e.sourceLocationName+" | "+e.amount;e.palletName&&(a+=" | ".concat(e.palletName)),e.tradeNo&&(a+=" | 第".concat(e.tradeNo,"批次")),t.sourceLocationAndPalletName+=a+" \n"})),Object.assign(e,t))}))}else e.$message.error(a.message);e.confirmLoading=!1}))},onCancel:function(){}})},arrangePan:function(){var e=this.$refs.listTable.getCheckboxRecords();if(e.length<=0)this.$message.warn("请先选择要进行自动安排的记录！");else{var t=e.filter((function(e){return e.assignDetailList.length<=0}));t.length>0?this.$message.warning("请先安排库位信息"):this.$refs.palletModal.showModal()}},onSelectPallet:function(e){var t=this.$refs.listTable.getCheckboxRecords();try{Array.from(t,(function(t){Array.from(t.assignDetailList,(function(t){t.palletId=e[0].id,t.palletName=e[0].name}))})),this.updateAssignInfo(),this.$message.success("设置成功")}catch(a){this.$message.error("设置失败")}},save:function(){var e=y(g().m((function e(t){var a,r,o,i,s=this;return g().w((function(e){while(1)switch(e.n){case 0:if(this.fromFlow){e.n=1;break}a=this.$refs.listTable.getCheckboxRecords(),a.length>0?this.$confirm({content:"是否确认发放选中".concat(a.length,"数据？"),onOk:function(){var e=a.map((function(e,t){return{id:e.id,palletId:e.palletName,receive:e.receive}})),t={id:s.queryParam.orderId,detailList:e};Object(n["i"])(t).then((function(e){e.success?s.$emit("ok"):s.$emit("fail",e)})).catch((function(e){s.$message.error("保存异常"),s.$emit("fail")}))}}):this.$message.error("尚未选中任何数据!"),e.n=6;break;case 1:if(!(this.tableData&&this.tableData.length>0)){e.n=5;break}if(r={id:this.queryParam.orderId,onlySave:t,detailList:this.tableData.filter((function(e){return!e.noSave}))},o=!0,i=this.tableData.filter((function(e){return 0===e.receive})),t||!i.length){e.n=3;break}return e.n=2,new Promise((function(e,t){var a=i.map((function(e){return"["+e.materialTypeName+"-"+e.materialTypeCode+"]缺少"+(e.amount-e.receive)})).join("；");s.$confirm({content:"数量不匹配提醒：  ".concat(a,"  ;  是否继续提交？"),onOk:function(){e(!0)},onCancel:function(){e(!1)}})}));case 2:o=e.v;case 3:if(o){e.n=4;break}return this.$emit("cancel"),e.a(2);case 4:n["i"].call(this,r).then((function(e){e.success?s.$emit("ok"):s.$emit("fail",e)})).catch((function(e){s.$message.error("备料保存异常"),s.$emit("fail",e)})),e.n=6;break;case 5:this.$emit("ok");case 6:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),close:function(){this.$emit("close")},initDictData:function(){var e=this;Object(l["f"])(this.dictCode,null).then((function(t){t.success&&t.result&&t.result.map((function(t){e.palletList=e.palletList.concat({label:t.text,value:t.value})}))}))},openDistribution:function(e){this.curRow=e,this.openDistribution(e)},onSuccess:function(e){var t=this;e.forEach((function(a){var r=t.tableData.find((function(e){return e.id===a.applyDetailId}));r.assignDetailList=JSON.parse(JSON.stringify(e)),r.receive=0,r.assignDetailList.forEach((function(e){r.receive+=Number(e.amount);var t=e.sourceLocationName+" | "+e.amount;e.palletName&&(t+=" | ".concat(e.palletName)),e.tradeNo&&(t+=" | 第".concat(e.tradeNo,"批次")),r.sourceLocationAndPalletName+=t+" \n"}))}))},updateAssignInfo:function(){this.tableData.forEach((function(e){e.sourceLocationAndPalletName="",e.assignDetailList.forEach((function(t){var a=t.sourceLocationName+" | "+t.amount;t.palletName&&(a+=" | ".concat(t.palletName)),t.tradeNo&&(a+=" | 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=a+" \n"}))}))}},m(m(m(m(m(m(m(m(m(m(r,"openDistribution",(function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isDistribution=!0,this.curEditMode=0,this.$nextTick((function(){e.$refs.materialTable.setRadioRow(t||e.tableData[0]||{}),e.setActiveRow(t||e.tableData[0])}))})),"closeDistribution",(function(){this.hasActiveRow?this.$message.warn("存在未保存数据，请先保存"):(this.isDistribution=!1,this.curEditMode=0)})),"setActiveRow",(function(e){var t=this;this.tableDistributionData=[],this.selectInfo={},this.selectInfo=this.tableData.find((function(t){return t.id===e.id})),this.selectInfo.assignDetailList.forEach((function(e){t.tableDistributionData.push(JSON.parse(JSON.stringify(e)))}))})),"onRadioChange",(function(e){var t=e.row;t&&!this.hasActiveRow&&this.setActiveRow(t)})),"onMaterialCellClick",(function(e){var t=e.$event;t.stopPropagation()})),"addDetail",(function(){var e=this;if(!this.$refs.distributionTable.getActiveRecord()){this.curEditMode=1;var t={applyDetailId:this.selectInfo.id,materialTypeId:this.selectInfo.materialTypeId,amount:this.getAmount()};this.$refs.distributionTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.distributionTable.setActiveRow(a)}))}})),"editRowEvent",(function(e){this.$refs.distributionTable.getActiveRecord()||(this.curEditMode=2,this.$refs.distributionTable.setActiveRow(e))})),"getAmount",(function(){if(!this.selectInfo)return 0;var e=0;return this.tableDistributionData.forEach((function(t){e+=Number(t.amount)})),this.selectInfo.amount-e})),"openlocationModal",(function(e){this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,e.applyDetailId,e.id)})),"onSelectLocation",(function(e){if(e.length>0){var t=this.$refs.distributionTable.getActiveRecord(),a=t.row;a&&(a.locationName=e[0].warehouseName,a.locationWbs=e[0].warehouseWbs,a.sourceLocationName=e[0].sourceLocationName,a.tradeNo=e[0].tradeNo,a.price=e[0].price,a.needChooseTradeNo=e[0].needChooseTradeNo,a.tradeNoChoiceList=e[0].tradeNoChoiceList,a.locationNum=e[0].usableAmount,this.calcAmount>a.locationNum?a.amount=a.locationNum:this.calcAmount>0&&this.calcAmount<=a.locationNum?a.amount=this.calcAmount:a.amount=0)}})),m(m(m(m(m(r,"saveRowEvent",(function(e){var t=this;this.$refs.distributionTable.validate(e,(function(a){if(!a){if(t.tableDistributionData.find((function(t){return t.sourceLocationName===e.sourceLocationName&&t.tradeNo===e.tradeNo}))&&1===t.curEditMode)return void t.$message.warn("该仓库该批次的物资记录已存在");if("number"===typeof e.locationNum&&e.amount>e.locationNum)return void t.$message.warn("该仓库该批次的物资库存量不足");var r=0;if(t.tableDistributionData.forEach((function(t){t.sourceLocationName,e.sourceLocationName,t.tradeNo!==e.tradeNo&&(r+=Number(t.amount))})),r+Number(e.amount)>Number(t.selectInfo.amount))return void t.$message.warn("选择的实际数量超过了发放数量");1===t.curEditMode&&(e.isNew=!0,t.tableDistributionData.push(JSON.parse(JSON.stringify(e)))),t.$refs.distributionTable.clearActived(),t.onSuccess(t.tableDistributionData),t.curEditMode=0}}))})),"cancelRowEvent",(function(e){this.$refs.distributionTable.clearActived(),1===this.curEditMode?this.$refs.distributionTable.remove(e):2===this.curEditMode&&this.$refs.distributionTable.revertData(e),this.curEditMode=0})),"handleDel",(function(e){var t=this;this.$refs.distributionTable.getActiveRecord()||(this.$confirm({content:"是否删除选中的数据？",okText:"确定",cancelText:"取消",onOk:function(){t.tableDistributionData.splice(t.tableDistributionData.findIndex((function(t){return t.sourceLocationName===e.sourceLocationName})),1);var a=t.tableData.find((function(t){return t.id===e.applyDetailId}));a.assignDetailList.find((function(t){return t.sourceLocationName===e.sourceLocationName}))&&(a.receive-=a.assignDetailList.find((function(t){return t.sourceLocationName===e.sourceLocationName})).amount,a.assignDetailList.splice(a.assignDetailList.findIndex((function(t){return t.sourceLocationName===e.sourceLocationName})),1)),t.$nextTick((function(){t.locationMaxAmount=t.calcAmount}))}}),this.curEditMode=0)})),"openPalletModal",(function(){this.$refs.palletModal2.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName)})),"onChoosePallet",(function(e){if(e.length>0){var t=this.$refs.distributionTable.getActiveRecord(),a=t.row;a&&(a.palletId=e[0].id,a.palletName=e[0].name)}})))},M=S,_=(a("51c5"),a("2877")),N=Object(_["a"])(M,o,i,!1,null,"efd43ef8",null);t["default"]=N.exports}}]);