(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2681a398"],{"0e8e":function(t,e,r){},"1b89":function(t,e,r){},"552a":function(t,e,r){"use strict";r("0e8e")},5832:function(t,e,r){"use strict";r("1b89")},d2a4:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main"},[e("iframe",{staticStyle:{width:"850px",height:"500px",border:"medium none",overflow:"hidden"},attrs:{id:"ssologinframe",scrolling:"no",src:t.ssoLoginUrl}}),e("a-modal",{attrs:{title:"登录部门选择",width:450,visible:t.departVisible,closable:!1,maskClosable:!1}},[e("template",{slot:"footer"},[e("a-button",{attrs:{type:"primary"},on:{click:t.departOk}},[t._v("确认")])],1),e("a-form",[e("a-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{labelCol:{span:4},wrapperCol:{span:20},"validate-status":t.validate_status}},[e("a-tooltip",{attrs:{placement:"topLeft"}},[e("template",{slot:"title"},[e("span",[t._v("您隶属于多部门，请选择登录部门")])]),e("a-avatar",{staticStyle:{backgroundColor:"#87d068"},attrs:{icon:"gold"}})],2),e("a-select",{class:{"valid-error":"error"==t.validate_status},staticStyle:{"margin-left":"10px",width:"80%"},attrs:{placeholder:"请选择登录部门"},on:{change:t.departChange}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"gold"},slot:"suffixIcon"}),t._l(t.departList,(function(r){return e("a-select-option",{key:r.id,attrs:{value:r.orgCode}},[t._v(" "+t._s(r.departName)+" ")])}))],2)],1)],1)],2)],1)},a=[],s=r("9fb0"),n=r("2ca2"),o=r("2f62"),c=r("ca00"),u=r("2b0e"),l=r("0fea"),d=r("9da4"),p=r("4360"),f=r("ed3b");function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach((function(e){b(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function b(t,e,r){return(e=g(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function g(t){var e=v(t,"string");return"symbol"==y(e)?e:e+""}function v(t,e){if("object"!=y(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=y(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}var w={components:{TwoStepCaptcha:n["default"]},data:function(){return{departList:[],departVisible:!1,departSelected:"",validate_status:"",ssoLoginUrl:window._CONFIG["domianURL"]+"/sso/login"}},created:function(){this.currdatetime=(new Date).getTime(),u["default"].ls.remove(s["a"]),this.getRouterData(),f["a"].destroyAll()},mounted:function(){var t=this,e=function(e){var r=e.data;if("object"!==y(r)&&"string"===typeof r)try{var i=JSON.parse(r);if(i.type&&"token"===i.type){var a=i.data;u["default"].ls.set(s["n"],new Date),t.ThirdLogin(a).then((function(e){e.success?t.departConfirm(e):t.requestFailed(e)}))}}catch(n){}};window.addEventListener("message",e,!1)},methods:h(h({},Object(o["b"])(["ThirdLogin"])),{},{requestFailed:function(t){this.$notification["error"]({message:"登录失败",description:((t.response||{}).data||{}).message||t.message||"请求出现错误，请稍后再试",duration:4})},departConfirm:function(t){if(t.success){this.departList=t.result.departs;var e=t.result.multi_depart;0===e?(this.loginSuccess(),this.$notification.warn({message:"提示",description:"您尚未归属部门,请确认账号信息",duration:3})):2===e?(this.departVisible=!0,this.departList=t.result.departs):this.loginSuccess()}else this.requestFailed(t),this.Logout()},departOk:function(){var t=this;if(!this.departSelected)return this.validate_status="error",!1;var e={orgCode:this.departSelected,username:this.form.getFieldValue("username")};Object(l["k"])("/sys/selectDepart",e).then((function(e){if(e.success){var r=e.result.userInfo;u["default"].ls.set(s["s"],r,6048e5),p["a"].commit("SET_INFO",r),t.loginSuccess(),t.departClear()}else t.requestFailed(e),t.Logout().then((function(){t.departClear()}))}))},departClear:function(){this.departList=[],this.departSelected="",this.currentUsername="",this.departVisible=!1,this.validate_status=""},departChange:function(t){this.validate_status="success",this.departSelected=t},getRouterData:function(){var t=this;this.$nextTick((function(){t.$route.params.username&&t.form.setFieldsValue({username:t.$route.params.username})}))},loginSuccess:function(){var t=this.$store.getters.userInfo.departId;if(this.departList&&this.departList.length>0){var e=this.departList.filter((function(e){return e.id===t}));e&&e.length>0&&p["a"].commit("SET_DEPARTNAME",e[0].departName)}this.$router.push({path:s["m"]}),this.$notification.success({message:"欢迎",description:"".concat(Object(c["s"])(),"，欢迎回来")})},getEncrypte:function(){var t=this,e=u["default"].ls.get(s["k"]);null==e?Object(d["a"])().then((function(e){t.encryptedString=e})):this.encryptedString=e}})},O=w,S=(r("5832"),r("552a"),r("2877")),j=Object(S["a"])(O,i,a,!1,null,"d059b6e4",null);e["default"]=j.exports}}]);