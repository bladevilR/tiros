(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a98ca87","chunk-e2335e4e","chunk-24cb054c","chunk-2d221d88","chunk-2d2222fd"],{"03be":function(t,e,n){"use strict";n("a71c")},"4e53":function(t,e,n){},9527:function(t,e,n){},"964a":function(t,e,n){"use strict";n("4e53")},a71c:function(t,e,n){},b245:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"85%",title:"人员选择",visible:t.visible,confirmLoading:t.confirmLoading,cancelText:"关闭",bodyStyle:{height:"70vh"},destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-row",[e("a-col",{attrs:{md:4,sm:24}},[e("div",{staticStyle:{height:"calc(70vh - 20px)","border-right":"1px solid #e3e1e1","margin-right":"15px"}},[t.treeData&&t.treeData.length>0?e("a-tree",{staticClass:"limitHeight",attrs:{defaultSelectedKeys:[t.queryParam.depId],defaultExpandAll:!0,"tree-data":t.treeData},on:{select:t.onSelect}}):t._e()],1)]),e("a-col",{attrs:{md:20,sm:24}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.findList.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"账号"}},[e("a-input",{attrs:{placeholder:"请输入用户账号"},model:{value:t.queryParam.username,callback:function(e){t.$set(t.queryParam,"username",e)},expression:"queryParam.username"}})],1)],1),e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"真实名字"}},[e("a-input",{attrs:{placeholder:"请输入真实名字"},model:{value:t.queryParam.realname,callback:function(e){t.$set(t.queryParam,"realname",e)},expression:"queryParam.realname"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"手机号码"}},[e("a-input",{attrs:{placeholder:"请输入手机号码"},model:{value:t.queryParam.phone,callback:function(e){t.$set(t.queryParam,"phone",e)},expression:"queryParam.phone"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"角色"}},[e("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"sys_role,role_name,id",placeholder:"选择角色"},model:{value:t.queryParam.roleId,callback:function(e){t.$set(t.queryParam,"roleId",e)},expression:"queryParam.roleId"}})],1)],1),e("a-col",{attrs:{md:2,sm:8}},[e("a-button",{on:{click:t.findList}},[t._v("查询")])],1)],1)],1)],1),e("div",{staticStyle:{height:"calc(70vh - 130px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 130px)"},attrs:{border:"",align:t.allAlign,data:t.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":t.multiple?{}:{trigger:"row"},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"manual",mode:"row"}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"5%"}}):e("vxe-table-column",{attrs:{type:"radio",width:"5%"}}),e("vxe-table-column",{attrs:{field:"workNo",title:"工号",width:"100",align:"center"}}),e("vxe-table-column",{attrs:{field:"username",title:"用户账号",width:"150",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"realname",title:"用户名字",width:"100",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"roleNames",title:"角色","min-width":"180",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"sex_dictText",title:"性别",width:"80"}}),e("vxe-table-column",{attrs:{field:"phone",title:"手机号码",width:"120"}}),e("vxe-table-column",{attrs:{field:"orgCode",title:"部门",width:"120",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}})],1),e("vxe-pager",{attrs:{perfect:"","current-page":t.queryParam.pageNo,"page-size":t.queryParam.pageSize,total:t.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:current-page":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:pageSize":function(e){return t.$set(t.queryParam,"pageSize",e)},"update:page-size":function(e){return t.$set(t.queryParam,"pageSize",e)},"page-change":t.handlePageChange}})],1)])],1)],1)},a=[],o=n("8fad"),i={name:"UserList",props:{multiple:{type:Boolean,default:!0},depId:{type:String,default:""}},data:function(){return{queryParam:{username:"",realname:"",phone:"",orgCode:"",roleId:void 0,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[]}},watch:{depId:function(t){this.$set(this.queryParam,"depId",t||"")}},mounted:function(){this.$set(this.queryParam,"depId",this.depId||"")},methods:{showModal:function(){this.visible=!0,this.findList(),this.getTreeList()},getTreeList:function(){var t=this;Object(o["yb"])().then((function(e){e.success&&(t.treeData=e.result)}))},onSelect:function(t,e){if(t.length){var n=e.node.dataRef;this.queryParam.depId=n.id,this.findList()}else this.queryParam.orgCode="",this.findList()},findList:function(){var t=this;this.loading=!0,Object(o["uc"])(this.queryParam).then((function(e){t.loading=!1,e.success?(t.totalResult=e.result.total,t.tableData=e.result.records):t.$message.error("加载用户数据失败")})).catch((function(e){t.$message.error("加载用户数据异常")})).finally((function(){}))},handlePageChange:function(t){var e=t.currentPage,n=t.pageSize;this.queryParam.pageNo=e,this.queryParam.pageSize=n,this.findList()},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,Object.assign(this.$data,this.$options.data())}}},c=i,s=(n("f76d"),n("2877")),l=Object(s["a"])(c,r,a,!1,null,"4aa7956f",null);e["default"]=l.exports},cba4:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"审阅作业指导书",width:"600px",maskClosable:!1,confirmLoading:t.loading},on:{ok:t.handleOk,cancel:t.handleCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("a-form",{attrs:{layout:"vertical"}},[e("a-form-item",{attrs:{label:"审阅结论"}},[e("a-radio-group",{model:{value:t.reviewStatus,callback:function(e){t.reviewStatus=e},expression:"reviewStatus"}},[e("a-radio",{attrs:{value:2}},[t._v("通过")]),e("a-radio",{attrs:{value:3}},[t._v("驳回")])],1)],1),e("a-form-item",{attrs:{label:"审阅意见"}},[e("a-textarea",{attrs:{rows:4,placeholder:"请输入审阅意见"},model:{value:t.reviewComment,callback:function(e){t.reviewComment=e},expression:"reviewComment"}})],1)],1)],1)},a=[],o=n("8fad"),i={name:"TechBookReviewModal",data:function(){return{visible:!1,loading:!1,record:{},reviewStatus:2,reviewComment:""}},methods:{open:function(t){this.record=t||{},this.reviewStatus=2,this.reviewComment=t&&t.reviewComment||"",this.visible=!0},handleOk:function(){var t=this;if(this.record.id)if(1===this.record.reviewStatus){var e=(this.reviewComment||"").trim();e?(this.loading=!0,Object(o["A"])({id:this.record.id,reviewStatus:this.reviewStatus,reviewComment:e}).then((function(e){e.success?(t.$message.success("审阅完成"),t.$emit("ok"),t.handleCancel()):t.$message.error(e.message||"审阅失败")})).finally((function(){t.loading=!1}))):this.$message.warning("请填写审阅意见")}else this.$message.warning("仅待审状态可进行审阅");else this.$message.warning("未选择指导书")},handleCancel:function(){this.visible=!1,this.record={},this.reviewComment=""}}},c=i,s=n("2877"),l=Object(s["a"])(c,r,a,!1,null,null,null);e["default"]=l.exports},cd95:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"名称/编码"}},[e("a-input",{attrs:{placeholder:"请输入名称或编码",allowClear:""},model:{value:t.queryParam.formName,callback:function(e){t.$set(t.queryParam,"formName",e)},expression:"queryParam.formName"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"线路"}},[e("a-select",{attrs:{allowClear:"",showSearch:"",optionFilterProp:"children",placeholder:"全部"},model:{value:t.queryParam.lineId,callback:function(e){t.$set(t.queryParam,"lineId",e)},expression:"queryParam.lineId"}},t._l(t.lineOptions,(function(n){return e("a-select-option",{key:n.value,attrs:{value:n.value}},[t._v(" "+t._s(n.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"状态"}},[e("a-select",{attrs:{allowClear:"",placeholder:"全部"},model:{value:t.queryParam.bizStatus,callback:function(e){t.$set(t.queryParam,"bizStatus",e)},expression:"queryParam.bizStatus"}},[e("a-select-option",{attrs:{value:"DRAFT"}},[t._v("草稿")]),e("a-select-option",{attrs:{value:"REVIEWING"}},[t._v("审核中")]),e("a-select-option",{attrs:{value:"REVIEW_PASS"}},[t._v("审核通过")]),e("a-select-option",{attrs:{value:"APPROVING"}},[t._v("审批中")]),e("a-select-option",{attrs:{value:"APPROVED"}},[t._v("审批通过")]),e("a-select-option",{attrs:{value:"PUBLISHED"}},[t._v("发布")]),e("a-select-option",{attrs:{value:"OBSOLETE"}},[t._v("作废")])],1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"车型"}},[e("a-select",{attrs:{allowClear:"",showSearch:"",optionFilterProp:"children",placeholder:"全部"},model:{value:t.queryParam.trainTypeId,callback:function(e){t.$set(t.queryParam,"trainTypeId",e)},expression:"queryParam.trainTypeId"}},t._l(t.trainTypeOptions,(function(n){return e("a-select-option",{key:n.value,attrs:{value:n.value}},[t._v(" "+t._s(n.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"修程"}},[e("a-select",{attrs:{allowClear:"",showSearch:"",optionFilterProp:"children",placeholder:"全部"},model:{value:t.queryParam.repairProId,callback:function(e){t.$set(t.queryParam,"repairProId",e)},expression:"queryParam.repairProId"}},t._l(t.repairProgramOptions,(function(n){return e("a-select-option",{key:n.value,attrs:{value:n.value}},[t._v(" "+t._s(n.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"类型"}},[e("a-select",{attrs:{allowClear:"",placeholder:"全部"},model:{value:t.queryParam.templateFlag,callback:function(e){t.$set(t.queryParam,"templateFlag",e)},expression:"queryParam.templateFlag"}},[e("a-select-option",{attrs:{value:1}},[t._v("模板")]),e("a-select-option",{attrs:{value:0}},[t._v("正式")])],1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"编制人"}},[e("a-input",{attrs:{placeholder:"请输入编制人",allowClear:""},model:{value:t.queryParam.creatorName,callback:function(e){t.$set(t.queryParam,"creatorName",e)},expression:"queryParam.creatorName"}})],1)],1),e("a-col",{attrs:{md:12,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("新建指导书")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleEdit(t.selectRows[0])}}},[t._v("编辑基础信息")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleEditContent(t.selectRows[0])}}},[t._v("编辑正文")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:t.handleSaveAsTemplate}},[t._v("保存为模板")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleSubmitReview(t.selectRows[0])}}},[t._v("提交审核")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleSubmitApprove(t.selectRows[0])}}},[t._v("提交审批")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleApproveDecision(t.selectRows[0])}}},[t._v("审批")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handlePublish(t.selectRows[0])}}},[t._v("发布")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleReviseVersion(t.selectRows[0])}}},[t._v("修订升版")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:t.handleDelete}},[t._v("删除")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:t.handleBatchExport}},[t._v("导出PDF")]),e("a-button",{on:{click:t.handleExportCatalog}},[t._v("导出目录")]),e("a-button",{on:{click:t.handleSearch}},[t._v("查询")])],1)],1)])],1)],1)],1),e("div",{staticStyle:{height:"calc(100vh - 225px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 225px)"},attrs:{border:"","auto-resize":"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}},on:{"checkbox-change":t.checkboxChange,"checkbox-all":t.checkboxChange}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"fileNo",title:"文件编号",width:"11%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"fileName",title:"文件名称",width:"16%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"fileVer",title:"版本",width:"6%","header-align":"center",align:"center"}}),e("vxe-table-column",{attrs:{field:"lineName",title:"线路",width:"8%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"trainTypeName",title:"车型",width:"10%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"repairProgramName",title:"修程",width:"8%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"creatorName",title:"编制人",width:"8%","header-align":"center",align:"center"}}),e("vxe-table-column",{attrs:{field:"statusText",title:"状态",width:"8%","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("a-tag",{attrs:{color:t.statusColor(n.row)}},[t._v(t._s(t.formatBizStatus(n.row)))])]}}])}),e("vxe-table-column",{attrs:{field:"reviewerName",title:"当前处理人",width:"8%","header-align":"center",align:"center"}}),e("vxe-table-column",{attrs:{field:"templateFlag",title:"类型",width:"6%","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("a-tag",{attrs:{color:1===n.row.templateFlag?"blue":"green"}},[t._v(" "+t._s(1===n.row.templateFlag?"模板":"正式")+" ")])]}}])}),e("vxe-table-column",{attrs:{field:"updateTime",title:"修改日期",width:"11%",formatter:t.formatDate}}),e("vxe-table-column",{attrs:{title:"操作",width:"27%","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(n){var r=n.row;return[e("a-space",[e("a",{on:{click:function(e){return t.handleEditContent(r)}}},[t._v("查看/正文")]),e("a",{on:{click:function(e){return t.handleExport(r)}}},[t._v("导出PDF")]),e("a",{on:{click:function(e){return t.handleSubmitReview(r)}}},[t._v("提交审核")]),e("a",{on:{click:function(e){return t.handleReviewDecision(r)}}},[t._v("审核")]),e("a",{on:{click:function(e){return t.handleSubmitApprove(r)}}},[t._v("提交审批")]),e("a",{on:{click:function(e){return t.handleApproveDecision(r)}}},[t._v("审批")]),e("a",{on:{click:function(e){return t.handlePublish(r)}}},[t._v("发布")]),e("a",{on:{click:function(e){return t.handleReviseVersion(r)}}},[t._v("修订")])])]}}])})],1),e("vxe-pager",{attrs:{perfect:"","current-page":t.queryParam.pageNo,"page-size":t.queryParam.pageSize,total:t.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:current-page":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:pageSize":function(e){return t.$set(t.queryParam,"pageSize",e)},"update:page-size":function(e){return t.$set(t.queryParam,"pageSize",e)},"page-change":t.handlePageChange}})],1),e("techmanual-detail-modal",{ref:"techmanualModal",on:{ok:function(e){return t.loadData()}}}),e("tech-book-editor-modal",{ref:"editorModal",on:{saved:t.loadData}}),e("tech-book-review-modal",{ref:"reviewModal",on:{ok:t.loadData}}),e("user-list",{ref:"reviewerSelect",attrs:{multiple:!1},on:{ok:t.onReviewerSelected}})],1)},a=[],o=n("c1df"),i=n.n(o),c=(n("5c3a"),n("ce16")),s=n("d5ab"),l=n("cba4"),d=n("b245"),u=n("4ec3"),h=n("8fad");function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){y(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function y(t,e,n){return(e=v(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t){var e=g(t,"string");return"symbol"==m(e)?e:e+""}function g(t,e){if("object"!=m(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function b(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=S(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){c=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw o}}}}function w(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var s=r&&r.prototype instanceof c?r:c,l=Object.create(s.prototype);return x(l,"_invoke",function(n,r,a){var o,c,s,l=0,d=a||[],u=!1,h={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return o=e,c=0,s=t,h.n=n,i}};function m(n,r){for(c=n,s=r,e=0;!u&&l&&!a&&e<d.length;e++){var a,o=d[e],m=h.p,f=o[2];n>3?(a=f===r)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=t):o[0]<=m&&((a=n<2&&m<o[1])?(c=0,h.v=r,h.n=o[1]):m<f&&(a=n<3||o[0]>r||r>f)&&(o[4]=n,o[5]=r,h.n=f,c=0))}if(a||n>1)return i;throw u=!0,r}return function(a,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),c=d,s=f;(e=c<2?t:s)||!u;){o||(c?c<3?(c>1&&(h.n=-1),m(c,s)):h.n=s:h.v=s);try{if(l=2,o){if(c||(a="next"),e=o[a]){if(!(e=e.call(o,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=o.return)&&e.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);o=t}else if((e=(u=h.n<0)?s:n.call(r,h))!==i)break}catch(e){o=t,c=1,s=e}finally{l=1}}return{value:e,done:u}}}(n,a,o),!0),l}var i={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var d=[][r]?e(e([][r]())):(x(e={},r,(function(){return this})),e),u=l.prototype=c.prototype=Object.create(d);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,x(t,a,"GeneratorFunction")),t.prototype=Object.create(u),t}return s.prototype=l,x(u,"constructor",l),x(l,"constructor",s),s.displayName="GeneratorFunction",x(l,a,"GeneratorFunction"),x(u),x(u,a,"Generator"),x(u,r,(function(){return this})),x(u,"toString",(function(){return"[object Generator]"})),(w=function(){return{w:o,m:h}})()}function x(t,e,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}x=function(t,e,n,r){function o(e,n){x(t,e,(function(t){return this._invoke(e,n,t)}))}e?a?a(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},x(t,e,n,r)}function k(t,e,n,r,a,o,i){try{var c=t[o](i),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,a)}function _(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){k(o,r,a,i,c,"next",t)}function c(t){k(o,r,a,i,c,"throw",t)}i(void 0)}))}}function O(t){return N(t)||E(t)||S(t)||P()}function P(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function S(t,e){if(t){if("string"==typeof t)return j(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}function E(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function N(t){if(Array.isArray(t))return j(t)}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var $={components:{TechmanualDetailModal:c["default"],TechBookEditorModal:s["default"],TechBookReviewModal:l["default"],UserList:d["default"]},data:function(){return{selectRows:[],pendingReviewRecord:null,pendingApproveRecord:null,reviewerAction:"review",lineOptions:[],repairProgramOptions:[],trainTypeOptions:[],printFrameWindow:null,queryParam:{formName:"",creatorName:"",lineId:void 0,bizStatus:void 0,trainTypeId:void 0,repairProId:void 0,templateFlag:void 0,pageNo:1,pageSize:10},totalResult:0,allAlign:"center",tableData:[],loading:!1}},created:function(){this.loadDictOptions(),this.loadData()},methods:{downloadExcel:function(t,e){var n=this,r=["序号","线路","状态","车型","修程","文件编号","文件名称","版本号","编制人"],a=(t||[]).map((function(t,e){var r=[e+1,t.lineName||"",n.formatBizStatus(t),t.trainTypeName||"",t.repairProgramName||"",t.fileNo||"",t.fileName||"",t.fileVer||"",t.creatorName||""];return r.map((function(t){return'"'.concat(String(t).replace(/"/g,'""'),'"')})).join(",")})),o=[r.join(",")].concat(O(a)).join("\n"),i=new Blob(["\ufeff",o],{type:"text/csv;charset=utf-8;"}),c=window.URL.createObjectURL(i),s=document.createElement("a");s.style.display="none",s.href=c,s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(c)},loadDictOptions:function(){var t=this;Object(u["f"])("bu_mtr_line,line_name,line_id",null).then((function(e){var n=e&&e.success&&e.result||[];t.lineOptions=n.map((function(t){return{label:t.text,value:t.value}}))})),Object(u["f"])("bu_train_type,name,id",null).then((function(e){var n=e&&e.success&&e.result||[];t.trainTypeOptions=n.map((function(t){return{label:t.text,value:t.value}}))})),Object(u["f"])("bu_repair_program,name,id",null).then((function(e){var n=e&&e.success&&e.result||[];t.repairProgramOptions=n.map((function(t){return{label:t.text,value:t.value}}))}))},checkboxChange:function(t){this.selectRows=t.records},loadData:function(){var t=this;this.loading=!0,Object(h["cc"])(this.queryParam).then((function(e){e.success&&(t.tableData=e.result.records||[],t.totalResult=e.result.total||0)})).finally((function(){t.loading=!1}))},handleSearch:function(){this.queryParam.pageNo=1,this.loadData()},handlePageChange:function(t){var e=t.currentPage,n=t.pageSize;this.queryParam.pageNo=e,this.queryParam.pageSize=n,this.loadData()},handleAdd:function(){this.$refs.techmanualModal.add()},handleEdit:function(t){this.canEdit(t)?this.$refs.techmanualModal.edit(t):this.$message.warning("仅草稿、审核中、审批中状态可编辑")},handleEditContent:function(t){t&&t.id&&this.$refs.editorModal.open(t)},handleDelete:function(){var t=this;if(0!==this.selectRows.length){var e=this.selectRows.filter((function(t){return 1===t.status||9===t.status}));e.length>0?this.$message.warning("发布/作废状态不允许删除"):this.$confirm({title:"删除确认",content:"确认删除选中的作业指导书吗？",onOk:function(){var e=t.selectRows.map((function(t){return t.id})).join(",");Object(h["L"])({ids:e}).then((function(e){e.success?(t.$message.success("删除成功"),t.selectRows=[],t.loadData()):t.$message.error(e.message||"删除失败")}))}})}else this.$message.warning("请先选择要删除的记录")},handleSaveAsTemplate:function(){var t=this;if(1===this.selectRows.length){var e=this.selectRows[0].id;Object(h["yd"])({id:e}).then((function(e){e.success?(t.$message.success("已另存为模板"),t.loadData()):t.$message.error(e.message||"操作失败")}))}else this.$message.warning("请选择一条指导书")},handleReviseVersion:function(t){var e=this;if(t&&t.id)if(1===t.status){var n=String(t.fileVer||"").trim();this.$confirm({title:"修订升版",content:"将版本【".concat(n||"-","】升版并生成新草稿，是否继续？"),onOk:function(){var r=e.buildNextVersion(n);r?Object(h["jd"])({id:t.id,newVersion:r}).then((function(t){t.success?(e.$message.success("修订升版成功，新版本：".concat(r)),e.loadData()):e.$message.error(t.message||"修订升版失败")})):e.$message.warning("无法自动计算新版本号，请先补充当前版本号")}})}else this.$message.warning("仅发布状态可修订升版");else this.$message.warning("请选择指导书")},buildNextVersion:function(t){var e=String(t||"").trim();if(!e)return"V2.0";var n=e.match(/^([Vv])(\d+)(?:\.(\d+))?$/);if(n){var r=Number(n[2]||0);return"V".concat(r+1,".0")}var a=e.match(/(\d+)(?!.*\d)/);if(a){var o=a[1],i=String(Number(o)+1);return e.replace(new RegExp("".concat(o,"(?!.*\\d)")),i)}return""},canEdit:function(t){return!!t&&(2===t.status||0===t.status&&(0===t.reviewStatus||1===t.reviewStatus))},handleSubmitReview:function(t){t&&t.id&&(0===t.status&&0===t.reviewStatus?(this.reviewerAction="review",this.pendingReviewRecord=t,this.$refs.reviewerSelect.showModal()):this.$message.warning("仅草稿状态可提交审核"))},handleReviewDecision:function(t){1===t.reviewStatus&&0===t.status?this.$refs.reviewModal.open(t):this.$message.warning("仅审核中状态可进行审核")},handleSubmitApprove:function(t){t&&t.id&&(0===t.status&&2===t.reviewStatus?(this.reviewerAction="approve",this.pendingApproveRecord=t,this.$refs.reviewerSelect.showModal()):this.$message.warning("仅审核通过状态可提交审批"))},handleApproveDecision:function(t){var e=this;t&&t.id&&(2===t.status?this.$confirm({title:"审批处理",content:"是否审批通过？若需退回请点“否”并填写原因。",okText:"是",cancelText:"否",onOk:function(){Object(h["z"])({id:t.id,approveStatus:1}).then((function(t){t.success?(e.$message.success("审批通过"),e.loadData()):e.$message.error(t.message||"审批失败")}))},onCancel:function(){var n=_(w().m((function n(){var r,a;return w().w((function(n){while(1)switch(n.n){case 0:if(r=window.prompt("请输入审批退回原因"),null!==r){n.n=1;break}return n.a(2);case 1:if(a=String(r||"").trim(),a){n.n=2;break}return e.$message.warning("请输入退回原因"),n.a(2);case 2:Object(h["z"])({id:t.id,approveStatus:2,approveComment:a}).then((function(t){t.success?(e.$message.success("已退回"),e.loadData()):e.$message.error(t.message||"退回失败")}));case 3:return n.a(2)}}),n)})));function r(){return n.apply(this,arguments)}return r}()}):this.$message.warning("仅审批中状态可审批"))},onReviewerSelected:function(t){var e=this;if(t&&0!==t.length){var n=t[0];"approve"===this.reviewerAction&&this.pendingApproveRecord?Object(h["Nd"])({id:this.pendingApproveRecord.id,approverId:n.id,approverName:n.realname||n.username}).then((function(t){t.success?(e.$message.success("已提交审批"),e.loadData()):e.$message.error(t.message||"提交失败")})).finally((function(){e.pendingApproveRecord=null,e.reviewerAction="review"})):this.pendingReviewRecord&&Object(h["Od"])({id:this.pendingReviewRecord.id,reviewerId:n.id,reviewerName:n.realname||n.username}).then((function(t){t.success?(e.$message.success("已提交审核"),e.loadData()):e.$message.error(t.message||"提交失败")})).finally((function(){e.pendingReviewRecord=null,e.reviewerAction="review"}))}else this.$message.warning("请选择处理人")},handlePublish:function(t){var e=this;t&&t.id&&(3===t.status?this.$confirm({title:"发布确认",content:"发布后将自动作废同文件编号的旧发布版本，是否继续？",onOk:function(){Object(h["Wd"])({id:t.id,status:1}).then((function(t){t.success?(e.$message.success("已发布"),e.loadData()):e.$message.error(t.message||"发布失败")}))}}):this.$message.warning("请先审批通过后再发布"))},handleExport:function(){var t=_(w().m((function t(e){var n;return w().w((function(t){while(1)switch(t.n){case 0:return t.n=1,this.ensureContentHtml(e);case 1:n=t.v,this.openPrintWindow(n);case 2:return t.a(2)}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleBatchExport:function(){var t=_(w().m((function t(){var e,n,r,a,o,i,c,s;return w().w((function(t){while(1)switch(t.p=t.n){case 0:if(e=this.selectRows||[],0!==e.length){t.n=1;break}return this.$message.warning("请先选择要导出的指导书"),t.a(2);case 1:n=[],r=b(e),t.p=2,r.s();case 3:if((a=r.n()).done){t.n=6;break}return o=a.value,t.n=4,this.ensureContentHtml(o);case 4:i=t.v,c=o.fileName||o.fileNo||"作业指导书",n.push('<section style="page-break-after:always;"><h2 style="text-align:center;">'.concat(c,"</h2>").concat(i,"</section>"));case 5:t.n=3;break;case 6:t.n=8;break;case 7:t.p=7,s=t.v,r.e(s);case 8:return t.p=8,r.f(),t.f(8);case 9:this.openPrintWindow(n.join(""));case 10:return t.a(2)}}),t,this,[[2,7,8,9]])})));function e(){return t.apply(this,arguments)}return e}(),handleExportCatalog:function(){var t=this,e=p(p({},this.queryParam),{},{pageNo:1,pageSize:2e3});Object(h["cc"])(e).then((function(e){if(e&&e.success){var n=e.result&&e.result.records?e.result.records:[];t.downloadExcel(n,"作业指导书目录.csv")}else t.$message.warning("目录导出失败")}))},openPrintWindow:function(t){var e=this.printFrameWindow||this.ensurePrintFrame(),n=e.document;n.open(),n.write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body>'.concat(t,"</body></html>")),n.close(),e.focus(),e.print()},ensurePrintFrame:function(){var t=document.createElement("iframe");return t.style.position="fixed",t.style.right="-9999px",t.style.bottom="-9999px",t.style.width="0",t.style.height="0",t.setAttribute("tabindex","-1"),document.body.appendChild(t),this.printFrameWindow=t.contentWindow,this.printFrameWindow},ensureContentHtml:function(){var t=_(w().m((function t(e){var n,r,a,o,i,c;return w().w((function(t){while(1)switch(t.p=t.n){case 0:if(!e.contentHtml){t.n=1;break}return t.a(2,e.contentHtml);case 1:return t.p=1,t.n=2,Object(h["ac"])({bookId:e.id});case 2:return n=t.v,r=n&&n.result?n.result:[],a=r.map((function(t){return Object(h["bc"])({detailId:t.id})})),t.n=3,Promise.all(a);case 3:return o=t.v,i=o.filter((function(t){return t&&t.success})).map((function(t){return t.result})).sort((function(t,e){return(t.stepNum||0)-(e.stepNum||0)})),c=this.$refs.editorModal.renderTemplate(e,i),t.n=4,Object(h["Ad"])(e.id,c);case 4:return e.contentHtml=c,t.a(2,c);case 5:return t.p=5,t.v,this.$message.warning("生成正文失败，请先编辑正文"),t.a(2,"<p>暂无正文</p>")}}),t,this,[[1,5]])})));function e(e){return t.apply(this,arguments)}return e}(),formatBizStatus:function(t){return t?9===t.status?"作废":1===t.status?"发布":3===t.status?"审批通过":2===t.status?"审批中":1===t.reviewStatus?"审核中":2===t.reviewStatus?"审核通过":"草稿":"-"},statusColor:function(t){var e=this.formatBizStatus(t);return"发布"===e?"green":"审批通过"===e?"cyan":"审批中"===e||"审核中"===e?"blue":"作废"===e?"red":"default"},formatDate:function(t){var e=t.updateTime||t.createTime;return e?i()(e).format("YYYY-MM-DD HH:mm:ss"):""}}},R=$,I=(n("964a"),n("2877")),q=Object(I["a"])(R,r,a,!1,null,"4e27ed9c",null);e["default"]=q.exports},ce16:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:t.isEdit?"编辑作业指导书":"新建作业指导书",width:"900px",confirmLoading:t.loading,maskClosable:!1},on:{ok:t.handleOk,cancel:t.handleCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("a-form",{attrs:{form:t.form,layout:"vertical"}},[e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:24}},[e("a-form-item",[e("a-checkbox",{model:{value:t.reuseEnabled,callback:function(e){t.reuseEnabled=e},expression:"reuseEnabled"}},[t._v("从既有作业指导书复用")])],1)],1)],1),t.reuseEnabled&&!t.isEdit?e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:24}},[e("a-form-item",{attrs:{label:"复用来源",required:!0}},[e("a-select",{attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择要复用的作业指导书"},model:{value:t.reuseSourceId,callback:function(e){t.reuseSourceId=e},expression:"reuseSourceId"}},t._l(t.reuseOptions,(function(n){return e("a-select-option",{key:n.id,attrs:{value:n.id}},[t._v(" "+t._s(n.fileNo)+" - "+t._s(n.fileName)+"（"+t._s(n.fileVer)+"） ")])})),1)],1)],1)],1):t._e(),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"文件编号",required:!0}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileNo",{rules:[{required:!0,message:"请输入文件编号"}]}],expression:"['fileNo', {rules: [{required: true, message: '请输入文件编号'}]}]"}],attrs:{placeholder:"请输入文件编号"}})],1)],1),e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"文件名称",required:!0}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileName",{rules:[{required:!0,message:"请输入文件名称"}]}],expression:"['fileName', {rules: [{required: true, message: '请输入文件名称'}]}]"}],attrs:{placeholder:"请输入文件名称"}})],1)],1)],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"版本",required:!0}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileVer",{rules:[{required:!0,message:"请输入版本号"}]}],expression:"['fileVer', {rules: [{required: true, message: '请输入版本号'}]}]"}],attrs:{placeholder:"请输入版本号，如V1.0"}})],1)],1),e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"所属线路",required:!0}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId",{rules:[{required:!0,message:"请选择所属线路"}]}],expression:"['lineId', {rules: [{required: true, message: '请选择所属线路'}]}]"}],attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择所属线路"}},t._l(t.lineOptions,(function(n){return e("a-select-option",{key:n.value,attrs:{value:n.value}},[t._v(" "+t._s(n.label)+" ")])})),1)],1)],1)],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"所属修程",required:!0}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["repairProgramId",{rules:[{required:!0,message:"请选择所属修程"}]}],expression:"['repairProgramId', {rules: [{required: true, message: '请选择所属修程'}]}]"}],attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择所属修程"}},t._l(t.repairProgramOptions,(function(n){return e("a-select-option",{key:n.value,attrs:{value:n.value}},[t._v(" "+t._s(n.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"实施日期",required:!0}},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["exeTime",{rules:[{required:!0,message:"请选择实施日期"}]}],expression:"['exeTime', {rules: [{required: true, message: '请选择实施日期'}]}]"}],staticStyle:{width:"100%"},attrs:{valueFormat:"YYYY-MM-DD",placeholder:"请选择实施日期"}})],1)],1)],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{span:24}},[e("a-form-item",{attrs:{label:"备注"}},[e("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!1}]}],expression:"['remark', {rules: [{required: false}]}]"}],attrs:{placeholder:"请输入备注",rows:3}})],1)],1)],1)],1)],1)},a=[],o=n("8fad"),i=n("4ec3");function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return(e=u(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){var e=h(t,"string");return"symbol"==c(e)?e:e+""}function h(t,e){if("object"!=c(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var m={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this),record:null,isEdit:!1,reuseEnabled:!1,reuseSourceId:"",reuseOptions:[],lineOptions:[],repairProgramOptions:[]}},created:function(){this.loadDictOptions()},methods:{loadDictOptions:function(){var t=this;Object(i["f"])("bu_mtr_line,line_name,line_id",null).then((function(e){var n=e&&e.success&&e.result||[];t.lineOptions=n.map((function(t){return{label:t.text,value:t.value}}))})),Object(i["f"])("bu_repair_program,name,id",null).then((function(e){var n=e&&e.success&&e.result||[];t.repairProgramOptions=n.map((function(t){return{label:t.text,value:t.value}}))})),Object(o["cc"])({pageNo:1,pageSize:1e3,templateFlag:0}).then((function(e){if(e&&e.success){var n=e.result&&e.result.records?e.result.records:[];t.reuseOptions=n.filter((function(t){return t&&9!==t.status}))}}))},add:function(){this.isEdit=!1,this.record=null,this.reuseEnabled=!1,this.reuseSourceId="",this.form.resetFields(),this.visible=!0},edit:function(t){var e=this;this.isEdit=!0,this.record=t,this.reuseEnabled=!1,this.reuseSourceId="",this.visible=!0,this.$nextTick((function(){e.form.setFieldsValue({fileNo:t.fileNo,fileName:t.fileName,fileVer:t.fileVer,lineId:t.lineId,repairProgramId:t.repairProgramId,exeTime:t.exeTime,remark:t.remark})}))},handleOk:function(){var t=this;this.form.validateFields((function(e,n){if(!e){if(t.isEdit&&t.record&&1===t.record.status)return void t.$message.warning("已发布指导书不允许修改基础信息");if(!t.isEdit&&t.reuseEnabled&&!t.reuseSourceId)return void t.$message.warning("请选择复用来源");t.loading=!0;var r=l(l({},n),{},{id:t.isEdit?t.record.id:void 0}),a=!t.isEdit&&t.reuseEnabled?Object(o["zd"])(t.reuseSourceId,r):Object(o["Cd"])(r);a.then((function(e){e.success?(t.$message.success(t.isEdit?"修改成功":"新增成功"),t.handleCancel(),t.$emit("ok")):t.$message.error(e.message||"操作失败")})).finally((function(){t.loading=!1}))}}))},handleCancel:function(){this.visible=!1,this.form.resetFields(),this.record=null,this.reuseEnabled=!1,this.reuseSourceId=""}}},f=m,p=n("2877"),y=Object(p["a"])(f,r,a,!1,null,null,null);e["default"]=y.exports},d5ab:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"编辑作业指导书正文",width:"96%",maskClosable:!1,footer:null,bodyStyle:t.modalBodyStyle,dialogStyle:{top:"10px"},wrapClassName:"tech-book-editor-modal"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"editor-toolbar"},[e("a-space",[e("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleSave}},[t._v("保存")]),e("a-dropdown",[e("a-button",[t._v("插入模板")]),e("a-menu",{attrs:{slot:"overlay"},on:{click:t.handleInsertTemplate},slot:"overlay"},[e("a-menu-item",{key:"cover"},[t._v("封面")]),e("a-menu-item",{key:"changeRecord"},[t._v("文件变更记录卡")]),e("a-menu-item",{key:"processFlow"},[t._v("工艺流程图")]),e("a-menu-item",{key:"preWork"},[t._v("作业前准备")]),e("a-menu-item",{key:"processStep"},[t._v("工序工步")]),e("a-menu-item",{key:"tools"},[t._v("工具工装")]),e("a-menu-item",{key:"consumables"},[t._v("消耗料")]),e("a-menu-item",{key:"materialDetail"},[t._v("物料明细")]),e("a-menu-item",{key:"torqueList"},[t._v("扭力值清单")]),e("a-menu-item",{key:"appendix"},[t._v("附录")])],1)],1),e("a-button",{on:{click:t.handleRebuild}},[t._v("重新生成模板")]),e("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleExport}},[t._v("导出规范Word")]),e("a-button",{on:{click:t.handleClose}},[t._v("关闭")])],1),e("a-space",[e("a-button",{attrs:{size:"small"},on:{click:t.insertPageBreak}},[t._v("插入分页符")])],1),e("div",{staticClass:"tips"},[t._v(" 当前模板："+t._s(t.record.fileName||"-")+"（版本："+t._s(t.record.fileVer||"-")+"） ")])],1),e("div",{staticClass:"editor-body"},[e("j-editor",{attrs:{height:t.editorHeight},model:{value:t.contentHtml,callback:function(e){t.contentHtml=e},expression:"contentHtml"}})],1)])},a=[],o=n("a061"),i=n("8fad"),c="border-collapse:collapse;width:100%;border:1px solid #000;font-family:宋体,SimSun;font-size:10.5pt;",s="border:1px solid #000;background:#e7e6e6;padding:4px;text-align:center;font-weight:bold;vertical-align:middle;",l="border:1px solid #000;padding:4px;vertical-align:top;",d="page-break-after:always;";function u(t){var e=t||{};return'\n<div style="'.concat(d,'text-align:center;padding-top:80px;">\n  <h1 style="font-size:26pt;margin-bottom:40px;font-family:宋体;font-weight:bold;">').concat(e.fileName||"作业指导书",'</h1>\n  <table border="1" cellspacing="0" cellpadding="8" style="').concat(c,'margin-top:60px;width:80%;margin-left:auto;margin-right:auto;">\n    <tr>\n      <td style="').concat(s,'width:25%;">文件编号</td>\n      <td style="').concat(l,'width:25%;">').concat(e.fileNo||"",'</td>\n      <td style="').concat(s,'width:25%;">版本号</td>\n      <td style="').concat(l,'width:25%;">').concat(e.fileVer||"1.0",'</td>\n    </tr>\n    <tr>\n      <td style="').concat(s,'">编制人</td>\n      <td style="').concat(l,'">').concat(e.creatorName||"",'</td>\n      <td style="').concat(s,'">编制日期</td>\n      <td style="').concat(l,'">').concat(e.exeTime||"",'</td>\n    </tr>\n    <tr>\n      <td style="').concat(s,'">审核人</td>\n      <td style="').concat(l,'">').concat(e.reviewerName||"",'</td>\n      <td style="').concat(s,'">审批人</td>\n      <td style="').concat(l,'">').concat(e.approverName||"",'</td>\n    </tr>\n    <tr>\n      <td style="').concat(s,'">项目号</td>\n      <td style="').concat(l,'">{{PROJECT_NO}}</td>\n      <td style="').concat(s,'">文件名称</td>\n      <td style="').concat(l,'">{{FILE_NAME}}</td>\n    </tr>\n  </table>\n</div>\n')}function h(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">文件变更记录卡</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}} &nbsp; 项目号：{{PROJECT_NO}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(c,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(s,'width:8%;">序号</th>\n      <th style="').concat(s,'width:15%;">变更日期</th>\n      <th style="').concat(s,'width:37%;">变更内容</th>\n      <th style="').concat(s,'width:15%;">变更人</th>\n      <th style="').concat(s,'width:15%;">审批人</th>\n      <th style="').concat(s,'width:10%;">版本</th>\n    </tr>\n    <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">3</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  </table>\n</div>\n')}function m(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">工艺流程图</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <div style="border:2px dashed #666;min-height:300px;padding:20px;text-align:center;color:#666;background:#f9f9f9;margin-top:10px;">\n    <p style="font-family:宋体;font-size:11pt;">（请在此处插入工艺流程图或相关图片）</p>\n  </div>\n</div>\n')}function f(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">消耗料清单</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(c,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(s,'width:8%;">序号</th>\n      <th style="').concat(s,'width:15%;">物料编码</th>\n      <th style="').concat(s,'width:25%;">物料名称</th>\n      <th style="').concat(s,'width:20%;">规格型号</th>\n      <th style="').concat(s,'width:8%;">单位</th>\n      <th style="').concat(s,'width:8%;">数量</th>\n      <th style="').concat(s,'width:16%;">备注</th>\n    </tr>\n    <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">3</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  </table>\n</div>\n')}function p(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">物料明细表</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(c,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(s,'width:8%;">序号</th>\n      <th style="').concat(s,'width:12%;">物料编��</th>\n      <th style="').concat(s,'width:20%;">物料名称</th>\n      <th style="').concat(s,'width:15%;">规格型号</th>\n      <th style="').concat(s,'width:8%;">单位</th>\n      <th style="').concat(s,'width:8%;">数量</th>\n      <th style="').concat(s,'width:12%;">单价(元)</th>\n      <th style="').concat(s,'width:17%;">备注</th>\n    </tr>\n    <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  </table>\n</div>\n')}function y(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">作业前准备</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(c,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(s,'width:10%;">序号</th>\n      <th style="').concat(s,'width:50%;">检查项目</th>\n      <th style="').concat(s,'width:20%;">标准/要求</th>\n      <th style="').concat(s,'width:20%;">确认结果</th>\n    </tr>\n    <tr><td style="').concat(l,'">1</td><td style="').concat(l,'">人员资质确认</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">2</td><td style="').concat(l,'">工具工装检查</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">3</td><td style="').concat(l,'">物料准备确认</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">4</td><td style="').concat(l,'">安全防护确认</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  </table>\n</div>\n')}function v(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">工序工步</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(c,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(s,'width:8%;">工序号</th>\n      <th style="').concat(s,'width:8%;">工步号</th>\n      <th style="').concat(s,'width:35%;">作业内容</th>\n      <th style="').concat(s,'width:20%;">技术要求</th>\n      <th style="').concat(s,'width:14%;">工具/工装</th>\n      <th style="').concat(s,'width:15%;">备注</th>\n    </tr>\n    <tr><td style="').concat(l,'">1</td><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'"></td><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">2</td><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  </table>\n</div>\n')}function g(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">工具工装清单</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(c,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(s,'width:10%;">序号</th>\n      <th style="').concat(s,'width:18%;">工具编码</th>\n      <th style="').concat(s,'width:24%;">工具名称</th>\n      <th style="').concat(s,'width:20%;">规格型号</th>\n      <th style="').concat(s,'width:10%;">数量</th>\n      <th style="').concat(s,'width:18%;">备注</th>\n    </tr>\n    <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  </table>\n</div>\n')}function b(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">扭力值清单</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(c,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(s,'width:10%;">序号</th>\n      <th style="').concat(s,'width:25%;">安装部位</th>\n      <th style="').concat(s,'width:20%;">螺栓规格</th>\n      <th style="').concat(s,'width:15%;">扭力值(N·m)</th>\n      <th style="').concat(s,'width:15%;">工具</th>\n      <th style="').concat(s,'width:15%;">备注</th>\n    </tr>\n    <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n    <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  </table>\n</div>\n')}function w(){return'\n<div style="'.concat(d,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">附录</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <div style="border:1px solid #333;min-height:250px;padding:15px;color:#666;background:#fafafa;margin-top:10px;">\n    <p style="font-family:宋体;font-size:10.5pt;color:#999;">（请在此处填写附录内容，可插入图片、其他表格、补充说明等）</p>\n  </div>\n</div>\n')}function x(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var s=r&&r.prototype instanceof c?r:c,l=Object.create(s.prototype);return k(l,"_invoke",function(n,r,a){var o,c,s,l=0,d=a||[],u=!1,h={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return o=e,c=0,s=t,h.n=n,i}};function m(n,r){for(c=n,s=r,e=0;!u&&l&&!a&&e<d.length;e++){var a,o=d[e],m=h.p,f=o[2];n>3?(a=f===r)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=t):o[0]<=m&&((a=n<2&&m<o[1])?(c=0,h.v=r,h.n=o[1]):m<f&&(a=n<3||o[0]>r||r>f)&&(o[4]=n,o[5]=r,h.n=f,c=0))}if(a||n>1)return i;throw u=!0,r}return function(a,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),c=d,s=f;(e=c<2?t:s)||!u;){o||(c?c<3?(c>1&&(h.n=-1),m(c,s)):h.n=s:h.v=s);try{if(l=2,o){if(c||(a="next"),e=o[a]){if(!(e=e.call(o,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=o.return)&&e.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);o=t}else if((e=(u=h.n<0)?s:n.call(r,h))!==i)break}catch(e){o=t,c=1,s=e}finally{l=1}}return{value:e,done:u}}}(n,a,o),!0),l}var i={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var d=[][r]?e(e([][r]())):(k(e={},r,(function(){return this})),e),u=l.prototype=c.prototype=Object.create(d);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,k(t,a,"GeneratorFunction")),t.prototype=Object.create(u),t}return s.prototype=l,k(u,"constructor",l),k(l,"constructor",s),s.displayName="GeneratorFunction",k(l,a,"GeneratorFunction"),k(u),k(u,a,"Generator"),k(u,r,(function(){return this})),k(u,"toString",(function(){return"[object Generator]"})),(x=function(){return{w:o,m:h}})()}function k(t,e,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}k=function(t,e,n,r){function o(e,n){k(t,e,(function(t){return this._invoke(e,n,t)}))}e?a?a(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},k(t,e,n,r)}function _(t,e,n,r,a,o,i){try{var c=t[o](i),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,a)}function O(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){_(o,r,a,i,c,"next",t)}function c(t){_(o,r,a,i,c,"throw",t)}i(void 0)}))}}var P=["{{FILE_NO}}","{{FILE_NAME}}","{{FILE_VER}}","{{PROJECT_NO}}"],S={name:"TechBookEditorModal",components:{JEditor:o["default"]},data:function(){return{visible:!1,record:{},contentHtml:"",loading:!1,editorHeight:520}},computed:{modalBodyStyle:function(){return{height:"calc(100vh - 120px)",overflow:"hidden"}}},methods:{handleInsertTemplate:function(t){var e=t.key,n={cover:u,changeRecord:h,processFlow:m,preWork:y,processStep:v,tools:g,consumables:f,materialDetail:p,torqueList:b,appendix:w},r=n[e];if(r){var a=this.resolveTemplatePlaceholders(r(this.record||{}));this.contentHtml=(this.contentHtml||"")+a}},resolveTemplatePlaceholders:function(t){var e=t||"",n={"{{FILE_NO}}":this.record&&this.record.fileNo?this.record.fileNo:"","{{FILE_NAME}}":this.record&&this.record.fileName?this.record.fileName:"","{{FILE_VER}}":this.record&&this.record.fileVer?this.record.fileVer:"","{{PROJECT_NO}}":this.record&&(this.record.projectNo||this.record.project||this.record.fileNo)?this.record.projectNo||this.record.project||this.record.fileNo:""};return P.forEach((function(t){e=e.split(t).join(n[t])})),e},insertPageBreak:function(){var t='<div style="page-break-after:always;"><span style="color:#999;">—— 分页 ——</span></div>';this.contentHtml=(this.contentHtml||"")+t},open:function(){var t=O(x().m((function t(e){var n,r,a,o,c,s;return x().w((function(t){while(1)switch(t.p=t.n){case 0:if(this.record=e||{},n=0===this.record.status||2===this.record.status,this.contentHtml=e.contentHtml||"",this.visible=!0,this.setEditorHeight(),window.addEventListener("resize",this.setEditorHeight),this.contentHtml||!this.record.id){t.n=5;break}return this.loading=!0,t.p=1,t.n=2,Object(i["ac"])({bookId:this.record.id});case 2:return r=t.v,a=r&&r.result?r.result:[],o=a.map((function(t){return Object(i["bc"])({detailId:t.id})})),t.n=3,Promise.all(o);case 3:if(c=t.v,s=c.filter((function(t){return t&&t.success})).map((function(t){return t.result})).sort((function(t,e){return(t.stepNum||0)-(e.stepNum||0)})),this.contentHtml=this.renderTemplate(this.record,s),!n){t.n=4;break}return t.n=4,Object(i["Ad"])(this.record.id,this.contentHtml);case 4:return t.p=4,this.loading=!1,t.f(4);case 5:return t.a(2)}}),t,this,[[1,,4,5]])})));function e(e){return t.apply(this,arguments)}return e}(),handleSave:function(){var t=this;if(this.record.id){var e=2===this.record.status||0===this.record.status&&2!==this.record.reviewStatus;e?(this.loading=!0,Object(i["Ad"])(this.record.id,this.contentHtml).then((function(e){e.success?(t.$message.success("正文已保存"),t.$emit("saved"),t.handleClose()):t.$message.error(e.message||"保存失败")})).finally((function(){t.loading=!1}))):this.$message.warning("仅草稿、审核中、审批中状态可编辑保存")}else this.$message.warning("未选择指导书")},handleExport:function(){var t=O(x().m((function t(){var e,n,r,a,o,i;return x().w((function(t){while(1)switch(t.p=t.n){case 0:if(this.contentHtml){t.n=1;break}return this.$message.warning("暂无正文内容，无法导出"),t.a(2);case 1:return this.loading=!0,t.p=2,t.n=3,this.$axios({method:"post",url:"http://localhost:8081/api/techmanual/export-word",data:{htmlContent:this.contentHtml,manualName:this.record.fileName||"作业指导书",fileNo:this.record.fileNo||"",fileVer:this.record.fileVer||"1.0",projectNo:this.record.projectNo||this.record.project||""},responseType:"blob"});case 3:e=t.v,n="".concat(this.record.fileName||"作业指导书",".docx"),r=e.data,a=window.URL.createObjectURL(r),o=document.createElement("a"),o.href=a,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a),this.$message.success("导出成功！"),t.n=5;break;case 4:t.p=4,i=t.v,this.$message.error("导出失败："+(i.message||"未知错误"));case 5:return t.p=5,this.loading=!1,t.f(5);case 6:return t.a(2)}}),t,this,[[2,4,5,6]])})));function e(){return t.apply(this,arguments)}return e}(),handleRebuild:function(){var t=this;this.record.id?this.$confirm({title:"重新生成模板",content:"将根据步骤/物料/工器具重新生成正文，当前编辑内容会被覆盖，是否继续？",onOk:function(){var e=O(x().m((function e(){var n,r,a,o,c;return x().w((function(e){while(1)switch(e.p=e.n){case 0:return t.loading=!0,e.p=1,e.n=2,Object(i["ac"])({bookId:t.record.id});case 2:return n=e.v,r=n&&n.result?n.result:[],a=r.map((function(t){return Object(i["bc"])({detailId:t.id})})),e.n=3,Promise.all(a);case 3:return o=e.v,c=o.filter((function(t){return t&&t.success})).map((function(t){return t.result})).sort((function(t,e){return(t.stepNum||0)-(e.stepNum||0)})),t.contentHtml=t.renderTemplate(t.record,c),e.n=4,Object(i["Ad"])(t.record.id,t.contentHtml);case 4:t.$message.success("已重新生成");case 5:return e.p=5,t.loading=!1,e.f(5);case 6:return e.a(2)}}),e,null,[[1,,5,6]])})));function n(){return e.apply(this,arguments)}return n}()}):this.$message.warning("未选择指导书")},handleClose:function(){this.visible=!1,this.record={},this.contentHtml="",this.loading=!1,window.removeEventListener("resize",this.setEditorHeight)},setEditorHeight:function(){var t=window.innerHeight||900;this.editorHeight=Math.max(420,t-220)},renderTemplate:function(t,e){if(!e||0===e.length)return"";var n='\n        <h1 style="text-align:center;">'.concat(t.fileName||"作业指导书",'</h1>\n        <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">\n          <tr>\n            <td style="width:15%;">文件编号</td><td style="width:35%;">').concat(t.fileNo||"",'</td>\n            <td style="width:15%;">版本</td><td style="width:35%;">').concat(t.fileVer||"","</td>\n          </tr>\n          <tr>\n            <td>线路</td><td>").concat(t.lineName||"","</td>\n            <td>修程</td><td>").concat(t.repairProgramName||"",'</td>\n          </tr>\n          <tr>\n            <td>实施日期</td><td colspan="3">').concat(t.exeTime||"","</td>\n          </tr>\n        </table>\n        <h2>工序工步</h2>\n      "),r=(e||[]).map((function(t,e){var n=t.stepContent?"<div>".concat(t.stepContent,"</div>"):"<div>（无内容）</div>",r=t.materialList&&t.materialList.length?'\n          <h4>物料</h4>\n          <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">\n            <tr><th>编码</th><th>名称</th><th>规格</th><th>单位</th><th>数量</th></tr>\n            '.concat(t.materialList.map((function(t){return"\n              <tr>\n                <td>".concat(t.code||"","</td>\n                <td>").concat(t.name||"","</td>\n                <td>").concat(t.spec||"","</td>\n                <td>").concat(t.unit||"","</td>\n                <td>").concat(t.amount||"","</td>\n              </tr>")})).join(""),"\n          </table>"):"",a=t.toolList&&t.toolList.length?'\n          <h4>工器具</h4>\n          <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">\n            <tr><th>编码</th><th>名称</th><th>规格</th><th>单位</th><th>数量</th></tr>\n            '.concat(t.toolList.map((function(t){return"\n              <tr>\n                <td>".concat(t.code||"","</td>\n                <td>").concat(t.name||"","</td>\n                <td>").concat(t.spec||"","</td>\n                <td>").concat(t.unit||"","</td>\n                <td>").concat(t.amount||"","</td>\n              </tr>")})).join(""),"\n          </table>"):"";return"\n          <h3>步骤".concat(t.stepNum||e+1,"：").concat(t.stepTitle||"","</h3>\n          ").concat(n,"\n          ").concat(r,"\n          ").concat(a,"\n        ")})).join("");return n+r}}},E=S,N=(n("03be"),n("2877")),j=Object(N["a"])(E,r,a,!1,null,"b3ed834c",null);e["default"]=j.exports},f76d:function(t,e,n){"use strict";n("9527")}}]);