(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f47bb1c2","chunk-101b6969","chunk-2d590ccc"],{"3bbd":function(e,t,a){"use strict";a("e6d2")},"50c3":function(e,t,a){},"6abe":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{id:"leftTrainAsset"}},[t("div",{staticClass:"typeTitle"},[t("a-icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"database"}}),e._v(" 车辆列表 ")],1),t("div",{staticStyle:{width:"100%",height:"calc(100% - 52px)",padding:"0 10%","overflow-y":"auto"}},[e.treeData.length?t("a-tree",{attrs:{"show-line":"",checkStrictly:"","tree-data":e.treeData,"default-selected-keys":e.defaultSelectedKeys,replaceFields:{title:"name",key:"name"},expandedKeys:e.expandedKeys},on:{"update:expandedKeys":function(t){e.expandedKeys=t},"update:expanded-keys":function(t){e.expandedKeys=t},select:e.handleTreeSelect}}):e._e()],1)])},i=[],r=a("ca00"),s=a("8fad"),l={name:"leftTrainAsset",props:["value"],data:function(){return{defaultSelectedKeys:[],selectedKeys:[],selectedNode:{},treeData:[],expandedKeys:[],queryParam:{parentId:""}}},created:function(){},methods:{handleTreeSelect:function(e,t){var a={};e.length>0&&(a={trainId:e[0],trainTypeId:t.node.dataRef.trainTypeId}),this.$emit("input",a)},queryTreeData:function(){var e=this;Object(s["oc"])().then((function(t){if(t.success){if(e.treeData=t.result,Object(r["e"])(e.value)){e.defaultSelectedKeys[0]=t.result[0].name;var a={trainId:t.result[0].name,trainTypeId:t.result[0].trainTypeId};e.$emit("input",a)}else e.defaultSelectedKeys[0]=e.value.trainId;e.$nextTick((function(t){e.expandedKeys=e.treeData.filter((function(t){return t.children.find((function(t){return t.name===e.value.trainId}))})).map((function(e){return e.name}))}))}}))},onSelectTree:function(e){this.queryTreeData(e)}}},c=l,d=(a("3bbd"),a("2877")),o=Object(d["a"])(c,n,i,!1,null,null,null);t["default"]=o.exports},dafc:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"查看",width:"100%",height:"auto",visible:e.visible,dialogClass:"fullDialog",confirmLoading:e.confirmLoading,footer:null,destroyOnClose:!0,zIndex:50},on:{cancel:e.handleCancel}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between",height:"calc(100vh - 68px)"}},[t("div",{staticStyle:{width:"100%",height:"100%"}},[t("train-info",{on:{close:function(t){return e.handleCancel()}},model:{value:e.trainInfo,callback:function(t){e.trainInfo=t},expression:"trainInfo"}})],1)])])},i=[],r=a("db1c"),s=a("6abe"),l={name:"TrainAsset",components:{LeftTrainAsset:s["default"],TrainInfo:r["default"]},data:function(){return{visible:!1,confirmLoading:!1,trainInfo:{trainId:"",trainTypeId:""}}},methods:{show:function(e){var t=this;this.visible=!0,this.trainInfo.trainId=e.trainId,this.trainInfo.trainTypeId=e.trainTypeId,this.$nextTick((function(){t.$refs.leftTrainAsset.queryTreeData()}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},c=l,d=a("2877"),o=Object(d["a"])(c,n,i,!1,null,"5cc3c53a",null);t["default"]=o.exports},db1c:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{id:"trainAssetRightContent"}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchQuery.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"名称或编码"},model:{value:e.queryParam.title,callback:function(t){e.$set(e.queryParam,"title",t)},expression:"queryParam.title"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"状态"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_effective"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:10,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.searchQuery}},[e._v("查询")]),t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),t("a-button",{attrs:{disabled:1!=e.records.length},on:{click:function(t){return e.handleEdit(e.records[0])}}},[e._v("编辑")]),t("a-button",{attrs:{disabled:e.records.length<1},on:{click:e.handleDel}},[e._v("删除")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.importStructure}},[e._v("导入创建")])],1)],1)])],1)],1)],1),t("div",{staticClass:"tableHeight"},[t("vxe-table",{ref:"listTable",attrs:{border:"",resizable:"","row-id":"id",align:e.allAlign,height:"auto",data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,checkStrictly:!0},"edit-config":{trigger:"manual",mode:"row"},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}},on:{"checkbox-change":e.checkboxChange,"checkbox-all":e.checkboxChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{title:"车号",width:"100"}},[[t("div",[e._v(" "+e._s(e.value.trainId)+" ")])]],2),t("vxe-table-column",{attrs:{field:"assetName",title:"车厢","tree-node":"",width:"20%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"placeDesc",title:"位置",width:"14%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{title:"系统",width:"14%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"assetNo",title:"编码",width:"14%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"structType_dictText",title:"类型",width:"10%"}}),t("vxe-table-column",{attrs:{field:"assetTypeName",title:"设备类型",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"assetCode",title:"资产编码",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"manufNo",title:"出厂编码",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{title:"设备标签",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"placeId",title:"所属位置",width:"10%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"placeDesc",title:"位置描述",width:"10%",align:"left","header-align":"center"}})],1)],1),t("train-asset-type",{ref:"modalForm",attrs:{trainTypeId:e.trainTypeId,pid:e.selectPid,multiple:!0},on:{ok:e.importTarget}}),t("train-sys-item-modal",{ref:"sysModalForm",attrs:{trainId:e.trainId,trainTypeId:e.trainTypeId,parent:e.selectParent},on:{ok:e.addTarget}})],1)},i=[],r=a("2cb5"),s=a("1297"),l=a("8fad"),c={components:{TrainAssetType:r["default"],TrainSysItemModal:s["default"]},name:"TrainInfo",props:["value"],data:function(){return{records:[],trainId:"",trainTypeId:"",selectParent:{},queryParam:{code:""},allAlign:"center",tableData:[],selectTreeNode:[],selectPid:"",loading:!1}},watch:{value:{immediate:!0,handler:function(e){e&&(this.trainId=e.trainId,this.trainTypeId=e.trainTypeId,this.queryParam.code=e.trainId),this.findList()}}},created:function(){},methods:{checkboxChange:function(e){this.records=e.records},findList:function(){var e=this;Object(l["ic"])(this.queryParam).then((function(t){t.success&&(e.loading=!1,e.tableData=t.result,e.records=[])}))},findSelectList:function(){var e={code:this.trainId};Object(l["ic"])(e).then((function(e){e.success}))},loadChildrenMethod:function(e){var t=this,a=e.row,n={code:this.trainId,id:a.id,searchText:this.queryParam.searchText,status:this.queryParam.status};return new Promise((function(e){Object(l["ic"])(n).then((function(a){a.success?e(a.result):t.$message.error("".concat(a.msg))}))}))},loadSelectNodeMethod:function(e){var t=this,a={code:this.trainId,id:e.dataRef.id};return new Promise((function(e){Object(l["ic"])(a).then((function(e){if(e.success)e.result.map((function(e){t.selectTreeNode=t.selectTreeNode.concat(t.genSelectTreeNode(e))}));else t.$message.error(e.message)})),e()}))},genSelectTreeNode:function(e){return{id:e.id,pId:e.parentId,value:e.id,title:e.assetName,isLeaf:!e.hasChildren}},searchQuery:function(){this.findList()},handleAdd:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?1==t.length?this.selectParent={id:t[0].id,name:t[0].assetName}:this.$message.error("只能选择一个上级节点或者不选!"):this.selectParent={},setTimeout((function(){e.$refs.sysModalForm.add(),e.$refs.sysModalForm.title="新增"}),0)},handleEdit:function(e){this.$refs.sysModalForm.edit(e),this.$refs.sysModalForm.title="编辑"},addTarget:function(){this.loadData()},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"此操作将删除当前设备及其子级数据，是否继续？",okText:"确定",cancelText:"取消",onOk:function(){var a=t.map((function(e,t){return e.id})).join(",");Object(l["P"])({ids:a}).then((function(t){t.success?(e.$message.success(t.message),e.loadData()):e.$message.error(t.message)}))}}):this.$message.error("尚未选中任何数据!")},importStructure:function(){if(this.value&&this.value.trainId){var e=this.$refs.listTable.getCheckboxRecords();0===e.length?this.$refs.modalForm.showModal():1===e.length?(this.selectPid=e[0].id,this.$refs.modalForm.showModal()):this.$message.error("只能在一个设备下进行导入，不要选择多个设备!")}else this.$message.error("请选择要的导入的车辆!")},importTarget:function(e){var t=this,a=e.map((function(e,t){return e.id})).join(","),n={childId:a,parentId:this.selectPid,trainNo:this.trainId};this.loading=!0,Object(l["Cc"])(n).then((function(e){e.success?(t.$message.success(e.message),t.loadData()):t.$message.warning(e.message)})).finally((function(){return t.loading=!1}))},loadData:function(){this.queryParam.id="",this.findList()},handleBack:function(){this.$emit("close")}}},d=c,o=(a("ea5c"),a("2877")),u=Object(o["a"])(d,n,i,!1,null,null,null);t["default"]=u.exports},e6d2:function(e,t,a){},ea5c:function(e,t,a){"use strict";a("50c3")}}]);