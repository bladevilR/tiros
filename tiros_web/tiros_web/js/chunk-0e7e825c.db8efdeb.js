(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e7e825c"],{"1d70":function(t,e,a){"use strict";a("7ae8")},"7ae8":function(t,e,a){},80295:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("na-splitter",{attrs:{"default-size":200}},[e("div",{staticStyle:{height:"calc(100vh - 120px)"},attrs:{slot:"left-panel"},slot:"left-panel"},[e("div",[e("a-button",{attrs:{type:"link",block:""},on:{click:t.openFile}},[t._v(" 设置背景 "),e("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.bgFileChange}})])],1),e("div",[e("a-button",{attrs:{type:"link",block:""},on:{click:t.clearCanvas}},[t._v(" 清除设置 ")])],1),e("div",[e("a-button",{attrs:{type:"link",block:""},on:{click:t.testCanvas}},[t._v(" 测试功能 ")])],1),e("div",{staticStyle:{"background-color":"#eeeeee",width:"100%","line-height":"30px","margin-top":"10px","padding-left":"10px","font-weight":"bold"}},[t._v(" 工位列表 ")]),e("div",{staticClass:"listWorkStation"},[e("div",{staticClass:"selectItem",attrs:{draggable:"true",workNo:"1",workName:"1 号"},on:{dragstart:t.dragStart}},[e("div",{staticClass:"logo"},[e("img",{attrs:{src:a("fba6")}})]),e("div",{staticClass:"title"},[t._v(" 1 号工位 ")]),e("div",{staticStyle:{clear:"both"}})]),e("div",{staticClass:"selectItem",attrs:{draggable:"true",workNo:"2",workName:"2 号"},on:{dragstart:t.dragStart}},[e("div",{staticClass:"logo"},[e("img",{attrs:{src:a("fba6")}})]),e("div",{staticClass:"title"},[t._v(" 2 号工位 ")]),e("div",{staticStyle:{clear:"both"}})])])]),e("div",{ref:"rightPanel",staticStyle:{height:"calc(100vh - 120px)",position:"relative"},attrs:{slot:"right-panel"},on:{contextmenu:t.onContextmenu},slot:"right-panel"},[e("canvas",{ref:"main",staticStyle:{width:"100%",height:"100%"},attrs:{id:"main"}}),e("div",{ref:"hoverPop",staticStyle:{width:"200px",height:"200px",position:"absolute",top:"0px",left:"0px","background-color":"aquamarine",display:"none","z-index":"999"}},[t.hoverItem?e("div",[t._v(" "+t._s(t.hoverItem.workNo)+"-"+t._s(t.hoverItem.workName)+" ")]):t._e()]),e("div",{ref:"contextMenu",staticStyle:{width:"100px",height:"100px",position:"absolute",top:"0px",left:"0px","background-color":"aquamarine",display:"none","z-index":"999"}},[e("div",{on:{click:t.deleteWorkStation}},[t._v(" 删除 ")]),e("div",{on:{click:t.changeImage}},[t._v(" 改变图片 ")])])])])},n=[],s=a("7a94"),o=a("e18e");s["fabric"].NamedImage=s["fabric"].util.createClass(s["fabric"].Image,{type:"named-image",initialize:function(t,e){this.callSuper("initialize",t,e),e&&this.set("name",e.name)&&this.set("id",e.id)},toObject:function(){return s["fabric"].util.object.extend(this.callSuper("toObject"),{name:this.name})}}),s["fabric"].NamedImage.fromObject=function(t,e){s["fabric"].util.loadImage(t.src,(function(a){e&&e(new s["fabric"].NamedImage(a,t))}))};var r={name:"canvas_demo",components:{NaSplitter:o["default"],splitter:splitter},data:function(){return{imgAllow:["jpeg","jpg","gif","png"],canvas:null,dragItem:null,hoverItem:null,contextObj:null,imgSize:{w:30,h:30}}},mounted:function(){var t=this.$refs.rightPanel.clientWidth,e=this.$refs.rightPanel.clientHeight;this.$refs.main.width=t,this.$refs.main.height=e,this.canvas=new s["fabric"].Canvas("main"),this.canvas.on("drop",this.dropImage),this.canvas.on("mouse:over",this.mouseHover),this.canvas.on("mouse:out",this.mouseOut),this.canvas.on("mouse:down",this.onMouseDown),this.setBackgroundImage(a("9b1e"))},methods:{openFile:function(){this.$refs.file.dispatchEvent(new MouseEvent("click"))},bgFileChange:function(t){var e=this,a=t.target.files;if(null!=a&&0!==a.length){var i="";try{var n=a[0].name.split(".");i=n[n.length-1]}catch(o){i=""}if(""===i||this.imgAllow.indexOf(i)<0)this.$message.error("不是有效的图片文件,只支持"+this.imgAllow.join(",")+"图片文件");else{var s=new FileReader;s.onload=function(t){var a=t.target.result;e.setBackgroundImage(a)},s.readAsDataURL(a[0])}}},setBackgroundImage:function(t){var e=this;s["fabric"].Image.fromURL(t,(function(t){var a=t.height/t.width,i=e.canvas.width/t.width,n=e.canvas.width*a/t.height;e.canvas.setBackgroundImage(t,e.canvas.renderAll.bind(e.canvas),{scaleX:i,scaleY:n},{crossOrigin:"anonymous"})}))},dragStart:function(t){var e=t.target.children[0].children[0];this.dragItem={workNo:t.target.attributes["workNo"].value,workName:t.target.attributes["workName"].value,img:e}},dropImage:function(t){var e=this;if(this.dragItem){var a=t.e,i=a.offsetX,n=a.offsetY;this.checkObjectId(this.dragItem.workNo)?this.$message.error(this.dragItem.workName+"已经存在了，不能重复创建"):s["fabric"].util.loadImage(this.dragItem.img.src,(function(t){var a=new s["fabric"].NamedImage(t,{width:e.dragItem.img.naturalWidth,height:e.dragItem.img.naturalHeight,scaleX:e.imgSize.w/e.dragItem.img.naturalWidth,scaleY:e.imgSize.h/e.dragItem.img.naturalHeight,top:0,left:0,id:e.dragItem.workNo,name:e.dragItem.workName});a.set("selectable",!1);var o=new s["fabric"].Text(e.dragItem.workName,{top:e.imgSize.h+3,left:5,fontSize:12});o.set("selectable",!1);var r=n-e.imgSize.h/2.5,l=i-e.imgSize.w/2.5,c=new s["fabric"].Group([a,o],{left:l,top:r});e.canvas.add(c),e.dragItem=null}))}},mouseHover:function(t){var e=this.$refs.hoverPop;if(e)if(t.target){var a=t.target.top+30,i=t.target.left+30;if(t.target._objects&&t.target._objects.length>0){var n=t.target._objects[0];this.hoverItem={workNo:n.id,workName:n.name},e.style.left=i+"px",e.style.top=a+"px",e.style.display=""}}else this.hoverItem=null,e.style.display="none"},mouseOut:function(t){var e=this.$refs.hoverPop;e&&t.target&&(e.style.display="none")},onContextmenu:function(t){var e=this.$refs.hoverPop;e&&(e.style.display="none");var a=this.canvas.findTarget(t,!1);if(a&&a._objects&&a._objects.length>0){a._objects[0];this.contextObj=a;var i=a.top+30,n=a.left+30;this.$refs.contextMenu.style.left=n+"px",this.$refs.contextMenu.style.top=i+"px",this.$refs.contextMenu.style.display=""}t.preventDefault()},deleteWorkStation:function(){if(this.contextObj){this.canvas.remove(this.contextObj),this.contextObj=null;var t=this.$refs.contextMenu;t&&(t.style.display="none")}},changeImage:function(){var t=this;if(this.contextObj&&"group"===this.contextObj.get("type")){var e=this.contextObj._objects[0];if("named-image"===e.get("type")){var i=a("ffc6");s["fabric"].util.loadImage(i,(function(a){var i=t.imgSize.w/a.naturalWidth,n=t.imgSize.h/a.naturalHeight;e.setElement(a,{scaleX:i,scaleY:n}),t.canvas.renderAll()}))}}},onMouseDown:function(t){var e=this.$refs.hoverPop;e&&(e.style.display="none");var a=this.$refs.contextMenu;a&&(a.style.display="none"),this.hoverItem=null},checkObjectId:function(t){var e=this,a=!1;return this.canvas.forEachObject((function(i){e.checkIdEqual(i,t)&&(a=!0)})),a},checkIdEqual:function(t,e){if("group"===t.get("type")){for(var a=!1,i=0;i<t._objects.length;i++)if(a=this.checkIdEqual(t._objects[i],e),a)break;return a}return"named-image"===t.get("type")&&t.id===e},testCanvas:function(){},clearCanvas:function(){var t=this;this.canvas.forEachObject((function(e){t.canvas.remove(e)}))}}},l=r,c=(a("1d70"),a("2877")),h=Object(c["a"])(l,i,n,!1,null,"55980ad2",null);e["default"]=h.exports},"9b1e":function(t,e,a){t.exports=a.p+"img/workshop_bg.7b3c9b27.jpg"},fba6:function(t,e,a){t.exports=a.p+"img/station_blue.32a75355.png"}}]);