(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f19df12","chunk-e9361084","chunk-24cb054c","chunk-2d0bd653","chunk-2d0b2517"],{"01a1":function(t,e,a){"use strict";a("3e8b")},2432:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"审核作业指导书",width:"600px",maskClosable:!1,confirmLoading:t.loading},on:{ok:t.handleOk,cancel:t.handleCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("a-form",{attrs:{layout:"vertical"}},[e("a-form-item",{attrs:{label:"审核结论"}},[e("a-radio-group",{model:{value:t.reviewStatus,callback:function(e){t.reviewStatus=e},expression:"reviewStatus"}},[e("a-radio",{attrs:{value:2}},[t._v("通过")]),e("a-radio",{attrs:{value:3}},[t._v("驳回")])],1)],1),e("a-form-item",{attrs:{label:"审核意见"}},[e("a-textarea",{attrs:{rows:4,placeholder:"请输入审核意见"},model:{value:t.reviewComment,callback:function(e){t.reviewComment=e},expression:"reviewComment"}})],1)],1)],1)},r=[],i=a("8fad"),o={name:"JobGuideBookReviewModal",data:function(){return{visible:!1,loading:!1,record:{},reviewStatus:2,reviewComment:""}},methods:{open:function(t){this.record=t||{},this.reviewStatus=2,this.reviewComment=t&&t.reviewComment||"",this.visible=!0},handleOk:function(){var t=this;if(this.record.id)if(1===this.record.reviewStatus){var e=(this.reviewComment||"").trim();e?(this.loading=!0,Object(i["y"])({id:this.record.id,reviewStatus:this.reviewStatus,reviewComment:e}).then((function(e){e.success?(t.$message.success("审核完成"),t.$emit("ok"),t.handleCancel()):t.$message.error(e.message||"审核失败")})).finally((function(){t.loading=!1}))):this.$message.warning("请填写审核意见")}else this.$message.warning("仅待审状态可进行审核");else this.$message.warning("未选择作业指导书")},handleCancel:function(){this.visible=!1,this.record={},this.reviewComment=""}}},s=o,l=a("2877"),c=Object(l["a"])(s,n,r,!1,null,null,null);e["default"]=c.exports},"2c8d":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:t.isEdit?"编辑作业指导书":"新建作业指导书",width:"900px",confirmLoading:t.loading,maskClosable:!1},on:{ok:t.handleOk,cancel:t.handleCancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("a-form",{attrs:{form:t.form,layout:"vertical"}},[e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:24}},[e("a-form-item",[e("a-checkbox",{model:{value:t.reuseEnabled,callback:function(e){t.reuseEnabled=e},expression:"reuseEnabled"}},[t._v("从既有作业指导书复用")])],1)],1)],1),t.reuseEnabled&&!t.isEdit?e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:24}},[e("a-form-item",{attrs:{label:"复用来源",required:!0}},[e("a-select",{attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择要复用的作业指导书"},model:{value:t.reuseSourceId,callback:function(e){t.reuseSourceId=e},expression:"reuseSourceId"}},t._l(t.reuseOptions,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.fileNo)+" - "+t._s(a.fileName)+"（"+t._s(a.fileVer)+"） ")])})),1)],1)],1)],1):t._e(),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"文件编号",required:!0}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileNo",{rules:[{required:!0,message:"请输入文件编号"}]}],expression:"['fileNo', {rules: [{required: true, message: '请输入文件编号'}]}]"}],attrs:{placeholder:"请输入文件编号"}})],1)],1),e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"文件名称",required:!0}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileName",{rules:[{required:!0,message:"请输入文件名称"}]}],expression:"['fileName', {rules: [{required: true, message: '请输入文件名称'}]}]"}],attrs:{placeholder:"请输入文件名称"}})],1)],1)],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"版本",required:!0}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileVer",{rules:[{required:!0,message:"请输入版本号"}]}],expression:"['fileVer', {rules: [{required: true, message: '请输入版本号'}]}]"}],attrs:{placeholder:"请输入版本号，如V1.0"}})],1)],1),e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"所属线路",required:!0}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId",{rules:[{required:!0,message:"请选择所属线路"}]}],expression:"['lineId', {rules: [{required: true, message: '请选择所属线路'}]}]"}],attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择所属线路"}},t._l(t.lineOptions,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1)],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"车型",required:!0}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["trainTypeId",{rules:[{required:!0,message:"请选择车型"}]}],expression:"['trainTypeId', {rules: [{required: true, message: '请选择车型'}]}]"}],attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择车型"}},t._l(t.trainTypeOptions,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"所属修程",required:!0}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["repairProgramId",{rules:[{required:!0,message:"请选择所属修程"}]}],expression:"['repairProgramId', {rules: [{required: true, message: '请选择所属修程'}]}]"}],attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择所属修程"}},t._l(t.repairProgramOptions,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1)],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"项目"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["project",{rules:[{required:!1}]}],expression:"['project', {rules: [{required: false}]}]"}],attrs:{placeholder:"请输入项目"}})],1)],1),e("a-col",{attrs:{md:12}},[e("a-form-item",{attrs:{label:"实施日期",required:!0}},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["exeTime",{rules:[{required:!0,message:"请选择实施日期"}]}],expression:"['exeTime', {rules: [{required: true, message: '请选择实施日期'}]}]"}],staticStyle:{width:"100%"},attrs:{valueFormat:"YYYY-MM-DD",placeholder:"请选择实施日期"}})],1)],1)],1),e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{span:24}},[e("a-form-item",{attrs:{label:"备注"}},[e("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",{rules:[{required:!1}]}],expression:"['remark', {rules: [{required: false}]}]"}],attrs:{placeholder:"请输入备注",rows:3}})],1)],1)],1)],1)],1)},r=[],i=a("8fad"),o=a("4ec3");function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){d(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function d(t,e,a){return(e=u(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function u(t){var e=h(t,"string");return"symbol"==s(e)?e:e+""}function h(t,e){if("object"!=s(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,e||"default");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var m={data:function(){return{visible:!1,loading:!1,form:this.$form.createForm(this),record:null,isEdit:!1,reuseEnabled:!1,reuseSourceId:"",reuseOptions:[],lineOptions:[],trainTypeOptions:[],repairProgramOptions:[]}},created:function(){this.loadDictOptions()},methods:{loadDictOptions:function(){var t=this;Object(o["f"])("bu_mtr_line,line_name,line_id",null).then((function(e){var a=e&&e.success&&e.result||[];t.lineOptions=a.map((function(t){return{label:t.text,value:t.value}}))})),Object(o["f"])("bu_train_type,name,id",null).then((function(e){var a=e&&e.success&&e.result||[];t.trainTypeOptions=a.map((function(t){return{label:t.text,value:t.value}}))})),Object(o["f"])("bu_repair_program,name,id",null).then((function(e){var a=e&&e.success&&e.result||[];t.repairProgramOptions=a.map((function(t){return{label:t.text,value:t.value}}))})),Object(i["Gb"])({pageNo:1,pageSize:1e3,templateFlag:0}).then((function(e){if(e&&e.success){var a=e.result&&e.result.records?e.result.records:[];t.reuseOptions=a.filter((function(t){return t&&9!==t.status}))}}))},add:function(){this.isEdit=!1,this.record=null,this.reuseEnabled=!1,this.reuseSourceId="",this.form.resetFields(),this.visible=!0},edit:function(t){var e=this;this.isEdit=!0,this.record=t,this.reuseEnabled=!1,this.reuseSourceId="",this.visible=!0,this.$nextTick((function(){e.form.setFieldsValue({fileNo:t.fileNo,fileName:t.fileName,fileVer:t.fileVer,lineId:t.lineId,trainTypeId:t.trainTypeId,repairProgramId:t.repairProgramId,project:t.project,exeTime:t.exeTime,remark:t.remark})}))},handleOk:function(){var t=this;this.form.validateFields((function(e,a){if(!e){if(t.isEdit&&t.record&&1===t.record.status)return void t.$message.warning("已发布作业指导书不允许修改基础信息");t.loading=!0;var n=c(c({},a),{},{id:t.isEdit?t.record.id:void 0});if(!t.isEdit&&t.reuseEnabled&&!t.reuseSourceId)return t.$message.warning("请选择复用来源"),void(t.loading=!1);var r=!t.isEdit&&t.reuseEnabled?Object(i["ld"])(t.reuseSourceId,n):Object(i["nd"])(n);r.then((function(e){e.success?(t.$message.success(t.isEdit?"修改成功":"新增成功"),t.handleCancel(),t.$emit("ok")):t.$message.error(e.message||"操作失败")})).finally((function(){t.loading=!1}))}}))},handleCancel:function(){this.visible=!1,this.form.resetFields(),this.record=null,this.reuseEnabled=!1,this.reuseSourceId=""}}},f=m,p=a("2877"),v=Object(p["a"])(f,n,r,!1,null,null,null);e["default"]=v.exports},"3e8b":function(t,e,a){},"5c15":function(t,e,a){},9527:function(t,e,a){},"9b9c":function(t,e,a){"use strict";a("5c15")},ae1c:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"编辑作业指导书正文",width:"96%",maskClosable:!1,footer:null,bodyStyle:t.modalBodyStyle,dialogStyle:{top:"10px"},wrapClassName:"jgb-editor-modal"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"editor-toolbar"},[e("a-space",[e("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleSave}},[t._v("保存")]),e("a-dropdown",[e("a-button",[t._v("插入模板")]),e("a-menu",{attrs:{slot:"overlay"},on:{click:t.handleInsertTemplate},slot:"overlay"},[e("a-menu-item",{key:"cover"},[t._v("封面")]),e("a-menu-item",{key:"changeRecord"},[t._v("文件变更记录卡")]),e("a-menu-item",{key:"processFlow"},[t._v("工艺流程图")]),e("a-menu-item",{key:"consumables"},[t._v("消耗料")]),e("a-menu-item",{key:"materialDetail"},[t._v("物料明细")]),e("a-menu-item",{key:"preWork"},[t._v("作业前准备")]),e("a-menu-item",{key:"processStep"},[t._v("工序工步")]),e("a-menu-item",{key:"tools"},[t._v("工具工装")]),e("a-menu-item",{key:"torqueList"},[t._v("扭力值清单")]),e("a-menu-item",{key:"appendix"},[t._v("附录")])],1)],1),e("a-button",{on:{click:t.handleExport}},[t._v("导出DOCX")]),e("a-button",{on:{click:t.handleClose}},[t._v("关闭")])],1),e("div",{staticClass:"tips"},[t._v(" 当前："+t._s(t.record.fileName||"-")+"（版本："+t._s(t.record.fileVer||"-")+"） ")])],1),e("div",{staticClass:"editor-body"},[e("j-editor",{ref:"jeditor",attrs:{height:t.editorHeight},model:{value:t.contentHtml,callback:function(e){t.contentHtml=e},expression:"contentHtml"}})],1)])},r=[],i=a("a061"),o=a("8fad"),s="width:100%;border-collapse:collapse;",l="border:1px solid #333;padding:6px 8px;",c={FILE_NO:"fileNo",FILE_NAME:"fileName",FILE_VER:"fileVer",PROJECT:"project",CREATOR_NAME:"creatorName",EXE_TIME:"exeTime",REVIEWER_NAME:"reviewerName",APPROVER_NAME:"approverName"};function d(t){return null===t||void 0===t?"":String(t)}function u(t){var e=t||{},a={};return Object.keys(c).forEach((function(t){var n=c[t];a[t]=d(e[n])})),a}function h(t){return'<span data-jgb-token="'.concat(t,'">').concat("{{"+t+"}}","</span>")}function m(){return'\n<div style="page-break-after:always;text-align:center;padding-top:120px;">\n  <h1 style="font-size:28px;">'.concat(h("FILE_NAME"),'</h1>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(s,'margin-top:60px;">\n    <tr>\n      <td style="').concat(l,'width:25%;">文件编号</td>\n      <td style="').concat(l,'width:25%;">').concat(h("FILE_NO"),'</td>\n      <td style="').concat(l,'width:25%;">版本号</td>\n      <td style="').concat(l,'width:25%;">').concat(h("FILE_VER"),'</td>\n    </tr>\n    <tr>\n      <td style="').concat(l,'">编制人</td>\n      <td style="').concat(l,'">').concat(h("CREATOR_NAME"),'</td>\n      <td style="').concat(l,'">编制日期</td>\n      <td style="').concat(l,'">').concat(h("EXE_TIME"),'</td>\n    </tr>\n    <tr>\n      <td style="').concat(l,'">审核人</td>\n      <td style="').concat(l,'">').concat(h("REVIEWER_NAME"),'</td>\n      <td style="').concat(l,'">审批人</td>\n      <td style="').concat(l,'">').concat(h("APPROVER_NAME"),'</td>\n    </tr>\n    <tr>\n      <td style="').concat(l,'">项目号</td>\n      <td style="').concat(l,'" colspan="3">').concat(h("PROJECT"),"</td>\n    </tr>\n  </table>\n</div>\n")}function f(){return'\n<h2>文件变更记录卡</h2>\n<table border="1" cellspacing="0" cellpadding="6" style="'.concat(s,'">\n  <tr style="background:#f0f0f0;">\n    <th style="').concat(l,'width:8%;">序号</th>\n    <th style="').concat(l,'width:15%;">变更日期</th>\n    <th style="').concat(l,'width:37%;">变更内容</th>\n    <th style="').concat(l,'width:15%;">变更人</th>\n    <th style="').concat(l,'width:15%;">审批人</th>\n    <th style="').concat(l,'width:10%;">版本</th>\n  </tr>\n  <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">3</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n</table>\n')}function p(){return'\n<h2>工艺流程图</h2>\n<div style="border:1px dashed #999;min-height:300px;padding:20px;text-align:center;color:#999;">\n  <p>（请在此处插入工艺流程图图片）</p>\n</div>\n'}function v(){return'\n<h2>消耗料清单</h2>\n<table border="1" cellspacing="0" cellpadding="6" style="'.concat(s,'">\n  <tr style="background:#f0f0f0;">\n    <th style="').concat(l,'width:8%;">序号</th>\n    <th style="').concat(l,'width:18%;">物料编码</th>\n    <th style="').concat(l,'width:22%;">物料名称</th>\n    <th style="').concat(l,'width:18%;">规格型号</th>\n    <th style="').concat(l,'width:10%;">单位</th>\n    <th style="').concat(l,'width:10%;">数量</th>\n    <th style="').concat(l,'width:14%;">备注</th>\n  </tr>\n  <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">3</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n</table>\n')}function y(){return'\n<h2>物料明细</h2>\n<table border="1" cellspacing="0" cellpadding="6" style="'.concat(s,'">\n  <tr style="background:#f0f0f0;">\n    <th style="').concat(l,'width:8%;">序号</th>\n    <th style="').concat(l,'width:15%;">物料编码</th>\n    <th style="').concat(l,'width:20%;">物料名称</th>\n    <th style="').concat(l,'width:15%;">规格型号</th>\n    <th style="').concat(l,'width:8%;">单位</th>\n    <th style="').concat(l,'width:8%;">数量</th>\n    <th style="').concat(l,'width:12%;">单价</th>\n    <th style="').concat(l,'width:14%;">备注</th>\n  </tr>\n  <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">3</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n</table>\n')}function g(){return'\n<h2>作业前准备</h2>\n<table border="1" cellspacing="0" cellpadding="6" style="'.concat(s,'">\n  <tr style="background:#f0f0f0;">\n    <th style="').concat(l,'width:8%;">序号</th>\n    <th style="').concat(l,'width:52%;">检查项目</th>\n    <th style="').concat(l,'width:20%;">标准/要求</th>\n    <th style="').concat(l,'width:20%;">确认结果</th>\n  </tr>\n  <tr><td style="').concat(l,'">1</td><td style="').concat(l,'">人员资质确认</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">2</td><td style="').concat(l,'">工具工装检查</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">3</td><td style="').concat(l,'">物料准备确认</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">4</td><td style="').concat(l,'">安全防护确认</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n</table>\n')}function b(){return'\n<h2>工序工步</h2>\n<table border="1" cellspacing="0" cellpadding="6" style="'.concat(s,'">\n  <tr style="background:#f0f0f0;">\n    <th style="').concat(l,'width:8%;">工序号</th>\n    <th style="').concat(l,'width:8%;">工步号</th>\n    <th style="').concat(l,'width:34%;">作业内容</th>\n    <th style="').concat(l,'width:20%;">技术要求</th>\n    <th style="').concat(l,'width:15%;">工具/工装</th>\n    <th style="').concat(l,'width:15%;">备注</th>\n  </tr>\n  <tr><td style="').concat(l,'">1</td><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'"></td><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">2</td><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n</table>\n')}function w(){return'\n<h2>工具工装清单</h2>\n<table border="1" cellspacing="0" cellpadding="6" style="'.concat(s,'">\n  <tr style="background:#f0f0f0;">\n    <th style="').concat(l,'width:8%;">序号</th>\n    <th style="').concat(l,'width:18%;">工具编码</th>\n    <th style="').concat(l,'width:24%;">工具名称</th>\n    <th style="').concat(l,'width:20%;">规格型号</th>\n    <th style="').concat(l,'width:10%;">数量</th>\n    <th style="').concat(l,'width:20%;">备注</th>\n  </tr>\n  <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">3</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n</table>\n')}function k(){return'\n<h2>扭力值清单</h2>\n<table border="1" cellspacing="0" cellpadding="6" style="'.concat(s,'">\n  <tr style="background:#f0f0f0;">\n    <th style="').concat(l,'width:8%;">序号</th>\n    <th style="').concat(l,'width:22%;">安装部位</th>\n    <th style="').concat(l,'width:20%;">螺栓规格</th>\n    <th style="').concat(l,'width:15%;">扭力值(N·m)</th>\n    <th style="').concat(l,'width:15%;">工具</th>\n    <th style="').concat(l,'width:20%;">备注</th>\n  </tr>\n  <tr><td style="').concat(l,'">1</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">2</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n  <tr><td style="').concat(l,'">3</td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td><td style="').concat(l,'"></td></tr>\n</table>\n')}function x(){return'\n<h2>附录</h2>\n<div style="border:1px dashed #999;min-height:200px;padding:20px;color:#999;">\n  <p>（请在此处填写附录内容，可插入图片、表格等）</p>\n</div>\n'}function P(t,e){var a=t||"",n=u(e);return Object.keys(n).forEach((function(t){var e=n[t],r=new RegExp("\\{\\{".concat(t,"\\}\\}"),"g");a=a.replace(r,e)})),a}var S={name:"JobGuideBookEditorModal",components:{JEditor:i["default"]},data:function(){return{visible:!1,record:{},contentHtml:"",loading:!1,editorHeight:520}},computed:{modalBodyStyle:function(){return{height:"calc(100vh - 120px)",overflow:"hidden"}}},methods:{open:function(t){this.record=t||{},this.contentHtml=P(t&&t.contentHtml||"",this.record),this.visible=!0,this.setEditorHeight(),window.addEventListener("resize",this.setEditorHeight)},handleInsertTemplate:function(t){var e=t.key,a={cover:m,changeRecord:f,processFlow:p,consumables:v,materialDetail:y,preWork:g,processStep:b,tools:w,torqueList:k,appendix:x},n=a[e];if(n){var r=P(n(this.record),this.record);this.contentHtml=(this.contentHtml||"")+r}},handleSave:function(){var t=this;if(this.record.id){var e=2===this.record.status||0===this.record.status&&2!==this.record.reviewStatus;e?(this.loading=!0,Object(o["md"])(this.record.id,this.contentHtml).then((function(e){e.success?(t.$message.success("正文已保存"),t.$emit("saved"),t.handleClose()):t.$message.error(e.message||"保存失败")})).finally((function(){t.loading=!1}))):this.$message.warning("仅草稿、审核中、审批中状态可编辑保存")}else this.$message.warning("未选择作业指导书")},handleExport:function(){var t='<html><head><meta charset="utf-8"></head><body>'.concat(this.contentHtml||"<p>暂无正文</p>","</body></html>"),e=new Blob(["\ufeff",t],{type:"application/msword"}),a=window.URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download="".concat(this.record.fileName||"作业指导书",".docx"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)},handleClose:function(){this.visible=!1,this.record={},this.contentHtml="",this.loading=!1,window.removeEventListener("resize",this.setEditorHeight)},setEditorHeight:function(){var t=window.innerHeight||900;this.editorHeight=Math.max(420,t-220)}}},O=S,_=(a("01a1"),a("2877")),E=Object(_["a"])(O,n,r,!1,null,"7454b49a",null);e["default"]=E.exports},b245:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"85%",title:"人员选择",visible:t.visible,confirmLoading:t.confirmLoading,cancelText:"关闭",bodyStyle:{height:"70vh"},destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-row",[e("a-col",{attrs:{md:4,sm:24}},[e("div",{staticStyle:{height:"calc(70vh - 20px)","border-right":"1px solid #e3e1e1","margin-right":"15px"}},[t.treeData&&t.treeData.length>0?e("a-tree",{staticClass:"limitHeight",attrs:{defaultSelectedKeys:[t.queryParam.depId],defaultExpandAll:!0,"tree-data":t.treeData},on:{select:t.onSelect}}):t._e()],1)]),e("a-col",{attrs:{md:20,sm:24}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.findList.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"账号"}},[e("a-input",{attrs:{placeholder:"请输入用户账号"},model:{value:t.queryParam.username,callback:function(e){t.$set(t.queryParam,"username",e)},expression:"queryParam.username"}})],1)],1),e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"真实名字"}},[e("a-input",{attrs:{placeholder:"请输入真实名字"},model:{value:t.queryParam.realname,callback:function(e){t.$set(t.queryParam,"realname",e)},expression:"queryParam.realname"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"手机号码"}},[e("a-input",{attrs:{placeholder:"请输入手机号码"},model:{value:t.queryParam.phone,callback:function(e){t.$set(t.queryParam,"phone",e)},expression:"queryParam.phone"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"角色"}},[e("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"sys_role,role_name,id",placeholder:"选择角色"},model:{value:t.queryParam.roleId,callback:function(e){t.$set(t.queryParam,"roleId",e)},expression:"queryParam.roleId"}})],1)],1),e("a-col",{attrs:{md:2,sm:8}},[e("a-button",{on:{click:t.findList}},[t._v("查询")])],1)],1)],1)],1),e("div",{staticStyle:{height:"calc(70vh - 130px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 130px)"},attrs:{border:"",align:t.allAlign,data:t.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":t.multiple?{}:{trigger:"row"},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"manual",mode:"row"}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"5%"}}):e("vxe-table-column",{attrs:{type:"radio",width:"5%"}}),e("vxe-table-column",{attrs:{field:"workNo",title:"工号",width:"100",align:"center"}}),e("vxe-table-column",{attrs:{field:"username",title:"用户账号",width:"150",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"realname",title:"用户名字",width:"100",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"roleNames",title:"角色","min-width":"180",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"sex_dictText",title:"性别",width:"80"}}),e("vxe-table-column",{attrs:{field:"phone",title:"手机号码",width:"120"}}),e("vxe-table-column",{attrs:{field:"orgCode",title:"部门",width:"120",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}})],1),e("vxe-pager",{attrs:{perfect:"","current-page":t.queryParam.pageNo,"page-size":t.queryParam.pageSize,total:t.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:current-page":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:pageSize":function(e){return t.$set(t.queryParam,"pageSize",e)},"update:page-size":function(e){return t.$set(t.queryParam,"pageSize",e)},"page-change":t.handlePageChange}})],1)])],1)],1)},r=[],i=a("8fad"),o={name:"UserList",props:{multiple:{type:Boolean,default:!0},depId:{type:String,default:""}},data:function(){return{queryParam:{username:"",realname:"",phone:"",orgCode:"",roleId:void 0,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[]}},watch:{depId:function(t){this.$set(this.queryParam,"depId",t||"")}},mounted:function(){this.$set(this.queryParam,"depId",this.depId||"")},methods:{showModal:function(){this.visible=!0,this.findList(),this.getTreeList()},getTreeList:function(){var t=this;Object(i["yb"])().then((function(e){e.success&&(t.treeData=e.result)}))},onSelect:function(t,e){if(t.length){var a=e.node.dataRef;this.queryParam.depId=a.id,this.findList()}else this.queryParam.orgCode="",this.findList()},findList:function(){var t=this;this.loading=!0,Object(i["uc"])(this.queryParam).then((function(e){t.loading=!1,e.success?(t.totalResult=e.result.total,t.tableData=e.result.records):t.$message.error("加载用户数据失败")})).catch((function(e){t.$message.error("加载用户数据异常")})).finally((function(){}))},handlePageChange:function(t){var e=t.currentPage,a=t.pageSize;this.queryParam.pageNo=e,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,Object.assign(this.$data,this.$options.data())}}},s=o,l=(a("f76d"),a("2877")),c=Object(l["a"])(s,n,r,!1,null,"4aa7956f",null);e["default"]=c.exports},f390:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"名称/编码"}},[e("a-input",{attrs:{placeholder:"请输入名称或编码",allowClear:""},model:{value:t.queryParam.formName,callback:function(e){t.$set(t.queryParam,"formName",e)},expression:"queryParam.formName"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"项目"}},[e("a-input",{attrs:{placeholder:"请输入项目",allowClear:""},model:{value:t.queryParam.project,callback:function(e){t.$set(t.queryParam,"project",e)},expression:"queryParam.project"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"编制人"}},[e("a-input",{attrs:{placeholder:"请输入编制人",allowClear:""},model:{value:t.queryParam.creatorName,callback:function(e){t.$set(t.queryParam,"creatorName",e)},expression:"queryParam.creatorName"}})],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"状态"}},[e("a-select",{attrs:{allowClear:"",placeholder:"全部"},model:{value:t.queryParam.bizStatus,callback:function(e){t.$set(t.queryParam,"bizStatus",e)},expression:"queryParam.bizStatus"}},[e("a-select-option",{attrs:{value:"DRAFT"}},[t._v("草稿")]),e("a-select-option",{attrs:{value:"REVIEWING"}},[t._v("审核中")]),e("a-select-option",{attrs:{value:"REVIEW_PASS"}},[t._v("审核通过")]),e("a-select-option",{attrs:{value:"APPROVING"}},[t._v("审批中")]),e("a-select-option",{attrs:{value:"APPROVED"}},[t._v("审批通过")]),e("a-select-option",{attrs:{value:"PUBLISHED"}},[t._v("发布")]),e("a-select-option",{attrs:{value:"OBSOLETE"}},[t._v("作废")])],1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"车型"}},[e("a-select",{attrs:{allowClear:"",showSearch:"",optionFilterProp:"children",placeholder:"全部"},model:{value:t.queryParam.trainTypeId,callback:function(e){t.$set(t.queryParam,"trainTypeId",e)},expression:"queryParam.trainTypeId"}},t._l(t.trainTypeOptions,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"修程"}},[e("a-select",{attrs:{allowClear:"",showSearch:"",optionFilterProp:"children",placeholder:"全部"},model:{value:t.queryParam.repairProId,callback:function(e){t.$set(t.queryParam,"repairProId",e)},expression:"queryParam.repairProId"}},t._l(t.repairProgramOptions,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:6,sm:24}},[e("a-form-item",{attrs:{label:"线路"}},[e("a-select",{attrs:{allowClear:"",showSearch:"",optionFilterProp:"children",placeholder:"全部"},model:{value:t.queryParam.lineId,callback:function(e){t.$set(t.queryParam,"lineId",e)},expression:"queryParam.lineId"}},t._l(t.lineOptions,(function(a){return e("a-select-option",{key:a.value,attrs:{value:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1),e("a-col",{attrs:{md:12,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("新建")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleEdit(t.selectRows[0])}}},[t._v("编辑信息")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleEditContent(t.selectRows[0])}}},[t._v("编辑正文")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:t.handleSaveAsTemplate}},[t._v("保存为模板")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:function(e){return t.handleSubmitReview()}}},[t._v("提交审核")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:function(e){return t.handleReviewDecision()}}},[t._v("审核")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:function(e){return t.handleSubmitApprove()}}},[t._v("提交审批")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:function(e){return t.handleApproveDecision()}}},[t._v("审批")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handlePublish(t.selectRows[0])}}},[t._v("发布")]),e("a-button",{attrs:{disabled:1!=t.selectRows.length},on:{click:function(e){return t.handleReviseVersion(t.selectRows[0])}}},[t._v("修订升版")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:t.handleDelete}},[t._v("删除")]),e("a-button",{attrs:{disabled:t.selectRows.length<1},on:{click:t.handleBatchExport}},[t._v("导出PDF")]),e("a-button",{on:{click:t.handleExportCatalog}},[t._v("导出目录")]),e("a-button",{on:{click:t.handleSearch}},[t._v("查询")])],1)],1)])],1)],1)],1),e("div",{staticStyle:{height:"calc(100vh - 225px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 225px)"},attrs:{border:"","auto-resize":"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}},on:{"checkbox-change":t.checkboxChange,"checkbox-all":t.checkboxChange}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"fileNo",title:"文件编号",width:"11%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"fileName",title:"文件名称",width:"14%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"fileVer",title:"版本",width:"5%","header-align":"center",align:"center"}}),e("vxe-table-column",{attrs:{field:"lineName",title:"线路",width:"8%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"trainTypeName",title:"车型",width:"8%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"repairProgramName",title:"修程",width:"7%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"project",title:"项目",width:"8%","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"creatorName",title:"编制人",width:"7%","header-align":"center",align:"center"}}),e("vxe-table-column",{attrs:{field:"statusText",title:"状态",width:"7%","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("a-tag",{attrs:{color:t.statusColor(a.row)}},[t._v(t._s(t.formatBizStatus(a.row)))])]}}])}),e("vxe-table-column",{attrs:{field:"updateTime",title:"修改日期",width:"10%",formatter:t.formatDate}}),e("vxe-table-column",{attrs:{title:"操作",width:"15%","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var n=a.row;return[e("a-space",[e("a",{on:{click:function(e){return t.handleEditContent(n)}}},[t._v("查看")]),e("a",{on:{click:function(e){return t.handleExport(n)}}},[t._v("导出")]),e("a",{on:{click:function(e){return t.handleReviewDecision(n)}}},[t._v("审核")]),e("a",{on:{click:function(e){return t.handleReviseVersion(n)}}},[t._v("修订")])])]}}])})],1),e("vxe-pager",{attrs:{perfect:"","current-page":t.queryParam.pageNo,"page-size":t.queryParam.pageSize,total:t.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:current-page":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:pageSize":function(e){return t.$set(t.queryParam,"pageSize",e)},"update:page-size":function(e){return t.$set(t.queryParam,"pageSize",e)},"page-change":t.handlePageChange}})],1),e("job-guide-book-detail-modal",{ref:"detailModal",on:{ok:function(e){return t.loadData()}}}),e("job-guide-book-editor-modal",{ref:"editorModal",on:{saved:t.loadData}}),e("job-guide-book-review-modal",{ref:"reviewModal",on:{ok:t.loadData}}),e("user-list",{ref:"reviewerSelect",attrs:{multiple:!1},on:{ok:t.onReviewerSelected}})],1)},r=[],i=a("c1df"),o=a.n(i),s=(a("5c3a"),a("e8ae")),l=a.n(s),c=a("21a6"),d=a.n(c),u=a("2c8d"),h=a("ae1c"),m=a("2432"),f=a("b245"),p=a("4ec3"),v=a("8fad");function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function g(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function b(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?g(Object(a),!0).forEach((function(e){w(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function w(t,e,a){return(e=k(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function k(t){var e=x(t,"string");return"symbol"==y(e)?e:e+""}function x(t,e){if("object"!=y(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,e||"default");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function P(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",r=a.toStringTag||"@@toStringTag";function i(a,n,r,i){var l=n&&n.prototype instanceof s?n:s,c=Object.create(l.prototype);return S(c,"_invoke",function(a,n,r){var i,s,l,c=0,d=r||[],u=!1,h={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,a){return i=e,s=0,l=t,h.n=a,o}};function m(a,n){for(s=a,l=n,e=0;!u&&c&&!r&&e<d.length;e++){var r,i=d[e],m=h.p,f=i[2];a>3?(r=f===n)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=m&&((r=a<2&&m<i[1])?(s=0,h.v=n,h.n=i[1]):m<f&&(r=a<3||i[0]>n||n>f)&&(i[4]=a,i[5]=n,h.n=f,s=0))}if(r||a>1)return o;throw u=!0,n}return function(r,d,f){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),s=d,l=f;(e=s<2?t:l)||!u;){i||(s?s<3?(s>1&&(h.n=-1),m(s,l)):h.n=l:h.v=l);try{if(c=2,i){if(s||(r="next"),e=i[r]){if(!(e=e.call(i,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=t}else if((e=(u=h.n<0)?l:a.call(n,h))!==o)break}catch(e){i=t,s=1,l=e}finally{c=1}}return{value:e,done:u}}}(a,r,i),!0),c}var o={};function s(){}function l(){}function c(){}e=Object.getPrototypeOf;var d=[][n]?e(e([][n]())):(S(e={},n,(function(){return this})),e),u=c.prototype=s.prototype=Object.create(d);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,S(t,r,"GeneratorFunction")),t.prototype=Object.create(u),t}return l.prototype=c,S(u,"constructor",c),S(c,"constructor",l),l.displayName="GeneratorFunction",S(c,r,"GeneratorFunction"),S(u),S(u,r,"Generator"),S(u,n,(function(){return this})),S(u,"toString",(function(){return"[object Generator]"})),(P=function(){return{w:i,m:h}})()}function S(t,e,a,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}S=function(t,e,a,n){function i(e,a){S(t,e,(function(t){return this._invoke(e,a,t)}))}e?r?r(t,e,{value:a,enumerable:!n,configurable:!n,writable:!n}):t[e]=a:(i("next",0),i("throw",1),i("return",2))},S(t,e,a,n)}function O(t,e,a,n,r,i,o){try{var s=t[i](o),l=s.value}catch(t){return void a(t)}s.done?e(l):Promise.resolve(l).then(n,r)}function _(t){return function(){var e=this,a=arguments;return new Promise((function(n,r){var i=t.apply(e,a);function o(t){O(i,n,r,o,s,"next",t)}function s(t){O(i,n,r,o,s,"throw",t)}o(void 0)}))}}var E={components:{JobGuideBookDetailModal:u["default"],JobGuideBookEditorModal:h["default"],JobGuideBookReviewModal:m["default"],UserList:f["default"]},data:function(){return{selectRows:[],pendingReviewIds:"",pendingApproveIds:"",reviewerAction:"review",lineOptions:[],repairProgramOptions:[],trainTypeOptions:[],queryParam:{formName:"",project:"",creatorName:"",lineId:void 0,bizStatus:void 0,trainTypeId:void 0,repairProId:void 0,templateFlag:void 0,pageNo:1,pageSize:10},totalResult:0,allAlign:"center",tableData:[],loading:!1}},created:function(){this.loadDictOptions(),this.loadData()},methods:{loadDictOptions:function(){var t=this;Object(p["f"])("bu_mtr_line,line_name,line_id",null).then((function(e){var a=e&&e.success&&e.result||[];t.lineOptions=a.map((function(t){return{label:t.text,value:t.value}}))})),Object(p["f"])("bu_train_type,name,id",null).then((function(e){var a=e&&e.success&&e.result||[];t.trainTypeOptions=a.map((function(t){return{label:t.text,value:t.value}}))})),Object(p["f"])("bu_repair_program,name,id",null).then((function(e){var a=e&&e.success&&e.result||[];t.repairProgramOptions=a.map((function(t){return{label:t.text,value:t.value}}))}))},checkboxChange:function(t){this.selectRows=t.records},loadData:function(){var t=this;this.loading=!0,Object(v["Gb"])(this.queryParam).then((function(e){e.success&&(t.tableData=e.result.records||[],t.totalResult=e.result.total||0)})).finally((function(){t.loading=!1}))},handleSearch:function(){this.queryParam.pageNo=1,this.loadData()},handlePageChange:function(t){var e=t.currentPage,a=t.pageSize;this.queryParam.pageNo=e,this.queryParam.pageSize=a,this.loadData()},handleAdd:function(){this.$refs.detailModal.add()},handleEdit:function(t){this.canEdit(t)?this.$refs.detailModal.edit(t):this.$message.warning("仅草稿、审核中、审批中状态可编辑")},handleEditContent:function(t){t&&t.id&&this.$refs.editorModal.open(t)},handleDelete:function(){var t=this;if(0!==this.selectRows.length){var e=this.selectRows.filter((function(t){return 1===t.status||9===t.status}));e.length>0?this.$message.warning("发布/作废状态不允许删除"):this.$confirm({title:"删除确认",content:"确认删除选中的作业指导书吗？",onOk:function(){var e=t.selectRows.map((function(t){return t.id})).join(",");Object(v["E"])({ids:e}).then((function(e){e.success?(t.$message.success("删除成功"),t.selectRows=[],t.loadData()):t.$message.error(e.message||"删除失败")}))}})}else this.$message.warning("请先选择要删除的记录")},handleSaveAsTemplate:function(){var t=this;if(1===this.selectRows.length){var e=this.selectRows[0].id;Object(v["kd"])({id:e}).then((function(e){e.success?(t.$message.success("已另存为模板"),t.loadData()):t.$message.error(e.message||"操作失败")}))}else this.$message.warning("请选择一条作业指导书")},handleReviseVersion:function(t){var e=this;if(t&&t.id)if(1===t.status){var a=String(t.fileVer||"").trim();this.$confirm({title:"修订升版",content:"将版本【".concat(a||"-","】升版并生成新草稿，是否继续？"),onOk:function(){var n=e.buildNextVersion(a);n?Object(v["id"])({id:t.id,newVersion:n}).then((function(t){t.success?(e.$message.success("修订升版成功，新版本：".concat(n)),e.loadData()):e.$message.error(t.message||"修订升版失败")})):e.$message.warning("无法自动计算新版本号，请先补充当前版本号")}})}else this.$message.warning("仅发布状态可修订升版");else this.$message.warning("请选择作业指导书")},buildNextVersion:function(t){var e=String(t||"").trim();if(!e)return"V2.0";var a=e.match(/^([Vv])(\d+)(?:\.(\d+))?$/);if(a){var n=Number(a[2]||0);return"V".concat(n+1,".0")}var r=e.match(/(\d+)(?!.*\d)/);if(r){var i=r[1],o=String(Number(i)+1);return e.replace(new RegExp("".concat(i,"(?!.*\\d)")),o)}return""},canEdit:function(t){return!!t&&(2===t.status||0===t.status&&(0===t.reviewStatus||1===t.reviewStatus))},resolveTargetRows:function(t){return t&&t.id?[t]:(this.selectRows||[]).filter((function(t){return t&&t.id}))},canSubmitReview:function(t){return!!t&&0===t.status&&0===t.reviewStatus},canReviewDecision:function(t){return!!t&&0===t.status&&1===t.reviewStatus},canSubmitApprove:function(t){return!!t&&0===t.status&&2===t.reviewStatus},canApproveDecision:function(t){return!!t&&2===t.status},handleSubmitReview:function(t){var e=this,a=this.resolveTargetRows(t);if(0!==a.length){var n=a.filter((function(t){return!e.canSubmitReview(t)}));n.length>0?this.$message.warning("仅草稿状态可提交审核，请重新选择"):(this.reviewerAction="review",this.pendingReviewIds=a.map((function(t){return t.id})).join(","),this.$refs.reviewerSelect.showModal())}else this.$message.warning("请先选择作业指导书")},handleReviewDecision:function(t){var e=this;if(t&&t.id)return this.canReviewDecision(t)?void this.$refs.reviewModal.open(t):void this.$message.warning("仅审核中状态可进行审核");var a=this.resolveTargetRows(t);if(0!==a.length){if(1===a.length){var n=a[0];return this.canReviewDecision(n)?void this.$refs.reviewModal.open(n):void this.$message.warning("仅审核中状态可进行审核")}var r=a.filter((function(t){return!e.canReviewDecision(t)}));if(r.length>0)this.$message.warning("批量审核仅支持审核中状态，请重新选择");else{var i=a.map((function(t){return t.id})).join(",");this.$confirm({title:"批量审核",content:"是否批量审核通过选中的 ".concat(a.length,' 条记录？若需退回请点"否"并填写原因。'),okText:"是",cancelText:"否",onOk:function(){Object(v["y"])({ids:i,reviewStatus:2,reviewComment:"批量审核通过"}).then((function(t){t.success?(e.$message.success("已批量审核通过 ".concat(a.length," 条")),e.loadData()):e.$message.error(t.message||"批量审核失败")}))},onCancel:function(){var t=_(P().m((function t(){var n,r;return P().w((function(t){while(1)switch(t.n){case 0:if(n=window.prompt("请输入审核退回原因"),null!==n){t.n=1;break}return t.a(2);case 1:if(r=String(n||"").trim(),r){t.n=2;break}return e.$message.warning("请输入退回原因"),t.a(2);case 2:Object(v["y"])({ids:i,reviewStatus:3,reviewComment:r}).then((function(t){t.success?(e.$message.success("已批量退回 ".concat(a.length," 条")),e.loadData()):e.$message.error(t.message||"批量退回失败")}));case 3:return t.a(2)}}),t)})));function n(){return t.apply(this,arguments)}return n}()})}}else this.$message.warning("请先选择作业指导书")},handleSubmitApprove:function(t){var e=this,a=this.resolveTargetRows(t);if(0!==a.length){var n=a.filter((function(t){return!e.canSubmitApprove(t)}));n.length>0?this.$message.warning("仅审核通过状态可提交审批，请重新选择"):(this.reviewerAction="approve",this.pendingApproveIds=a.map((function(t){return t.id})).join(","),this.$refs.reviewerSelect.showModal())}else this.$message.warning("请先选择作业指导书")},handleApproveDecision:function(t){var e=this,a=this.resolveTargetRows(t);if(0!==a.length){var n=a.filter((function(t){return!e.canApproveDecision(t)}));if(n.length>0)this.$message.warning("仅审批中状态可审批，请重新选择");else{var r=a.map((function(t){return t.id})).join(",");this.$confirm({title:a.length>1?"批量审批处理":"审批处理",content:a.length>1?"是否批量审批通过选中的 ".concat(a.length,' 条记录？若需退回请点"否"并填写原因。'):'是否审批通过？若需退回请点"否"并填写原因。',okText:"是",cancelText:"否",onOk:function(){Object(v["x"])({ids:r,approveStatus:1}).then((function(t){t.success?(e.$message.success(a.length>1?"已批量审批通过 ".concat(a.length," 条"):"审批通过"),e.loadData()):e.$message.error(t.message||(a.length>1?"批量审批失败":"审批失败"))}))},onCancel:function(){var t=_(P().m((function t(){var n,i;return P().w((function(t){while(1)switch(t.n){case 0:if(n=window.prompt("请输入审批退回原因"),null!==n){t.n=1;break}return t.a(2);case 1:if(i=String(n||"").trim(),i){t.n=2;break}return e.$message.warning("请输入退回原因"),t.a(2);case 2:Object(v["x"])({ids:r,approveStatus:2,approveComment:i}).then((function(t){t.success?(e.$message.success(a.length>1?"已批量退回 ".concat(a.length," 条"):"已退回"),e.loadData()):e.$message.error(t.message||(a.length>1?"批量退回失败":"退回失败"))}));case 3:return t.a(2)}}),t)})));function n(){return t.apply(this,arguments)}return n}()})}}else this.$message.warning("请先选择作业指导书")},onReviewerSelected:function(t){var e=this;if(t&&0!==t.length){var a=t[0];if("approve"===this.reviewerAction&&this.pendingApproveIds){var n=this.pendingApproveIds,r=n.split(",").filter(Boolean).length;Object(v["Kd"])({ids:n,approverId:a.id,approverName:a.realname||a.username}).then((function(t){t.success?(e.$message.success(r>1?"已批量提交审批 ".concat(r," 条"):"已提交审批"),e.loadData()):e.$message.error(t.message||"提交失败")})).finally((function(){e.pendingApproveIds="",e.reviewerAction="review"}))}else if(this.pendingReviewIds){var i=this.pendingReviewIds,o=i.split(",").filter(Boolean).length;Object(v["Ld"])({ids:i,reviewerId:a.id,reviewerName:a.realname||a.username}).then((function(t){t.success?(e.$message.success(o>1?"已批量提交审核 ".concat(o," 条"):"已提交审核"),e.loadData()):e.$message.error(t.message||"提交失败")})).finally((function(){e.pendingReviewIds="",e.reviewerAction="review"}))}}else this.$message.warning("请选择处理人")},handlePublish:function(t){var e=this;t&&t.id&&(3===t.status?this.$confirm({title:"发布确认",content:"发布后将自动作废同文件编号的旧发布版本，是否继续？",onOk:function(){Object(v["Sd"])({id:t.id,status:1}).then((function(t){t.success?(e.$message.success("已发布"),e.loadData()):e.$message.error(t.message||"发布失败")}))}}):this.$message.warning("请先审批通过后再发布"))},handleExport:function(t){if(t&&t.id){var e="".concat(t.fileName||"作业指导书",".pdf");Object(v["sb"])(e,{ids:t.id})}else this.$message.warning("请选择作业指导书")},handleBatchExport:function(){var t=this.selectRows||[];if(0!==t.length){var e=t.map((function(t){return t.id})).join(","),a=o()().format("YYYYMMDDHHmmss"),n=1===t.length?"".concat(t[0].fileName||"作业指导书",".pdf"):"作业指导书批量导出_".concat(a,".zip");Object(v["sb"])(n,{ids:e})}else this.$message.warning("请先选择要导出的作业指导书")},handleExportCatalog:function(){var t=_(P().m((function t(){var e,a,n;return P().w((function(t){while(1)switch(t.n){case 0:return e=b(b({},this.queryParam),{},{pageNo:1,pageSize:2e3}),t.n=1,Object(v["Gb"])(e);case 1:if(a=t.v,a&&a.success){t.n=2;break}return this.$message.warning("目录导出失败"),t.a(2);case 2:return n=a.result&&a.result.records?a.result.records:[],t.n=3,this.downloadExcel(n,"作业指导书目录.xlsx");case 3:return t.a(2)}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),downloadExcel:function(){var t=_(P().m((function t(e,a){var n,r,i,o,s=this;return P().w((function(t){while(1)switch(t.n){case 0:return n=new l.a.Workbook,r=n.addWorksheet("作业指导书目录"),r.columns=[{header:"序号",key:"idx",width:8},{header:"线路",key:"lineName",width:14},{header:"状态",key:"bizStatus",width:12},{header:"车型",key:"trainTypeName",width:14},{header:"修程",key:"repairProgramName",width:14},{header:"项目",key:"project",width:16},{header:"文件编号",key:"fileNo",width:20},{header:"文件名称",key:"fileName",width:32},{header:"版本号",key:"fileVer",width:12},{header:"编制人",key:"creatorName",width:14}],(e||[]).forEach((function(t,e){r.addRow({idx:e+1,lineName:t.lineName||"",bizStatus:s.formatBizStatus(t),trainTypeName:t.trainTypeName||"",repairProgramName:t.repairProgramName||"",project:t.project||"",fileNo:t.fileNo||"",fileName:t.fileName||"",fileVer:t.fileVer||"",creatorName:t.creatorName||""})})),r.getRow(1).font={bold:!0},t.n=1,n.xlsx.writeBuffer();case 1:i=t.v,o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),d.a.saveAs(o,a);case 2:return t.a(2)}}),t)})));function e(e,a){return t.apply(this,arguments)}return e}(),formatBizStatus:function(t){return t?9===t.status?"作废":1===t.status?"发布":3===t.status?"审批通过":2===t.status?"审批中":1===t.reviewStatus?"审核中":2===t.reviewStatus?"审核通过":"草稿":"-"},statusColor:function(t){var e=this.formatBizStatus(t);return"发布"===e?"green":"审批通过"===e?"cyan":"审批中"===e||"审核中"===e?"blue":"作废"===e?"red":"default"},formatDate:function(t){var e=t.updateTime||t.createTime;return e?o()(e).format("YYYY-MM-DD HH:mm:ss"):""}}},$=E,N=(a("9b9c"),a("2877")),j=Object(N["a"])($,n,r,!1,null,"0b4be5cd",null);e["default"]=j.exports},f76d:function(t,e,a){"use strict";a("9527")}}]);