(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f6b358b"],{be6a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:900,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form-model",{ref:"form",attrs:{model:e.model,rules:e.validatorRules,"label-col":{span:6},"wrapper-col":{span:16}}},[t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"配置提示","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-alert",{attrs:{type:"info","show-icon":"",message:"支持按步骤配置图文内容；步骤可新增、删除、排序，支持本地上传图片。"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序编码",prop:"processNo"}},[t("a-input",{attrs:{placeholder:"请输入工序编码"},model:{value:e.model.processNo,callback:function(t){e.$set(e.model,"processNo",t)},expression:"model.processNo"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序名称",prop:"processName"}},[t("a-input",{attrs:{placeholder:"请输入工序名称"},model:{value:e.model.processName,callback:function(t){e.$set(e.model,"processName",t)},expression:"model.processName"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序类型",prop:"processType"}},[t("a-select",{attrs:{placeholder:"请选择工序类型"},model:{value:e.model.processType,callback:function(t){e.$set(e.model,"processType",t)},expression:"model.processType"}},[t("a-select-option",{attrs:{value:"1"}},[e._v("拆卸")]),t("a-select-option",{attrs:{value:"2"}},[e._v("检修")]),t("a-select-option",{attrs:{value:"3"}},[e._v("安装")])],1)],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"车型"}},[t("a-input",{attrs:{placeholder:"请输入车型"},model:{value:e.model.trainType,callback:function(t){e.$set(e.model,"trainType",t)},expression:"model.trainType"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"标准工时(分钟)"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.model.standardDuration,callback:function(t){e.$set(e.model,"standardDuration",t)},expression:"model.standardDuration"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序图示"}},[t("a-input",{attrs:{value:e.stepImageSummary,disabled:"",placeholder:"根据步骤中的图片URL自动生成"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"工序步骤","label-col":{span:3},"wrapper-col":{span:20}}},[t("div",{staticClass:"process-step-wrapper"},[t("div",{staticClass:"process-step-scroll"},e._l(e.stepRows,(function(a,r){return t("div",{key:a.uid||r,staticClass:"process-step-item"},[t("a-row",{attrs:{gutter:8}},[t("a-col",{attrs:{span:4}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,precision:0,placeholder:"序号"},model:{value:a.stepNo,callback:function(t){e.$set(a,"stepNo",t)},expression:"step.stepNo"}})],1),t("a-col",{attrs:{span:8}},[t("a-input",{attrs:{placeholder:"步骤名称（必填）"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"step.name"}})],1),t("a-col",{attrs:{span:8}},[t("a-space",[t("a-input",{staticStyle:{width:"200px"},attrs:{placeholder:"步骤图片URL"},model:{value:a.imageUrl,callback:function(t){e.$set(a,"imageUrl",t)},expression:"step.imageUrl"}}),t("j-image-upload",{attrs:{text:"上传",isMultiple:!1,bizPath:"/standard-process/step"},model:{value:a.imageUrl,callback:function(t){e.$set(a,"imageUrl",t)},expression:"step.imageUrl"}})],1)],1),t("a-col",{attrs:{span:4}},[t("a-button",{attrs:{danger:"",block:"",disabled:1===e.stepRows.length},on:{click:function(t){return e.removeStepRow(r)}}},[e._v("删除")])],1)],1),t("a-row",{staticStyle:{"margin-top":"8px"},attrs:{gutter:8}},[t("a-col",{attrs:{span:12}},[t("a-input",{attrs:{placeholder:"检验点（选填）"},model:{value:a.checkPoint,callback:function(t){e.$set(a,"checkPoint",t)},expression:"step.checkPoint"}})],1),t("a-col",{attrs:{span:12}},[t("a-input",{attrs:{placeholder:"步骤备注（选填）"},model:{value:a.remark,callback:function(t){e.$set(a,"remark",t)},expression:"step.remark"}})],1)],1),t("a-row",{staticStyle:{"margin-top":"8px"}},[t("a-col",{attrs:{span:24}},[t("a-textarea",{attrs:{rows:2,placeholder:"步骤详细内容（可填）"},model:{value:a.content,callback:function(t){e.$set(a,"content",t)},expression:"step.content"}})],1)],1)],1)})),0),t("a-space",{staticStyle:{"margin-top":"8px"}},[t("a-button",{attrs:{size:"small",type:"dashed",icon:"plus"},on:{click:e.addStepRow}},[e._v("新增步骤")]),t("a-button",{attrs:{size:"small"},on:{click:e.normalizeStepRows}},[e._v("按序号排序")])],1)],1)])],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"备注","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:2,placeholder:"请输入备注"},model:{value:e.model.remark,callback:function(t){e.$set(e.model,"remark",t)},expression:"model.remark"}})],1)],1)],1)],1)],1)],1)},s=[],i=a("8fad"),n=a("e610");function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return(t=u(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function u(e){var t=m(e,"string");return"symbol"==o(t)?t:t+""}function m(e,t){if("object"!=o(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var d={name:"StandardProcessModal",components:{JImageUpload:n["default"]},computed:{stepImageSummary:function(){return(this.stepRows||[]).map((function(e){return(e.imageUrl||"").trim()})).filter(Boolean).join(",")}},data:function(){return{title:"",visible:!1,confirmLoading:!1,model:{},stepRows:[],validatorRules:{processNo:[{required:!0,message:"请输入工序编码",trigger:"blur"}],processName:[{required:!0,message:"请输入工序名称",trigger:"blur"}]}}},methods:{add:function(){this.title="新增标准工序",this.visible=!0,this.model={processType:"1",standardDuration:0},this.stepRows=[this.createEmptyStepRow(1)]},edit:function(e){this.title="编辑标准工序",this.visible=!0,this.model=Object.assign({},e),this.stepRows=this.parseStepRows(e.processSteps,e.processImages)},handleOk:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.normalizeStepRows();var a=e.buildPayloadSteps(e.stepRows);if(!a.length)return void e.$message.warning("请至少配置一个步骤名称");var r=Object.assign({},e.model);r.processSteps=JSON.stringify(a),r.processImages=a.map((function(e){return(e.imageUrl||"").trim()})).filter(Boolean).join(","),e.confirmLoading=!0;var s=r.id?Object(i["Xd"])(r):Object(i["Dd"])(r);s.then((function(t){t.success?(e.$message.success(r.id?"修改成功":"新增成功"),e.visible=!1,e.$emit("ok")):e.$message.error(t.message||"操作失败")})).finally((function(){e.confirmLoading=!1}))}}))},handleCancel:function(){this.visible=!1,this.$refs.form.resetFields(),this.stepRows=[]},addStepRow:function(){var e=(this.stepRows||[]).length+1;this.stepRows.push(this.createEmptyStepRow(e))},removeStepRow:function(e){this.stepRows.splice(e,1),0===this.stepRows.length&&this.stepRows.push(this.createEmptyStepRow(1)),this.normalizeStepRows()},normalizeStepRows:function(){var e=this;this.stepRows=(this.stepRows||[]).map((function(t,a){var r=e.toPositiveInt(t.stepNo);return{uid:t.uid||e.newUid(),stepNo:r>0?r:a+1,name:(t.name||"").trim(),content:(t.content||"").trim(),checkPoint:(t.checkPoint||"").trim(),imageUrl:(t.imageUrl||"").trim(),remark:(t.remark||"").trim()}})).sort((function(e,t){return e.stepNo-t.stepNo})),0===this.stepRows.length&&this.stepRows.push(this.createEmptyStepRow(1))},parseStepRows:function(e,t){var a=this,r=String(t||"").split(",").map((function(e){return e.trim()})).filter(Boolean),s=function(){var t=String(e||"").split("\n").map((function(e){return e.trim()})).filter(Boolean);return t.length?t.map((function(e,t){return c(c({},a.createEmptyStepRow(t+1)),{},{name:e,imageUrl:r[t]||""})})):[a.createEmptyStepRow(1)]};if(!e)return[this.createEmptyStepRow(1)];try{var i=JSON.parse(e);return Array.isArray(i)&&0!==i.length?i.map((function(e,t){return{uid:a.newUid(),stepNo:a.toPositiveInt(e.stepNo)||t+1,name:(e.name||e.stepName||"").trim(),content:(e.content||e.desc||e.description||"").trim(),checkPoint:(e.checkPoint||"").trim(),imageUrl:(e.imageUrl||r[t]||"").trim(),remark:(e.remark||"").trim()}})):s()}catch(n){return s()}},buildPayloadSteps:function(e){var t=this;return(e||[]).map((function(e){return{stepNo:t.toPositiveInt(e.stepNo),name:(e.name||"").trim(),content:(e.content||"").trim(),checkPoint:(e.checkPoint||"").trim(),imageUrl:(e.imageUrl||"").trim(),remark:(e.remark||"").trim()}})).filter((function(e){return e.name||e.content||e.imageUrl||e.checkPoint||e.remark})).map((function(e,t){return c(c({},e),{},{stepNo:e.stepNo>0?e.stepNo:t+1})}))},createEmptyStepRow:function(e){return{uid:this.newUid(),stepNo:e||1,name:"",content:"",checkPoint:"",imageUrl:"",remark:""}},toPositiveInt:function(e){var t=Number(e);return Number.isNaN(t)||t<=0?0:Math.floor(t)},newUid:function(){return"step_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8))}}},f=d,h=(a("c9c7"),a("2877")),g=Object(h["a"])(f,r,s,!1,null,"7d101734",null);t["default"]=g.exports},c9c7:function(e,t,a){"use strict";a("f2f7")},e610:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-upload",{attrs:{name:"file",listType:"picture-card",multiple:e.isMultiple,action:e.uploadAction,headers:e.headers,data:{fileName:e.bizPath},fileList:e.fileList,beforeUpload:e.beforeUpload,disabled:e.disabled,isMultiple:e.isMultiple,showUploadList:e.isMultiple},on:{change:e.handleChange,preview:e.handlePreview}},[!e.isMultiple&&e.picUrl?t("img",{staticStyle:{height:"104px","max-width":"300px"},attrs:{src:e.getAvatarView()}}):t("div",[t("a-icon",{attrs:{type:e.uploadLoading?"loading":"plus"}}),t("div",{staticClass:"ant-upload-text"},[e._v(e._s(e.text))])],1),t("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:function(t){return e.handleCancel()}}},[t("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1)},s=[],i=a("2b0e"),n=a("9fb0"),o=a("0fea"),l=function(){return"-"+parseInt(1e4*Math.random()+1,10)},c=function(e){if(e.lastIndexOf("\\")>=0){var t=new RegExp("\\\\","g");e=e.replace(t,"/")}return e.substring(e.lastIndexOf("/")+1)},p={name:"JImageUpload",data:function(){return{uploadAction:window._CONFIG["fileServiceUrl"]+"/oss/file/upload",uploadLoading:!1,picUrl:!1,headers:{},fileList:[],previewImage:"",previewVisible:!1}},props:{text:{type:String,required:!1,default:"上传"},bizPath:{type:String,required:!1,default:"/img"},value:{type:[String,Array],required:!1},disabled:{type:Boolean,required:!1,default:!1},isMultiple:{type:Boolean,required:!1,default:!1}},watch:{value:function(e){e instanceof Array?this.initFileList(e.join(",")):this.initFileList(e)}},created:function(){var e=i["default"].ls.get(n["a"]);this.headers={"X-Access-Token":e}},methods:{initFileList:function(e){if(e&&0!=e.length){this.picUrl=!0;for(var t=[],a=e.split(","),r=function(e){var r;Object(o["f"])(a[e]).then((function(s){r=s,t.push({uid:l(),name:c(a[e]),status:"done",url:r,response:{status:"history",message:a[e]}})}))},s=0;s<a.length;s++)r(s);this.fileList=t}else this.fileList=[]},beforeUpload:function(e){var t=e.type;if(t.indexOf("image")<0)return this.$message.warning("请上传图片"),!1},handleChange:function(e){this.picUrl=!1;var t=e.fileList;"done"===e.file.status?e.file.response.success&&(this.picUrl=!0,t=t.map((function(e){return e.response&&(e.url=e.response.result),e}))):"error"===e.file.status?this.$message.error("".concat(e.file.name," 上传失败.")):"removed"===e.file.status&&this.handleDelete(e.file),this.fileList=t,"done"!==e.file.status&&"removed"!==e.file.status||this.handlePathChange()},handlePreview:function(e){this.previewImage=e.url||e.thumbUrl,this.previewVisible=!0},getAvatarView:function(){if(this.fileList.length>0){var e=this.fileList[0].url;return e}},handlePathChange:function(){var e=this.fileList,t="";e&&0!=e.length||(t="");var a=[];if(this.isMultiple)for(var r=0;r<e.length;r++)a.push(e[r].response.result);else a.push(e[e.length-1].response.result);a.length>0&&(t=a.join(",")),this.$emit("change",t)},handleDelete:function(e){},handleCancel:function(){this.close(),this.previewVisible=!1},close:function(){}},model:{prop:"value",event:"change"}},u=p,m=a("2877"),d=Object(m["a"])(u,r,s,!1,null,"1ef1dc4c",null);t["default"]=d.exports},f2f7:function(e,t,a){}}]);