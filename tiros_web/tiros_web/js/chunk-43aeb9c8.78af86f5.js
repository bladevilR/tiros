(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43aeb9c8"],{1968:function(e,t,o){"use strict";o("e31f")},a957:function(e,t,o){"use strict";o("d64c")},d64c:function(e,t,o){},e31f:function(e,t,o){},f916:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{"overflow-x":"hidden"}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form-model",{ref:"form",attrs:{layout:"inline",model:e.form,rules:e.rules}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{span:3}},[t("a-form-model-item",{attrs:{prop:"code",label:"编码"}},[t("a-input",{attrs:{placeholder:"表单编码"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1)],1),t("a-col",{attrs:{span:3}},[t("a-form-model-item",{attrs:{prop:"code",label:"分类"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,placeholder:"请选择",dictCode:"sys_category,name,id,id!='1328995025744318466'"},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1)],1),t("a-col",{attrs:{span:5}},[t("a-form-model-item",{attrs:{prop:"name",label:"名称"}},[t("a-input",{attrs:{placeholder:"表单名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),t("a-col",{attrs:{span:5}},[t("a-form-model-item",{staticClass:"a-form-item-width-gy",attrs:{prop:"reguId",label:"技术规程"}},[t("a-select",{attrs:{allowClear:""},on:{change:e.reguDetaiChange},model:{value:e.form.reguId,callback:function(t){e.$set(e.form,"reguId",t)},expression:"form.reguId"}},e._l(e.treeDataSource,(function(o,r){return t("a-select-option",{key:r,attrs:{value:o.id}},[e._v(" "+e._s(o.name+(o.version?"(".concat(o.version,")"):""))+" ")])})),1)],1)],1),t("a-col",{attrs:{span:4}},[t("a-form-model-item",{attrs:{prop:"lineId",label:"所属线路"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,placeholder:"请选择",dictCode:"bu_mtr_line,line_name,line_id|train_type_id"},model:{value:e.form.lineId,callback:function(t){e.$set(e.form,"lineId",t)},expression:"form.lineId"}})],1)],1),t("a-col",{attrs:{span:3}},[t("a-form-model-item",{attrs:{prop:"repairProgramId",label:"所属修程"}},[t("j-dict-select-tag",{ref:"lineSelect",attrs:{triggerChange:!0,placeholder:"请选择",dictCode:"bu_repair_program,name,id"},model:{value:e.form.repairProgramId,callback:function(t){e.$set(e.form,"repairProgramId",t)},expression:"form.repairProgramId"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:4}},[t("a-form-model-item",{attrs:{label:"当前选中"}},[e._v(" "+e._s(e.curRange)+" "),e.curRange&&!e.manyCell?t("span",[e._v("["+e._s(e.curIsAllow?"可编辑":"不可编辑")+"]")]):e._e()])],1),t("a-col",{attrs:{span:5}},[t("a-space",[t("a-button",{attrs:{type:"dashed"},on:{click:function(t){return e.setCellEditAble(null,!0)}}},[e._v("可编辑")]),"1328995639249358850"!==e.form.category?t("a-button",{attrs:{type:"dashed"},on:{click:function(t){return e.allEditAble(!0)}}},[e._v("全部可编辑")]):e._e(),t("a-button",{attrs:{type:"dashed"},on:{click:function(t){return e.setCellEditAble(null,!1)}}},[e._v("不可编辑")])],1)],1),t("a-col",{staticClass:"space-btn",attrs:{span:5}},[t("a-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")]),t("a-button",{on:{click:e.openFile}},[e._v(" 导入表格 "),t("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.uploadExcel}})])],1)],1)],1)],1),t("div",{staticStyle:{margin:"0px",padding:"0px",width:"100%",height:"calc(100vh - 127px)"},attrs:{id:"luckysheet"}}),e.showLoading?t("div",{staticStyle:{width:"100%","text-align":"center",position:"absolute",top:"0px",height:"100%","font-size":"16px","z-index":"1000000000",background:"#fff"}},[e._m(0)]):e._e()])},n=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{position:"relative",top:"45%",width:"100%"}},[t("div",{staticClass:"luckysheetLoaderGif"}),t("span",[e._v("加载中...")])])}],l=o("8fad"),c=o("ca00"),a=o("2410"),i=o.n(a),s=o("7268");function d(e){return m(e)||f(e)||u(e)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){if(e){if("string"==typeof e)return x(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?x(e,t):void 0}}function f(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function m(e){if(Array.isArray(e))return x(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}var g={name:"edit",props:["formInfo"],data:function(){var e=this;return{treeDataSource:[],showLoading:!1,form:{code:"",name:"",category:"",content:"",type:1,lineId:"",repairProgramId:"",createGroupId:"",reguId:"",datajson:""},rules:{code:[{required:!0,message:"请输入表单编码",trigger:"blur"},{max:7,message:"输入长度不能超过7字符!",trigger:"blur"}],name:[{required:!0,message:"请输入表单名称",trigger:"blur"},{max:100,message:"输入长度不能超过100字符!",trigger:"blur"}],lineId:[{required:!0,message:"请选择线路",trigger:"blur"}],repairProgramId:[{required:!0,message:"请选择修程",trigger:"blur"}]},curRange:"",curIsAllow:!1,manyCell:!1,allowRange:"",colNames:[],defaultOptions:{container:"luckysheet",title:"sheet",column:26,row:50,lang:"zh",allowEdit:!0,showinfobar:!1,sheetFormulaBar:!0,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!0,hook:{sheetMouseup:function(t,o,r,n){e.onSelectRange()},workbookCreateAfter:function(t){"1328995639249358850"===e.form.category&&luckysheet.getLuckysheetfile().forEach((function(t,o){e.setDefaultAllowEdit(t)}))}}}}},beforeDestroy:function(){luckysheet.destroy()},mounted:function(){var e=this;this.queryTreeData();for(var t=65;t<91;t++)this.colNames.push(String.fromCharCode(t));this.formInfo&&Object.assign(this.form,this.formInfo);var o=i()(this.defaultOptions);o.data=[{name:"Sheet1",color:"",status:"1",order:"0",index:0,ch_width:2044,rh_height:1080}],this.form.id?Object(l["ub"])(this.form.id).then((function(e){if(e.success){var t=JSON.parse(e.result);o.data=[t],luckysheet.destroy(),luckysheet.create(o)}})).catch((function(t){e.$message.error("加载表单内容异常"),luckysheet.destroy(),luckysheet.create(o)})):(luckysheet.destroy(),luckysheet.create(o))},methods:{reguDetaiChange:function(e){if(e){var t=this.treeDataSource.filter((function(t,o){return t.id===e}));t.length>0&&(t=t[0],this.form.lineId=t.lineId,this.form.repairProgramId=t.repairProId,this.$forceUpdate())}},queryTreeData:function(){var e=this;Object(l["Lb"])().then((function(t){t.success&&(e.treeDataSource=t.result)}))},onSave:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;var o=luckysheet.getAllSheets()[0];if("1328995639249358850"===e.form.category)try{var r=e.getMetadata(o,!0);r&&(e.form.datajson=JSON.stringify(r))}catch(n){}o.scrollLeft=0,o.scrollTop=0,o.data=[],o.luckysheet_select_save=[],e.form.content=JSON.stringify(o),e.form.createGroupId||(e.form.createGroupId=e.$store.getters.userInfo.departId),e.form.id?Object(l["hd"])(e.form).then((function(t){t.success?(e.$message.success("保存成功"),e.$emit("saveSuccess"),e.closeWindow()):e.$message.error("保存失败")})).catch((function(t){e.$message.error("保存自定义表单异常")})):Object(l["b"])(e.form).then((function(t){t.success?(e.$message.success("保存成功"),e.$emit("saveSuccess"),e.closeWindow()):e.$message.error("保存失败")})).catch((function(t){e.$message.error("保存自定义表单异常")}))}))},closeWindow:function(){luckysheet.destroy(),this.$emit("update:visible",!1)},openFile:function(){this.$refs.file.dispatchEvent(new MouseEvent("click"))},uploadExcel:function(e){var t=this;this.showLoading=!0;var o=e.target.files;if(null!=o&&0!==o.length){var r="";try{var n=o[0].name.split(".");r=n[n.length-1]}catch(l){r=""}if(""===r||"xlsx"!==r)return this.$message.error("不是有效的EXCEL文件,只支持xlsx格式的EXCEL文件"),void(this.showLoading=!1);LuckyExcel.transformExcelToLucky(o[0],(function(o,r){if(null==o.sheets||0===o.sheets.length)return t.$message.error("读取EXCEL文件失败, 当前不支持xls格式的excel文件!"),void(t.showLoading=!1);var n=i()(t.defaultOptions);o.sheets.forEach((function(e){e.config.authority={sheet:0,hintText:"禁止编辑",allowRangeList:[]}})),n.data=o.sheets,luckysheet.destroy(),t.showLoading=!1,luckysheet.create(n),t.form.name=o.info.name.replace(".xlsx",""),t.form.remark=o.info.name,t.form.code=Object(c["n"])(6)+"",t.$forceUpdate(),setTimeout((function(){if("1328995639249358850"===t.form.category)try{var o=luckysheet.getLuckysheetfile()[0],r=t.getMetadata(o,!0);r&&(t.form.datajson=JSON.stringify(r))}catch(e){}}),2e3)}))}else this.showLoading=!1},setDefaultAllowEdit:function(e){if(s["a"].checkProperty(e.config,"authority")&&!(e.config.authority.allowRangeList&&e.config.authority.allowRangeList.length>0)){e.config.authority.sheet=1;var t=[];e.celldata.forEach((function(e){t.push({r:e.r,c:e.c})}));var o=this.getSelectCells(e,t);this.setCellEditAble(e,!0,o)}},getShowRowIndex:function(e){return e+1},onSelectRange:function(){var e=luckysheet.getLuckysheetfile()[0],t=luckysheet.getRange()[0];this.curRange=this.colNames[t.column[0]]+this.getShowRowIndex(t.row[0])+":"+this.colNames[t.column[1]]+this.getShowRowIndex(t.row[1]),e.config.authority&&e.config.authority.allowRangeList&&(this.curIsAllow=!!this.searchAllowRange(t,e.config.authority.allowRangeList),this.manyCell=t.column[0]!==t.column[1]||t.row[0]!==t.row[1])},searchAllowRange:function(e,t){var o=null;if(!t||t.length<1)return null;var r="$"+this.colNames[e.column[0]]+"$"+this.getShowRowIndex(e.row[0]),n=e.column[0]===e.column[1]&&e.row[0]===e.row[1];return n||(r+=":$"+this.colNames[e.column[1]]+"$"+this.getShowRowIndex(e.row[1])),t.forEach((function(e,t){if(e.sqref===r)return!0,o=e,o["index"]=t,!0})),o},setCellEditAble:function(e,t){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null==e&&(e=luckysheet.getLuckysheetfile()[0]),r||(r=this.getSelectCells(e)),r.length<1||r.forEach((function(r){var n=null;if(s["a"].checkProperty(r,"mc")){if(!s["a"].checkProperty(r.mc,"rs")||!s["a"].checkProperty(r.mc,"cs"))return;n={row:[r.mc.r,r.mc.r+r.mc.rs-1],column:[r.mc.c,r.mc.c+r.mc.cs-1]}}else n={row:[r.r,r.r],column:[r.c,r.c]};var l=o.searchAllowRange(n,e.config.authority.allowRangeList);if(l)t||e.config.authority.allowRangeList.splice(l.index,1);else if(t){var c="$"+o.colNames[n.column[0]]+"$"+o.getShowRowIndex(n.row[0]),a=n.column[0]===n.column[1]&&n.row[0]===n.row[1];a||(c+=":$"+o.colNames[n.column[1]]+"$"+o.getShowRowIndex(n.row[1]));var i="area_"+c,d=o.buildAllowRange(i,c);e.config.authority.allowRangeList.push(d)}}))},allEditAble:function(e){var t=luckysheet.getLuckysheetfile()[0];e?t.config.authority.sheet=0:(t.config.authority.sheet=1,t.config.authority.allowRangeList=[]),this.$message.success("设置成功，注意保存设置！")},getSelectCells:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t||(t=luckysheet.getRangeWithFlatten());var o=[];return t.forEach((function(t){var r=e.data[t.r][t.c];r?o.push(Object.assign({r:t.r,c:t.c},r)):o.push({r:t.r,c:t.c})})),o},buildAllowRange:function(e,t){return{name:e,hintText:"",algorithmName:"None",saltValue:null,sqref:t}},getRangeWithFlatten:function(e){for(var t=[],o=e.row[0];o<=e.row[1];o++)for(var r=e.column[0];r<=e.column[1];r++)t.push({r:o,c:r});return t},getMetadata:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=luckysheet.transToData(e.celldata),r={checkDetail:{id:"checkDetail",name:"作业记录表作业项明细",type:"zone",rowIndex:-1,colIndex:0,rowIndexTo:-1,colIndexTo:-1,rows:[]}},n=[],l=0;l<o.length;l++){var c=o[l],a=[];n.push(a);for(var i=0;i<c.length;i++){var h=c[i];if(h){var u=s["a"].getCellText(h);if(!u&&s["a"].checkProperty(h,"mc")){var f=h.mc;if(s["a"].checkProperty(f,"r")&&s["a"].checkProperty(f,"c")&&s["a"].checkProperty(f,"rs")&&s["a"].checkProperty(f,"cs"));else if(s["a"].checkProperty(f,"r")&&s["a"].checkProperty(f,"c")){var m=n[f.r][f.c];u=m||""}}u?a.push(u):a.push("")}else a.push("")}if(a.includes("结果")&&a.includes("自检")&&a.includes("互检")){var x={id:"detailTitle",name:"明细标题行",type:"row",rowIndex:l,rowIndexTo:l,cells:{}};r.checkDetail.rows.push(x),r.checkDetail.rowIndex=l;for(var g=0;g<c.length;g++){var I=c[g];if(I){r.checkDetail.colIndexTo=g;var p=s["a"].getCellText(I);if(p){var y=s["a"].getCellLocation(l,g,I);switch(p){case"序号":x.cells.xh={id:"xh",name:"序号",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"项目":x.cells.xm={id:"xm",name:"项目",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"位置":case"作业内容":x.cells.zynr={id:"zynr",name:"作业内容",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"控制点":x.cells.kzd={id:"kzd",name:"控制点",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"技术要求":x.cells.jsyq={id:"jsyq",name:"技术要求",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"作业情况":x.cells.zyqk={id:"zyqk",name:"作业情况",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"结果":x.cells.jg={id:"jg",name:"结果",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"自检":x.cells.zijian={id:"zijian",name:"自检",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"互检":x.cells.hujian={id:"hujian",name:"互检",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};break;case"专检":x.cells.zhuanjian={id:"zhuanjian",name:"专检",type:"cell",cellType:"title",rowIndex:y.rowIndex,rowIndexTo:y.rowIndexTo,colIndex:y.colIndex,colIndexTo:y.colIndexTo};default:}}}}}if(r.checkDetail.rowIndex>-1&&r.checkDetail.rows.length>0){var w=r.checkDetail.rows[0].cells,k=a[w.xh.colIndex];if(k&&parseInt(k)>0){r.checkDetail.rowIndexTo=l;var v=c[w.zynr.colIndex],T=!1;if(v)if(s["a"].checkProperty(v,"mc")){var b=v.mc;s["a"].checkProperty(b,"r")&&s["a"].checkProperty(b,"c")&&s["a"].checkProperty(b,"rs")&&s["a"].checkProperty(b,"cs")?T=!0:s["a"].checkProperty(b,"r")&&s["a"].checkProperty(b,"c")&&(T=!1)}else T=!0;T&&r.checkDetail.rows.push({xh:{id:"xh",name:a[w.xh.colIndex],type:"cell",cellType:"title",rowIndex:l,rowIndexTo:l,colIndex:w.xh.colIndex,colIndexTo:w.xh.colIndexTo},xm:{id:"xm",name:a[w.xm.colIndex],type:"cell",cellType:"title",rowIndex:l,rowIndexTo:l,colIndex:w.xm.colIndex,colIndexTo:w.xm.colIndexTo},zynr:{id:"zynr",name:a[w.zynr.colIndex],type:"cell",cellType:"title",rowIndex:l,rowIndexTo:l,colIndex:w.zynr.colIndex,colIndexTo:w.zynr.colIndexTo},kzd:{id:"kzd",name:a[w.kzd.colIndex],type:"cell",cellType:"title",rowIndex:l,rowIndexTo:l,colIndex:w.kzd.colIndex,colIndexTo:w.kzd.colIndexTo},jsyq:{id:"jsyq",name:a[w.jsyq.colIndex],type:"cell",cellType:"title",rowIndex:l,rowIndexTo:l,colIndex:w.jsyq.colIndex,colIndexTo:w.jsyq.colIndexTo}})}}}var j=!0;if(r.checkDetail.rows.length<1||-1===r.checkDetail.rowIndex||-1===r.checkDetail.rowIndexTo)j=!1,t&&this.$message.warn("该作业记录表不是标准格式，无法找到作业项，请知晓");else{var S=r.checkDetail.rows[0].cells,C=[];s["a"].checkProperty(S,"zyqk")&&C.push.apply(C,d(this.getRangeWithFlatten({row:[r.checkDetail.rowIndex,r.checkDetail.rowIndexTo],column:[S.zyqk.colIndex,S.zyqk.colIndex]}))),s["a"].checkProperty(S,"jg")&&C.push.apply(C,d(this.getRangeWithFlatten({row:[r.checkDetail.rowIndex,r.checkDetail.rowIndexTo],column:[S.jg.colIndex,S.jg.colIndex]}))),s["a"].checkProperty(S,"zijian")&&C.push.apply(C,d(this.getRangeWithFlatten({row:[r.checkDetail.rowIndex,r.checkDetail.rowIndexTo],column:[S.zijian.colIndex,S.zijian.colIndex]}))),s["a"].checkProperty(S,"hujian")&&C.push.apply(C,d(this.getRangeWithFlatten({row:[r.checkDetail.rowIndex,r.checkDetail.rowIndexTo],column:[S.hujian.colIndex,S.hujian.colIndex]}))),s["a"].checkProperty(S,"zhuanjian")&&C.push.apply(C,d(this.getRangeWithFlatten({row:[r.checkDetail.rowIndex,r.checkDetail.rowIndexTo],column:[S.zhuanjian.colIndex,S.zhuanjian.colIndex]}))),this.setCellEditAble(e,!1,this.getSelectCells(e,C))}if(j){var R=s["a"].searchCellByText("检查结果",o);if(R&&R.r!==r.checkDetail.rowIndex){r["checkResult"]={id:"checkResult",name:"检查结果",type:"cell",cellType:"write",isJoin:!1,original:"",rowIndex:R.r,colIndex:R.c,rowIndexTo:R.r,colIndexTo:R.c};var D={r:R.r,c:R.c};R.mc&&R.mc.rs&&R.mc.cs&&(D={r:R.mc.r,c:R.mc.c});var $=this.getSelectCells(e,[D]);this.setCellEditAble(e,!1,$)}else t&&this.$message.warn("该作业记录表不是标准格式，无法找到 '检查结果' 输入处，请知晓");return r}e.config.authority.sheet=0}}},I=g,p=(o("1968"),o("a957"),o("2877")),y=Object(p["a"])(I,r,n,!1,null,null,null);t["default"]=y.exports}}]);