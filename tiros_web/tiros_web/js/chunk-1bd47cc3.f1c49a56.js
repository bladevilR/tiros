(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1bd47cc3"],{"11e8":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",[t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"用户账号",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["username",e.validatorRules.username],expression:"[ 'username', validatorRules.username]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入用户账号",readOnly:!!e.model.id}})],1)],1),e.model.id?e._e():[t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"登陆密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",e.validatorRules.password],expression:"[ 'password', validatorRules.password]"}],attrs:{type:"password",placeholder:"请输入登陆密码"}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["confirmpassword",e.validatorRules.confirmpassword],expression:"[ 'confirmpassword', validatorRules.confirmpassword]"}],attrs:{type:"password",placeholder:"请重新输入登陆密码"},on:{blur:e.handleConfirmBlur}})],1)],1)],t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"用户姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["realname",e.validatorRules.realname],expression:"[ 'realname', validatorRules.realname]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入用户姓名"}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"工号",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workNo",e.validatorRules.workNo],expression:"[ 'workNo', validatorRules.workNo]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入工号"}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"职务",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("j-select-position",{directives:[{name:"decorator",rawName:"v-decorator",value:["post",{}],expression:"['post', {}]"}],attrs:{placeholder:"请选择职务",multiple:!1}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.roleDisabled,expression:"!roleDisabled"}],attrs:{label:"角色分配",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",placeholder:"请选择用户角色",optionFilterProp:"children",getPopupContainer:function(e){return e.parentNode}},model:{value:e.selectedRole,callback:function(t){e.selectedRole=t},expression:"selectedRole"}},e._l(e.roleList,(function(a,r){return t("a-select-option",{key:r.toString(),attrs:{value:a.id}},[e._v(" "+e._s(a.roleName)+" ")])})),1)],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.departDisabled,expression:"!departDisabled"}],attrs:{label:"部门分配",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input-search",{attrs:{placeholder:"点击选择部门",readOnly:""},on:{search:e.onSearch},model:{value:e.checkedDepartNameString,callback:function(t){e.checkedDepartNameString=t},expression:"checkedDepartNameString"}},[t("a-button",{attrs:{slot:"enterButton",icon:"search"},slot:"enterButton"},[e._v("选择")])],1)],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"身份",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{on:{change:e.identityChange},model:{value:e.identity,callback:function(t){e.identity=t},expression:"identity"}},[t("a-radio",{attrs:{value:"1"}},[e._v("普通用户")]),t("a-radio",{attrs:{value:"2"}},[e._v("上级")])],1)],1)],1),t("a-col",{attrs:{span:e.colSize}},[1==e.departIdShow?t("a-form-item",{attrs:{label:"负责部门",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",placeholder:"请选择负责部门",optionFilterProp:"children",getPopupContainer:function(e){return e.parentNode},dropdownStyle:{maxHeight:"200px",overflow:"auto"}},model:{value:e.departIds,callback:function(t){e.departIds=t},expression:"departIds"}},e._l(e.resultDepartOptions,(function(a){return t("a-select-option",{key:a.key,attrs:{value:a.key}},[e._v(e._s(a.title)+" ")])})),1)],1):e._e()],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"生日",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["birthday",{initialValue:e.model.birthday?e.moment(e.model.birthday,e.dateFormat):null}],expression:"['birthday', {initialValue:!model.birthday?null:moment(model.birthday,dateFormat)}]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请选择生日",getCalendarContainer:function(e){return e.parentNode}}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"性别",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["sex",{}],expression:"[ 'sex', {}]"}],attrs:{placeholder:"请选择性别",getPopupContainer:function(e){return e.parentNode}}},[t("a-select-option",{attrs:{value:1}},[e._v("男")]),t("a-select-option",{attrs:{value:2}},[e._v("女")])],1)],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"邮箱",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",e.validatorRules.email],expression:"[ 'email', validatorRules.email]"}],attrs:{placeholder:"请输入邮箱"}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"手机号码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone",e.validatorRules.phone],expression:"[ 'phone', validatorRules.phone]"}],attrs:{placeholder:"请输入手机号码",disabled:e.isDisabledAuth("user:form:phone")}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"座机",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["telephone",e.validatorRules.telephone],expression:"[ 'telephone', validatorRules.telephone]"}],attrs:{placeholder:"请输入座机"}})],1)],1),t("a-col",{attrs:{span:e.colSize}},[t("a-form-item",{attrs:{label:"头像",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("j-image-upload",{staticClass:"avatar-uploader",attrs:{text:"上传"},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}})],1)],1)],2)],1)],1),t("depart-window",{ref:"departWindow",on:{ok:e.modalFormOk}})],1)},s=[],l=a("88bc"),i=a.n(l),o=a("c1df"),d=a.n(o),n=a("2b0e"),c=a("c63e"),p=a("61fc"),u=a("9fb0"),h=a("0fea"),m=a("4ec3"),f=a("c82c"),v=a("e610"),w={name:"BaseInfo2",components:{JImageUpload:v["default"],departWindow:c["default"],JSelectPosition:p["default"]},props:{currentUser:{type:Object,default:{}}},data:function(){return{colSize:12,departDisabled:!1,roleDisabled:!1,modalWidth:800,drawerWidth:700,modaltoggleFlag:!0,confirmDirty:!1,selectedDepartKeys:[],checkedDepartKeys:[],checkedDepartNames:[],checkedDepartNameString:"",resultDepartOptions:[],userId:"",disableSubmit:!1,userDepartModel:{userId:"",departIdList:[]},dateFormat:"YYYY-MM-DD",validatorRules:{username:{rules:[{required:!0,message:"请输入用户账号!"},{validator:this.validateUsername}]},password:{rules:[{required:!0,pattern:/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,./]).{8,}$/,message:"密码由8位数字、大小写字母和特殊符号组成!"},{validator:this.validateToNextPassword}]},confirmpassword:{rules:[{required:!0,message:"请重新输入登陆密码!"},{validator:this.compareToFirstPassword}]},realname:{rules:[{required:!0,message:"请输入用户名称!"}]},phone:{rules:[{validator:this.validatePhone}]},email:{rules:[{validator:this.validateEmail}]},roles:{},workNo:{rules:[{required:!0,message:"请输入工号"},{validator:this.validateWorkNo}]},telephone:{rules:[{pattern:/^0\d{2,3}-[1-9]\d{6,7}$/,message:"请输入正确的座机号码"}]}},departIdShow:!1,departIds:[],title:"操作",visible:!1,model:{},roleList:[],selectedRole:[],labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},uploadLoading:!1,confirmLoading:!1,headers:{},form:this.$form.createForm(this),picUrl:"",url:{fileUpload:window._CONFIG["domianURL"]+"/sys/common/upload",userWithDepart:"/sys/user/userDepartList",userId:"/sys/user/generateUserId",syncUserByUserName:"/process/extActProcess/doSyncUserByUserName"},identity:"1",fileList:[]}},created:function(){var e=n["default"].ls.get(u["a"]);this.headers={"X-Access-Token":e}},mounted:function(){this.currentUser&&this.currentUser.id&&this.show(this.currentUser.id)},computed:{uploadAction:function(){return this.url.fileUpload}},methods:{isDisabledAuth:function(e){return Object(f["a"])(e)},toggleScreen:function(){this.modaltoggleFlag?this.modalWidth=window.innerWidth:this.modalWidth=800,this.modaltoggleFlag=!this.modaltoggleFlag},initialRoleList:function(){var e=this;Object(m["U"])().then((function(t){t.success&&(e.roleList=t.result)}))},loadUserRoles:function(e){var t=this;Object(m["T"])({userid:e}).then((function(e){e.success&&(t.selectedRole=e.result)}))},refresh:function(){this.selectedDepartKeys=[],this.checkedDepartKeys=[],this.checkedDepartNames=[],this.checkedDepartNameString="",this.userId="",this.resultDepartOptions=[],this.departId=[],this.departIdShow=!1},show:function(e){var t=this;Object(m["S"])(e).then((function(e){e.success?t.edit(e.result):t.add()}))},add:function(){this.picUrl="",this.refresh(),this.edit({activitiSync:"1"})},edit:function(e){var t=this;this.resetScreenSize();var a=this;a.initialRoleList(),a.checkedDepartNameString="",a.form.resetFields(),e.hasOwnProperty("id")&&(a.loadUserRoles(e.id),setTimeout((function(){t.fileList=e.avatar}),5)),a.userId=e.id,a.visible=!0,a.model=Object.assign({},e),a.$nextTick((function(){a.form.setFieldsValue(i()(t.model,"username","sex","realname","email","phone","activitiSync","workNo","telephone","post"))})),"2"==this.model.userIdentity?(this.identity="2",this.departIdShow=!0):(this.identity="1",this.departIdShow=!1),a.checkedDepartKeys=[],a.loadCheckedDeparts()},loadCheckedDeparts:function(){var e=this,t=this;t.userId&&Object(h["d"])(t.url.userWithDepart,{userId:t.userId}).then((function(a){if(t.checkedDepartNames=[],a.success){for(var r=[],s=[],l=0;l<a.result.length;l++)t.checkedDepartNames.push(a.result[l].title),e.checkedDepartNameString=e.checkedDepartNames.join(","),t.checkedDepartKeys.push(a.result[l].key),r.push({key:a.result[l].key,title:a.result[l].title}),s.push(a.result[l].key);t.resultDepartOptions=r,e.model.departIds?e.departIds=e.model.departIds.split(","):e.departIds=s,t.userDepartModel.departIdList=t.checkedDepartKeys}}))},close:function(){this.$emit("close"),this.visible=!1,this.disableSubmit=!1,this.selectedRole=[],this.userDepartModel={userId:"",departIdList:[]},this.checkedDepartNames=[],this.checkedDepartNameString="",this.checkedDepartKeys=[],this.selectedDepartKeys=[],this.resultDepartOptions=[],this.departIds=[],this.departIdShow=!1,this.identity="1",this.fileList=[]},moment:d.a,validateInput:function(){var e=this;return new Promise((function(t,a){e.form.validateFields((function(e,r){e?a():t()}))}))},handleSubmit:function(){var e=this,t=this;return new Promise((function(a,r){e.form.validateFields((function(s,l){if(!s){t.confirmLoading=!0,l.birthday?l.birthday=l.birthday.format(e.dateFormat):l.birthday="";var i,o=Object.assign(e.model,l);""!=t.fileList?o.avatar=t.fileList:o.avatar=null,o.selectedroles=e.selectedRole.length>0?e.selectedRole.join(","):"",o.selecteddeparts=e.userDepartModel.departIdList.length>0?e.userDepartModel.departIdList.join(","):"",o.userIdentity=e.identity,"2"===e.identity?o.departIds=e.departIds.join(","):o.departIds="",e.model.id?i=Object(m["r"])(o):(o.id=e.userId,i=Object(m["e"])(o)),i.then((function(e){e.success?a(e.result):r(e.message)})).finally((function(){t.confirmLoading=!1}))}}))}))},handleCancel:function(){this.close()},validateToNextPassword:function(e,t,a){var r=this.form,s=r.getFieldValue("confirmpassword");t&&s&&t!==s&&a("两次输入的密码不一样！"),t&&this.confirmDirty&&r.validateFields(["confirm"],{force:!0}),a()},compareToFirstPassword:function(e,t,a){var r=this.form;t&&t!==r.getFieldValue("password")?a("两次输入的密码不一样！"):a()},validatePhone:function(e,t,a){if(t)if(new RegExp(/^1[3|4|5|7|8|9][0-9]\d{8}$/).test(t)){var r={tableName:"sys_user",fieldName:"phone",fieldVal:t,dataId:this.userId};Object(m["m"])(r).then((function(e){e.success?a():a("手机号已存在!")}))}else a("请输入正确格式的手机号码!");else a()},validateEmail:function(e,t,a){if(t)if(new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(t)){var r={tableName:"sys_user",fieldName:"email",fieldVal:t,dataId:this.userId};Object(m["m"])(r).then((function(e){e.success?a():a("邮箱已存在!")}))}else a("请输入正确格式的邮箱!");else a()},validateUsername:function(e,t,a){var r={tableName:"sys_user",fieldName:"username",fieldVal:t,dataId:this.userId};Object(m["m"])(r).then((function(e){e.success?a():a("用户名已存在!")}))},validateWorkNo:function(e,t,a){var r={tableName:"sys_user",fieldName:"work_no",fieldVal:t,dataId:this.userId};Object(m["m"])(r).then((function(e){e.success?a():a("工号已存在!")}))},handleConfirmBlur:function(e){var t=e.target.value;this.confirmDirty=this.confirmDirty||!!t},normFile:function(e){return Array.isArray(e)?e:e&&e.fileList},beforeUpload:function(e){var t=e.type;if(t.indexOf("image")<0)return this.$message.warning("请上传图片"),!1},handleChange:function(e){if(this.picUrl="","uploading"!==e.file.status){if("done"===e.file.status){var t=e.file.response;this.uploadLoading=!1,t.success?(this.model.avatar=t.message,this.picUrl="Has no pic url yet"):this.$message.warning(t.message)}}else this.uploadLoading=!0},onSearch:function(){this.$refs.departWindow.add(this.checkedDepartKeys,this.userId)},modalFormOk:function(e){this.checkedDepartNames=[],this.selectedDepartKeys=[],this.checkedDepartNameString="",this.userId=e.userId,this.userDepartModel.userId=e.userId,this.departIds=[],this.resultDepartOptions=[];for(var t=[],a=0;a<e.departIdList.length;a++)this.selectedDepartKeys.push(e.departIdList[a].key),this.checkedDepartNames.push(e.departIdList[a].title),this.checkedDepartNameString=this.checkedDepartNames.join(","),t.push({key:e.departIdList[a].key,title:e.departIdList[a].title}),this.departIds.push(e.departIdList[a].key);this.resultDepartOptions=t,this.userDepartModel.departIdList=this.selectedDepartKeys,this.checkedDepartKeys=this.selectedDepartKeys},resetScreenSize:function(){var e=document.body.clientWidth;this.drawerWidth=e<500?e:700},identityChange:function(e){"1"===e.target.value?this.departIdShow=!1:this.departIdShow=!0}}},b=w,y=(a("92d5"),a("2877")),C=Object(y["a"])(b,r,s,!1,null,"2e0388eb",null);t["default"]=C.exports},"120f":function(e,t,a){},"92d5":function(e,t,a){"use strict";a("120f")}}]);