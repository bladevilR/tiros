(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c48c142","chunk-2d2288b1","chunk-2d0ba8aa"],{"2fc4":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.files,"edit-rules":e.validRules,"keep-source":!0,"show-overflow":"ellipsis","checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.files=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange},model:{value:i.orderTaskId,callback:function(t){e.$set(i,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,i){return t("a-select-option",{key:i,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}])}),t("vxe-table-column",{attrs:{field:"fileName",title:"文件名称","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-select",{ref:"fileSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件",open:!1},on:{focus:function(t){return e.openFileSelectModal(i)}},model:{value:i.fileName,callback:function(t){e.$set(i,"fileName",t)},expression:"row.fileName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"fileType",title:"文件类型"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.fileType)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"fileSize",title:"文件大小",align:"right"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.fileSize)+" ")]}}])}),e.getButtonShow()?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[e.$refs.listTable.isActiveByRow(i)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(i)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(i)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(i)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1),t("task-select-modal",{ref:"taskSelectModal",on:{ok:e.onSelectTask}}),t("tech-file-list",{ref:"fileSelectModal",attrs:{id:"4",multiple:!1},on:{ok:e.onFileSelect}})],1)},l=[],s=a("ca00"),r=a("383b"),n=a("da42"),o={name:"TaskTechFiles",components:{TaskSelectModal:r["default"],TechFileList:n["default"]},props:{files:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0}},data:function(){return{curEditMode:0,curRow:null,validRules:{fileName:[{required:!0,message:"请选择文件"}]}}},methods:{getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator)},handleAdd:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:Object(s["p"])()};this.selectTask&&Object.assign(t,{orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"taskName")}))}},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.files.map((function(a,i){t.id===a.id&&e.files.splice(i,1)}))}))}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.files.map((function(a,i){e.id===a.id&&t.files.splice(i,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var i in a){var l=a[i];l.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.files.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openFileSelectModal:function(e){this.curRow=e,this.$refs.fileSelectModal.showModal(),this.$refs.fileSelect.blur()},onFileSelect:function(e){if(e&&e.length>0){var t=e[0];this.curRow.fileId=t.id,this.curRow.fileName=t.name,this.curRow.fileType=t.type,this.curRow.fileSize=t.size}else this.curRow.fileId="",this.curRow.fileName="",this.curRow.fileType="",this.curRow.fileSize="";this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},openTaskSelectModal:function(e){this.curRow=e,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(e){if(e&&e.length>0){var t=e[0];this.curRow.orderTaskId=t.id,this.curRow.taskName=t.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[t.key].taskName,this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))}}},c=o,u=a("2877"),d=Object(u["a"])(c,i,l,!1,null,"74f14a29",null);t["default"]=d.exports},"383b":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"任务选择",centered:"",visible:e.visible,bodyStyle:{height:"70vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.tasks,"max-height":"100%","show-overflow":"ellipsis","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",title:"任务编号",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"任务名称",align:"left"}}),t("vxe-table-column",{attrs:{field:"workTime",title:"预计工时",align:"right",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskContent",title:"任务要求",align:"left"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left",width:"200"}})],1)],1)},l=[],s={name:"TaskSelectModal",props:{multiple:{type:Boolean,default:!1}},data:function(){return{visible:!1,tasks:[]}},methods:{showModal:function(e){this.tasks=e,this.visible=!0},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},r=s,n=a("2877"),o=Object(n["a"])(r,i,l,!1,null,"161bbc55",null);t["default"]=o.exports},da42:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",visible:e.visible,title:"文件选择",centered:"",bodyStyle:{height:"80vh"},confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("na-splitter",{staticStyle:{height:"calc(80vh - 15px)"},attrs:{defaultSize:300}},[t("div",{staticStyle:{"overflow-y":"auto","overflow-x":"hidden","padding-right":"2px"},attrs:{slot:"left-panel"},slot:"left-panel"},[t("a-directory-tree",{attrs:{defaultExpandAll:"","tree-data":e.treeData,replaceFields:{title:"name",key:"id"}},on:{select:e.onSelect}})],1),t("div",{staticStyle:{"padding-left":"5px","padding-right":"3px"},attrs:{slot:"right-panel"},slot:"right-panel"},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"文件名称"}},[t("a-input",{attrs:{placeholder:"请输入文件名称",allowClear:!0},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1)],1),t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"文件类型"}},[t("a-select",{attrs:{placeholder:"请选择",allowClear:!0},model:{value:e.queryParam.type,callback:function(t){e.$set(e.queryParam,"type",t)},expression:"queryParam.type"}},[t("a-select-option",{attrs:{value:void 0}},[e._v("请选择")]),t("a-select-option",{attrs:{value:""}},[e._v("所有文件")]),e._l(e.fileType,(function(a){return t("a-select-option",{key:a,attrs:{alue:a}},[e._v(" "+e._s(a)+" ")])}))],2)],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","row-id":"id",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"},"radio-config":{trigger:"row"},"checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"type",title:"类型",width:"150",align:"center"}}),t("vxe-table-column",{attrs:{field:"size",title:"大小(kb)",width:"180",align:"right","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"uploadDate",title:"上传日期",width:"150"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"200",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])])],1)},l=[],s=a("8fad"),r={name:"TechFileList",props:{multiple:{type:Boolean,default:!0},id:{type:String,default:""}},data:function(){return{fileType:[],queryParam:{id:"",name:"",showType:2,type:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[]}},methods:{getFileType:function(){var e=this;Object(s["Cb"])().then((function(t){e.fileType=t.result}))},selectTree:function(){var e=this;Object(s["Bb"])({id:this.id}).then((function(t){t.success&&(e.treeData=t.result)}))},showModal:function(){this.visible=!0,this.selectTree(),this.getFileType(),this.findList()},onSelect:function(e,t){if(e.length){var a=t.node.dataRef;this.queryParam.id=a.id}this.findList()},findList:function(){var e=this;Object(s["Ab"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},n=r,o=a("2877"),c=Object(o["a"])(n,i,l,!1,null,null,null);t["default"]=c.exports}}]);