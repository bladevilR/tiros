(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-25a0aeba","chunk-2d89a616","chunk-5db6ff55"],{"2ddc":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"".concat(e.queryParam.id?"编辑":"新增").concat(e.title),width:"100%",dialogClass:"fullDialog no-footer",visible:e.visible,confirmLoading:e.confirmLoading,footer:null},on:{cancel:e.handleCancel}},[t("a-spin",{staticClass:"full-srceen",attrs:{spinning:e.confirmLoading}},[t("NaCardContent",{staticClass:"table-page-search-wrapper",staticStyle:{background:"transparent"},attrs:{title:"基本信息"}},[t("a-form",{attrs:{form:e.form,layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"文件编号"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileNo",e.validatorRules.fileNo],expression:"['fileNo', validatorRules.fileNo]"}],attrs:{maxLength:33,placeholder:"请输入内容"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"文件名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileName",e.validatorRules.fileName],expression:"['fileName', validatorRules.fileName]"}],attrs:{maxLength:33,placeholder:"请输入内容"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"文件版本"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["fileVer",e.validatorRules.fileVer],expression:"['fileVer', validatorRules.fileVer]"}],attrs:{maxLength:17,placeholder:"请输入内容"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"线路"}},[t("line-select-list",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId",e.validatorRules.lineId],expression:"['lineId', validatorRules.lineId]"}],on:{change:e.onLineChange}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"修程类型"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["repairProgramId",e.validatorRules.repairProgramId],expression:"['repairProgramId', validatorRules.repairProgramId]"}],attrs:{triggerChange:"",dictCode:"bu_repair_program,name,id"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{staticStyle:{"padding-left":"11px"},attrs:{label:"实施日期"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},on:{change:e.dateChange},model:{value:e.pickDate,callback:function(t){e.pickDate=t},expression:"pickDate"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{staticStyle:{"padding-left":"11px"},attrs:{label:"是否有效"}},[t("a-switch",{model:{value:e.bookStatus,callback:function(t){e.bookStatus=t},expression:"bookStatus"}})],1)],1),t("a-col",{attrs:{span:24,align:"right"}},[t("a-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1)],1)],1),t("WorkSopDetail",{key:e.visible,ref:"workSopDetailRef",on:{beforeSave:e.onBeforeSave}})],1)],1)},r=[],n=a("d4ee"),s=a("5633"),o=a("8fad"),l=a("690c"),c={name:"WorkSopModal",components:{LineSelectList:s["default"],NaCardContent:n["default"],WorkSopDetail:l["default"]},data:function(){return{value:1,title:"作业指导书",visible:!1,dictTrainStr:"bu_train_info,train_no,train_no,status=1",model:{},labelCol1:{xs:{span:24},sm:{span:3}},wrapperCol1:{xs:{span:24},sm:{span:21}},labelCol2:{xs:{span:24},sm:{span:6}},wrapperCol2:{xs:{span:24},sm:{span:18}},labelCol3:{xs:{span:24},sm:{span:9}},wrapperCol3:{xs:{span:24},sm:{span:15}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{fileName:{rules:[{required:!0,message:"请输入文件名称!"},{max:32,message:"不能超过32个字符"}]},fileNo:{rules:[{required:!0,message:"请输入文件编号!"},{max:32,message:"不能超过32个字符"}]},fileVer:{rules:[{required:!0,message:"请文件版本!"},{max:16,message:"不能超过16个字符"}]},lineId:{rules:[{required:!0,message:"请选择线路!"}]},repairProgramId:{rules:[{required:!0,message:"请选择修程!"}]}},pickDate:this.$moment(new Date),bookStatus:!0,closeAfterClose:!1,queryParam:{exeTime:this.$moment(new Date).format("YYYY-MM-DD"),fileName:null,fileNo:null,fileVer:null,id:null,lineId:null,repairProgramId:null,status:!0}}},created:function(){this.onLineChange("")},methods:{add:function(){this.edit({}),this.bookStatus=!0},edit:function(e){var t=this;this.visible=!0,e.id?e=Object.assign(this.queryParam,e):(this.pickDate=this.$moment(new Date),this.queryParam.exeTime=this.$moment(new Date).format("YYYY-MM-DD"),this.queryParam.fileName=null,this.queryParam.fileNo=null,this.queryParam.fileVer=null,this.queryParam.id=null,this.queryParam.lineId=null,this.queryParam.repairProgramId=null,this.queryParam.status=1,e=Object.assign({},this.queryParam)),this.form.resetFields(),this.model=Object.assign({},e),this.bookStatus=1===this.model.status,this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue({fileName:e.fileName,fileNo:e.fileNo,fileVer:e.fileVer,lineId:e.lineId,repairProgramId:e.repairProgramId})})),this.updateDetail()},handleOk:function(){this.save()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},onLineChange:function(e,t){},dateChange:function(){this.queryParam.exeTime=this.$moment(this.pickDate).format("YYYY-MM-DD")},save:function(){var e=this;this.form.validateFields((function(t,a){t||(Object.assign(e.queryParam,a),e.queryParam.status=e.bookStatus?1:0,Object(o["Yc"])(e.queryParam).then((function(t){t.success?(e.queryParam.id?e.close():t.result&&(e.queryParam.id=t.result,e.updateDetail()),e.$message.success("保存成功"),e.$emit("change")):e.$message.error(t.message)})))}))},updateDetail:function(){var e=this;this.$nextTick((function(){e.$refs.workSopDetailRef.findList(e.queryParam.id)}))},onBeforeSave:function(){var e=this;this.form.validateFields((function(t,a){t||e.queryParam.id||e.$confirm({content:"新增步骤前需要先保存作业指导书",okText:"确定",cancelText:"取消",onOk:function(){e.save()}})}))}}},u=c,d=a("2877"),m=Object(d["a"])(u,i,r,!1,null,null,null);t["default"]=m.exports},"39ff7":function(e,t,a){},4501:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"作业指导书",width:"100%",dialogClass:"fullDialog no-footer",visible:e.visible,footer:null},on:{cancel:e.handleCancel}},[t("div",{staticClass:"sop-body"},[t("div",{staticStyle:{display:"flex","align-content":"center","flex-wrap":"wrap"}},[e.loading?t("a-spin",{attrs:{tip:"下载中..."}}):e._e()],1),e.loading?e._e():t("div",{ref:"mainDom",staticClass:"sop-body-page"})])])},r=[],n=a("8fad"),s={name:"WorkSopView",components:{},data:function(){return{visible:!1,tableData:[],queryParam:{bookId:""},loading:!1}},created:function(){},methods:{findList:function(){},handleCancel:function(){this.visible=!1},showBook:function(e){var t=this;this.visible=!0,this.loading=!0,Object(n["Pb"])({bookId:e}).then((function(e){if(e.success){var a=[];e.result.forEach((function(e){a.push(Object(n["Qb"])({detailId:e.id}).then((function(e){if(e.success){var a=JSON.parse(JSON.stringify(e.result));return a}return t.$message.error(e.message),null})))})),Promise.all(a).then((function(e){e.sort((function(e,t){return e.stepNum-t.stepNum}));var a="";e.forEach((function(e){e&&(a+="<h2>".concat(e.stepNum,'<span style="margin-left:15px;margin-top: 24px;">').concat(e.stepTitle,"</span></h2>"),a+=e.stepContent||"")})),t.loading=!1,t.$nextTick.call(t,(function(){t.$refs.mainDom.innerHTML=a}))}))}}))},showSopDetail:function(e){var t=this;this.visible=!0;var a=[];e.forEach((function(e){a.push(Object(n["Qb"])({detailId:e}).then((function(e){return e.success?e.result:""})))})),Promise.all(a).then((function(e){var a="";e.forEach((function(e){a+="<h2>".concat(e.stepNum,'<span style="margin-left:15px;">').concat(e.stepTitle,"</span></h2>"),a+=e.stepContent})),t.$refs.mainDom.innerHTML=a}))}}},o=s,l=(a("a9f9"),a("bca7"),a("2877")),c=Object(l["a"])(o,i,r,!1,null,"7e7655fc",null);t["default"]=c.exports},"5bbd":function(e,t,a){},"690c":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("NaCardContent",{attrs:{title:"内容明细",height:"100%"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{staticStyle:{"margin-bottom":"12px"},attrs:{span:24}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),t("a-button",{attrs:{type:"dashed",disabled:!e.isCheckRow},on:{click:e.handleEdit}},[e._v("编辑")]),t("a-button",{attrs:{type:"dashed",disabled:!e.isCheckRows},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1),t("div",{staticClass:"table-page-body-wrapper",staticStyle:{height:"100%"}},[t("div",{staticClass:"table-body-context"},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto",loading:e.loading,data:e.tableData,"checkbox-config":{trigger:"row",highlight:!0,range:!0}},on:{"checkbox-change":e.rangeChange,"checkbox-all":e.rangeChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"60px"}}),t("vxe-table-column",{attrs:{field:"stepNum",title:"步骤",width:"120px"}}),t("vxe-table-column",{attrs:{field:"stepTitle",title:"步骤名称",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a",{on:{click:function(t){return t.stopPropagation(),e.showDetail(i)}}},[e._v(e._s(i.stepTitle))])]}}])})],1)],1)]),t("WorkSopDetailModal",{ref:"workSopDetailModal",on:{ok:e.findList}}),t("WorkSopView",{ref:"workSopViewModal"})],1)},r=[],n=a("d4ee"),s=a("7dfc"),o=a("8fad"),l=a("4501"),c={name:"WorkSopDetail",components:{NaCardContent:n["default"],WorkSopDetailModal:s["default"],WorkSopView:l["default"]},data:function(){return{isCheckRow:!1,isCheckRows:!1,visible:!1,confirmLoading:!1,loading:!1,tableData:[],queryParam:{bookId:""}}},created:function(){},methods:{findList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isCheckRow=!1,this.isCheckRows=!1,t&&(this.queryParam.bookId=t),this.queryParam.bookId&&(this.loading=!0,Object(o["Pb"])(this.queryParam).then((function(t){t.success?e.tableData=t.result:e.$message.error(t.message)})).finally((function(){e.loading=!1})))},save:function(){},rangeChange:function(e){var t=e.records;this.isCheckRow=1===t.length,this.isCheckRows=t.length>0},handleAdd:function(){if(this.queryParam.bookId){var e=1;this.tableData.forEach((function(t){Number(t.stepNum)>=Number(e)&&(e=Number(t.stepNum)+1)})),this.$refs.workSopDetailModal.add(this.queryParam.bookId,e)}else this.$emit("beforeSave")},handleEdit:function(){var e=this.$refs.listTable.getCheckboxRecords()[0];this.$refs.workSopDetailModal.edit(e)},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var a=t.map((function(e){return e.id})),i=new FormData;i.append("ids",a.join(",")),Object(o["E"])(i).then((function(t){t.success?(e.$message.success("删除成功"),e.findList()):e.$message.error(t.message)}))}})},showDetail:function(e){this.$refs.workSopViewModal.showSopDetail([e.id])}}},u=c,d=a("2877"),m=Object(d["a"])(u,i,r,!1,null,null,null);t["default"]=m.exports},"7ba1":function(e,t,a){"use strict";a("5bbd")},"7c1d":function(e,t,a){},"7dfc":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"".concat(e.queryParam.id?"编辑":"新增").concat(e.title),width:"100%",dialogClass:"fullDialog",visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"bodyWrapper",staticStyle:{height:"100% !important"}},[t("a-spin",{staticClass:"full-srceen",staticStyle:{padding:"0 12px",height:"100% !important"},attrs:{spinning:e.confirmLoading}},[t("NaCardContent",{attrs:{title:"基本信息"}},[t("a-form",{attrs:{form:e.form,layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{staticStyle:{width:"100%"},attrs:{label:"步骤",labelCol:{span:6},wrapperCol:{span:18}}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["stepNum",e.validatorRules.stepNum],expression:"['stepNum', validatorRules.stepNum]"}],staticStyle:{width:"100%"},attrs:{max:999999999,placeholder:"请输入步骤"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{staticStyle:{width:"100%"},attrs:{label:"步骤标题",labelCol:{span:6},wrapperCol:{span:18}}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["stepTitle",e.validatorRules.stepTitle],expression:"['stepTitle', validatorRules.stepTitle]"}],staticStyle:{width:"100%"},attrs:{maxLength:65,placeholder:"请输入内容"}})],1)],1)],1)],1)],1),t("NaCardContent",{attrs:{title:"步骤明细",height:"100%"}},[t("a-tabs",{attrs:{forceRender:!0},on:{tabClick:e.onTabClick,change:e.tabChangeEvent},scopedSlots:e._u([{key:"tabBarExtraContent",fn:function(){return[t("a-space",[1!==e.activeKey?t("a-button",{attrs:{type:"primary",disabled:e.isSaveData},on:{click:e.openFormModal}},[e._v("新增")]):e._e(),1!==e.activeKey?t("a-button",{attrs:{type:"dashed",disabled:!(e.isCheckRows&&!e.isSaveData)},on:{click:e.handleDel}},[e._v("删除")]):e._e(),e.isSaveData&&1!==e.activeKey?t("a-button",{attrs:{type:"primary"},on:{click:e.saveRowData}},[e._v("保存")]):e._e(),e.isSaveData&&1!==e.activeKey?t("a-button",{on:{click:e.cencelRowData}},[e._v("取消")]):e._e()],1)]},proxy:!0}]),model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}},[t("a-tab-pane",{key:1,attrs:{tab:"步骤内容"}},[e.isShowEditor?t("j-editor",{attrs:{triggerChange:""},on:{change:e.onEditor},model:{value:e.queryParam.stepContent,callback:function(t){e.$set(e.queryParam,"stepContent",t)},expression:"queryParam.stepContent"}}):e._e()],1),t("a-tab-pane",{key:2,attrs:{tab:"额定物料"}},[t("div",{staticStyle:{height:"calc(100vh - 334px)"}},[t("vxe-table",{ref:"materialListTable",attrs:{border:"",align:"center",height:"auto",data:e.queryParam.materialList,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"checkbox-change":e.rangeChange,"checkbox-all":e.rangeChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"60px"}}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称"}}),t("vxe-table-column",{attrs:{field:"category2_dictText",title:"物料分类"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:i.amount,callback:function(t){e.$set(i,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码"}}),t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[e.$refs.materialListTable.isActiveByRow(i)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowData()}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cencelRowData()}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!1,size:"small"},on:{click:function(t){return t.stopPropagation(),e.handleEdit(i)}}},[e._v("编辑")])]]}}])})],1)],1)]),t("a-tab-pane",{key:3,attrs:{tab:"所需工具"}},[t("div",{staticStyle:{height:"calc(100vh - 334px)"}},[t("vxe-table",{ref:"toolListTable",attrs:{border:"",align:"center",height:"auto",data:e.queryParam.toolList,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"checkbox-change":e.rangeChange,"checkbox-all":e.rangeChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"60px"}}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称"}}),t("vxe-table-column",{attrs:{field:"kind_dictText",title:"工器具分类"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:i.amount,callback:function(t){e.$set(i,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码"}}),t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[e.$refs.toolListTable.isActiveByRow(i)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowData()}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cencelRowData()}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!1,size:"small"},on:{click:function(t){return t.stopPropagation(),e.handleEdit(i)}}},[e._v("编辑")])]]}}])})],1)],1)])],1)],1)],1)],1),t("material-list",{ref:"materialModal",attrs:{multiple:!0},on:{ok:e.onSelectMaterial}}),t("ToolsList",{ref:"toolsModal",attrs:{batch:"",multiple:!0,canSelectType:[4,5]},on:{ok:e.onSelectTool}})],1)},r=[],n=a("d4ee"),s=a("7164"),o=a("5633"),l=a("a4db"),c=a("8fad"),u=a("a061"),d=a("ca00"),m={name:"WorkSopDetailModal",components:{LineSelectList:o["default"],JEditor:u["default"],NaCardContent:n["default"],MaterialList:s["default"],ToolsList:l["default"]},data:function(){return{isCheckRow:!1,isCheckRows:!1,isSaveData:!1,isShowEditor:!0,value:1,title:"步骤",visible:!1,activeKey:1,contentStr:"",model:{},curRow:null,confirmLoading:!1,form:this.$form.createForm(this),validRules:{amount:[{required:!0,message:"数量必须填写"}]},validatorRules:{stepNum:{rules:[{required:!0,message:"请输入步骤"}]},stepTitle:{rules:[{required:!0,message:"请输入标题"},{max:64,message:"不能超过64个字符"}]}},queryParam:{bookId:null,stepNum:null,stepTitle:null,stepContent:null,materialList:[],toolList:[]},historyActiveKey:null,maxNumber:-1}},computed:{activeTableRef:function(){return 3===this.activeKey?this.$refs.toolListTable:this.$refs.materialListTable}},created:function(){},methods:{add:function(e,t){this.queryParam.bookId=e,this.maxNumber=t,this.edit({})},edit:function(e){var t=this;this.confirmLoading=!1,this.visible=!0,this.activeKey=1,this.isSaveData=!1,e.id?Object(c["Qb"])({detailId:e.id}).then((function(a){a.success?e=Object.assign(t.queryParam,JSON.parse(JSON.stringify(a.result))):(t.$message.error(a.message),t.visible=!1)})):(this.queryParam.id=null,this.queryParam.stepNum=null,this.queryParam.stepTitle=null,this.queryParam.stepContent=null,this.queryParam.materialList=[],this.queryParam.toolList=[],this.maxNumber>0&&(this.queryParam.stepNum=this.maxNumber),e=JSON.parse(JSON.stringify(this.queryParam))),this.form.resetFields(),this.model=JSON.parse(JSON.stringify(e)),this.visible=!0,this.$nextTick((function(){t.isShowEditor=!0,t.form.setFieldsValue({stepNum:e.stepNum,stepTitle:e.stepTitle})})),this.queryParam.stepNum=-1},handleOk:function(){this.save()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.isShowEditor=!1,this.visible=!1},save:function(){var e=this;this.confirmLoading=!0,this.form.validateFields((function(t,a){t?e.confirmLoading=!1:(Object.assign(e.queryParam,a),Object(c["Xc"])(e.queryParam).then((function(t){t.success?(e.$message.success("保存成功"),e.isShowEditor=!1,e.$emit("ok",e.queryParam.bookId),e.visible=!1):e.$message.error(t.message)})).finally((function(){e.confirmLoading=!1})))}))},saveRowData:function(){var e=this,t=this.activeTableRef.getActiveRecord();t&&(this.activeTableRef.validate(t.row,(function(a){if(a)for(var i in a){var r=a[i];r.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 2===e.activeKey?e.queryParam.materialList.find((function(e){return e===t.row}))||(t.row.id=Object(d["p"])(),e.queryParam.materialList.push(Object.assign({},t.row))):e.queryParam.toolList.find((function(e){return e===t.row}))||(t.row.id=Object(d["p"])(),e.queryParam.toolList.push(Object.assign({},t.row))),e.isSaveData=!1,e.activeTableRef.clearActived()})),this.rangeChange())},cencelRowData:function(){var e=this.activeTableRef.getActiveRecord();e&&(e.row.id?this.activeTableRef.revertData(e.row):this.activeTableRef.remove(e.row)),this.activeTableRef.clearActived(),this.isSaveData=!1},handleEdit:function(e){this.activeTableRef.setActiveRow(e),this.isSaveData=!0},handleDel:function(){var e=this,t=this.activeTableRef.getCheckboxRecords();this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.forEach((function(t){2===e.activeKey?e.queryParam.materialList.splice(e.queryParam.materialList.findIndex((function(e){return e===t})),1):3===e.activeKey&&e.queryParam.toolList.splice(e.queryParam.toolList.findIndex((function(e){return e===t})),1),e.isCheckRow=!1,e.isCheckRows=!1}))}})},openFormModal:function(){switch(this.activeKey){case 2:this.$refs.materialModal.showModal();break;case 3:this.$refs.toolsModal.showModal();break}},onEditor:function(e){this.queryParam.stepContent=e},onSelectMaterial:function(e){var t=this;e.forEach((function(e){if(t.queryParam.materialList.find((function(t){return t.materialTypeId===e.id})))t.$message.warn("".concat(e.name,"物料已经存在列表中"));else{var a={amount:Number(e.num),bookDetailId:t.queryParam.id,category1:e.category1,category1_dictText:e.category1_dictText,category2:e.category2,category2_dictText:e.category2_dictText,code:e.code,id:"",kind:e.kind,materialTypeId:e.id,name:e.name,price:e.price,spec:e.spec,unit:e.unit};t.queryParam.materialList.push(a)}}))},onSelectTool:function(e){var t=this;e.forEach((function(e){if(t.queryParam.toolList.find((function(t){return t.toolTypeId===e.id})))t.$message.warn("".concat(e.name,"工器具已经存在列表中"));else{var a={amount:Number(e.num),bookDetailId:t.queryParam.id,kind_dictText:e.kind_dictText,code:e.code,id:"",toolTypeId:e.id,unit:e.unit,name:e.name,status_dictText:e.status_dictText};t.queryParam.toolList.push(a)}}))},rangeChange:function(){var e=this.activeTableRef.getCheckboxRecords();this.isCheckRow=1===e.length,this.isCheckRows=e.length>0},testEvent:function(e){return e.preventDefault(),!1},onTabClick:function(){if(this.activeTableRef&&this.activeTableRef.getActiveRecord())return this.historyActiveKey=this.activeKey,void this.$message.warn("有未保存数据");this.historyActiveKey=null},tabChangeEvent:function(){this.historyActiveKey&&(this.activeKey=this.historyActiveKey),this.isShowEditor=1===this.activeKey}}},h=m,f=a("2877"),p=Object(f["a"])(h,i,r,!1,null,null,null);t["default"]=p.exports},"9d91":function(e,t,a){"use strict";a("7c1d")},a4db:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:e.title,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"搜索"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"分类"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_tools_type",disabledArray:e.canSelectType},model:{value:e.queryParam.category1,callback:function(t){e.$set(e.queryParam,"category1",t)},expression:"queryParam.category1"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":e.onCellClick}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别",width:"150"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"150"}}),e.batch?t("vxe-table-column",{attrs:{field:"num",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}):e._e()],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},r=[],n=a("c54ca"),s={name:"ToolTypeSelect",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:function(){return[4,5,6]}},batch:{type:Boolean,default:!1}},data:function(){return{title:"工器具类型选择",queryParam:{type:"2",searchText:"",category1:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.category1=this.canSelectType[0]),this.findList()},findList:function(){var e=this;this.loading=!0,Object(n["Cb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"num",1)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},checkRadioMethod:function(e){var t=e.row;return!this.canSelectType||-1!==this.canSelectType.indexOf(t.category1)},onCellClick:function(e){var t=e.row,a=e.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([t],!0)}}},o=s,l=(a("7ba1"),a("2877")),c=Object(l["a"])(o,i,r,!1,null,"df2d4508",null);t["default"]=c.exports},a9f9:function(e,t,a){"use strict";a("d392")},bca7:function(e,t,a){"use strict";a("39ff7")},d392:function(e,t,a){},d4ee:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"na-content-body",style:{height:e.height}},[t("h4",{staticClass:"na-content-title"},[e._v(e._s(e.title))]),e._t("default")],2)},r=[],n={props:{title:{type:String,default:""},height:{type:String,default:"auto"}}},s=n,o=(a("9d91"),a("2877")),l=Object(o["a"])(s,i,r,!1,null,"274eed10",null);t["default"]=l.exports}}]);