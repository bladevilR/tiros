(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76fb5b9c","chunk-ccd9324a","chunk-2d0ba8aa","chunk-2d22d5d2"],{"190e":function(t,e,n){"use strict";n("c984")},"383b":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"70%",title:"任务选择",centered:"",visible:t.visible,bodyStyle:{height:"70vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:t.tasks,"max-height":"100%","show-overflow":"ellipsis","radio-config":t.multiple?{}:{trigger:"row"},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{type:"seq",title:"任务编号",width:"100"}}),e("vxe-table-column",{attrs:{field:"taskName",title:"任务名称",align:"left"}}),e("vxe-table-column",{attrs:{field:"workTime",title:"预计工时",align:"right",width:"100"}}),e("vxe-table-column",{attrs:{field:"taskContent",title:"任务要求",align:"left"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left",width:"200"}})],1)],1)},i=[],o={name:"TaskSelectModal",props:{multiple:{type:Boolean,default:!1}},data:function(){return{visible:!1,tasks:[]}},methods:{showModal:function(t){this.tasks=t,this.visible=!0},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},a=o,c=n("2877"),l=Object(c["a"])(a,r,i,!1,null,"161bbc55",null);e["default"]=l.exports},"41ca":function(t,e,n){"use strict";n("ae84")},"51c5":function(t,e,n){"use strict";n("e9d9")},ae84:function(t,e,n){},b9c3:function(t,e,n){"use strict";n.d(e,"lb",(function(){return a})),n.d(e,"f",(function(){return c})),n.d(e,"i",(function(){return l})),n.d(e,"v",(function(){return s})),n.d(e,"b",(function(){return f})),n.d(e,"l",(function(){return p})),n.d(e,"p",(function(){return m})),n.d(e,"G",(function(){return h})),n.d(e,"c",(function(){return d})),n.d(e,"B",(function(){return g})),n.d(e,"k",(function(){return y})),n.d(e,"A",(function(){return v})),n.d(e,"x",(function(){return w})),n.d(e,"g",(function(){return k})),n.d(e,"E",(function(){return T})),n.d(e,"C",(function(){return x})),n.d(e,"M",(function(){return O})),n.d(e,"kb",(function(){return S})),n.d(e,"O",(function(){return R})),n.d(e,"N",(function(){return N})),n.d(e,"jb",(function(){return _})),n.d(e,"t",(function(){return M})),n.d(e,"d",(function(){return C})),n.d(e,"W",(function(){return A})),n.d(e,"X",(function(){return L})),n.d(e,"e",(function(){return I})),n.d(e,"o",(function(){return E})),n.d(e,"V",(function(){return q})),n.d(e,"R",(function(){return F})),n.d(e,"Q",(function(){return B})),n.d(e,"K",(function(){return J})),n.d(e,"L",(function(){return K})),n.d(e,"fb",(function(){return gt})),n.d(e,"bb",(function(){return H})),n.d(e,"Y",(function(){return Q})),n.d(e,"J",(function(){return X})),n.d(e,"hb",(function(){return ot})),n.d(e,"U",(function(){return at})),n.d(e,"eb",(function(){return Y})),n.d(e,"cb",(function(){return Z})),n.d(e,"a",(function(){return tt})),n.d(e,"j",(function(){return ut})),n.d(e,"nb",(function(){return dt})),n.d(e,"gb",(function(){return ft})),n.d(e,"m",(function(){return pt})),n.d(e,"H",(function(){return vt})),n.d(e,"T",(function(){return z})),n.d(e,"S",(function(){return P})),n.d(e,"mb",(function(){return G})),n.d(e,"z",(function(){return mt})),n.d(e,"db",(function(){return ht})),n.d(e,"y",(function(){return bt})),n.d(e,"u",(function(){return u})),n.d(e,"F",(function(){return b})),n.d(e,"ob",(function(){return D})),n.d(e,"q",(function(){return $})),n.d(e,"D",(function(){return j})),n.d(e,"ib",(function(){return et})),n.d(e,"n",(function(){return nt})),n.d(e,"I",(function(){return W})),n.d(e,"P",(function(){return V})),n.d(e,"s",(function(){return ct})),n.d(e,"Z",(function(){return lt})),n.d(e,"ab",(function(){return st})),n.d(e,"h",(function(){return rt})),n.d(e,"w",(function(){return it})),n.d(e,"r",(function(){return U}));var r=n("0fea"),i=n("4328"),o=n.n(i),a=function(t){return Object(r["j"])("/group/fault/info/submit",t)},c=function(t){return Object(r["j"])("/group/fault/info/cancel",t)},l=function(t){return Object(r["j"])("/group/fault/info/delete",t)},s=function(t){return Object(r["d"])("/group/fault/info/page",t)},u=function(t){return Object(r["d"])("/group/fault/info/get",t)},d=function(t){return Object(r["j"])("/group/safeassume/read/add",t)},f=function(t){return Object(r["j"])("/group/safeassume/add",t)},p=function(t){return Object(r["j"])("/group/safeassume/delete",t)},m=function(t){return Object(r["j"])("/group/safeassume/edit",t)},h=function(t){return Object(r["d"])("/group/safeassume/page",t)},b=function(t){return Object(r["d"])("/group/safeassume/get",t)},g=function(t){return Object(r["d"])("/group/turnoverchange/page",t)},v=function(t){return Object(r["d"])("/material/spare-part/get",t)},y=function(t){return Object(r["j"])("/group/turnoverchange/delete",t)},w=function(t){return Object(r["d"])("/group/measurealert/page",t)},k=function(t){return Object(r["j"])("/group/measurealert/close",t)},T=function(t){return Object(r["d"])("/group/spare-part/page",t)},x=function(t){return Object(r["d"])("/group/spare-part/get",t)},j=function(t){return Object(r["d"])("/produce/train/history/asset/use/page",t)},O=function(t){return Object(r["d"])("/group/toolequipment/page",t)},S=function(t){return Object(r["j"])("/group/toolequipment/setStatus",t)},$=function(t){return Object(r["d"])("/group/toolequipment/usage",t)},R=function(t){return Object(r["d"])("/group/tool/page",t)},N=function(t){return Object(r["d"])("/group/tool/get",t)},_=function(t){return Object(r["j"])("/group/tool/setDutyUser",t)},D=function(t){return Object(r["d"])("/group/tool/usage",t)},M=function(t){return Object(r["d"])("/group/information/basic",t)},C=function(t){return Object(r["j"])("/group/information/tools/add",t)},A=function(t){return Object(r["d"])("/group/information/workstation/page-related",t)},L=function(t){return Object(r["d"])("/group/information/workstation/page-unrelated",t)},I=function(t){return Object(r["j"])("/group/information/workstation/add",t)},E=function(t){return Object(r["j"])("/group/information/workstation/delete",t)},P=function(t){return Object(r["d"])("/workGroup/workOrder/relevanceInfo/".concat(t))},G=function(t){return Object(r["j"])("/workGroup/workOrder/submit-to-dispatcher",o.a.stringify(t))},q=function(t){return Object(r["d"])("/workGroup/workRecord/list",t)},B=function(t){return Object(r["d"])("/serialPlan/plan/forms/online-form/get",t)},F=function(t){return Object(r["d"])("/serialPlan/plan/forms/work-record/get",t)},V=function(t){return Object(r["d"])("/serialPlan/plan/forms/check-record/get",t)},z=function(t){return Object(r["d"])("/workGroup/workOrder/page",t)},U=function(t){return Object(r["d"])("/workGroup/workOrder/apply/page",t)},J=function(t){return Object(r["d"])("/workGroup/workRecord/recordForm",t)},K=function(t){return Object(r["d"])("/workGroup/workRecord/relevanceInfo/".concat(t))},W=function(t){return Object(r["d"])("/workGroup/workRecord/relevanceInfo/bookSteps/".concat(t))},H=function(t){return Object(r["j"])("/workGroup/workRecord/save/form-result",t)},Q=function(t){return Object(r["j"])("/workGroup/workRecord/check",t)},X=function(t){return Object(r["j"])("/workGroup/workRecord/getTaskQRCode",t)},Y=function(t){return Object(r["j"])("/workGroup/workRecord/work-record/save-manufNo",o.a.stringify(t))},Z=function(t){return Object(r["j"])("/workGroup/workRecord/save/material",t)},tt=function(t){return Object(r["j"])("/workGroup/workRecord/save/actMaterial",t)},et=function(t){return Object(r["j"])("/workGroup/workRecord/save/work-time",t)},nt=function(t){return Object(r["j"])("/workGroup/workRecord/arrange/delete",t)},rt=function(t){return Object(r["j"])("/workGroup/workOrder/material/commit-temp-apply",t)},it=function(t){return Object(r["d"])("/workGroup/workOrder/material/apply/list",t)},ot=function(t){return Object(r["j"])("/workGroup/workRecord/check/saveExcelData",t)},at=function(t){return Object(r["d"])("/workGroup/workRecord/get/excelData/".concat(t))},ct=function(t){return Object(r["d"])("/serialPlan/plan/forms/check-record/item/list",t)},lt=function(t){return Object(r["j"])("/workGroup/workRecord/check-record/set-check",t)},st=function(t){return Object(r["j"])("/workGroup/workRecord/check-record/set-time",t)},ut=function(t){return Object(r["j"])("/workGroup/workRecord/delete/material",o.a.stringify(t))},dt=function(t){return Object(r["j"])("/workGroup/workRecord/submit-task",t)},ft=function(t){return Object(r["j"])("/workGroup/workRecord/save/tool",t)},pt=function(t){return Object(r["j"])("/workGroup/workRecord/delete/tool",o.a.stringify(t))},mt=function(t){return Object(r["d"])("/workGroup/workRecord/outsourceOutin",t)},ht=function(t){return Object(r["j"])("/workGroup/workRecord/save/outsourceOutin",t)},bt=function(t){return Object(r["d"])("/workGroup/workRecord/outin/not-returns",t)},gt=function(t){return Object(r["j"])("/group/safeassume/read/add",o.a.stringify(t))},vt=function(t){return Object(r["d"])("/serialPlan/plan/page",t)}},c984:function(t,e,n){},d888:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"test-class",style:"height: calc(100% - ".concat(t.getButtonShow()?"47px":"4px",");")},[2!==t.operator&&3!==t.operator?e("div",{attrs:{"na-flex-height-full":""}},[t.getButtonShow()?e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:24}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")]),2===t.opType?e("a-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交领料申请")]):t._e(),2===t.opType?e("span",{staticStyle:{color:"#dbaaaa"}},[t._v("<- 提交领料申请后，将暂停作业填报，工单重新流转到物料员进行发料")]):t._e(),3===t.opType?e("span",{staticStyle:{color:"#dbaaaa"}},[t._v("<- 添加的退回物料，在工班长提交工单后，统一生成退料单提交给物料员")]):t._e()],1)],1)],1)],1)],1):t._e(),e("div",{attrs:{"na-flex-height-full":""}},[2===t.opType?e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:t.taskMaterials,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"row-style":t.checkMaterialShow,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(e){t.taskMaterials=e},blur:function(e){return t.$refs.listTable.clearValidate()}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(e){return t.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(e){t.$set(r,"code",e)},expression:"row.code"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,166663900)}),e("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[t._v(" "+t._s(n.name)+" ")]}}],null,!1,1805491503)}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type"},on:{select:t.onCategoryChange,blur:function(e){return t.$refs.listTable.clearValidate()}},model:{value:r.useCategory,callback:function(e){t.$set(r,"useCategory",e)},expression:"row.useCategory"}})]}}],null,!1,1274400700)}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(e){t.$set(r,"amount",e)},expression:"row.amount"}})]}}],null,!1,3749314421)}),e("vxe-table-column",{attrs:{field:"actAmount",title:"实际消耗"}}),e("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[t._v(" "+t._s(n.unit)+" ")]}}],null,!1,1773474126)}),e("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",align:"left","edit-render":{name:"$input",props:{type:"text"}}}}),t.getButtonShow()?e("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(n){var r=n.row;return[t.$refs.listTable.isActiveByRow(r)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(r)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(r)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(r)}}},[t._v("编辑")])]]}}],null,!1,1311980394)}):t._e()],1):t._e(),3===t.opType?e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:t.taskMaterials,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"row-style":t.checkMaterialShow2,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(e){t.taskMaterials=e},blur:function(e){return t.$refs.listTable.clearValidate()}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(e){return t.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(e){t.$set(r,"code",e)},expression:"row.code"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,166663900)}),e("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[t._v(" "+t._s(n.name)+" ")]}}],null,!1,1805491503)}),e("vxe-table-column",{attrs:{field:"amount",title:"退料数量","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:1e4},model:{value:r.amount,callback:function(e){t.$set(r,"amount",e)},expression:"row.amount"}})]}}],null,!1,223652004)}),e("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[t._v(" "+t._s(n.unit)+" ")]}}],null,!1,1773474126)}),t.getButtonShow()?e("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(n){var r=n.row;return[t.$refs.listTable.isActiveByRow(r)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(r)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(r)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(r)}}},[t._v("编辑")])]]}}],null,!1,1311980394)}):t._e()],1):t._e()],1)],1):t._e(),e("material-list",{ref:"modalForm",attrs:{multiple:!1,mode:[1,2],"show-type-code":!0,typeCodeList:[2,3,-1]},on:{ok:t.onSelectMaterial}}),e("ReturnMaterialModal",{ref:"returnMaterialModal",on:{ok:t.onSelectReturnMaterial}}),e("task-select-modal",{ref:"taskSelectModal",on:{ok:t.onSelectTask}})],1)},i=[],o=n("7164"),a=n("383b"),c=n("ff09"),l=n("f6d0"),s=n("f9cc"),u=(n("c54ca"),n("b9c3"));function d(t){return h(t)||m(t)||p(t)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){if(t){if("string"==typeof t)return b(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function m(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function h(t){if(Array.isArray(t))return b(t)}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function g(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return v(s,"_invoke",function(n,r,i){var o,c,l,s=0,u=i||[],d=!1,f={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return o=e,c=0,l=t,f.n=n,a}};function p(n,r){for(c=n,l=r,e=0;!d&&s&&!i&&e<u.length;e++){var i,o=u[e],p=f.p,m=o[2];n>3?(i=m===r)&&(l=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=t):o[0]<=p&&((i=n<2&&p<o[1])?(c=0,f.v=r,f.n=o[1]):p<m&&(i=n<3||o[0]>r||r>m)&&(o[4]=n,o[5]=r,f.n=m,c=0))}if(i||n>1)return a;throw d=!0,r}return function(i,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,m),c=u,l=m;(e=c<2?t:l)||!d;){o||(c?c<3?(c>1&&(f.n=-1),p(c,l)):f.n=l:f.v=l);try{if(s=2,o){if(c||(i="next"),e=o[i]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,c<2&&(c=0)}else 1===c&&(e=o.return)&&e.call(o),c<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),c=1);o=t}else if((e=(d=f.n<0)?l:n.call(r,f))!==a)break}catch(e){o=t,c=1,l=e}finally{s=1}}return{value:e,done:d}}}(n,i,o),!0),s}var a={};function c(){}function l(){}function s(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(v(e={},r,(function(){return this})),e),d=s.prototype=c.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,v(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=s,v(d,"constructor",s),v(s,"constructor",l),l.displayName="GeneratorFunction",v(s,i,"GeneratorFunction"),v(d),v(d,i,"Generator"),v(d,r,(function(){return this})),v(d,"toString",(function(){return"[object Generator]"})),(g=function(){return{w:o,m:f}})()}function v(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}v=function(t,e,n,r){function o(e,n){v(t,e,(function(t){return this._invoke(e,n,t)}))}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},v(t,e,n,r)}function y(t,e,n,r,i,o,a){try{var c=t[o](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,i)}function w(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){y(o,r,i,a,c,"next",t)}function c(t){y(o,r,i,a,c,"throw",t)}a(void 0)}))}}var k={name:"ReceiveMaterial",components:{TaskSelectModal:a["default"],MaterialList:o["default"],ApplyReadyComponent:c["default"],ApplyConfirmComponent:l["default"],ReturnMaterialModal:s["default"]},props:{taskMaterials:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},opType:{type:Number,default:2},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0},workOrderId:{type:String,default:null}},data:function(){return{curEditMode:0,curRow:null,validRules:{taskName:[{required:!0,message:"请选工单任务",trigger:"manual"}],code:[{required:!0,message:"请选择物料",trigger:"manual"}],useCategory_dictText:[{required:!0,message:"类别必须选择",trigger:"manual"}],amount:[{required:!0,message:"数量必须填写",trigger:"manual"}],actAmount:[{required:2===this.opType,message:"数量必须填写",trigger:"manual"}]},applyMaterialList:[],typeCodeList:[]}},mounted:function(){},methods:{onCategoryChange:function(t,e){var n=this.$refs.listTable.getActiveRecord();n.row.useCategory_dictText=e?e.title:void 0,this.$forceUpdate()},save:function(t){},saveOk:function(){this.$emit("ok")},saveFail:function(t){this.$emit("fail",t)},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||2===this.operator)},handleAdd:function(){var t=this;if(!this.$refs.listTable.getActiveRecord())if(this.curEditMode=1,3!==this.opType){this.applyMaterialList=[];var e={useCategory:null,opType:this.opType,isGenOrder:0,opType_dictText:2===this.opType?"临时新增":"退还物资"};this.selectTask&&Object.assign(e,{orderId:this.selectTask.orderId,orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}),this.$refs.listTable.insertAt(e,-1).then((function(e){var n=e.row;t.$refs.listTable.setActiveCell(n,"code")}))}else this.$refs.returnMaterialModal.showModal(this.selectTask.orderId)},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e=e.filter((function(e){return e.opType===t.opType})),e.find((function(e){return 1===e.isGenOrder&&2===t.opType}))?this.$message.warn("".concat(e.find((function(e){return 1===e.isGenOrder&&2===t.opType})).name,"物料已经生成单据，不能删除")):e.length>0?this.$confirm({content:"是否删除选中".concat(e.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var n=e.map((function(t){return t.id}));Object(u["j"])({ids:n.join(",")}).then((function(e){e.success?(n.forEach((function(e){t.taskMaterials.map((function(n,r){e===n.id&&t.taskMaterials.splice(r,1)}))})),t.$emit("ok"),t.$message.success("删除成功")):t.$message.error("删除失败")}))}}):this.$message.error("尚未选中任何数据!")},handleSubmit:function(){var t=this,e=this.taskMaterials.filter((function(t){return 2===t.opType&&1===t.needDispatchin&&0===t.isGenOrder}));e.length?this.$confirm({content:"确认是否发起领料申请？",okText:"确定",cancelText:"取消",onOk:function(){var n=new FormData;n.append("orderId",t.selectTask.orderId),n.append("opType",2),Object(u["h"])(n).then((function(n){n.success?(t.$message.success("提交申请成功"),e.forEach((function(e){t.taskMaterials[t.taskMaterials.findIndex((function(t){return t==e}))]&&(t.taskMaterials[t.taskMaterials.findIndex((function(t){return t==e}))].isGenOrder=1,t.taskMaterials[t.taskMaterials.findIndex((function(t){return t==e}))].isGenOrder_dictText="是")})),t.$emit("submit")):t.$message.error(n.message)}))}}):this.$message.warn("没有新添加的物料明细，不能提交")},editRowEvent:function(t){this.curEditMode=2,3===this.opType?this.getAppleMaterialList():this.applyMaterialList=[],this.$refs.listTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.taskMaterials.map((function(n,r){t.id===n.id&&e.taskMaterials.splice(r,1)}))},saveRowEvent:function(){var t=w(g().m((function t(e){var n=this;return g().w((function(t){while(1)switch(t.n){case 0:this.$refs.listTable.validate(e,(function(t){if(t)for(var r in t){var i=t[r];i.forEach((function(t){t.rule&&n.$message.error(t.rule.message)}))}else{if(3===n.opType&&n.applyMaterialList.find((function(t){return t.materialTypeId===e.materialTypeId})).amount<e.amount)return void n.$message.warn("退料数量不能大于领料数量");if(e.actAmount>e.amount)return void n.$message.error("实际消耗不能大于所需数量");n.$emit(1===n.curEditMode?"add":"edit",e),n.$refs.listTable.clearActived(),n.curEditMode=0}}));case 1:return t.a(2)}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getAppleMaterialList:function(){var t=this;this.applyMaterialList=[],Object(u["w"])({orderId:this.selectTask.orderId}).then((function(e){e.success?e.result.forEach((function(e){t.applyMaterialList=[].concat(d(t.applyMaterialList),d(e.detailList))})):t.$message.error("读取领用明细失败")}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},openMaterialSelectModal:function(t){this.curRow=t,this.$refs.modalForm.showModal(),this.$refs.listTable.clearValidate()},onSelectMaterial:function(t){if(t&&t.length>0){var e=t[0];this.curRow.code=e.code,this.curRow.materialTypeId=e.id,this.curRow.name=e.name,this.curRow.kind=e.kind,this.curRow.unit=e.unit,this.curRow.kind_dictText=e.kind_dictText,2===this.opType&&-1!==e.category1&&(this.curRow.useCategory=e.category1?e.category1:null,this.curRow.useCategory_dictText=e.category1?e.category1_dictText:""),this.curRow.amount=e.num,this.curRow.actAmount=0,this.curRow.needDispatchin=1,this.curRow.needDispatchin_dictText="是"}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory="",this.curRow.useCategory_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.actAmount=0,this.curRow.actAmount=0,this.curRow.needDispatchin=1,this.curRow.needDispatchin_dictText="是"},onSelectReturnMaterial:function(t){var e=this,n=[];t.forEach((function(t){if(e.taskMaterials.find((function(e){return e.materialTypeId===t.materialTypeId&&3===e.opType})))e.$message.warn("".concat(t.materialTypeName,"物资已存在"));else{var r={useCategory:null,isGenOrder:0,opType:e.opType,opType_dictText:"退还物资"};e.selectTask&&Object.assign(r,{orderId:e.selectTask.orderId,orderTaskId:e.selectTask.id,taskName:e.selectTask.taskName}),Object.assign(r,{code:t.materialTypeCode,materialTypeId:t.materialTypeId,name:t.materialTypeName,unit:t.materialTypeUnit,useCategory:t.useCategory,useCategory_dictText:t.useCategory_dictText,amount:t.num,actAmount:0,planAmount:0,needDispatchin:0}),n.push(Object(u["cb"])(r).then((function(t){return t.success?r:(e.$message.error("保存错误"),null)})).catch((function(t){return e.$message.error("保存异常"),null})))}})),n.length&&Promise.all(n).then((function(t){e.$message.success("执行成功"),e.$emit("addReturnMateriles",t.filter((function(t){return t})))}))},openTaskSelectModal:function(t){this.curRow=t,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(t){if(t&&t.length>0){var e=t[0];this.curRow.orderTaskId=e.id,this.curRow.taskName=e.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(t,e){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[e.key].taskName},clearValidate:function(){this.$refs.listTable.clearValidate()},checkMaterialShow:function(t){var e=t.row;return e.opType!==this.opType||0===e.needDispatchin||1===e.isGenOrder?"display: none;":void 0},checkMaterialShow2:function(t){var e=t.row;if(e.opType!==this.opType)return"display: none;"}}},T=k,x=(n("41ca"),n("2877")),j=Object(x["a"])(T,r,i,!1,null,"489bc3d2",null);e["default"]=j.exports},e9d9:function(t,e,n){},f6d0:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[t.fromFlow?t._e():e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:12,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden","margin-bottom":"8px"}},[e("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:t.save}},[t._v("确认领用")]),e("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.close}},[t._v("关闭")])],1)])],1),e("div",{staticStyle:{height:"calc(70vh - 45px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,range:!0}}},[e("vxe-table-column",{attrs:{type:"seq",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"确认状态",width:"100"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}})],1)],1),e("ApplyDistributionModal",{ref:"distributionModal",attrs:{dataList:t.distributionTableList},on:{ok:t.onSuccess}})],1)},i=[],o=n("c54ca"),a=n("2eb4"),c=n("8973");function l(t){return f(t)||d(t)||u(t)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"==typeof t)return p(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function d(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function f(t){if(Array.isArray(t))return p(t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var m={name:"ApplyConfirmComponent",components:{ApplyDistributionModal:a["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:null}},data:function(){return{tableData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{orderId:"",status:[1]}}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:{edit:function(t){this.queryParam.orderId=t,this.findList()},findList:function(){var t=this;this.tableData=[],Object(o["bb"])(this.queryParam).then((function(e){e.success?(t.tableData=[].concat(l(t.tableData),l(e.result)),c["a"].joinDistributionInfo(t.tableData)):t.$message.error("加载数据失败"),t.$emit("loaded")}))},save:function(t){var e=this;if(this.tableData&&this.tableData.length>0){var n=this.tableData.map((function(t,e){return t.id}));if(0===n.length)return this.$message.warn("没有要确认领料的物资，无法继续！"),void this.$emit("fail",{message:"没有要确认领料的物资，无法继续！"});var r={fromType:2,ids:n.join(",")};Object(o["j"])(r).then((function(t){t.success?e.$emit("ok"):e.$emit("fail",t)})).catch((function(t){e.$message.error("保存异常"),e.$emit("fail",{message:"保存异常！"})}))}else this.$emit("ok")},close:function(){this.$emit("close")},openDistribution:function(t){this.$refs.distributionModal.showModal(t)},onSuccess:function(){var t=this;this.tableData.forEach((function(e){e.receive=0,t.distributionTableList.forEach((function(t){t.applyDetailId===e.id&&(e.receive+=Number(t.amount))}))}))}}},h=m,b=n("2877"),g=Object(b["a"])(h,r,i,!1,null,"1c988508",null);e["default"]=g.exports},f9cc:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"97%",title:"物料选择",visible:t.visible,confirmLoading:t.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("div",{staticStyle:{height:"calc(80vh - 186px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 186px)"},attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":t.multiple?{}:{trigger:"row"},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":t.onCellClick}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物料编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物料名称",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"150"}}),e("vxe-table-column",{attrs:{field:"receive",title:"领用数量",width:"150"}}),e("vxe-table-column",{attrs:{field:"num",title:"退还数量",width:"200","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入数量",min:1,max:r.receive},model:{value:r.num,callback:function(e){t.$set(r,"num",e)},expression:"row.num"}})]}}])})],1)],1)])},i=[],o=n("b098"),a=n("5633"),c=n("b9c3");function l(t){return f(t)||d(t)||u(t)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"==typeof t)return p(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function d(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function f(t){if(Array.isArray(t))return p(t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var m={name:"ReturnMaterialModal",components:{JTreeSelect:o["default"],LineSelectList:a["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{hiddenType:[],dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",dictCodeStrWork:"bu_mtr_workstation,name,id",queryParam:{type:"1",category1:"",searchText:"",attr:null,warehouseId:"",materialTypeCodeList:[],pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},created:function(){},methods:{showModal:function(t){var e=this;this.loading=!0,this.tableData=[],Object(c["w"])({orderId:t}).then((function(t){t.success?(t.result.forEach((function(t){t.detailList.map((function(t){return t.num=1,t})),e.tableData=[].concat(l(e.tableData),l(t.detailList))})),e.loading=!1,e.visible=!0):e.$message.error("读取领用明细失败")}))},handleOk:function(){var t=[];t=this.$refs.listTable.getCheckboxRecords(),this.$emit("ok",t),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.tabIndex="1"},onCellClick:function(t){var e=t.row,n=t.column;"num"===n.property&&this.$refs.listTable.setCheckboxRow([e],!0)}}},h=m,b=(n("190e"),n("2877")),g=Object(b["a"])(h,r,i,!1,null,"63189a6c",null);e["default"]=g.exports},ff09:function(t,e,n){"use strict";n.r(e);var r,i=function(){var t=this,e=t._self._c;return e("div",[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"right",overflow:"hidden","margin-bottom":"8px"}},[e("a-space",[t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.autoArrange}},[t._v("自动安排库位")]),t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.arrangePan}},[t._v("批量设置托盘")])],1)],1)])],1),t.isDistribution?t._e():e("div",{staticStyle:{height:"calc(70vh - 45px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,trigger:"row",range:!0}},on:{"checkbox-change":t.checkboxChange,"checkbox-all":t.checkboxChange}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{title:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(n){var r=n.row;return[e("a",{on:{click:function(e){return e.stopPropagation(),t.openDistribution(r)}}},[t._v("发放管理")])]}}],null,!1,768125003)})],1)],1),t.isDistribution?e("div",{staticClass:"panel-main",staticStyle:{height:"calc(70vh - 45px)"}},[e("div",{staticClass:"panel-left"},[e("vxe-table",{ref:"materialTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableData,"radio-config":{highlight:!0,trigger:"row",range:!0,checkMethod:function(){return 0===t.curEditMode}}},on:{"radio-change":t.onRadioChange,"cell-click":t.onMaterialCellClick}},[e("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",width:"160",title:"物资编码"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"名称"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"80"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"80"}})],1)],1),e("div",{staticClass:"panel-right"},[e("div",{staticClass:"ant-alert ant-alert-info",staticStyle:{"margin-bottom":"16px"}},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:t.addDetail}},[t._v("添加发放库位")]),e("a-button",{on:{click:t.closeDistribution}},[t._v("关闭")]),e("span",{staticStyle:{color:"red","margin-left":"15px"}},[t._v(t._s("总量: ".concat(t.selectInfo?t.selectInfo.amount:0,";")))]),e("span",{staticStyle:{color:"red","margin-left":"5px"}},[t._v(t._s("差额：".concat(t.calcAmount)))])],1)],1),e("div",{staticStyle:{height:"calc(100% - 62px)"}},[e("vxe-table",{ref:"distributionTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableDistributionData,"edit-rules":t.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[e("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("a-select",{ref:"locationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:function(e){return t.openlocationModal(r)}},model:{value:r.sourceLocationName,callback:function(e){t.$set(r,"sourceLocationName",e)},expression:"row.sourceLocationName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,325071706)}),e("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择托盘",open:!1},on:{dropdownVisibleChange:function(e){return t.openPalletModal()}},model:{value:r.palletName,callback:function(e){t.$set(r,"palletName",e)},expression:"row.palletName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,3015230497)}),e("vxe-table-column",{attrs:{field:"tradeNo",title:"所属批次",width:"270","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(n){var r=n.row;return[r.needChooseTradeNo?e("div",[e("a-select",{staticStyle:{width:"100%"},on:{change:function(e){return t.tradeNoCHange(r)}},model:{value:r.tradeNo,callback:function(e){t.$set(r,"tradeNo",e)},expression:"row.tradeNo"}},t._l(r.tradeNoChoiceList,(function(n,r){return e("a-select-option",{key:r,attrs:{value:n.tradeNo}},[t._v(" "+t._s(n.tradeNo)+"    "+t._s(n.price)+" ")])})),1)],1):e("div",[t._v(" "+t._s(r.tradeNo)+" ")])]}}],null,!1,2270284966)}),e("vxe-table-column",{attrs:{field:"amount",title:"发放数量",width:"120",align:"center","edit-render":{name:"$input",props:{type:"number",min:0}}}}),e("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center","show-overflow":!1},scopedSlots:t._u([{key:"default",fn:function(n){var r=n.row;return[r&&!t.$refs.distributionTable.isActiveByRow(r)?e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(r)}}},[t._v("编辑 ")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleDel(r)}}},[t._v("删除")])],1):e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(r)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(r)}}},[t._v("取消")])],1)]}}],null,!1,743031837)})],1)],1)])]):t._e(),e("ApplyDistributionModal",{ref:"distributionModal",on:{ok:t.onSuccess}}),e("PalletList",{ref:"palletModal",attrs:{modeType:2},on:{ok:t.onSelectPallet}}),e("PalletList",{ref:"palletModal2",attrs:{modeType:2},on:{ok:t.onChoosePallet}}),e("LocationList",{ref:"locationModal",attrs:{modeType:2},on:{ok:t.onSelectLocation}})],1)},o=[],a=n("c54ca"),c=n("2eb4"),l=n("4ec3"),s=n("9f49"),u=n("13f1"),d=n("8973");function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function p(t,e,n){return(e=m(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(t){var e=h(t,"string");return"symbol"==f(e)?e:e+""}function h(t,e){if("object"!=f(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return g(s,"_invoke",function(n,r,i){var o,c,l,s=0,u=i||[],d=!1,f={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return o=e,c=0,l=t,f.n=n,a}};function p(n,r){for(c=n,l=r,e=0;!d&&s&&!i&&e<u.length;e++){var i,o=u[e],p=f.p,m=o[2];n>3?(i=m===r)&&(l=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=t):o[0]<=p&&((i=n<2&&p<o[1])?(c=0,f.v=r,f.n=o[1]):p<m&&(i=n<3||o[0]>r||r>m)&&(o[4]=n,o[5]=r,f.n=m,c=0))}if(i||n>1)return a;throw d=!0,r}return function(i,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,m),c=u,l=m;(e=c<2?t:l)||!d;){o||(c?c<3?(c>1&&(f.n=-1),p(c,l)):f.n=l:f.v=l);try{if(s=2,o){if(c||(i="next"),e=o[i]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,c<2&&(c=0)}else 1===c&&(e=o.return)&&e.call(o),c<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),c=1);o=t}else if((e=(d=f.n<0)?l:n.call(r,f))!==a)break}catch(e){o=t,c=1,l=e}finally{s=1}}return{value:e,done:d}}}(n,i,o),!0),s}var a={};function c(){}function l(){}function s(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(g(e={},r,(function(){return this})),e),d=s.prototype=c.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,g(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=s,g(d,"constructor",s),g(s,"constructor",l),l.displayName="GeneratorFunction",g(s,i,"GeneratorFunction"),g(d),g(d,i,"Generator"),g(d,r,(function(){return this})),g(d,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:o,m:f}})()}function g(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}g=function(t,e,n,r){function o(e,n){g(t,e,(function(t){return this._invoke(e,n,t)}))}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},g(t,e,n,r)}function v(t,e,n,r,i,o,a){try{var c=t[o](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,i)}function y(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){v(o,r,i,a,c,"next",t)}function c(t){v(o,r,i,a,c,"throw",t)}a(void 0)}))}}function w(t){return j(t)||x(t)||T(t)||k()}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(t,e){if(t){if("string"==typeof t)return O(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}function x(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function j(t){if(Array.isArray(t))return O(t)}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var S={name:"ApplyReadyComponent",components:{ApplyDistributionModal:c["default"],PalletList:s["default"],LocationList:u["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!1},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:""}},data:function(){return{records:[],confirmLoading:!1,tableData:[],tableDistributionData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{status:[0],orderId:""},curRow:null,isDistribution:!1,selectInfo:{},addParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},curEditMode:0,validRules:{sourceLocationName:[{required:!0,message:"请选择库位",trigger:"manual"}],tradeNo:[{required:!0,message:"批次号不能为空",trigger:"manual"}],amount:[{required:!0,message:"请输入数量",trigger:"manual"}]}}},computed:{hasActiveRow:function(){return!!this.$refs.distributionTable.getActiveRecord()},calcAmount:function(){return this.getAmount()}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:(r={tradeNoCHange:function(t){var e=t.tradeNoChoiceList.filter((function(e){return e.tradeNo==t.tradeNo}));t.price=e[0].price},checkboxChange:function(t){this.records=t.records},edit:function(t){this.initDictData(),this.queryParam.orderId=t,this.findList()},findList:function(){var t=this;this.tableData=[],this.records=[],Object(a["bb"])(this.queryParam).then((function(e){e.success?(t.tableData=[].concat(w(t.tableData),w(e.result)),d["a"].joinDistributionInfo(t.tableData),t.distributionTableList=[]):t.$message.error("加载数据失败"),t.$emit("loaded")}))},autoArrange:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<=0?this.$message.warn("请先选择要进行自动安排的记录！"):this.$confirm({content:"将根据现有库存情况自动安排库位，并覆盖原有数据？",okText:"确定",cancelText:"取消",onOk:function(){var n={applyDetailIdList:[],type:0};e.forEach((function(t){n.applyDetailIdList.push(t.id)})),t.confirmLoading=!0,Object(a["k"])(n).then((function(n){if(n.success){var r=n.result.applyDetailList;t.$message.success(n.result.assignResultMessage),e.forEach((function(t){var e=r.find((function(e){return e.id===t.id}));e&&(e.sourceLocationAndPalletName="",e.assignDetailList.forEach((function(t){var n=t.sourceLocationName+" | "+t.amount;t.palletName&&(n+=" | ".concat(t.palletName)),t.tradeNo&&(n+=" | 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=n+" \n"})),Object.assign(t,e))}))}else t.$message.error(n.message);t.confirmLoading=!1}))},onCancel:function(){}})},arrangePan:function(){var t=this.$refs.listTable.getCheckboxRecords();if(t.length<=0)this.$message.warn("请先选择要进行自动安排的记录！");else{var e=t.filter((function(t){return t.assignDetailList.length<=0}));e.length>0?this.$message.warning("请先安排库位信息"):this.$refs.palletModal.showModal()}},onSelectPallet:function(t){var e=this.$refs.listTable.getCheckboxRecords();try{Array.from(e,(function(e){Array.from(e.assignDetailList,(function(e){e.palletId=t[0].id,e.palletName=t[0].name}))})),this.updateAssignInfo(),this.$message.success("设置成功")}catch(n){this.$message.error("设置失败")}},save:function(){var t=y(b().m((function t(e){var n,r,i,o,c=this;return b().w((function(t){while(1)switch(t.n){case 0:if(this.fromFlow){t.n=1;break}n=this.$refs.listTable.getCheckboxRecords(),n.length>0?this.$confirm({content:"是否确认发放选中".concat(n.length,"数据？"),onOk:function(){var t=n.map((function(t,e){return{id:t.id,palletId:t.palletName,receive:t.receive}})),e={id:c.queryParam.orderId,detailList:t};Object(a["i"])(e).then((function(t){t.success?c.$emit("ok"):c.$emit("fail",t)})).catch((function(t){c.$message.error("保存异常"),c.$emit("fail")}))}}):this.$message.error("尚未选中任何数据!"),t.n=6;break;case 1:if(!(this.tableData&&this.tableData.length>0)){t.n=5;break}if(r={id:this.queryParam.orderId,onlySave:e,detailList:this.tableData.filter((function(t){return!t.noSave}))},i=!0,o=this.tableData.filter((function(t){return 0===t.receive})),e||!o.length){t.n=3;break}return t.n=2,new Promise((function(t,e){var n=o.map((function(t){return"["+t.materialTypeName+"-"+t.materialTypeCode+"]缺少"+(t.amount-t.receive)})).join("；");c.$confirm({content:"数量不匹配提醒：  ".concat(n,"  ;  是否继续提交？"),onOk:function(){t(!0)},onCancel:function(){t(!1)}})}));case 2:i=t.v;case 3:if(i){t.n=4;break}return this.$emit("cancel"),t.a(2);case 4:a["i"].call(this,r).then((function(t){t.success?c.$emit("ok"):c.$emit("fail",t)})).catch((function(t){c.$message.error("备料保存异常"),c.$emit("fail",t)})),t.n=6;break;case 5:this.$emit("ok");case 6:return t.a(2)}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),close:function(){this.$emit("close")},initDictData:function(){var t=this;Object(l["f"])(this.dictCode,null).then((function(e){e.success&&e.result&&e.result.map((function(e){t.palletList=t.palletList.concat({label:e.text,value:e.value})}))}))},openDistribution:function(t){this.curRow=t,this.openDistribution(t)},onSuccess:function(t){var e=this;t.forEach((function(n){var r=e.tableData.find((function(t){return t.id===n.applyDetailId}));r.assignDetailList=JSON.parse(JSON.stringify(t)),r.receive=0,r.assignDetailList.forEach((function(t){r.receive+=Number(t.amount);var e=t.sourceLocationName+" | "+t.amount;t.palletName&&(e+=" | ".concat(t.palletName)),t.tradeNo&&(e+=" | 第".concat(t.tradeNo,"批次")),r.sourceLocationAndPalletName+=e+" \n"}))}))},updateAssignInfo:function(){this.tableData.forEach((function(t){t.sourceLocationAndPalletName="",t.assignDetailList.forEach((function(e){var n=e.sourceLocationName+" | "+e.amount;e.palletName&&(n+=" | ".concat(e.palletName)),e.tradeNo&&(n+=" | 第".concat(e.tradeNo,"批次")),t.sourceLocationAndPalletName+=n+" \n"}))}))}},p(p(p(p(p(p(p(p(p(p(r,"openDistribution",(function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isDistribution=!0,this.curEditMode=0,this.$nextTick((function(){t.$refs.materialTable.setRadioRow(e||t.tableData[0]||{}),t.setActiveRow(e||t.tableData[0])}))})),"closeDistribution",(function(){this.hasActiveRow?this.$message.warn("存在未保存数据，请先保存"):(this.isDistribution=!1,this.curEditMode=0)})),"setActiveRow",(function(t){var e=this;this.tableDistributionData=[],this.selectInfo={},this.selectInfo=this.tableData.find((function(e){return e.id===t.id})),this.selectInfo.assignDetailList.forEach((function(t){e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))}))})),"onRadioChange",(function(t){var e=t.row;e&&!this.hasActiveRow&&this.setActiveRow(e)})),"onMaterialCellClick",(function(t){var e=t.$event;e.stopPropagation()})),"addDetail",(function(){var t=this;if(!this.$refs.distributionTable.getActiveRecord()){this.curEditMode=1;var e={applyDetailId:this.selectInfo.id,materialTypeId:this.selectInfo.materialTypeId,amount:this.getAmount()};this.$refs.distributionTable.insertAt(e,-1).then((function(e){var n=e.row;t.$refs.distributionTable.setActiveRow(n)}))}})),"editRowEvent",(function(t){this.$refs.distributionTable.getActiveRecord()||(this.curEditMode=2,this.$refs.distributionTable.setActiveRow(t))})),"getAmount",(function(){if(!this.selectInfo)return 0;var t=0;return this.tableDistributionData.forEach((function(e){t+=Number(e.amount)})),this.selectInfo.amount-t})),"openlocationModal",(function(t){this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,t.applyDetailId,t.id)})),"onSelectLocation",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),n=e.row;n&&(n.locationName=t[0].warehouseName,n.locationWbs=t[0].warehouseWbs,n.sourceLocationName=t[0].sourceLocationName,n.tradeNo=t[0].tradeNo,n.price=t[0].price,n.needChooseTradeNo=t[0].needChooseTradeNo,n.tradeNoChoiceList=t[0].tradeNoChoiceList,n.locationNum=t[0].usableAmount,this.calcAmount>n.locationNum?n.amount=n.locationNum:this.calcAmount>0&&this.calcAmount<=n.locationNum?n.amount=this.calcAmount:n.amount=0)}})),p(p(p(p(p(r,"saveRowEvent",(function(t){var e=this;this.$refs.distributionTable.validate(t,(function(n){if(!n){if(e.tableDistributionData.find((function(e){return e.sourceLocationName===t.sourceLocationName&&e.tradeNo===t.tradeNo}))&&1===e.curEditMode)return void e.$message.warn("该仓库该批次的物资记录已存在");if("number"===typeof t.locationNum&&t.amount>t.locationNum)return void e.$message.warn("该仓库该批次的物资库存量不足");var r=0;if(e.tableDistributionData.forEach((function(e){e.sourceLocationName,t.sourceLocationName,e.tradeNo!==t.tradeNo&&(r+=Number(e.amount))})),r+Number(t.amount)>Number(e.selectInfo.amount))return void e.$message.warn("选择的实际数量超过了发放数量");1===e.curEditMode&&(t.isNew=!0,e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))),e.$refs.distributionTable.clearActived(),e.onSuccess(e.tableDistributionData),e.curEditMode=0}}))})),"cancelRowEvent",(function(t){this.$refs.distributionTable.clearActived(),1===this.curEditMode?this.$refs.distributionTable.remove(t):2===this.curEditMode&&this.$refs.distributionTable.revertData(t),this.curEditMode=0})),"handleDel",(function(t){var e=this;this.$refs.distributionTable.getActiveRecord()||(this.$confirm({content:"是否删除选中的数据？",okText:"确定",cancelText:"取消",onOk:function(){e.tableDistributionData.splice(e.tableDistributionData.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1);var n=e.tableData.find((function(e){return e.id===t.applyDetailId}));n.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName}))&&(n.receive-=n.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName})).amount,n.assignDetailList.splice(n.assignDetailList.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1)),e.$nextTick((function(){e.locationMaxAmount=e.calcAmount}))}}),this.curEditMode=0)})),"openPalletModal",(function(){this.$refs.palletModal2.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName)})),"onChoosePallet",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),n=e.row;n&&(n.palletId=t[0].id,n.palletName=t[0].name)}})))},$=S,R=(n("51c5"),n("2877")),N=Object(R["a"])($,i,o,!1,null,"efd43ef8",null);e["default"]=N.exports}}]);