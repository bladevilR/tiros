(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-caaa5b6c","chunk-29096d72"],{"2cb5":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"90%",centered:"",title:t.title,visible:t.visible,confirmLoading:t.confirmLoading,cancelText:"关闭",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchQuery.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:7,sm:24}},[e("a-form-item",{attrs:{label:"名称"}},[e("a-input",{attrs:{placeholder:"名称或编码","allow-clear":""},model:{value:t.queryParam.searchText,callback:function(e){t.$set(t.queryParam,"searchText",e)},expression:"queryParam.searchText"}})],1)],1),e("a-col",{attrs:{md:7,sm:24}},[e("a-form-item",{attrs:{label:"状态"}},[e("j-dict-select-tag",{attrs:{dictCode:"bu_enable"},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}})],1)],1),e("a-col",{attrs:{md:3,sm:12}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[e("a-button",{on:{click:t.searchQuery}},[t._v("查询")])],1)])],1)],1)],1),e("div",{staticStyle:{height:"calc(80vh - 85px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 85px)"},attrs:{border:"","max-height":"100%","row-id":"id",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","radio-config":t.multiple?{}:{trigger:"row",checkMethod:t.checkRadioMethod},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,checkMethod:t.checkRadioMethod}:{},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:t.loadChildrenMethod}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"name",title:"名称","tree-node":"",align:"left"}}),e("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"code",title:"编码",width:"15%"}}),e("vxe-table-column",{attrs:{field:"structType_dictText",title:"类型",width:"10%"}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"10%"}}),e("vxe-table-column",{attrs:{field:"placeCode",title:"位置编码",width:"15%"}}),e("vxe-table-column",{attrs:{field:"placeDesc",title:"位置描述",width:"15%"}})],1)],1)])},n=[],o=a("8fad"),r={name:"TrainAssetType",props:{trainTypeId:{type:String,default:""},parentId:{type:String,default:null},multiple:{type:Boolean,default:!0},title:{type:String,default:"设备类型选择"},canSelectType:{type:Array,default:function(){return[1,2,3,4]}}},data:function(){return{queryParam:{trainTypeId:"",id:"",searchText:"",status:null,structType:null},allAlign:"center",tableData:[],treeData:[],selectParent:"",visible:!1,confirmLoading:!1}},mounted:function(){},methods:{showModal:function(){this.visible=!0,this.queryParam.trainTypeId=this.trainTypeId,this.findList()},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.visible=!1},handleCancel:function(){this.$emit("cancel"),this.close()},close:function(){this.$emit("close"),this.visible=!1},findList:function(){var t=this;this.loading=!0,this.parentId&&(this.queryParam.id=this.parentId),this.selectParent&&(this.queryParam.id=this.selectParent),Object(o["Qd"])(this.queryParam).then((function(e){e.success&&(t.loading=!1,t.tableData=e.result)}))},findSelectList:function(){var t=this,e={id:this.parentId,trainTypeId:this.trainTypeId};this.parentId&&(e.id=this.parentId),Object(o["Qd"])(e).then((function(e){e.success&&(t.loading=!1,t.treeData=e.result.map((function(e){return t.genSelectTreeNode(e)})))}))},loadChildrenMethod:function(t){var e=this,a=t.row,s={trainTypeId:this.trainTypeId,id:a.id};return new Promise((function(t){Object(o["Qd"])(s).then((function(a){a.success?t(a.result):e.$message.error("".concat(a.msg))}))}))},loadSelectNodeMethod:function(t){var e=this,a={trainTypeId:this.trainTypeId,id:t.dataRef.id,searchText:this.queryParam.searchText,status:this.queryParam.status,structType:this.queryParam.structType};return new Promise((function(t){Object(o["Qd"])(a).then((function(t){t.success?t.result.map((function(t){e.treeData=e.treeData.concat(e.genSelectTreeNode(t))})):e.$message.warning(t.message)})),t()}))},genSelectTreeNode:function(t){return{id:t.id,pId:t.parentId,value:t.id,title:t.name,isLeaf:!t.hasChildren}},searchQuery:function(){this.findList()},checkRadioMethod:function(t){var e=t.row;return this.canSelectType.indexOf(e.structType)>-1}}},i=r,l=(a("9589"),a("2877")),c=Object(l["a"])(i,s,n,!1,null,"52968c59",null);e["default"]=c.exports},7237:function(t,e,a){},"7a7c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{"padding-bottom":"50px"}},[e("a-form-model",{ref:"form",attrs:{model:t.taskInfo,rules:t.formRules}},[e("a-row",{staticStyle:{width:"100%"}},[e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"上级任务",prop:"ParentId"}},[e("a-input",{attrs:{disabled:""},model:{value:t.taskInfo.ParentName,callback:function(e){t.$set(t.taskInfo,"ParentName",e)},expression:"taskInfo.ParentName"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"是否生成工单",prop:"genOrder"}},[e("a-switch",{model:{value:t.taskInfo.genOrder,callback:function(e){t.$set(t.taskInfo,"genOrder",e)},expression:"taskInfo.genOrder"}})],1)],1),e("a-col",{attrs:{span:4}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"是否委外",prop:"outsource"}},[e("a-switch",{model:{value:t.taskInfo.outsource,callback:function(e){t.$set(t.taskInfo,"outsource",e)},expression:"taskInfo.outsource"}})],1)],1),e("a-col",{attrs:{span:4}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"重要任务",prop:"important"}},[e("a-switch",{model:{value:t.taskInfo.important,callback:function(e){t.$set(t.taskInfo,"important",e)},expression:"taskInfo.important"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"任务名称",prop:"taskName"}},[e("a-input",{attrs:{maxLength:51},model:{value:t.taskInfo.taskName,callback:function(e){t.$set(t.taskInfo,"taskName",e)},expression:"taskInfo.taskName"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"作业手段",prop:"method"}},[e("j-dict-select-tag",{attrs:{dictCode:"bu_regu_method"},on:{blur:t.onMethodBlur},model:{value:t.taskInfo.method,callback:function(e){t.$set(t.taskInfo,"method",e)},expression:"taskInfo.method"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"车辆停靠",prop:"trackId"}},[e("j-dict-select-tag",{attrs:{dictCode:"bu_mtr_track,name,id,status=1"},model:{value:t.taskInfo.trackId,callback:function(e){t.$set(t.taskInfo,"trackId",e)},expression:"taskInfo.trackId"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"所需工时",prop:"workTime"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:99999},model:{value:t.taskInfo.workTime,callback:function(e){t.$set(t.taskInfo,"workTime",e)},expression:"taskInfo.workTime"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"第几天",prop:"dayIndex"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{disabled:!!t.parentTask,min:0},on:{change:t.dayIndexChange},model:{value:t.taskInfo.dayIndex,callback:function(e){t.$set(t.taskInfo,"dayIndex",e)},expression:"taskInfo.dayIndex"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"工期",prop:"taskDuration"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},on:{change:t.taskDurationChange},model:{value:t.taskInfo.taskDuration,callback:function(e){t.$set(t.taskInfo,"taskDuration",e)},expression:"taskInfo.taskDuration"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"开始日期",prop:"startTime"}},[e("a-date-picker",{staticStyle:{width:"100%"},attrs:{"disabled-date":t.disabledStartDate},on:{change:t.changeStartDate},model:{value:t.taskInfo.startTime,callback:function(e){t.$set(t.taskInfo,"startTime",e)},expression:"taskInfo.startTime"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"作业工班",prop:"workGroupId"}},[e("j-dict-select-tag",{attrs:{dictCode:"sys_depart,depart_name,id,org_category=4",triggerChange:!0},on:{change:t.changeWorkGroup},model:{value:t.taskInfo.workGroupId,callback:function(e){t.$set(t.taskInfo,"workGroupId",e)},expression:"taskInfo.workGroupId"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"作业工位",prop:"workstations"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",labelInValue:""},on:{select:t.workStationSelect,deselect:t.workStationDeselect},model:{value:t.workStations,callback:function(e){t.workStations=e},expression:"workStations"}},t._l(t.workStationList,(function(a){return e("a-select-option",{key:a.id,attrs:{title:a.name}},[t._v(t._s(a.name))])})),1)],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"结束日期",prop:"finishTime"}},[e("a-date-picker",{staticStyle:{width:"100%"},attrs:{"disabled-date":t.disabledEndDate},on:{change:t.changeEndDate},model:{value:t.taskInfo.finishTime,callback:function(e){t.$set(t.taskInfo,"finishTime",e)},expression:"taskInfo.finishTime"}})],1)],1),e("a-col",{attrs:{span:24}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol1,wrapperCol:t.wrapperCol1,label:"任务描述",prop:"remark"}},[e("a-textarea",{attrs:{maxLength:65,placeholder:"请输入内容"},model:{value:t.taskInfo.remark,callback:function(e){t.$set(t.taskInfo,"remark",e)},expression:"taskInfo.remark"}})],1)],1),e("a-col",{attrs:{span:24}},[e("a-form-model-item",{attrs:{labelCol:t.labelCol1,wrapperCol:t.wrapperCol1,label:"安全预想",prop:"remark"}},[e("j-editor",{attrs:{plugins:"lists link table textcolor wordcount contextmenu fullscreen",triggerChange:""},on:{change:function(e){t.taskInfo.safeNotice=e}},model:{value:t.taskInfo.safeNotice,callback:function(e){t.$set(t.taskInfo,"safeNotice",e)},expression:"taskInfo.safeNotice"}})],1)],1)],1)],1),e("train-asset-type",{ref:"assetTypeModal",attrs:{title:"设备选择",trainTypeId:t.trainTypeId,"parent-id":t.taskInfo.systemId,multiple:!1,"can-select-type":[2,3,4]},on:{ok:t.onAssetTypeSelect,cancel:t.onCancelAssetTypeSelect}})],1)},n=[],o=a("c1df"),r=a.n(o),i=a("8fad"),l=a("2cb5"),c=a("a061"),d={name:"TaskBasicInfo",components:{TrainAssetType:l["default"],JEditor:c["default"]},props:{trainTypeId:{type:String,default:""},baseDate:{type:String,default:""},task:{type:Object,default:null},tasks:{type:Array,default:null},parentTask:{type:Object,default:null},planInfo:{type:Object,default:function(){return{}}}},data:function(){return{selectValue:2,workStations:[],systemDictCode:"bu_train_asset_type,name,id,train_type_id='"+this.trainTypeId+"' AND struct_type=1",taskInfo:{UID:"",ParentId:"",children:null,taskName:"",genOrder:!0,trackId:"",outsource:!1,important:!1,method:"",workTime:0,systemId:"",assetTypeId:"",dayIndex:0,taskDuration:0,startTime:"",finishTime:"",workGroupId:"",workstations:[],planId:"",remark:"",safeNotice:""},replaceFields:{children:"children",title:"Name",key:"ID",value:"UID"},formRules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"change"},{max:50,message:"输入长度不能超过50个字符",trigger:"change"}],remark:[{max:255,message:"输入长度不能超过255个字符",trigger:"change"}],method:[{required:!0,message:"请选择作业手段",trigger:"change"}],systemId:[{required:!0,message:"请选择关联系统",trigger:"change"}],assetTypeId:[{required:!0,message:"请选择关联设备",trigger:"change"}],startTime:[{required:!0,message:"请选择任务开始日期",trigger:"change"}],finishTime:[{required:!0,message:"请选择任务结束日期",trigger:"change"}]},baseDateMoment:r()(this.baseDate),workStationList:[],labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}},labelCol1:{xs:{span:24},sm:{span:2}},wrapperCol1:{xs:{span:24},sm:{span:22}},labelCol2:{xs:{span:24},sm:{span:3}},wrapperCol2:{xs:{span:24},sm:{span:21}}}},computed:{canSelectAsset:function(){return!(!this.taskInfo||!this.taskInfo.systemId)}},mounted:function(){var t=this;this.parentTask&&(this.taskInfo.startTime=r()(this.parentTask.startTime),this.changeStartDate(this.taskInfo.startTime)),this.task&&(Object.assign(this.taskInfo,this.task),this.task.startTime&&(this.taskInfo.startTime=new r.a(this.task.startTime)),this.task.finishTime&&(this.taskInfo.finishTime=new r.a(this.task.finishTime)),this.taskInfo.genOrder=1===this.taskInfo.genOrder||!0===this.taskInfo.genOrder,this.taskInfo.outsource=1===this.taskInfo.outsource||!0===this.taskInfo.outsource,this.taskInfo.important=1===this.taskInfo.important||!0===this.taskInfo.important,this.taskInfo.workstations&&this.taskInfo.workstations.length>0&&(this.workStations=[],this.taskInfo.workstations.map((function(e){t.workStations.push({key:e.workstationId,label:e.workstationName})}))),this.parentTask&&!this.taskInfo.workGroupId&&(this.taskInfo.workGroupId=this.parentTask.workGroupId),this.workStationList=[],this.taskInfo.workGroupId&&Object(i["dc"])(this.taskInfo.workGroupId).then((function(e){e.success&&(t.workStationList=e.result),t.workStationList&&0!==t.workStationList.length||Object(i["ec"])({id:t.$store.getters.userInfo.workshopId,pageNo:1,pageSize:1e4}).then((function(e){e.success&&(t.workStationList=e.result.records)}))})))},methods:{moment:r.a,setTimeEvent:function(t,e){if(this.parentTask)return!1;if(this.planInfo){var a=this.planInfo.baseDate;t&&e?(this.taskInfo.startTime=r()(a).add(t-1,"days"),this.taskInfo.finishTime=r()(this.taskInfo.startTime).add(e-1,"days")):t&&(this.taskInfo.startTime=r()(a).add(t-1,"days"))}},dayIndexChange:function(t){t>0&&this.setTimeEvent(t,this.taskInfo.taskDuration)},taskDurationChange:function(t){0==t?this.taskInfo.finishTime=null:t>0&&(this.taskInfo.startTime&&(this.taskInfo.finishTime=r()(this.taskInfo.startTime).add(t-1,"days")),this.setTimeEvent(this.taskInfo.dayIndex,t))},validate:function(){var t=this;return new Promise((function(e,a){t.$refs.form.validate((function(t){t?e(!0):a("基本信息输入验证失败，请检查")}))}))},setOutsource:function(t){this.taskInfo.outsource=t},setImportant:function(t){this.taskInfo.important=t},getData:function(){var t=mini.clone(this.taskInfo);return this.taskInfo.startTime&&(t.startTime=this.taskInfo.startTime.format("YYYY-MM-DD HH:mm:ss")),this.taskInfo.finishTime&&(t.finishTime=this.taskInfo.finishTime.format("YYYY-MM-DD HH:mm:ss")),this.taskInfo.Start&&(t.Start=new r.a(this.taskInfo.Start).format("YYYY-MM-DD HH:mm:ss")),this.taskInfo.Finish&&(t.Finish=new r.a(this.taskInfo.Finish).format("YYYY-MM-DD HH:mm:ss")),t.genOrder=t.genOrder?1:0,t.outsource=t.outsource?1:0,t.important=t.important?1:0,t.workstations=[],this.workStations.length>0&&this.workStations.map((function(e){t.workstations.push({taskId:t.UID,workstationId:e.key,workstationName:e.label})})),t},disabledStartDate:function(t){return this.parentTask?t<r()(this.parentTask.startTime):t<this.baseDateMoment},disabledEndDate:function(t){var e=this.taskInfo.startTime;return!(!e||!t)&&t<e},changeStartDate:function(t){if(t){var e=t.diff(this.baseDateMoment,"day");this.taskInfo.dayIndex=e,this.taskInfo.finishTime=t}var a=this.taskInfo.finishTime;if(t&&a){var s=r()(a).diff(t,"day");this.taskInfo.taskDuration=s+1}},changeEndDate:function(t){var e=this.taskInfo.startTime;if(t&&e){var a=r()(t).diff(e,"day");this.taskInfo.taskDuration=a+1}},changeWorkGroup:function(t){var e=this;Object(i["dc"])(t).then((function(t){e.workStationList=t.result}))},workStationSelect:function(t){},workStationDeselect:function(t){},openAssetTypeModal:function(){this.canSelectAsset&&(this.$refs.assetTypeModal.showModal(),this.$refs.assetType.blur())},onAssetTypeSelect:function(t){if(t.length>0){var e=t[0];e?(this.taskInfo.assetTypeName=e.name,this.taskInfo.assetTypeId=e.id):(this.taskInfo.assetTypeName="",this.taskInfo.assetTypeId=""),this.$forceUpdate(),this.$refs.form.validateField("assetType")}},onCancelAssetTypeSelect:function(){this.$refs.form.validateField("assetType")},onMethodBlur:function(){this.$refs.form.validateField("method")},onAssetSystemBlur:function(){this.$refs.form.validateField("assetSystem")},onSystemChange:function(t){},onParentTaskChange:function(t){this.$refs.form.validateField("parentTask")}}},f=d,p=a("2877"),u=Object(p["a"])(f,s,n,!1,null,null,null);e["default"]=u.exports},9589:function(t,e,a){"use strict";a("7237")}}]);