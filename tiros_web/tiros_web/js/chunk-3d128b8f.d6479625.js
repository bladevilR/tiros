(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d128b8f","chunk-42391c95"],{"260f":function(e,t,n){},"353a":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",visible:e.visible,title:e.title,centered:"",bodyStyle:{height:"80vh"},confirmLoading:e.confirmLoading,destroyOnClose:!0,footer:null},on:{cancel:e.handleCancel}},[t("div",[t("iframe",{staticClass:"filename",staticStyle:{height:"calc(80vh - 25px)"},attrs:{src:e.filePath,width:"100%",frameborder:"0"}})])])},r=[],i=n("e2aa"),o={name:"DocPreviewModal",props:{title:{type:String,default:"文件预览"}},data:function(){return{visible:!1,confirmLoading:!1,filePath:""}},methods:{handleFilePath:function(e){var t=this;Object(i["c"])(e).then((function(e){if(e.success){var n=e.result;t.visible=!0,t.filePath=window._CONFIG["onlinePreviewDomainURL"]+"?url="+encodeURIComponent(n)}else t.$message.warning("查看文件失败")}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=o,l=(n("9216"),n("2877")),c=Object(l["a"])(s,a,r,!1,null,"484795fd",null);t["default"]=c.exports},"53e7":function(e,t,n){"use strict";n("d5c3")},6971:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:e.files,"edit-rules":e.validRules,"keep-source":!0,"show-overflow":"ellipsis","checkbox-config":{trigger:"row",highlight:e.getButtonShow(),range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.files=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),e.getButtonShow()?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e._e(),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input",enabled:!e.selectTask},width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(n.taskName)+" ")]}},{key:"edit",fn:function(n){var a=n.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:!0},on:{change:e.taskSelectChange},model:{value:a.taskId,callback:function(t){e.$set(a,"taskId",t)},expression:"row.taskId"}},e._l(e.tasks,(function(n,a){return t("a-select-option",{key:a,attrs:{value:n.id}},[e._v(" "+e._s(n.taskName)+" ")])})),1)]}}],null,!1,1322267700)}):e._e(),t("vxe-table-column",{attrs:{field:"name",title:"文件名称",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(n){var a=n.row;return[t("a-upload",{staticClass:"attachedUploadBtn",attrs:{"before-upload":e.beforeLedUpload,multiple:!1,"file-list":[],showUploadList:!1},on:{blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("a-select",{ref:"toolSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件",open:!1},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"row.name"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)]}}])}),t("vxe-table-column",{attrs:{field:"type",title:"扩展名",width:"150px"}}),t("vxe-table-column",{attrs:{field:"fileSize",title:"文件大小(KB)",width:"150px"}}),t("vxe-table-column",{attrs:{field:"uid",title:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(n){var a=n.row;return[a&&!e.$refs.listTable.isActiveByRow(a)?t("span",[t("a",{on:{click:function(t){return t.stopPropagation(),e.previewImage(a)}}},[e._v("查看")]),t("a",{staticStyle:{"margin-left":"6px"},on:{click:function(t){return t.stopPropagation(),e.handleDownload(a)}}},[e._v("下载")])]):t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(a)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(a)}}},[e._v("取消")])],1)]}}])})],1)],1),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.previewFileName}})],1)},r=[],i=n("e2aa"),o=n("b47d"),s=n("353a"),l=n("ca00");function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,i){var l=a&&a.prototype instanceof s?a:s,c=Object.create(l.prototype);return u(c,"_invoke",function(n,a,r){var i,s,l,c=0,u=r||[],f=!1,d={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,l=e,d.n=n,o}};function h(n,a){for(s=n,l=a,t=0;!f&&c&&!r&&t<u.length;t++){var r,i=u[t],h=d.p,p=i[2];n>3?(r=p===a)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((r=n<2&&h<i[1])?(s=0,d.v=a,d.n=i[1]):h<p&&(r=n<3||i[0]>a||a>p)&&(i[4]=n,i[5]=a,d.n=p,s=0))}if(r||n>1)return o;throw f=!0,a}return function(r,u,p){if(c>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,p),s=u,l=p;(t=s<2?e:l)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,l)):d.n=l:d.v=l);try{if(c=2,i){if(s||(r="next"),t=i[r]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=e}else if((t=(f=d.n<0)?l:n.call(a,d))!==o)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:f}}}(n,r,i),!0),c}var o={};function s(){}function l(){}function f(){}t=Object.getPrototypeOf;var d=[][a]?t(t([][a]())):(u(t={},a,(function(){return this})),t),h=f.prototype=s.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,r,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=f,u(h,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,r,"GeneratorFunction"),u(h),u(h,r,"Generator"),u(h,a,(function(){return this})),u(h,"toString",(function(){return"[object Generator]"})),(c=function(){return{w:i,m:p}})()}function u(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}u=function(e,t,n,a){function i(t,n){u(e,t,(function(e){return this._invoke(t,n,e)}))}t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},u(e,t,n,a)}function f(e,t,n,a,r,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,r)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){f(i,a,r,o,s,"next",e)}function s(e){f(i,a,r,o,s,"throw",e)}o(void 0)}))}}var h={name:"TaskAttached",components:{DocPreviewModal:s["default"]},props:{files:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},workOrderId:{type:String,default:""},operator:{type:Number,default:0}},data:function(){return{curEditMode:1,curRow:null,previewFileName:"",validRules:{name:[{required:!0,message:"请选择文件",trigger:"manual"}]}}},methods:{getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||4===this.operator)},handleAdd:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:Object(l["p"])(),fileId:"",taskId:"",workOrderId:this.workOrderId,name:"",type:"",savepath:"",fileSize:""};this.selectTask?Object.assign(t,{taskId:this.selectTask.id,taskName:this.selectTask.taskName}):this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName,taskId:this.tasks[0].id}),this.$refs.listTable.insertAt(t,-1).then((function(t){var n=t.row;e.$refs.listTable.setActiveCell(n,"name")}))}},handleDel:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){var t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var n=Promise.resolve();t.map((function(t){n.then((function(){return Object(i["a"])(t.savepath).then((function(n){if(n.success){if(Object(l["e"])(t.id))return e.files.splice(e.files.findIndex((function(e){return e.savepath===t.savepath})),1);var a=new FormData;return a.append("ids",t.id),Object(o["A"])(a).then((function(n){n.success?(e.files.splice(e.files.findIndex((function(e){return e.savepath===t.savepath})),1),e.$emit("removeFile",t)):e.$message.error("文件删除失败")}))}return e.$message.error("文件删除失败")}))}))}))}}):this.$message.error("尚未选中任何数据!")}},handleDownload:function(){var e=d(c().m((function e(t){return c().w((function(e){while(1)switch(e.n){case 0:Object(i["b"])(t.savepath);case 1:return e.a(2)}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.files.map((function(n,a){e.id===n.id&&t.files.splice(a,1)}))},beforeLedUpload:function(e){var t=this;if(e.size/1024/1024>10)return this.$message.error("文件不得大于10MB!"),!1;var n=/([^\\/]+)\.([^\\/]+)/i;n.test(e.name);var a=RegExp.$1,r=RegExp.$2,o=new FormData,s=new File([e],"".concat(a).concat(this.$moment().format("YYYYMMDDhhmmss"),".").concat(r),{type:e.type});o.append("file",s);var l=this.$message.loading("文件上传中···",0);return Object(i["d"])(o,"/WorkOrder").then((function(n){t.$refs.listTable.getActiveRecord().row.name=a,t.$refs.listTable.getActiveRecord().row.type=r,t.$refs.listTable.getActiveRecord().row.savepath=n.result,t.$refs.listTable.getActiveRecord().row.fileSize=(e.size/1024).toFixed(0),l()})).catch((function(e){t.$message.error("文件上传失败，请联系管理员"),l()})),!1},previewImage:function(e){return this.previewFileName=e.name,this.$refs.docPreview.handleFilePath(e.savepath),!1},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=e?this.tasks[t.key].taskName:""},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(n){if(n)for(var a in n){var r=n[a];r.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else t.files.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0,t.$emit("addFile",e)}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),this.$refs.listTable.remove(e),this.curEditMode=0},getTaskName:function(e){return this.selectTask?this.selectTask.taskName:this.tasks.find((function(t){return t.id===e.taskId}))?this.tasks.find((function(t){return t.id===e.taskId})).taskName:""},clearValidate:function(){this.$refs.listTable.clearValidate()}}},p=h,v=(n("53e7"),n("2877")),m=Object(v["a"])(p,a,r,!1,null,null,null);t["default"]=m.exports},9216:function(e,t,n){"use strict";n("260f")},d5c3:function(e,t,n){}}]);