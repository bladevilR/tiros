(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fa5babd2","chunk-2c88bf26","chunk-3ed937ef"],{"39ff7":function(t,e,a){},4501:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"作业指导书",width:"100%",dialogClass:"fullDialog no-footer",visible:t.visible,footer:null},on:{cancel:t.handleCancel}},[e("div",{staticClass:"sop-body"},[e("div",{staticStyle:{display:"flex","align-content":"center","flex-wrap":"wrap"}},[t.loading?e("a-spin",{attrs:{tip:"下载中..."}}):t._e()],1),t.loading?t._e():e("div",{ref:"mainDom",staticClass:"sop-body-page"})])])},o=[],s=a("8fad"),n={name:"WorkSopView",components:{},data:function(){return{visible:!1,tableData:[],queryParam:{bookId:""},loading:!1}},created:function(){},methods:{findList:function(){},handleCancel:function(){this.visible=!1},showBook:function(t){var e=this;this.visible=!0,this.loading=!0,Object(s["ac"])({bookId:t}).then((function(t){if(t.success){var a=[];t.result.forEach((function(t){a.push(Object(s["bc"])({detailId:t.id}).then((function(t){if(t.success){var a=JSON.parse(JSON.stringify(t.result));return a}return e.$message.error(t.message),null})))})),Promise.all(a).then((function(t){t.sort((function(t,e){return t.stepNum-e.stepNum}));var a="";t.forEach((function(t){t&&(a+="<h2>".concat(t.stepNum,'<span style="margin-left:15px;margin-top: 24px;">').concat(t.stepTitle,"</span></h2>"),a+=t.stepContent||"")})),e.loading=!1,e.$nextTick.call(e,(function(){e.$refs.mainDom.innerHTML=a}))}))}}))},showSopDetail:function(t){var e=this;this.visible=!0;var a=[];t.forEach((function(t){a.push(Object(s["bc"])({detailId:t}).then((function(t){return t.success?t.result:""})))})),Promise.all(a).then((function(t){var a="";t.forEach((function(t){a+="<h2>".concat(t.stepNum,'<span style="margin-left:15px;">').concat(t.stepTitle,"</span></h2>"),a+=t.stepContent})),e.$refs.mainDom.innerHTML=a}))}}},l=n,r=(a("a9f9"),a("bca7"),a("2877")),c=Object(r["a"])(l,i,o,!1,null,"7e7655fc",null);e["default"]=c.exports},"61ca":function(t,e,a){"use strict";a("c35c")},"85df":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"90%",visible:t.visible,title:"作业指导步骤选择",centered:"",bodyStyle:{height:"80vh"},confirmLoading:t.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("na-splitter",{staticClass:"booksetp-body",staticStyle:{},attrs:{defaultSize:300}},[e("div",{staticStyle:{"overflow-y":"auto","overflow-x":"hidden","padding-right":"2px",height:"100%"},attrs:{slot:"left-panel"},slot:"left-panel"},[e("a-card",{attrs:{id:"bookStepsContent",height:"100%"}},[e("div",{staticClass:"typeTitle"},[t._v("作业指导书")]),e("a-input-search",{staticStyle:{margin:"8px 0",width:"90%"},attrs:{placeholder:"输入名称"},model:{value:t.serchValue,callback:function(e){t.serchValue=e},expression:"serchValue"}}),e("div",{staticStyle:{width:"70%",margin:"0 auto","min-height":"100%"}},[e("a-tree",{attrs:{showLine:"",selectedKeys:t.selectedKeys,"tree-data":t.showTreeData,replaceFields:{title:"fileName",key:"id"}},on:{select:t.onSelect}})],1)],1)],1),e("div",{staticStyle:{"padding-left":"5px","padding-right":"3px"},attrs:{slot:"right-panel"},slot:"right-panel"},[e("div",{staticStyle:{height:"100%"}},[e("vxe-table",{ref:"listTable",staticStyle:{},attrs:{border:"","row-id":"id",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","radio-config":{trigger:"row"},"checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"stepNum",title:"步骤",width:"120px"}}),e("vxe-table-column",{attrs:{field:"stepTitle",title:"标题",align:"left","header-align":"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.stepTitle)+" ")]}}])})],1)],1)])])],1)},o=[],s=a("8fad"),n={name:"SopDetailList",props:{multiple:{type:Boolean,default:!0},id:{type:String,default:""}},data:function(){return{fileType:[],queryParam:{bookId:""},allAlign:"center",totalResult:0,treeKey:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[],showTreeData:[],serchValue:"",selectedKeys:[]}},watch:{serchValue:function(){var t=this;this.showTreeData=this.treeData.map((function(e){return e.fileName.indexOf(t.serchValue)>-1?e:null})).filter((function(t){return t}))}},methods:{selectTree:function(){var t=this;Object(s["cc"])({pageNo:1,pageSize:1e3,searchText:""}).then((function(e){e.success&&(t.treeData=e.result.records,t.showTreeData=e.result.records,t.treeData.length>0&&(t.queryParam.bookId=t.treeData[0].id,t.selectedKeys[0]=t.treeData[0].id,t.selectData=t.treeData[0],t.findList()))}))},showModal:function(){this.visible=!0,this.selectTree()},onSelect:function(t,e){if(t.length){var a=e.node.dataRef;this.queryParam.bookId=a.id,this.selectedKeys[0]=a.id,this.selectData=a,this.findList()}},findList:function(){var t=this;Object(s["ac"])(this.queryParam).then((function(e){t.tableData=e.result}))},handleOk:function(){var t=this,e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),Array.from(e,(function(e){e.bookName=t.selectData.fileName})),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=n,r=(a("61ca"),a("2877")),c=Object(r["a"])(l,i,o,!1,null,null,null);e["default"]=c.exports},a9f9:function(t,e,a){"use strict";a("d392")},bca7:function(t,e,a){"use strict";a("39ff7")},c35c:function(t,e,a){},d392:function(t,e,a){},f795:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?t._e():e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:t.taskBookSteps,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{width:"60"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[e("a",{on:{click:function(e){return e.stopPropagation(),t.showSopDeatil(i)}}},[t._v(" 查看")])]}}])}),e("vxe-table-column",{attrs:{field:"bookStepNo",title:"步骤",width:"60px"}}),e("vxe-table-column",{attrs:{field:"bootStepTitle",title:"步骤标题","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"bookName",title:"所属作业指导书","max-width":"200"}})],1),e("SopDetailList",{ref:"modalForm",attrs:{multiple:!0},on:{ok:t.onSelectBookStep}}),e("WorkSopView",{ref:"workSopViewModal"})],1)},o=[],s=a("85df"),n=a("4501"),l=(a("ca00"),{name:"TaskBookSteps",components:{SopDetailList:s["default"],WorkSopView:n["default"]},props:{taskBookSteps:{type:Array,default:[]},taskId:{type:String,default:""},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,validRules:{}}},methods:{handleAdd:function(){this.$refs.modalForm.showModal()},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){e.map((function(e){t.taskBookSteps.map((function(a,i){e.id===a.id&&t.taskBookSteps.splice(i,1)}))}))}})},editRowEvent:function(t){this.curEditMode=2,this.$refs.listTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.taskBookSteps.map((function(a,i){t.id===a.id&&e.taskBookSteps.splice(i,1)}))},saveRowEvent:function(t){var e=this;this.$refs.listTable.validate(t,(function(a){if(a)for(var i in a){var o=a[i];o.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 1===e.curEditMode&&e.taskBookSteps.push(t),e.$refs.listTable.clearActived(),e.curEditMode=0}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},openBookStepSelectModal:function(t){this.curRow=t,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur()},onSelectBookStep:function(t){var e=this;t.forEach((function(t){e.taskBookSteps.find((function(e){return e.bookDetailId===t.id}))?e.$message.error("".concat(t.stepTitle,"步骤已经添加了")):e.taskBookSteps.push({bookDetailId:t.id,bookStepNo:t.stepNum,bootStepContent:t.stepContent,bootStepTitle:t.stepTitle,bookName:t.bookName,id:null,taskId:e.taskId,techBookId:t.bookId})})),this.$emit("update:taskBookSteps",this.taskBookSteps)},showSopDeatil:function(t){this.$refs.workSopViewModal.showSopDetail([t.bookDetailId])}}}),r=l,c=a("2877"),d=Object(c["a"])(r,i,o,!1,null,null,null);e["default"]=d.exports}}]);