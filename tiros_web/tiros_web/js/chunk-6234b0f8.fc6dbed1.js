(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6234b0f8","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7","chunk-2d0c89b7"],{"43f7":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"v",(function(){return l})),n.d(t,"e",(function(){return r})),n.d(t,"q",(function(){return s})),n.d(t,"m",(function(){return u})),n.d(t,"d",(function(){return m})),n.d(t,"t",(function(){return y})),n.d(t,"r",(function(){return d})),n.d(t,"p",(function(){return c})),n.d(t,"u",(function(){return f})),n.d(t,"o",(function(){return g})),n.d(t,"b",(function(){return p})),n.d(t,"n",(function(){return C})),n.d(t,"s",(function(){return h})),n.d(t,"f",(function(){return v})),n.d(t,"h",(function(){return b})),n.d(t,"g",(function(){return I})),n.d(t,"l",(function(){return k})),n.d(t,"j",(function(){return x})),n.d(t,"i",(function(){return D})),n.d(t,"k",(function(){return w}));var a=n("0fea"),r=function(e){return Object(a["d"])("/report/excel/get",{tempCode:e})},i=function(e){return Object(a["d"])("/report/daily/get",e)},o=function(e){return Object(a["d"])("/report/daily/generate",e)},l=function(e){return Object(a["j"])("/report/daily/save",e)},s=function(e){return Object(a["d"])("/report/fault/count/trains",e)},u=function(e){return Object(a["d"])("/report/fault/count/systems",e)},c=function(e){return Object(a["d"])("/report/fault/detail/list",e)},d=function(e){return Object(a["d"])("/report/cost/detail/statistic-consume",e)},h=function(e){return Object(a["d"])("/report/cost/detail/statistic-must-random",e)},f=function(e){return Object(a["d"])("/report/turnover/detail/page",e)},g=function(e){return Object(a["d"])("/report/cost/kpi/page",e)},p=function(e,t){return Object(a["c"])("/report/cost/kpi/export",e,t)},m=function(e){return Object(a["d"])("/report/fault/train-count/sys",e)},y=function(e){return Object(a["d"])("/report/cost/train/statistic",e)},C=function(e){return Object(a["d"])("/report/cost/train/get-cars-number",e)},v=function(e){return Object(a["d"])("/produce/plan/summary/cost",e)},b=function(e){return Object(a["d"])("/produce/plan/summary/fault",e)},I=function(e){return Object(a["d"])("/produce/plan/summary/total",e)},k=function(e){return Object(a["d"])("/produce/plan/summary/work-time",e)},x=function(e){return Object(a["d"])("/produce/plan/summary/period",e)},D=function(e){return Object(a["d"])("/produce/plan/summary/outsource",e)},w=function(e){return Object(a["d"])("/produce/plan/summary/progress",e)}},5633:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e._self._c;return t("span",[t("a-select",{key:e.key,attrs:{"allow-clear":"",value:e.getValueSting,disabled:e.disabled,placeholder:"线路"},on:{change:e.handleChange,select:e.onSelect}},[t("a-select-option",{attrs:{value:void 0}},[e._v("请选择")]),e._l(e.optionData,(function(n,a){return t("a-select-option",{key:a,attrs:{value:n.lineId}},[t("span",{staticStyle:{display:"inline-block",width:"100%"},attrs:{title:n.lineName}},[e._v(" "+e._s(n.lineName)+" ")])])}))],2)],1)},r=[],i=n("8fad"),o={name:"LineSelectList",props:{value:[String],triggerChange:Boolean,disabled:Boolean,defaultFirst:Boolean},data:function(){return{optionData:[],selectValue:"",key:0}},created:function(){this.findList()},computed:{getValueSting:function(){return null!=this.value?this.value.toString():void 0}},methods:{findList:function(){var e=this;Object(i["Jb"])().then((function(t){t.success&&(e.optionData=t.result,e.defaultFirst&&e.optionData&&e.optionData.length>0&&setTimeout((function(){e.$emit("change",e.optionData[0].lineId),e.$emit("input",e.optionData[0].lineId)}),500))}))},handleChange:function(e,t){var n="";if(t&&t.componentOptions.children[0].data&&(n=t.componentOptions.children[0].data.attrs.title),this.$emit("change",e),this.$emit("input",e),this.$emit("changeName",n),this.triggerChange)if(e){var a=this.optionData[t.key];this.$emit("change",e,a)}else this.$emit("change",e,null)},onSelect:function(e,t){if(e){var n=this.optionData[t.data.key];this.$emit("select",e,n)}else this.$emit("select","",null)}}},l=o,s=n("2877"),u=Object(s["a"])(l,a,r,!1,null,"77265147",null);t["default"]=u.exports},e24e:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("e8ae"),r=n.n(a),i=n("21a6"),o=n.n(i),l=(n("7268"),"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"),s=function(e,t){var n=new r.a.Workbook;"[object Object]"===Object.prototype.toString.call(e)&&(e=[e]),e.forEach((function(e){if(0===e.data.length)return!0;var t=n.addWorksheet(e.name),a=e.config&&e.config.merge||{},r=e.config&&e.config.borderInfo||{},i=e.config&&e.config.columnlen||{},o=e.images||{};return d(o,n,t),c(i,t),u(e.config,t),g(e.data,t),h(a,t),f(r,t),!0}));var a=n.xlsx.writeBuffer().then((function(e){var n=new Blob([e],{type:l});o.a.saveAs(n,"".concat(t,".xlsx"))}));return a},u=function(e,t){if(e&&e.rowlen)for(var n in e.rowlen){var a=parseInt(n),r=parseInt(e.rowlen[n]),i=t.getRow(a+1);i.height=r}},c=function(e,t){for(var n in e){var a=parseInt(n),r=parseInt(e[n]);t.getColumn(a+1).width=parseInt(r/7)}},d=function(e,t,n){for(var a in e){var r=e[a],i=r.src.split(";base64,"),o=i[0].replaceAll("data:image/",""),l=t.addImage({base64:r.src,extension:o}),s=luckysheet.location(r.default.left,r.default.top);n.addImage(l,{tl:{col:s.col,row:s.row},ext:{width:r.default.width,height:r.default.height}})}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object.values(e);n.forEach((function(e){t.mergeCells(e.r+1,e.c+1,e.r+e.rs,e.c+e.cs)}))},f=function(e,t){Array.isArray(e)&&e.forEach((function(e){if("range"===e.rangeType)for(var n=C(e.borderType,e.style,e.color),a=e.range[0],r=a.row,i=a.column,o=r[0]+1;o<r[1]+2;o++)for(var l=i[0]+1;l<i[1]+2;l++)t.getCell(o,l).border=n;if("cell"===e.rangeType){var s=e.value,u=s.col_index,c=s.row_index,d=Object.assign({},e.value);delete d.col_index,delete d.row_index;var h=v(d,c,u);t.getCell(c+1,u+1).border=h}}))},g=function(e,t){Array.isArray(e)&&e.forEach((function(e,n){e.every((function(e,a){if(!e)return!0;var r=p(e.bg),i=m(e.ff,e.fc,e.bl,e.it,e.fs,e.cl,e.ul),o=y(e.vt,e.ht,e.tb,e.tr),l="";e.f?l={formula:e.f,result:e.v}:!e.v&&e.ct&&e.ct.s?e.ct.s.forEach((function(e){l+=e.v})):l=e.v;var s=b(a),u=t.getCell(s+(n+1));for(var c in r){u.fill=r;break}return u.font=i,u.alignment=o,u.value=l,!0}))}))},p=function(e){if(!e)return{};var t={type:"pattern",pattern:"solid",fgColor:{argb:e.replace("#","")}};return t},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l={0:"微软雅黑",1:"宋体（Song）",2:"黑体（ST Heiti）",3:"楷体（ST Kaiti）",4:"仿宋（ST FangSong）",5:"新宋体（ST Song）",6:"华文新魏",7:"华文行楷",8:"华文隶书",9:"Arial",10:"Times New Roman ",11:"Tahoma ",12:"Verdana",num2bl:function(e){return 0!==e}},s={name:"number"===typeof e?l[e]:e,family:1,size:r,color:{argb:t.replace("#","")},bold:l.num2bl(n),italic:l.num2bl(a),underline:l.num2bl(o),strike:l.num2bl(i)};return s},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",r={vertical:{0:"middle",1:"top",2:"bottom",default:"top"},horizontal:{0:"center",1:"left",2:"right",default:"left"},wrapText:{0:!1,1:!1,2:!0,default:!1},textRotation:{0:0,1:45,2:-45,3:"vertical",4:90,5:-90,default:0}},i={vertical:r.vertical[e],horizontal:r.horizontal[t],wrapText:r.wrapText[n],textRotation:r.textRotation[a]};return i},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#000";if(!e)return{};var a={type:{"border-all":"all","border-top":"top","border-right":"right","border-bottom":"bottom","border-left":"left"},style:{0:"none",1:"thin",2:"hair",3:"dotted",4:"dashDot",5:"dashDot",6:"dashDotDot",7:"double",8:"medium",9:"mediumDashed",10:"mediumDashDot",11:"mediumDashDotDot",12:"slantDashDot",13:"thick"}},r={style:a.style[t],color:{argb:n.replace("#","")}},i={};return"all"===a.type[e]?(i["top"]=r,i["right"]=r,i["bottom"]=r,i["left"]=r):i[a.type[e]]=r,i};function v(e,t,n){var a={},r={type:{l:"left",r:"right",b:"bottom",t:"top"},style:{0:"none",1:"thin",2:"hair",3:"dotted",4:"dashDot",5:"dashDot",6:"dashDotDot",7:"double",8:"medium",9:"mediumDashed",10:"mediumDashDot",11:"mediumDashDotDot",12:"slantDashDot",13:"thick"}};for(var i in e)-1===e[i].color.indexOf("rgb")?a[r.type[i]]={style:r.style[e[i].style],color:{argb:e[i].color.replace("#","")}}:a[r.type[i]]={style:r.style[e[i].style],color:{argb:e[i].color}};return a}function b(e){var t="A".charCodeAt(0),n="Z".charCodeAt(0),a=n-t+1,r="";while(e>=0)r=String.fromCharCode(e%a+t)+r,e=Math.floor(e/a)-1;return r}},fe3b:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bodyWrapper",staticStyle:{padding:"8px"}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.loadData.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"日期"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",allowClear:!1},model:{value:e.queryParam.day,callback:function(t){e.$set(e.queryParam,"day",t)},expression:"queryParam.day"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"线路"}},[t("line-select-list",{on:{change:e.onLineChange},model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"车辆"}},[t("j-dict-select-seach-tag",{attrs:{dictCode:e.dictTrainStr},on:{focus:e.handleSysFocus},model:{value:e.queryParam.trainNo,callback:function(t){e.$set(e.queryParam,"trainNo",t)},expression:"queryParam.trainNo"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-space",[t("a-button",{attrs:{loading:e.loading},on:{click:e.loadData}},[e._v("查询")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.createDailyReport}},[e._v("重新生成")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.saveDayReport}},[e._v("保存日报")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.downloadExcel}},[e._v("导出")])],1)],1)],1)],1)],1),e._m(0)])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-page-body"},[t("div",{staticStyle:{height:"calc(100% - 0px)",width:"100%"},attrs:{id:"luckysheet"}})])}],i=n("43f7"),o=(n("2410"),n("e24e")),l=n("5633"),s={name:"report_day",components:{LineSelectList:l["default"]},data:function(){var e=this;return{loading:!1,queryParam:{day:this.$moment(new Date).format("YYYY-MM-DD"),trainNo:"",depotId:this.$store.getters.userInfo.depotId,lineId:"",workshopId:this.$store.getters.userInfo.workshopId},dictTrainStr:"",dailyInfo:null,defaultOptions:{container:"luckysheet",title:"sheet",column:26,row:50,lang:"zh",allowEdit:!0,showinfobar:!1,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!0,hook:{workbookCreateAfter:function(t){e.dailyInfo&&!e.dailyInfo.reportContent&&(e.loadHeaderInfo(e.dailyInfo),e.loadCurDayTask(e.dailyInfo.workPlanList),e.loadNexDayTask(e.dailyInfo.nextWorkList),e.loadOutInfo(e.dailyInfo.outinList),e.loadDailyFault(e.dailyInfo.faultList))}}}}},watch:{"queryParam.lineId":{handler:function(e){this.onLineChange(e)},deep:!0}},created:function(){this.$set(this.queryParam,"lineId",this.$store.getters.userInfo.lineId)},beforeDestroy:function(){luckysheet.destroy()},methods:{handleSysFocus:function(){this.queryParam.lineId||this.$message.warn("请先选择线路!")},onLineChange:function(e,t){this.dictTrainStr="bu_train_info,train_no,train_no,status=1 and line_id='"+e+"'"},check:function(){return this.queryParam.day?this.queryParam.trainNo?!!this.queryParam.workshopId||(this.$message.warn("当前人员没有车间"),!1):(this.$message.warn("请选择日报所属车辆"),!1):(this.$message.warn("请选择日报日期"),!1)},createDailyReport:function(){var e=this;this.check()&&(this.loading=!0,Object(i["a"])(this.queryParam).then((function(t){if(t.success){var n=t.result;e.inti_dayReport(n)}else e.$message.error("生成日报错误：",t.message)})))},loadData:function(){var e=this;this.check()&&(this.dailyInfo=null,this.loading=!0,Object(i["c"])(this.queryParam).then((function(t){if(t.success){var n=t.result;e.inti_dayReport(n)}else e.loading=!1,e.$message.error("查询日报错误：",t.message),e.dailyInfo=null})))},inti_dayReport:function(e){var t=this;if(this.dailyInfo=e,null!=this.dailyInfo.reportContent&&void 0!=this.dailyInfo.reportContent&&""!=this.dailyInfo.reportContent){var n=JSON.parse(this.dailyInfo.reportContent);this.init_sheet(n)}else Object(i["e"])("day_report").then((function(e){if(e.success)if(e.result&&e.result.tempContent){var n=JSON.parse(e.result.tempContent);t.init_sheet(n)}else t.$message.error("报表模板内容为空，请定义模板");else t.$message.error("报表模板查询失败：",e.message),t.dailyInfo=null}))},init_sheet:function(e){var t=Object.assign({},this.defaultOptions);t.data=[e],luckysheet.destroy(),luckysheet.create(t),this.loading=!1,luckysheet.setRangeShow("A1",{show:!1})},saveDayReport:function(){var e=this;if(this.dailyInfo){var t=Object.assign({},this.dailyInfo);t.userName||(t.userName=this.$store.getters.userInfo.realname),t.reportContent=JSON.stringify(luckysheet.getAllSheets()[0]),Object(i["v"])(t).then((function(t){t.success?e.$message.success("保存成功"):e.$message.error("保存失败")}))}else this.$message.warn("当前没有要保存的日报信息")},getCharIndex:function(e){var t=0;if(e.length<2&&(t=e.charCodeAt()-65),2===e.length){var n=e[0],a=e[1],r=n.charCodeAt()-65;r=25*(r+1),t=r+a.charCodeAt()-64}return t},loadHeaderInfo:function(e){this.setCellValue(0,this.getCharIndex("A"),e.title);var t=3;this.setCellValue(t,this.getCharIndex("C"),e.period),this.setCellValue(t,this.getCharIndex("F"),"日期："+e.reportDate),this.setCellValue(t,this.getCharIndex("G"),"作业天数："+e.dayIndex),this.setCellValue(t,this.getCharIndex("K"),e.trainNo),this.setCellValue(t,this.getCharIndex("O"),e.mileage+"km"),this.setCellValue(t,this.getCharIndex("U"),e.workshop),this.setCellValue(t,this.getCharIndex("AA"),e.userName),this.setCellValue(32,this.getCharIndex("B"),e.toolFault),this.setCellValue(32,this.getCharIndex("R"),e.assetFault)},loadCurDayTask:function(e){if(e)for(var t=5,n=9,a=e.length,r=0;r<n;r++){var i={actContent:"",finished:!1,finished_dictText:"",group:"",id:"",peoples:0,planContent:"",remark:"",reportId:"",workTime:0};r<a&&(i=e[r]),this.setCellValue(t,this.getCharIndex("C"),i.groupName),this.setCellValue(t,this.getCharIndex("F"),i.planContent||"无"),this.setCellValue(t,this.getCharIndex("I"),i.actContent||"无"),this.setCellValue(t,this.getCharIndex("P"),i.finished_dictText),this.setCellValue(t,this.getCharIndex("T"),i.peoples>0?i.peoples+"人/"+i.workTime+"小时":""),this.setCellValue(t,this.getCharIndex("X"),i.remark||"-"),t+=1}},setCellValue:function(e,t,n){luckysheet.setCellValue(e,t,n,{success:function(){}})},loadNexDayTask:function(e){for(var t=15,n=9,a=e.length,r=0;r<n;r++){var i={group:"",id:"",remark:"",reportId:"",tempWork:"",trackContent:"",workContent:""};r<a&&(i=e[r]),this.setCellValue(t,this.getCharIndex("C"),i.groupName),this.setCellValue(t,this.getCharIndex("F"),i.workContent),this.setCellValue(t,this.getCharIndex("M"),i.trackContent+"\n"+i.tempWork),this.setCellValue(t,this.getCharIndex("X"),i.remark),t+=1}},loadOutInfo:function(e){for(var t=25,n=8,a=e.length,r=0;r<n;r++){var i={assetTypeId:"",assetTypeName:"",id:"",receiveDesc:"",reportId:"",sendDesc:""};r<a&&(i=e[r]),4==r&&(t=25),r<4?(this.setCellValue(t,this.getCharIndex("C"),i.assetTypeName),this.setCellValue(t,this.getCharIndex("F"),i.sendDesc),this.setCellValue(t,this.getCharIndex("K"),i.receiveDesc)):(this.setCellValue(t,this.getCharIndex("P"),i.assetTypeName),this.setCellValue(t,this.getCharIndex("U"),i.sendDesc),this.setCellValue(t,this.getCharIndex("Z"),i.receiveDesc)),t+=1}},loadDailyFault:function(e){for(var t=30,n=4,a=e.length-1,r=0;r<n;r++){var i={dutyEngineer:"",faultDesc:"",faultTime:"",handleDesc:"",id:"",isHandle:0,remark:"",reportId:"",reportUser:""};r<=a&&(i=e[r]),this.setCellValue(t,this.getCharIndex("B"),r+1),this.setCellValue(t,this.getCharIndex("C"),i.faultTime),this.setCellValue(t,this.getCharIndex("E"),i.reportUser),this.setCellValue(t,this.getCharIndex("G"),i.faultDesc),i.reportUser?this.setCellValue(t,this.getCharIndex("P"),0==i.isHandle?"否":"是"):this.setCellValue(t,this.getCharIndex("P"),""),this.setCellValue(t,this.getCharIndex("R"),i.dutyEngineer),this.setCellValue(t,this.getCharIndex("T"),i.handleDesc),this.setCellValue(t,this.getCharIndex("Z"),i.remark),t+=1}},downloadExcel:function(){Object(o["a"])(luckysheet.getAllSheets(),this.queryParam.day+"  "+this.queryParam.trainNo+" 生产日报")},setSelectValue:function(){var e=luckysheet.getRange();if(e&&e.length>0){e[0].row[0],e[0].column[0];luckysheet.setCellValue(5,5,"插入",{success:function(){}})}}}},u=s,c=n("2877"),d=Object(c["a"])(u,a,r,!1,null,"4d06ae24",null);t["default"]=d.exports}}]);