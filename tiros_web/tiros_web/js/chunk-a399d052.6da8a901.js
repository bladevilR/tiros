(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a399d052","chunk-09589ce3","chunk-5db6ff55"],{"5bbd":function(e,t,a){},"7ba1":function(e,t,a){"use strict";a("5bbd")},"7c1d":function(e,t,a){},"7dfc":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"".concat(e.queryParam.id?"编辑":"新增").concat(e.title),width:"100%",dialogClass:"fullDialog",visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"bodyWrapper",staticStyle:{height:"100% !important"}},[t("a-spin",{staticClass:"full-srceen",staticStyle:{padding:"0 12px",height:"100% !important"},attrs:{spinning:e.confirmLoading}},[t("NaCardContent",{attrs:{title:"基本信息"}},[t("a-form",{attrs:{form:e.form,layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{staticStyle:{width:"100%"},attrs:{label:"步骤",labelCol:{span:6},wrapperCol:{span:18}}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["stepNum",e.validatorRules.stepNum],expression:"['stepNum', validatorRules.stepNum]"}],staticStyle:{width:"100%"},attrs:{max:999999999,placeholder:"请输入步骤"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{staticStyle:{width:"100%"},attrs:{label:"步骤标题",labelCol:{span:6},wrapperCol:{span:18}}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["stepTitle",e.validatorRules.stepTitle],expression:"['stepTitle', validatorRules.stepTitle]"}],staticStyle:{width:"100%"},attrs:{maxLength:65,placeholder:"请输入内容"}})],1)],1)],1)],1)],1),t("NaCardContent",{attrs:{title:"步骤明细",height:"100%"}},[t("a-tabs",{attrs:{forceRender:!0},on:{tabClick:e.onTabClick,change:e.tabChangeEvent},scopedSlots:e._u([{key:"tabBarExtraContent",fn:function(){return[t("a-space",[1!==e.activeKey?t("a-button",{attrs:{type:"primary",disabled:e.isSaveData},on:{click:e.openFormModal}},[e._v("新增")]):e._e(),1!==e.activeKey?t("a-button",{attrs:{type:"dashed",disabled:!(e.isCheckRows&&!e.isSaveData)},on:{click:e.handleDel}},[e._v("删除")]):e._e(),e.isSaveData&&1!==e.activeKey?t("a-button",{attrs:{type:"primary"},on:{click:e.saveRowData}},[e._v("保存")]):e._e(),e.isSaveData&&1!==e.activeKey?t("a-button",{on:{click:e.cencelRowData}},[e._v("取消")]):e._e()],1)]},proxy:!0}]),model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}},[t("a-tab-pane",{key:1,attrs:{tab:"步骤内容"}},[e.isShowEditor?t("j-editor",{attrs:{triggerChange:""},on:{change:e.onEditor},model:{value:e.queryParam.stepContent,callback:function(t){e.$set(e.queryParam,"stepContent",t)},expression:"queryParam.stepContent"}}):e._e()],1),t("a-tab-pane",{key:2,attrs:{tab:"额定物料"}},[t("div",{staticStyle:{height:"calc(100vh - 334px)"}},[t("vxe-table",{ref:"materialListTable",attrs:{border:"",align:"center",height:"auto",data:e.queryParam.materialList,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"checkbox-change":e.rangeChange,"checkbox-all":e.rangeChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"60px"}}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称"}}),t("vxe-table-column",{attrs:{field:"category2_dictText",title:"物料分类"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码"}}),t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.materialListTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowData()}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cencelRowData()}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!1,size:"small"},on:{click:function(t){return t.stopPropagation(),e.handleEdit(r)}}},[e._v("编辑")])]]}}])})],1)],1)]),t("a-tab-pane",{key:3,attrs:{tab:"所需工具"}},[t("div",{staticStyle:{height:"calc(100vh - 334px)"}},[t("vxe-table",{ref:"toolListTable",attrs:{border:"",align:"center",height:"auto",data:e.queryParam.toolList,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"checkbox-change":e.rangeChange,"checkbox-all":e.rangeChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"60px"}}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称"}}),t("vxe-table-column",{attrs:{field:"kind_dictText",title:"工器具分类"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码"}}),t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.toolListTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowData()}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cencelRowData()}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!1,size:"small"},on:{click:function(t){return t.stopPropagation(),e.handleEdit(r)}}},[e._v("编辑")])]]}}])})],1)],1)])],1)],1)],1)],1),t("material-list",{ref:"materialModal",attrs:{multiple:!0},on:{ok:e.onSelectMaterial}}),t("ToolsList",{ref:"toolsModal",attrs:{batch:"",multiple:!0,canSelectType:[4,5]},on:{ok:e.onSelectTool}})],1)},i=[],n=a("d4ee"),s=a("7164"),o=a("5633"),l=a("a4db"),c=a("8fad"),u=a("a061"),d=a("ca00"),h={name:"WorkSopDetailModal",components:{LineSelectList:o["default"],JEditor:u["default"],NaCardContent:n["default"],MaterialList:s["default"],ToolsList:l["default"]},data:function(){return{isCheckRow:!1,isCheckRows:!1,isSaveData:!1,isShowEditor:!0,value:1,title:"步骤",visible:!1,activeKey:1,contentStr:"",model:{},curRow:null,confirmLoading:!1,form:this.$form.createForm(this),validRules:{amount:[{required:!0,message:"数量必须填写"}]},validatorRules:{stepNum:{rules:[{required:!0,message:"请输入步骤"}]},stepTitle:{rules:[{required:!0,message:"请输入标题"},{max:64,message:"不能超过64个字符"}]}},queryParam:{bookId:null,stepNum:null,stepTitle:null,stepContent:null,materialList:[],toolList:[]},historyActiveKey:null,maxNumber:-1}},computed:{activeTableRef:function(){return 3===this.activeKey?this.$refs.toolListTable:this.$refs.materialListTable}},created:function(){},methods:{add:function(e,t){this.queryParam.bookId=e,this.maxNumber=t,this.edit({})},edit:function(e){var t=this;this.confirmLoading=!1,this.visible=!0,this.activeKey=1,this.isSaveData=!1,e.id?Object(c["Nb"])({detailId:e.id}).then((function(a){a.success?e=Object.assign(t.queryParam,JSON.parse(JSON.stringify(a.result))):(t.$message.error(a.message),t.visible=!1)})):(this.queryParam.id=null,this.queryParam.stepNum=null,this.queryParam.stepTitle=null,this.queryParam.stepContent=null,this.queryParam.materialList=[],this.queryParam.toolList=[],this.maxNumber>0&&(this.queryParam.stepNum=this.maxNumber),e=JSON.parse(JSON.stringify(this.queryParam))),this.form.resetFields(),this.model=JSON.parse(JSON.stringify(e)),this.visible=!0,this.$nextTick((function(){t.isShowEditor=!0,t.form.setFieldsValue({stepNum:e.stepNum,stepTitle:e.stepTitle})})),this.queryParam.stepNum=-1},handleOk:function(){this.save()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.isShowEditor=!1,this.visible=!1},save:function(){var e=this;this.confirmLoading=!0,this.form.validateFields((function(t,a){t?e.confirmLoading=!1:(Object.assign(e.queryParam,a),Object(c["Qc"])(e.queryParam).then((function(t){t.success?(e.$message.success("保存成功"),e.isShowEditor=!1,e.$emit("ok",e.queryParam.bookId),e.visible=!1):e.$message.error(t.message)})).finally((function(){e.confirmLoading=!1})))}))},saveRowData:function(){var e=this,t=this.activeTableRef.getActiveRecord();t&&(this.activeTableRef.validate(t.row,(function(a){if(a)for(var r in a){var i=a[r];i.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 2===e.activeKey?e.queryParam.materialList.find((function(e){return e===t.row}))||(t.row.id=Object(d["p"])(),e.queryParam.materialList.push(Object.assign({},t.row))):e.queryParam.toolList.find((function(e){return e===t.row}))||(t.row.id=Object(d["p"])(),e.queryParam.toolList.push(Object.assign({},t.row))),e.isSaveData=!1,e.activeTableRef.clearActived()})),this.rangeChange())},cencelRowData:function(){var e=this.activeTableRef.getActiveRecord();e&&(e.row.id?this.activeTableRef.revertData(e.row):this.activeTableRef.remove(e.row)),this.activeTableRef.clearActived(),this.isSaveData=!1},handleEdit:function(e){this.activeTableRef.setActiveRow(e),this.isSaveData=!0},handleDel:function(){var e=this,t=this.activeTableRef.getCheckboxRecords();this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.forEach((function(t){2===e.activeKey?e.queryParam.materialList.splice(e.queryParam.materialList.findIndex((function(e){return e===t})),1):3===e.activeKey&&e.queryParam.toolList.splice(e.queryParam.toolList.findIndex((function(e){return e===t})),1),e.isCheckRow=!1,e.isCheckRows=!1}))}})},openFormModal:function(){switch(this.activeKey){case 2:this.$refs.materialModal.showModal();break;case 3:this.$refs.toolsModal.showModal();break}},onEditor:function(e){this.queryParam.stepContent=e},onSelectMaterial:function(e){var t=this;e.forEach((function(e){if(t.queryParam.materialList.find((function(t){return t.materialTypeId===e.id})))t.$message.warn("".concat(e.name,"物料已经存在列表中"));else{var a={amount:Number(e.num),bookDetailId:t.queryParam.id,category1:e.category1,category1_dictText:e.category1_dictText,category2:e.category2,category2_dictText:e.category2_dictText,code:e.code,id:"",kind:e.kind,materialTypeId:e.id,name:e.name,price:e.price,spec:e.spec,unit:e.unit};t.queryParam.materialList.push(a)}}))},onSelectTool:function(e){var t=this;e.forEach((function(e){if(t.queryParam.toolList.find((function(t){return t.toolTypeId===e.id})))t.$message.warn("".concat(e.name,"工器具已经存在列表中"));else{var a={amount:Number(e.num),bookDetailId:t.queryParam.id,kind_dictText:e.kind_dictText,code:e.code,id:"",toolTypeId:e.id,unit:e.unit,name:e.name,status_dictText:e.status_dictText};t.queryParam.toolList.push(a)}}))},rangeChange:function(){var e=this.activeTableRef.getCheckboxRecords();this.isCheckRow=1===e.length,this.isCheckRows=e.length>0},testEvent:function(e){return e.preventDefault(),!1},onTabClick:function(){if(this.activeTableRef&&this.activeTableRef.getActiveRecord())return this.historyActiveKey=this.activeKey,void this.$message.warn("有未保存数据");this.historyActiveKey=null},tabChangeEvent:function(){this.historyActiveKey&&(this.activeKey=this.historyActiveKey),this.isShowEditor=1===this.activeKey}}},m=h,f=a("2877"),p=Object(f["a"])(m,r,i,!1,null,null,null);t["default"]=p.exports},9527:function(e,t,a){},"9d91":function(e,t,a){"use strict";a("7c1d")},a4db:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:e.title,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"搜索"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"分类"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_tools_type",disabledArray:e.canSelectType},model:{value:e.queryParam.category1,callback:function(t){e.$set(e.queryParam,"category1",t)},expression:"queryParam.category1"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":e.onCellClick}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别",width:"150"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"150"}}),e.batch?t("vxe-table-column",{attrs:{field:"num",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}):e._e()],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},i=[],n=a("c54ca"),s={name:"ToolTypeSelect",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:function(){return[4,5,6]}},batch:{type:Boolean,default:!1}},data:function(){return{title:"工器具类型选择",queryParam:{type:"2",searchText:"",category1:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.category1=this.canSelectType[0]),this.findList()},findList:function(){var e=this;this.loading=!0,Object(n["Cb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"num",1)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},checkRadioMethod:function(e){var t=e.row;return!this.canSelectType||-1!==this.canSelectType.indexOf(t.category1)},onCellClick:function(e){var t=e.row,a=e.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([t],!0)}}},o=s,l=(a("7ba1"),a("2877")),c=Object(l["a"])(o,r,i,!1,null,"df2d4508",null);t["default"]=c.exports},a74a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"".concat(e.title),width:"100%",dialogClass:"fullDialog",visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.save,cancel:e.handleCancel}},[t("a-spin",{staticClass:"full-srceen",attrs:{spinning:e.confirmLoading}},[t("NaCardContent",{staticClass:"table-page-search-wrapper",staticStyle:{"padding-bottom":"0",background:"transparent"},attrs:{title:"基本信息"}},[t("a-form",{attrs:{form:e.form,layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"借用类型",labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["borrowType",e.validatorRules.borrowType],expression:"['borrowType', validatorRules.borrowType]",modifiers:{trim:!0}}],attrs:{dictCode:"bu_borrow_type"},on:{input:e.onBorrowTypeChange}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"借用组织",labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[1==e.queryParam.borrowType?t("j-select-depart",{directives:[{name:"decorator",rawName:"v-decorator",value:["borrowDep",e.validatorRules.borrowDep],expression:"['borrowDep', validatorRules.borrowDep]"}],attrs:{rootOpened:!1}}):t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["borrowDep",e.validatorRules.borrowDep],expression:"['borrowDep', validatorRules.borrowDep]"}],attrs:{placeholder:"借用部门或厂家"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"借用人员",labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["borrowUser",e.validatorRules.borrowUser],expression:"['borrowUser', validatorRules.borrowUser]"}],attrs:{placeholder:"借用人员"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"归还类型",labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["returnType",e.validatorRules.returnType],expression:"['returnType', validatorRules.returnType]"}],attrs:{dictCode:"bu_material_return_type"},on:{input:e.onReturnTypeChange}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"借用日期",labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["pickDate",e.validatorRules.pickDate],expression:"['pickDate', validatorRules.pickDate]"}],staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},on:{change:e.dateChange}})],1)],1),t("a-col",{attrs:{md:8,sm:24,labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[t("a-form-item",{attrs:{label:"二级库"}},[t("j-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["warehouseId",e.validatorRules.warehouseId],expression:"['warehouseId', validatorRules.warehouseId]"}],attrs:{placeholder:"请选择",dict:"bu_mtr_warehouse,name,id",pidField:"parent_id"},on:{change:e.handleWarehouseChange}})],1)],1),t("a-col",{attrs:{md:8,sm:24,labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[t("a-form-item",{attrs:{label:"归还状态"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["returnStatus",e.validatorRules.returnStatus],expression:"['returnStatus', validatorRules.returnStatus]"}],attrs:{dictCode:e.dictReturnStatusStr},on:{input:e.onReturnStatusChange}})],1)],1),t("a-col",{attrs:{md:16,sm:24,labelCol:e.labelCol1,wrapperCol:e.wrapperCol1}},[t("a-form-item",{attrs:{label:"备注说明"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark",e.validatorRules.remark],expression:"['remark', validatorRules.remark]"}],attrs:{maxLength:201,placeholder:"请输入内容"}})],1)],1)],1)],1)],1),t("BorrowDetail",{ref:"borrowDetailRef",attrs:{tableData:e.queryParam.borrowDetailList,borrowInfo:e.queryParam}}),t("user-list",{ref:"userSelectModal",attrs:{multiple:!1},on:{ok:e.onSelectUser}})],1)],1)},i=[],n=a("d4ee"),s=a("b245"),o=a("5633"),l=a("c54ca"),c=a("ca00"),u=a("c1fa"),d=a("b098"),h=(a("4ec3"),a("fe54")),m={name:"BorrowModal",components:{LineSelectList:o["default"],NaCardContent:n["default"],BorrowDetail:u["default"],JTreeSelect:d["default"],JSelectDepart:h["default"],UserList:s["default"]},data:function(){return{value:1,title:"借用",visible:!1,dictReturnStatusStr:"bu_material_borrow_return_status",model:{},labelCol1:{xs:{span:24},sm:{span:8}},wrapperCol1:{xs:{span:24},sm:{span:16}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{borrowDep:{rules:[{required:!0,message:"请选择组织!"},{max:32,message:"输入长度不能超过32字符!"}]},borrowUser:{rules:[{required:!0,message:"请选择借用人员!"},{max:32,message:"输入长度不能超过32字符!"}]},borrowType:{rules:[{required:!0,message:"请选择借用类型!"}]},returnType:{rules:[{required:!0,message:"请选择归还类型!"}]},pickDate:{rules:[{required:!0,message:"请选择日期!"}]},returnStatus:{rules:[{required:!0,message:"请选择归还状态!"}]},warehouseId:{rules:[{required:!0,message:"请选择仓库!"}]},remark:{rules:[{required:!1,max:255,message:"输入长度不能超过255字符!"}]}},userList:[],pickDate:this.$moment(new Date),queryParam:{borrowDate:this.$moment(new Date).format("YYYY-MM-DD"),borrowDep:null,borrowType:null,returnStatus:null,returnType:null,billCode:null,borrowDetailList:[],borrowUser:null,borrowUserName:null,deptName:null,id:null,remark:null,warehouseName:null,warehouseId:null}}},created:function(){},methods:{add:function(){this.edit({})},edit:function(e){var t=this;this.visible=!0,this.$nextTick((function(){t.$refs.borrowDetailRef.initStatus()})),e.id?(e=Object.assign(this.queryParam,e),this.pickDate=this.$moment(e.borrowDate),1==e.returnType?this.dictReturnStatusStr="bu_material_borrow_return_status":2==e.returnType&&(this.dictReturnStatusStr="bu_material_transfers_status")):(this.pickDate=this.$moment(new Date),this.queryParam.borrowDep=null,this.queryParam.borrowType=null,this.queryParam.returnStatus=null,this.queryParam.returnType=null,this.queryParam.warehouseId=null,this.queryParam.billCode=null,this.queryParam.borrowDetailList=[],this.queryParam.borrowUser=null,this.queryParam.borrowUserName=null,this.queryParam.deptName=null,this.queryParam.id=null,this.queryParam.remark=null,this.queryParam.warehouseName=null,this.queryParam.warehouseId=null,e=Object.assign({},this.queryParam)),this.form.resetFields(),this.model=Object.assign({},e),this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue({pickDate:t.pickDate,borrowDep:e.borrowDep,borrowUser:e.borrowUser,borrowType:e.borrowType,returnStatus:e.returnStatus,returnType:e.returnType,borrowDate:e.borrowDate,warehouseId:e.warehouseId,remark:e.remark})})),this.updateDetail()},handleOk:function(){this.save()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},dateChange:function(e){this.pickDate=e,this.queryParam.borrowDate=this.$moment(this.pickDate).format("YYYY-MM-DD")},save:function(){var e=this;this.$refs.borrowDetailRef.isSaveData?this.$message.warn("请先保存明细内容"):this.form.validateFields((function(t,a){if(!t){if(0===e.queryParam.borrowDetailList.length)return void e.$message.warn("至少需要一条借用明细");Object.assign(e.queryParam,a),e.queryParam.borrowDate=e.pickDate.format("YYYY-MM-DD"),e.queryParam.id?Object(l["F"])(e.queryParam).then((function(t){t.success?(e.$emit("ok"),e.visible=!1):e.$message.error(t.message)})):(e.queryParam.id=Object(c["p"])(),Object(l["b"])(e.queryParam).then((function(t){t.success?(e.$emit("ok"),e.visible=!1):e.$message.error(t.message)})))}}))},updateDetail:function(){var e=this;Object(l["ab"])(this.queryParam.id).then((function(t){t.success?e.queryParam.borrowDetailList=t.result:(e.$message.error(t.message),e.visible=!1)}))},openUserSelectModal:function(){this.$refs.userSelectModal.showModal(),this.$refs.userSelect.blur()},handleWarehouseChange:function(e){this.form.setFieldsValue({warehouseId:e})},onBorrowTypeChange:function(e){this.form.setFieldsValue({borrowType:e}),this.queryParam.borrowType=e,this.queryParam.borrowUser="",this.form.setFieldsValue({borrowDep:"",borrowUser:""})},onReturnTypeChange:function(e){this.form.setFieldsValue({returnType:e}),e?1==e?this.dictReturnStatusStr="bu_material_borrow_return_status":2==e&&(this.dictReturnStatusStr="bu_material_transfers_status"):this.dictReturnStatusStr="",this.$refs.borrowDetailRef.updateDict(e)},onReturnStatusChange:function(e){this.form.setFieldsValue({returnStatus:e})},onSelectUser:function(e){e&&e.length>0&&(this.queryParam.borrowUser=e[0].id,this.queryParam.borrowUserName=e[0].realname,this.form.setFieldsValue({borrowUserName:e[0].realname}))}}},f=m,p=a("2877"),b=Object(p["a"])(f,r,i,!1,null,null,null);t["default"]=b.exports},b0cd:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"选择部门",width:e.modalWidth,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭"},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{tip:"Loading...",spinning:!1}},[t("a-input-search",{staticStyle:{"margin-bottom":"1px"},attrs:{placeholder:"请输入部门名称按回车进行搜索"},on:{search:e.onSearch}}),t("a-tree",{attrs:{checkable:"",treeData:e.treeData,checkStrictly:!0,autoExpandParent:e.autoExpandParent,expandedKeys:e.expandedKeys,checkedKeys:e.checkedKeys},on:{check:e.onCheck,select:e.onSelect,expand:e.onExpand},scopedSlots:e._u([{key:"title",fn:function(a){var r=a.title;return[r.indexOf(e.searchValue)>-1?t("span",[e._v(" "+e._s(r.substr(0,r.indexOf(e.searchValue)))+" "),t("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchValue))]),e._v(" "+e._s(r.substr(r.indexOf(e.searchValue)+e.searchValue.length))+" ")]):t("span",[e._v(e._s(r))])]}}])})],1)],1)},i=[],n=a("4ec3");function s(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=c(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s=!0,o=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return s=e.done,e},e:function(e){o=!0,n=e},f:function(){try{s||null==a.return||a.return()}finally{if(o)throw n}}}}function o(e){return d(e)||u(e)||c(e)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"==typeof e)return h(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(e,t):void 0}}function u(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function d(e){if(Array.isArray(e))return h(e)}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var m={name:"JSelectDepartModal",props:["modalWidth","multi","rootOpened","departId"],data:function(){return{visible:!1,confirmLoading:!1,treeData:[],autoExpandParent:!0,expandedKeys:[],dataList:[],checkedKeys:[],checkedRows:[],searchValue:""}},created:function(){this.loadDepart()},watch:{departId:function(){this.initDepartComponent()},visible:{handler:function(){this.departId?this.checkedKeys=this.departId.split(","):this.checkedKeys=[]}}},methods:{show:function(){this.visible=!0,this.checkedRows=[],this.checkedKeys=[]},loadDepart:function(){var e=this;Object(n["H"])().then((function(t){if(t.success){var a=o(t.result);e.reWriterWithSlot(a),e.treeData=a,e.initDepartComponent(),e.rootOpened&&e.initExpandedKeys(t.result)}}))},initDepartComponent:function(){var e="";if(this.departId){var t,a=this.departId,r=s(this.dataList);try{for(r.s();!(t=r.n()).done;){var i=t.value;a.indexOf(i.key)>=0&&(e+=","+i.title)}}catch(n){r.e(n)}finally{r.f()}e&&(e=e.substring(1))}this.$emit("initComp",e)},reWriterWithSlot:function(e){var t,a=s(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(r.children&&r.children.length>0){this.reWriterWithSlot(r.children);var i=Object.assign({},r);i.children={},this.dataList.push(i)}else this.dataList.push(r),r.scopedSlots={title:"title"}}}catch(n){a.e(n)}finally{a.f()}},initExpandedKeys:function(e){if(e&&e.length>0){var t,a=[],r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.children&&i.children.length>0&&a.push(i.id)}}catch(n){r.e(n)}finally{r.f()}this.expandedKeys=[].concat(a)}else this.expandedKeys=[]},onCheck:function(e,t){var a=this;if(this.multi)this.checkedKeys=e.checked,this.checkedRows=this.getCheckedRows(this.checkedKeys);else{var r=e.checked.filter((function(e){return a.checkedKeys.indexOf(e)<0}));this.checkedKeys=o(r),this.checkedRows=0===this.checkedKeys.length?[]:[t.node.dataRef]}},onSelect:function(e,t){var a=[];if(a.push(e[0]),this.checkedKeys&&0!==this.checkedKeys.length&&this.multi){var r,i=t.node.dataRef.key;if(this.checkedKeys.indexOf(i)>=0)this.checkedKeys=this.checkedKeys.filter((function(e){return e!==i}));else(r=this.checkedKeys).push.apply(r,a)}else this.checkedKeys=[].concat(a),this.checkedRows=[t.node.dataRef];this.checkedRows=this.getCheckedRows(this.checkedKeys)},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},handleSubmit:function(){this.checkedKeys&&0!=this.checkedKeys.length?this.$emit("ok",this.checkedRows,this.checkedKeys.join(",")):this.$emit("ok",""),this.handleClear()},handleCancel:function(){this.handleClear()},handleClear:function(){this.visible=!1,this.checkedKeys=[]},getParentKey:function(e,t){for(var a,r=0;r<t.length;r++){var i=t[r];i.children&&(i.children.some((function(t){return t.key===e}))?a=i.key:this.getParentKey(e,i.children)&&(a=this.getParentKey(e,i.children)))}return a},onSearch:function(e){var t=this,a=this.dataList.map((function(a){return a.title.indexOf(e)>-1?t.getParentKey(a.key,t.treeData):null})).filter((function(e,t,a){return e&&a.indexOf(e)===t}));Object.assign(this,{expandedKeys:a,searchValue:e,autoExpandParent:!0})},getCheckedRows:function(e){var t,a=function(e,t){var r,i=s(e);try{for(i.s();!(r=i.n()).done;){var n=r.value;if(n.id===t)return n;if(n.children instanceof Array){var o=a(n.children,t);if(null!=o)return o}}}catch(l){i.e(l)}finally{i.f()}return null},r=[],i=s(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,o=a(this.treeData,n);null!=o&&r.push(o)}}catch(l){i.e(l)}finally{i.f()}return r}}},f=m,p=a("2877"),b=Object(p["a"])(f,r,i,!1,null,"4907a211",null);t["default"]=b.exports},b245:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"85%",title:"人员选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",bodyStyle:{height:"70vh"},destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-row",[t("a-col",{attrs:{md:4,sm:24}},[t("div",{staticStyle:{height:"calc(70vh - 20px)","border-right":"1px solid #e3e1e1","margin-right":"15px"}},[e.treeData&&e.treeData.length>0?t("a-tree",{staticClass:"limitHeight",attrs:{defaultSelectedKeys:[e.queryParam.depId],defaultExpandAll:!0,"tree-data":e.treeData},on:{select:e.onSelect}}):e._e()],1)]),t("a-col",{attrs:{md:20,sm:24}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"账号"}},[t("a-input",{attrs:{placeholder:"请输入用户账号"},model:{value:e.queryParam.username,callback:function(t){e.$set(e.queryParam,"username",t)},expression:"queryParam.username"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"真实名字"}},[t("a-input",{attrs:{placeholder:"请输入真实名字"},model:{value:e.queryParam.realname,callback:function(t){e.$set(e.queryParam,"realname",t)},expression:"queryParam.realname"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"手机号码"}},[t("a-input",{attrs:{placeholder:"请输入手机号码"},model:{value:e.queryParam.phone,callback:function(t){e.$set(e.queryParam,"phone",t)},expression:"queryParam.phone"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"角色"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"sys_role,role_name,id",placeholder:"选择角色"},model:{value:e.queryParam.roleId,callback:function(t){e.$set(e.queryParam,"roleId",t)},expression:"queryParam.roleId"}})],1)],1),t("a-col",{attrs:{md:2,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(70vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 130px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"manual",mode:"row"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"5%"}}):t("vxe-table-column",{attrs:{type:"radio",width:"5%"}}),t("vxe-table-column",{attrs:{field:"workNo",title:"工号",width:"100",align:"center"}}),t("vxe-table-column",{attrs:{field:"username",title:"用户账号",width:"150",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"realname",title:"用户名字",width:"100",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"roleNames",title:"角色","min-width":"180",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"sex_dictText",title:"性别",width:"80"}}),t("vxe-table-column",{attrs:{field:"phone",title:"手机号码",width:"120"}}),t("vxe-table-column",{attrs:{field:"orgCode",title:"部门",width:"120",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])],1)],1)},i=[],n=a("8fad"),s={name:"UserList",props:{multiple:{type:Boolean,default:!0},depId:{type:String,default:""}},data:function(){return{queryParam:{username:"",realname:"",phone:"",orgCode:"",roleId:void 0,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[]}},watch:{depId:function(e){this.$set(this.queryParam,"depId",e||"")}},mounted:function(){this.$set(this.queryParam,"depId",this.depId||"")},methods:{showModal:function(){this.visible=!0,this.findList(),this.getTreeList()},getTreeList:function(){var e=this;Object(n["mb"])().then((function(t){t.success&&(e.treeData=t.result)}))},onSelect:function(e,t){if(e.length){var a=t.node.dataRef;this.queryParam.depId=a.id,this.findList()}else this.queryParam.orgCode="",this.findList()},findList:function(){var e=this;this.loading=!0,Object(n["gc"])(this.queryParam).then((function(t){e.loading=!1,t.success?(e.totalResult=t.result.total,e.tableData=t.result.records):e.$message.error("加载用户数据失败")})).catch((function(t){e.$message.error("加载用户数据异常")})).finally((function(){}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,Object.assign(this.$data,this.$options.data())}}},o=s,l=(a("f76d"),a("2877")),c=Object(l["a"])(o,r,i,!1,null,"4aa7956f",null);t["default"]=c.exports},c1fa:function(e,t,a){"use strict";function r(e){if(null==e)throw new TypeError("Cannot destructure "+e)}a.r(t);var i=function(){var e=this,t=e._self._c;return t("NaCardContent",{attrs:{title:"借用明细",height:"100%"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{staticStyle:{"margin-bottom":"12px"},attrs:{span:24}},[t("a-space",[e.isSaveData?e._e():t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),e.isCheckRow&&!e.isSaveData?t("a-button",{attrs:{type:"dashed"},on:{click:e.handleEdit}},[e._v("编辑")]):e._e(),e.isCheckRows&&!e.isSaveData?t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")]):e._e(),e.isSaveData?t("a-button",{attrs:{type:"primary"},on:{click:e.saveRowData}},[e._v("保存")]):e._e(),e.isSaveData?t("a-button",{on:{click:e.cencelRowData}},[e._v("取消")]):e._e()],1)],1)],1),t("div",{staticClass:"table-page-body-wrapper",staticStyle:{height:"100%"}},[t("div",{staticClass:"table-body-context"},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto","keep-source":!0,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},data:e.tableData,"edit-rules":e.validatorRules,"checkbox-config":{trigger:"row",highlight:!0,range:!0}},on:{"checkbox-change":e.rangeChange,"checkbox-all":e.rangeChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"60px"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"物资描述"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"amount",title:"借用数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:1e7},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"reason",title:"借用理由","edit-render":{name:"input"}}}),t("vxe-table-column",{attrs:{field:"warehouseName",title:"库位"}}),t("vxe-table-column",{attrs:{field:"returnStatus_dictText",title:"归还状态","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:e.dictReturnStatusStr},on:{select:e.onReturnStatusChange},model:{value:r.returnStatus,callback:function(t){e.$set(r,"returnStatus",t)},expression:"row.returnStatus"}})]}}])}),t("vxe-table-column",{attrs:{field:"returnDate",title:"归还日期","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){return r(a),[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:e.pickDate,callback:function(t){e.pickDate=t},expression:"pickDate"}})]}}])})],1)],1)]),t("material-list",{ref:"materialModal",attrs:{multiple:!1},on:{ok:e.onSelectMaterial}})],1)},n=[],s=a("d4ee"),o=a("7dfc"),l=(a("c54ca"),a("7164")),c={name:"BorrowDetail",components:{NaCardContent:s["default"],WorkSopDetailModal:o["default"],MaterialList:l["default"]},props:{tableData:{type:Array,default:[]},borrowInfo:{type:Object,default:{}}},data:function(){return{curEditMode:0,isCheckRow:!1,isCheckRows:!1,isSaveData:!1,visible:!1,dictReturnStatusStr:"bu_material_return_status",confirmLoading:!1,pickDate:null,queryParam:{id:""},validatorRules:{reason:[{max:64,message:"输入长度不能超过64个字符!"}]}}},created:function(){},methods:{initStatus:function(){this.isSaveData=!1,this.isCheckRow=!1,this.isCheckRows=!1,this.updateDict(this.borrowInfo.returnType)},updateDict:function(e){1==e?this.dictReturnStatusStr="bu_material_return_status":2==e&&(this.dictReturnStatusStr="bu_material_transfers_status")},save:function(){this.isSaveData=!1},saveRowData:function(){var e=this,t=this.$refs.listTable.getActiveRecord();t&&(this.$refs.listTable.validate(t.row,(function(a){if(a)for(var r in a){var i=a[r];i.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else e.pickDate&&(t.row.returnDate=e.pickDate.format("YYYY-MM-DD")),e.tableData.find((function(e){return e===t.row}))||e.tableData.push(Object.assign({},t.row)),e.isSaveData=!1,e.curEditMode=0,e.$refs.listTable.clearActived()})),this.rangeChange())},cencelRowData:function(){var e=this.$refs.listTable.getActiveRecord();e&&(e.row.id||2===this.curEditMode?this.$refs.listTable.revertData(e.row):this.$refs.listTable.remove(e.row)),this.$refs.listTable.clearActived(),this.isSaveData=!1,this.curEditMode=0},rangeChange:function(){var e=this.$refs.listTable.getCheckboxRecords();this.isCheckRow=1===e.length,this.isCheckRows=e.length>0},handleAdd:function(){this.curEditMode=1,this.$refs.materialModal.showModal()},handleEdit:function(){if(this.curEditMode=2,this.$refs.listTable.getActiveRecord())this.$message.warn("有未保存数据");else{var e=this.$refs.listTable.getCheckboxRecords()[0];this.$refs.listTable.setActiveRow(e),e.returnDate?this.pickDate=this.$moment(e.returnDate):this.pickDate=null,this.isSaveData=!0}},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.forEach((function(t){e.tableData.splice(e.tableData.findIndex((function(e){return e===t})),1),e.isCheckRow=!1,e.isCheckRows=!1}))}})},onReturnStatusChange:function(e,t){var a=this.$refs.listTable.getActiveRecord();a.row.returnStatus_dictText=t.title},onSelectMaterial:function(e){var t=this;e.forEach((function(e){if(t.tableData.find((function(t){return t.materialTypeId===e.id})))t.$message.warn("".concat(e.name,"物料已经存在列表中"));else{var a={amount:Number(e.num),borrowId:t.borrowInfo.borrowId,id:null,materialTypeCode:e.code,materialTypeId:e.id,materialTypeName:e.name,materialTypeSpec:e.spec,materialTypeUnit:e.unit,reason:"",remark:"",returnDate:null,returnStatus:0,returnStatus_dictText:"未归还",warehouseLocationId:t.borrowInfo.warehouseLocationId,warehouseName:t.borrowInfo.warehouseName};t.pickDate=null,t.isSaveData=!0,t.$refs.listTable.insertAt.call(t,a,-1).then((function(e){var a=e.row;t.isSaveData=!0,t.$refs.listTable.setActiveCell(a,"amount")}))}}))}}},u=c,d=a("2877"),h=Object(d["a"])(u,i,n,!1,null,null,null);t["default"]=h.exports},c94f:function(e,t,a){"use strict";a("fef4")},d4ee:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"na-content-body",style:{height:e.height}},[t("h4",{staticClass:"na-content-title"},[e._v(e._s(e.title))]),e._t("default")],2)},i=[],n={props:{title:{type:String,default:""},height:{type:String,default:"auto"}}},s=n,o=(a("9d91"),a("2877")),l=Object(o["a"])(s,r,i,!1,null,"274eed10",null);t["default"]=l.exports},f76d:function(e,t,a){"use strict";a("9527")},fe54:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"components-input-demo-presuffix"},[t("a-input",{attrs:{placeholder:"请点击选择部门",readOnly:"",disabled:e.disabled},on:{click:e.openModal},model:{value:e.departNames,callback:function(t){e.departNames=t},expression:"departNames"}},[t("a-icon",{attrs:{slot:"prefix",type:"cluster",title:"部门选择控件"},slot:"prefix"}),e.departIds?t("a-icon",{attrs:{slot:"suffix",type:"close-circle",title:"清空"},on:{click:e.handleEmpty},slot:"suffix"}):e._e()],1),t("j-select-depart-modal",{ref:"innerDepartSelectModal",attrs:{"modal-width":e.modalWidth,multi:e.multi,rootOpened:e.rootOpened,"depart-id":e.departIds},on:{ok:e.handleOK,initComp:e.initComp}})],1)},i=[],n=a("b0cd"),s={name:"JSelectDepart",components:{JSelectDepartModal:n["default"]},props:{modalWidth:{type:Number,default:500,required:!1},multi:{type:Boolean,default:!1,required:!1},rootOpened:{type:Boolean,default:!0,required:!1},value:{type:String,required:!1},disabled:{type:Boolean,required:!1,default:!1},customReturnField:{type:String,default:"id"}},data:function(){return{visible:!1,confirmLoading:!1,departNames:"",departIds:""}},mounted:function(){this.departIds=this.value},watch:{value:function(e){"id"===this.customReturnField&&(this.departIds=e)}},methods:{initComp:function(e){this.departNames=e},openModal:function(){this.$refs.innerDepartSelectModal.show()},handleOK:function(e,t){var a=this,r="";!e&&e.length<=0?(this.departNames="",this.departIds=""):(r=e.map((function(e){return e[a.customReturnField]})).join(","),this.departNames=e.map((function(e){return e["departName"]})).join(","),this.departIds=t),this.$emit("change",r)},getDepartNames:function(){return this.departNames},handleEmpty:function(){this.handleOK("")}},model:{prop:"value",event:"change"}},o=s,l=(a("c94f"),a("2877")),c=Object(l["a"])(o,r,i,!1,null,"4d448922",null);t["default"]=c.exports},fef4:function(e,t,a){}}]);