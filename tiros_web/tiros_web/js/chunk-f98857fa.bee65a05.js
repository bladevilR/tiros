(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f98857fa","chunk-42391c95","chunk-2d0ce878"],{"1b5f":function(e,t,a){},"260f":function(e,t,a){},"353a":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",visible:e.visible,title:e.title,centered:"",bodyStyle:{height:"80vh"},confirmLoading:e.confirmLoading,destroyOnClose:!0,footer:null},on:{cancel:e.handleCancel}},[t("div",[t("iframe",{staticClass:"filename",staticStyle:{height:"calc(80vh - 25px)"},attrs:{src:e.filePath,width:"100%",frameborder:"0"}})])])},l=[],r=a("e2aa"),i={name:"DocPreviewModal",props:{title:{type:String,default:"文件预览"}},data:function(){return{visible:!1,confirmLoading:!1,filePath:""}},methods:{handleFilePath:function(e){var t=this;Object(r["c"])(e).then((function(e){if(e.success){var a=e.result;t.visible=!0,t.filePath=window._CONFIG["onlinePreviewDomainURL"]+"?url="+encodeURIComponent(a)}else t.$message.warning("查看文件失败")}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=i,n=(a("9216"),a("2877")),c=Object(n["a"])(s,o,l,!1,null,"484795fd",null);t["default"]=c.exports},"4a8e":function(e,t,a){"use strict";a("1b5f")},"609a":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:900,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form-model",{ref:"form",attrs:{model:e.model,rules:e.validatorRules,"label-col":{span:6},"wrapper-col":{span:16}}},[t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"通知单号",prop:"noticeNo"}},[t("a-input",{attrs:{placeholder:"请输入通知单号"},model:{value:e.model.noticeNo,callback:function(t){e.$set(e.model,"noticeNo",t)},expression:"model.noticeNo"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"通知单标题",prop:"title"}},[t("a-input",{attrs:{placeholder:"请输入通知单标题"},model:{value:e.model.title,callback:function(t){e.$set(e.model,"title",t)},expression:"model.title"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"通知类型",prop:"noticeType"}},[t("a-select",{attrs:{placeholder:"请选择通知类型"},model:{value:e.model.noticeType,callback:function(t){e.$set(e.model,"noticeType",t)},expression:"model.noticeType"}},[t("a-select-option",{attrs:{value:"1"}},[e._v("技术类")]),t("a-select-option",{attrs:{value:"2"}},[e._v("变更类")])],1)],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"状态"}},[t("a-input",{attrs:{value:e.statusText,disabled:""}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"适用车型",prop:"trainType"}},[t("a-input",{attrs:{placeholder:"请输入车型"},model:{value:e.model.trainType,callback:function(t){e.$set(e.model,"trainType",t)},expression:"model.trainType"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"适用线别",prop:"line"}},[t("a-input",{attrs:{placeholder:"请输入线别"},model:{value:e.model.line,callback:function(t){e.$set(e.model,"line",t)},expression:"model.line"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"涉及列车总数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.model.totalTrains,callback:function(t){e.$set(e.model,"totalTrains",t)},expression:"model.totalTrains"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"已完成列车数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,disabled:!0},model:{value:e.model.completedTrains,callback:function(t){e.$set(e.model,"completedTrains",t)},expression:"model.completedTrains"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"作业范围","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:2,placeholder:"请输入作业范围描述"},model:{value:e.model.scope,callback:function(t){e.$set(e.model,"scope",t)},expression:"model.scope"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"通知内容","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:4,placeholder:"请输入通知内容"},model:{value:e.model.content,callback:function(t){e.$set(e.model,"content",t)},expression:"model.content"}})],1)],1)],1),"1"===e.model.noticeType?t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"关联作业记录表","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-select",{attrs:{mode:"multiple",value:e.relatedFormIdList,placeholder:"请选择需随工单下发的作业记录表",allowClear:"",showSearch:"",optionFilterProp:"children",maxTagCount:4,notFoundContent:e.formOptionLoading?"加载中...":void 0},on:{change:e.onRelatedFormsChange,dropdownVisibleChange:e.onRelatedFormsDropdown}},e._l(e.relatedFormOptions,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v(" "+e._s(a.code?"".concat(a.code," - ").concat(a.title):a.title)+" ")])})),1)],1)],1)],1):e._e(),"1"===e.model.noticeType||"2"===e.model.noticeType?t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"关联附件","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-select",{attrs:{mode:"multiple",value:e.relatedDocIdList,placeholder:e.docSelectPlaceholder,allowClear:"",showSearch:"",optionFilterProp:"children",maxTagCount:4,notFoundContent:e.docOptionLoading?"加载中...":void 0},on:{change:e.onRelatedDocsChange,dropdownVisibleChange:e.onRelatedDocsDropdown}},e._l(e.relatedDocOptions,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),1)],1)],1)],1):e._e(),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"编制人"}},[t("a-input",{attrs:{placeholder:"请输入编制人"},model:{value:e.model.creator,callback:function(t){e.$set(e.model,"creator",t)},expression:"model.creator"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"核对人"}},[t("a-input",{attrs:{placeholder:"请输入核对人"},model:{value:e.model.checker,callback:function(t){e.$set(e.model,"checker",t)},expression:"model.checker"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"备注","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:2,placeholder:"请输入备注"},model:{value:e.model.remark,callback:function(t){e.$set(e.model,"remark",t)},expression:"model.remark"}})],1)],1)],1),e.showProgressHint?t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"执行提示","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-alert",{attrs:{type:"info","show-icon":"",message:"技术类生产通知单发布后，将通过关联工单自动统计完成进度（已完成列车数/总列车数）"}})],1)],1)],1):e._e()],1)],1)],1)},l=[],r=a("8fad"),i={name:"ProductionNoticeModal",computed:{statusText:function(){var e={0:"草稿",1:"审核中",2:"已发布",3:"已关闭"};return e[this.model.status]||"草稿"},showProgressHint:function(){return"1"===this.model.noticeType},docSelectPlaceholder:function(){return"2"===this.model.noticeType?"请选择需通知查看/下载的关联工艺文件":"请选择需随工单下发的附件"}},data:function(){return{title:"",visible:!1,confirmLoading:!1,model:{},relatedFormIdList:[],relatedDocIdList:[],relatedFormOptions:[],relatedDocOptions:[],formOptionLoading:!1,docOptionLoading:!1,validatorRules:{noticeNo:[{required:!0,message:"请输入通知单号",trigger:"blur"}],title:[{required:!0,message:"请输入通知单标题",trigger:"blur"}],noticeType:[{required:!0,message:"请选择通知类型",trigger:"change"}]}}},methods:{add:function(){this.title="新增生产通知单",this.visible=!0,this.model={status:"0",totalTrains:0,completedTrains:0,progress:"0%"},this.relatedFormIdList=[],this.relatedDocIdList=[],this.relatedFormOptions=[],this.relatedDocOptions=[],this.loadRelatedFormOptions(),this.loadRelatedDocOptions()},edit:function(e){this.title="编辑生产通知单",this.visible=!0,this.model=Object.assign({},e),this.relatedFormIdList=this.parseIdCsv(e.relatedFormIds),this.relatedDocIdList=this.parseIdCsv(e.relatedDocIds),this.relatedFormOptions=[],this.relatedDocOptions=[],this.ensureSelectedFormOptions(),this.ensureSelectedDocOptions(),this.loadRelatedFormOptions(),this.loadRelatedDocOptions()},handleOk:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.model.relatedFormIds=e.joinIds(e.relatedFormIdList),e.model.relatedDocIds=e.joinIds(e.relatedDocIdList),e.confirmLoading=!0;var a=e.model.id?Object(r["Td"])(e.model):Object(r["sd"])(e.model);a.then((function(t){t.success?(e.$message.success(e.model.id?"修改成功":"新增成功"),e.visible=!1,e.$emit("ok")):e.$message.error(t.message||"操作失败")})).finally((function(){e.confirmLoading=!1}))}}))},handleCancel:function(){this.visible=!1,this.$refs.form.resetFields(),this.relatedFormIdList=[],this.relatedDocIdList=[]},onRelatedFormsChange:function(e){this.relatedFormIdList=e||[]},onRelatedDocsChange:function(e){this.relatedDocIdList=e||[]},onRelatedFormsDropdown:function(e){e&&this.loadRelatedFormOptions()},onRelatedDocsDropdown:function(e){e&&this.loadRelatedDocOptions()},loadRelatedFormOptions:function(){var e=this;this.formOptionLoading=!0,Object(r["Tc"])({pageNo:1,pageSize:200}).then((function(t){if(t&&t.success){var a=t.result&&t.result.records?t.result.records:[];e.relatedFormOptions=a.map((function(e){return{id:e.id,code:e.code,title:e.title||e.name||e.code||e.id}})),e.ensureSelectedFormOptions()}})).finally((function(){e.formOptionLoading=!1}))},loadRelatedDocOptions:function(){var e=this;this.docOptionLoading=!0,Object(r["Ab"])({pageNo:1,pageSize:200}).then((function(t){if(t&&t.success){var a=t.result&&t.result.records?t.result.records:[];e.relatedDocOptions=a.filter((function(e){return 1===Number(e.isFile)})).map((function(e){return{id:e.id,name:e.name||e.id,type:e.type,savepath:e.savepath,fileSize:e.fileSize}})),e.ensureSelectedDocOptions()}})).finally((function(){e.docOptionLoading=!1}))},ensureSelectedFormOptions:function(){var e=this,t={};(this.relatedFormOptions||[]).forEach((function(e){t[e.id]=!0})),(this.relatedFormIdList||[]).forEach((function(a){t[a]||e.relatedFormOptions.push({id:a,code:"",title:"已关联记录表(".concat(a,")")})}))},ensureSelectedDocOptions:function(){var e=this,t={};(this.relatedDocOptions||[]).forEach((function(e){t[e.id]=!0})),(this.relatedDocIdList||[]).forEach((function(a){t[a]||e.relatedDocOptions.push({id:a,name:"已关联附件(".concat(a,")")})}))},parseIdCsv:function(e){return e?String(e).split(",").map((function(e){return e.trim()})).filter(Boolean):[]},joinIds:function(e){return(e||[]).map((function(e){return String(e).trim()})).filter(Boolean).join(",")}}},s=i,n=a("2877"),c=Object(n["a"])(s,o,l,!1,null,null,null);t["default"]=c.exports},9216:function(e,t,a){"use strict";a("260f")},f13c:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"通知单号"}},[t("a-input",{attrs:{placeholder:"请输入通知单号",allowClear:""},model:{value:e.queryParam.noticeNo,callback:function(t){e.$set(e.queryParam,"noticeNo",t)},expression:"queryParam.noticeNo"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"状态"}},[t("a-select",{attrs:{placeholder:"请选择状态",allowClear:""},on:{change:e.handleQueryChange},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}},[t("a-select-option",{attrs:{value:""}},[e._v("全部")]),t("a-select-option",{attrs:{value:"0"}},[e._v("草稿")]),t("a-select-option",{attrs:{value:"1"}},[e._v("审核中")]),t("a-select-option",{attrs:{value:"2"}},[e._v("已发布")]),t("a-select-option",{attrs:{value:"3"}},[e._v("已关闭")])],1)],1)],1),e.advanced?[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"标题"}},[t("a-input",{attrs:{placeholder:"请输入标题",allowClear:""},model:{value:e.queryParam.title,callback:function(t){e.$set(e.queryParam,"title",t)},expression:"queryParam.title"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"类型"}},[t("a-select",{attrs:{placeholder:"请选择类型",allowClear:""},model:{value:e.queryParam.noticeType,callback:function(t){e.$set(e.queryParam,"noticeType",t)},expression:"queryParam.noticeType"}},[t("a-select-option",{attrs:{value:""}},[e._v("全部")]),t("a-select-option",{attrs:{value:"1"}},[e._v("技术类")]),t("a-select-option",{attrs:{value:"2"}},[e._v("变更类")])],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"车型"}},[t("a-input",{attrs:{placeholder:"请输入车型",allowClear:""},model:{value:e.queryParam.trainType,callback:function(t){e.$set(e.queryParam,"trainType",t)},expression:"queryParam.trainType"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"线别"}},[t("a-input",{attrs:{placeholder:"请输入线别",allowClear:""},model:{value:e.queryParam.line,callback:function(t){e.$set(e.queryParam,"line",t)},expression:"queryParam.line"}})],1)],1)]:e._e(),t("a-col",{attrs:{md:6,sm:8}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),t("a-button",{attrs:{disabled:1!=e.selectRows.length},on:{click:function(t){return e.handleEdit(e.selectRows[0])}}},[e._v("编辑")]),t("a-button",{attrs:{disabled:e.selectRows.length<1},on:{click:e.handleDelete}},[e._v("删除")]),t("a-button",{attrs:{disabled:!e.canSubmit},on:{click:e.handleSubmit}},[e._v("提交审核")]),t("a-button",{attrs:{disabled:!e.canPublish},on:{click:e.handlePublish}},[e._v("发布")]),t("a-button",{attrs:{disabled:!e.canClose},on:{click:e.handleClose}},[e._v("关闭")]),t("a-button",{attrs:{disabled:1!=e.selectRows.length},on:{click:e.loadProgressDetail}},[e._v("进度明细")]),t("a-button",{attrs:{disabled:1!=e.selectRows.length},on:{click:e.loadFormProgressDetail}},[e._v("表单填报明细")]),t("a-button",{attrs:{disabled:1!=e.selectRows.length},on:{click:e.loadRelatedFiles}},[e._v("关联文件")]),t("a-button",{on:{click:e.handleExport}},[e._v("导出")]),t("a-upload",{attrs:{name:"file",showUploadList:!1,multiple:!1,headers:e.tokenHeader,action:e.importExcelUrl},on:{change:e.handleImportExcel}},[t("a-button",[e._v("导入")])],1),t("a-button",{on:{click:e.handleSearch}},[e._v("查询")]),t("a",{on:{click:function(t){e.advanced=!e.advanced}}},[e._v(" "+e._s(e.advanced?"收起":"展开")+" "),t("a-icon",{attrs:{type:e.advanced?"up":"down"}})],1)],1)],1)])],2)],1)],1),t("div",{staticStyle:{height:"calc(100vh - 225px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 225px)"},attrs:{border:"","auto-resize":"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}},on:{"checkbox-change":e.checkboxChange,"checkbox-all":e.checkboxChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"noticeNo",title:"通知单号",width:"15%","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"title",title:"通知单标题",width:"25%","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"status",title:"状态",width:"12%","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return["0"===a.row.status?t("span",[e._v("草稿")]):"1"===a.row.status?t("span",[e._v("审核中")]):"2"===a.row.status?t("span",[e._v("已发布")]):"3"===a.row.status?t("span",[e._v("已关闭")]):e._e()]}}])}),t("vxe-table-column",{attrs:{field:"progress",title:"进度",width:"16%","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatProgress(t.row))+" ")]}}])}),t("vxe-table-column",{attrs:{field:"createTime",title:"创建时间",width:"18%",formatter:e.formatDate}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"15%","header-align":"center",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("production-notice-modal",{ref:"noticeModal",on:{ok:function(t){return e.loadData()}}}),t("a-modal",{attrs:{title:"生产通知执行进度明细",visible:e.progressVisible,footer:null,width:860,maskClosable:!1},on:{cancel:function(t){e.progressVisible=!1}}},[t("vxe-table",{attrs:{border:"","auto-resize":"","max-height":"420",align:e.allAlign,data:e.progressDetails}},[t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",width:"180"}}),t("vxe-table-column",{attrs:{field:"totalOrders",title:"关联工单数",width:"120"}}),t("vxe-table-column",{attrs:{field:"completedOrders",title:"已完成工单数",width:"120"}}),t("vxe-table-column",{attrs:{field:"progressRatio",title:"完成比",width:"120"}}),t("vxe-table-column",{attrs:{field:"progressText",title:"进度百分比",width:"120"}}),t("vxe-table-column",{attrs:{field:"lastFinishTime",title:"最近完成时间","min-width":"220",formatter:e.formatDate}})],1)],1),t("a-modal",{attrs:{title:"生产通知作业记录表填报明细",visible:e.formProgressVisible,footer:null,width:1100,maskClosable:!1},on:{cancel:function(t){e.formProgressVisible=!1}}},[t("vxe-table",{attrs:{border:"","auto-resize":"","max-height":"420",align:e.allAlign,data:e.formProgressDetails}},[t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",width:"120"}}),t("vxe-table-column",{attrs:{field:"orderCode",title:"工单号",width:"150"}}),t("vxe-table-column",{attrs:{field:"formCode",title:"记录表编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"formTitle",title:"记录表名称","min-width":"220"}}),t("vxe-table-column",{attrs:{field:"fillStatusText",title:"填报状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"checkResultText",title:"检查结果",width:"100"}}),t("vxe-table-column",{attrs:{field:"checkDate",title:"检查日期",width:"130"}})],1)],1),t("a-modal",{attrs:{title:"生产通知关联文件",visible:e.relatedFilesVisible,footer:null,width:900,maskClosable:!1},on:{cancel:function(t){e.relatedFilesVisible=!1}}},[t("vxe-table",{attrs:{border:"","auto-resize":"","max-height":"420",align:e.allAlign,data:e.relatedFiles}},[t("vxe-table-column",{attrs:{field:"name",title:"文件名称","min-width":"280"}}),t("vxe-table-column",{attrs:{field:"type",title:"类型",width:"120"}}),t("vxe-table-column",{attrs:{field:"fileSize",title:"大小(KB)",width:"100"}}),t("vxe-table-column",{attrs:{title:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{on:{click:function(t){return e.previewFile(a.row)}}},[e._v("预览")]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{on:{click:function(t){return e.downloadRelatedFile(a.row)}}},[e._v("下载")])]}}])})],1)],1),t("doc-preview-modal",{ref:"docPreview"})],1)},l=[],r=a("c1df"),i=a.n(r),s=(a("5c3a"),a("609a")),n=a("8fad"),c=a("0fea"),d=a("2b0e"),u=a("9fb0"),m=a("353a"),p=a("e2aa");function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){g(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function g(e,t,a){return(t=v(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function v(e){var t=w(e,"string");return"symbol"==f(t)?t:t+""}function w(e,t){if("object"!=f(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=f(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var y={name:"ProductionNotice",components:{ProductionNoticeModal:s["default"],DocPreviewModal:m["default"]},computed:{canSubmit:function(){return 1===this.selectRows.length&&"0"===this.selectRows[0].status},canPublish:function(){return 1===this.selectRows.length&&"1"===this.selectRows[0].status},canClose:function(){return 1===this.selectRows.length&&"2"===this.selectRows[0].status},importExcelUrl:function(){return"".concat(window._CONFIG["domianURL"],"/base/production-notice/importExcel")}},data:function(){return{selectRows:[],advanced:!1,tokenHeader:{"X-Access-Token":d["default"].ls.get(u["a"])},queryParam:{noticeNo:"",status:"",title:"",noticeType:"",trainType:"",line:"",pageNo:1,pageSize:10},totalResult:0,allAlign:"center",tableData:[],loading:!1,progressVisible:!1,progressDetails:[],formProgressVisible:!1,formProgressDetails:[],relatedFilesVisible:!1,relatedFiles:[]}},created:function(){this.loadData()},methods:{checkboxChange:function(e){this.selectRows=e.records},loadData:function(){var e=this;this.loading=!0,Object(n["Uc"])(this.queryParam).then((function(t){t.success&&(e.tableData=(t.result.records||[]).map((function(t){return b(b({},t),{},{progressRatio:e.buildProgressRatio(t)})})),e.totalResult=t.result.total||0)})).finally((function(){e.loading=!1}))},handleSearch:function(){this.queryParam.pageNo=1,this.loadData()},handleQueryChange:function(){this.handleSearch()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.loadData()},handleAdd:function(){this.$refs.noticeModal.add()},handleEdit:function(e){this.$refs.noticeModal.edit(e)},handleDelete:function(){var e=this;0!==this.selectRows.length?this.$confirm({title:"删除确认",content:"确认删除选中的生产通知单吗？",onOk:function(){var t=e.selectRows.map((function(e){return e.id})).join(",");Object(n["bb"])({ids:t}).then((function(t){t.success?(e.$message.success("删除成功"),e.selectRows=[],e.loadData()):e.$message.error(t.message||"删除失败")}))}}):this.$message.warning("请先选择要删除的记录")},handleExport:function(){var e=this,t=b({},this.queryParam);Object(c["b"])("/base/production-notice/exportXls",t).then((function(t){if(t){var a=new Blob([t],{type:"application/vnd.ms-excel"}),o=window.URL.createObjectURL(a),l=document.createElement("a");l.style.display="none",l.href=o,l.setAttribute("download","生产通知单.xls"),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o)}else e.$message.warning("文件下载失败")}))},handleSubmit:function(){var e=this;if(this.canSubmit){var t=this.selectRows[0];this.$confirm({title:"提交审核确认",content:"确认提交通知单【".concat(t.noticeNo,"】进入审核流程吗？"),onOk:function(){Object(n["Md"])({id:t.id}).then((function(t){t.success?(e.$message.success("提交审核成功"),e.loadData()):e.$message.error(t.message||"提交失败")}))}})}},handlePublish:function(){var e=this;if(this.canPublish){var t=this.selectRows[0];this.$confirm({title:"发布确认",content:"确认发布通知单【".concat(t.noticeNo,"】吗？"),onOk:function(){Object(n["ed"])({id:t.id}).then((function(t){t.success?(e.$message.success("发布成功"),e.loadData()):e.$message.error(t.message||"发布失败")}))}})}},handleClose:function(){var e=this;if(this.canClose){var t=this.selectRows[0];this.$confirm({title:"关闭确认",content:"确认关闭通知单【".concat(t.noticeNo,"】吗？关闭前会校验执行进度是否100%。"),onOk:function(){Object(n["t"])({id:t.id}).then((function(t){t.success?(e.$message.success("关闭成功"),e.loadData()):e.$message.error(t.message||"关闭失败")}))}})}},loadProgressDetail:function(){var e=this;if(1===this.selectRows.length){var t=this.selectRows[0];Object(n["Nc"])({id:t.id}).then((function(t){t.success?(e.progressDetails=(t.result||[]).map((function(e){var t=Number(e.totalOrders||0),a=Number(e.completedOrders||0),o=t>0?"".concat(Math.round(100*a/t),"%"):"0%",l=t>0?"".concat(a,"/").concat(t):"0/0";return b(b({},e),{},{progressRatio:l,progressText:o})})),e.progressVisible=!0):e.$message.error(t.message||"加载进度明细失败")}))}},loadFormProgressDetail:function(){var e=this;if(1===this.selectRows.length){var t=this.selectRows[0];Object(n["Mc"])({id:t.id}).then((function(t){t.success?(e.formProgressDetails=(t.result||[]).map((function(e){return b(b({},e),{},{fillStatusText:1===Number(e.fillStatus)?"已填写":"未填写",checkResultText:1===Number(e.checkResult)?"通过":0===Number(e.checkResult)?"未通过":"-"})})),e.formProgressVisible=!0):e.$message.error(t.message||"加载填报明细失败")}))}},loadRelatedFiles:function(){var e=this;if(1===this.selectRows.length){var t=this.selectRows[0];Object(n["Sb"])({id:t.id}).then((function(t){if(t&&t.success){var a=t.result||{};e.relatedFiles=a.relatedFiles||[],e.relatedFilesVisible=!0}else e.$message.error(t&&t.message||"加载关联文件失败")}))}},previewFile:function(e){e&&e.savepath?this.$refs.docPreview.handleFilePath(e.savepath):this.$message.warning("文件路径为空")},downloadRelatedFile:function(e){e&&e.savepath?Object(p["b"])(e.savepath):this.$message.warning("文件路径为空")},handleImportExcel:function(e){"done"===e.file.status?e.file.response&&e.file.response.success?(this.$message.success(e.file.response.message||"".concat(e.file.name," 导入成功")),this.loadData()):this.$message.error(e.file.response?e.file.response.message:"导入失败"):"error"===e.file.status&&this.$message.error("文件上传失败")},formatDate:function(e){var t=e.lastFinishTime||e.createTime;return t?i()(t).format("YYYY-MM-DD HH:mm:ss"):""},buildProgressRatio:function(e){var t=Number(e&&e.totalTrains||0),a=Number(e&&e.completedTrains||0);return t>0?"".concat(Math.min(a,t),"/").concat(t):a>0?"".concat(a,"/").concat(a):""},formatProgress:function(e){var t=this.buildProgressRatio(e),a=e&&e.progress?e.progress:"0%";return t?"".concat(t," (").concat(a,")"):a}}},x=y,O=(a("4a8e"),a("2877")),P=Object(O["a"])(x,o,l,!1,null,"68e4e078",null);t["default"]=P.exports}}]);