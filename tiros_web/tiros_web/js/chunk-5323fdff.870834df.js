(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5323fdff"],{"51fd":function(t,e,a){},bbd7:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("a-card",{attrs:{id:"structRightContent"}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchQuery.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:8}},[e("a-col",{attrs:{md:7,sm:24}},[e("a-form-item",{attrs:{label:"名称",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[e("a-input",{attrs:{placeholder:"名称或编码","allow-clear":""},model:{value:t.queryParam.searchText,callback:function(e){t.$set(t.queryParam,"searchText",e)},expression:"queryParam.searchText"}})],1)],1),e("a-col",{attrs:{md:7,sm:24}},[e("a-form-item",{attrs:{label:"状态",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[e("j-dict-select-tag",{attrs:{dictCode:"bu_enable"},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}})],1)],1),e("a-col",{attrs:{md:7,sm:24}},[e("a-form-item",{attrs:{label:"上级",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[e("a-tree-select",{attrs:{"tree-data-simple-mode":"","allow-clear":"","tree-data":t.selectTreeNode,replaceFields:{title:"title",value:"id"},placeholder:"请选择","load-data":t.loadSelectNodeMethod},on:{select:t.selectPid},model:{value:t.queryParam.id,callback:function(e){t.$set(t.queryParam,"id",e)},expression:"queryParam.id"}})],1)],1)],1),e("a-row",[e("a-col",[e("span",{staticClass:"table-page-search-submitButtons"},[e("a-space",[e("a-button",{on:{click:t.searchQuery}},[t._v("查询")]),e("a-button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("新增")]),e("a-button",{attrs:{disabled:1!=t.records.length},on:{click:function(e){return t.handleEdit(t.records[0])}}},[t._v("编辑")]),e("a-button",{attrs:{disabled:t.records.length<1},on:{click:t.handleDel}},[t._v("删除")]),e("a-button",{attrs:{loading:t.loading},on:{click:t.importType}},[t._v("导入创建")])],1)],1)])],1)],1)],1),e("div",{staticClass:"tableHeight",staticStyle:{height:"calc(100vh - 247px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","row-id":"id",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip",height:"auto","checkbox-config":{trigger:"row",highlight:!0,checkStrictly:!0},"edit-config":{trigger:"manual",mode:"row"},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:t.loadChildrenMethod}},on:{"checkbox-change":t.checkboxChange,"checkbox-all":t.checkboxChange}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"name",title:"名称","tree-node":"",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"structType_dictText",title:"类型",width:"120"}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"100"}}),e("vxe-table-column",{attrs:{field:"placeId",title:"所属位置",width:"150"}}),e("vxe-table-column",{attrs:{field:"placeDesc",title:"位置描述",width:"180",align:"left","header-align":"center"}})],1)],1),e("train-asset-type",{ref:"selectForm",attrs:{multiple:!0,trainTypeId:t.trainTypeId},on:{ok:t.importTarget}}),e("right-item-modal",{ref:"modalForm",attrs:{multiple:!0,trainStructId:t.trainStructId,trainTypeId:t.trainTypeId,parent:t.selectParent},on:{ok:t.loadData}})],1)},i=[],n=a("4564"),s=a("2cb5"),l=a("8fad"),c=a("ca00"),o={components:{RightItemModal:n["default"],TrainAssetType:s["default"]},name:"RightPage",props:["trainStruct","trainType"],data:function(){return{records:[],loading:!1,queryParam:{id:"",searchText:"",status:null,trainStructId:""},selectParent:{},importParam:{childId:"",parentId:"",trainStructId:""},labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:19}},trainStructId:"",trainTypeId:"",allAlign:"center",tableData:[],selectTreeNode:[]}},watch:{trainStruct:{immediate:!1,handler:function(t){this.queryParam.trainStructId=t,this.queryParam.id="",this.importParam.trainStructId=t,this.trainStructId=t,this.findList(),this.findSelectList()}},trainType:{immediate:!0,handler:function(t){this.trainTypeId=t}}},methods:{checkboxChange:function(t){this.records=t.records},findList:function(){var t=this;Object(l["pc"])(this.queryParam).then((function(e){e.success&&(t.records=[],t.tableData=e.result)}))},findSelectList:function(){var t=this,e={trainStructId:this.trainStructId};Object(l["pc"])(e).then((function(e){e.success&&(t.selectTreeNode=e.result.map((function(e){return t.genSelectTreeNode(e)})))}))},loadChildrenMethod:function(t){var e=this,a=t.row,r={trainStructId:this.trainStructId,id:a.id,searchText:this.queryParam.searchText,status:this.queryParam.status};return new Promise((function(t){Object(l["pc"])(r).then((function(a){a.success?t(a.result):e.$message.error("".concat(a.msg))}))}))},loadSelectNodeMethod:function(t){var e=this,a={trainStructId:this.trainStructId,id:t.dataRef.id};return new Promise((function(t){Object(l["pc"])(a).then((function(t){if(t.success)t.result.map((function(t){e.selectTreeNode=e.selectTreeNode.concat(e.genSelectTreeNode(t))}));else e.$message.warning(t.message)})),t()}))},genSelectTreeNode:function(t){return{id:t.id,pId:t.parentId,value:t.id,title:t.name,isLeaf:!t.hasChildren}},selectPid:function(t){},searchQuery:function(){this.findList()},handleAdd:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();if(1==e.length)this.importParam.parentId=this.trainStructId=e[0].trainStructId,this.selectParent={id:e[0].id,name:e[0].name,trainTypeId:e[0].trainTypeId,trainStructId:e[0].trainStructId};else{if(e.length>1)return void this.$message.error("最多选择1条数据!");if(Object(c["e"])(this.trainStruct))return void this.$message.error("请选择车辆结构!");this.selectParent={}}setTimeout((function(){t.$refs.modalForm.add(),t.$refs.modalForm.title="新增"}),0)},handleEdit:function(t){this.$refs.modalForm.edit(t),this.$refs.modalForm.title="编辑"},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length>0?this.$confirm({content:"此操作将删除当前设备及其子级数据，是否继续？",okText:"确定",cancelText:"取消",onOk:function(){var a=e.map((function(t,e){return t.id})).join(",");Object(l["S"])({ids:a}).then((function(e){e.success?(t.$message.success(e.message),t.loadData()):t.$message.warning(e.message)}))}}):this.$message.error("尚未选中任何数据!")},importType:function(){var t=this.$refs.listTable.getCheckboxRecords();1==t.length?(this.importParam.parentId=t[0].id,this.$refs.selectForm.showModal()):t.length>1?this.$message.error("最多选择1条数据!"):Object(c["e"])(this.trainStruct)?this.$message.error("请选择车辆结构!"):(this.importParam.parentId="",this.$refs.selectForm.showModal())},importTarget:function(t){var e=this;if(t.length){var a=t.map((function(t,e){return t.id})).join(",");this.importParam.childId=a,this.loading=!0,Object(l["Dc"])(this.importParam).then((function(t){t.success?e.$message.success(t.message):e.$message.warning(t.message),e.loadData()})).finally((function(){return e.loading=!1}))}},loadData:function(){this.findList(),this.findSelectList()}}},d=o,u=(a("f8fe"),a("2877")),h=Object(u["a"])(d,r,i,!1,null,null,null);e["default"]=h.exports},f8fe:function(t,e,a){"use strict";a("51fd")}}]);