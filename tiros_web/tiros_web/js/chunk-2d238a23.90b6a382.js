(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d238a23"],{ffe2:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.taskMaterials,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"cell",highlight:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskMaterials=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{focus:function(t){return e.openMaterialSelectModal(i)}},model:{value:i.code,callback:function(t){e.$set(i,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openMaterialSelectModal(i)}},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type",hiddenArray:[-1],allowClear:!1},on:{select:e.onCategoryChange,blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:i.useCategory,callback:function(t){e.$set(i,"useCategory",t)},expression:"row.useCategory"}})]}}])}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:999999},model:{value:i.amount,callback:function(t){e.$set(i,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-input",{attrs:{maxLength:201,placeholder:"请输入备注"},on:{change:function(t){return e.remarkChangeValue(i)}},model:{value:i.remark,callback:function(t){e.$set(i,"remark",t)},expression:"row.remark"}})]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[e.$refs.listTable.isActiveByRow(i)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(i)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(i)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(i)}}},[e._v("编辑")])]]}}],null,!1,1311980394)})],1),t("material-list",{ref:"modalForm",attrs:{typeCodeList:[2,3],multiple:!1},on:{ok:e.onSelectMaterial}}),t("material-list",{ref:"modalFormMultiple",attrs:{typeCodeList:[2,3],multiple:!0},on:{ok:e.onSelectMaterialMultiple}})],1)},r=[],n=a("7164"),o=a("ca00"),s={name:"TaskMaterials",components:{MaterialList:n["default"]},props:{taskMaterials:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择物料"}],useCategory_dictText:[{required:!0,message:"请选择类别"}],amount:[{required:!0,message:"数量必须填写"}],remark:[{max:200,type:"string",message:"备注不能超过200个字符"}]},isvalid:!1}},methods:{validAllEvent:function(){var e=this;return new Promise((function(t,a){e.$refs.listTable.validate(!0).then((function(e){t(!0)})).catch((function(a){t(!1),e.curEditMode=2}))}))},onCategoryChange:function(e,t){var a=this.$refs.listTable.getActiveRecord();a.row.useCategory_dictText=t?t.title:void 0,this.$forceUpdate()},remarkChangeValue:function(e){var t=e.remark;t.length>200&&this.$message.error("备注不能超过200个字符")},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){t.map((function(t){e.taskMaterials.map((function(a,i){t.id===a.id&&e.taskMaterials.splice(i,1)}))}))}})},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskMaterials.map((function(a,i){e.id===a.id&&t.taskMaterials.splice(i,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var i in a){var r=a[i];r.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.taskMaterials.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openMaterialSelectModal:function(e){this.curRow=e,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur()},onSelectMaterialMultiple:function(e){var t=this;if(e&&e.length>0){var a=this.taskMaterials;e.forEach((function(i,r){if(a.find((function(e){return e.materialTypeId===i.id})))t.$message.warn("你选择的".concat(i.name,"已经在列表中存在"));else{var n={id:Object(o["p"])(),code:i.code,materialTypeId:i.id,name:i.name,kind:i.kind,unit:i.unit,kind_dictText:i.kind_dictText,useCategory:-1==i.useCategory?"":i.useCategory,useCategory_dictText:-1==i.useCategory?"":i.useCategory_dictText,amount:i.num};1==e.length?t.$refs.listTable.insertAt(n,-1).then((function(e){var a=e.row;t.$refs.listTable.setActiveCell(a,"amount")})):(t.$refs.listTable.insertAt(n,-1),t.taskMaterials.push(n))}}))}},onSelectMaterial:function(e){if(e&&e.length>0){var t=e[0],a=0;if(this.taskMaterials.map((function(e){if(e.materialTypeId===t.id)return a=1,!1})),1===a)return void this.$message.error("你选择的物料已经在列表中存在，请选择其他物料");this.curRow.code=t.code,this.curRow.materialTypeId=t.id,this.curRow.name=t.name,this.curRow.kind=t.kind,this.curRow.unit=t.unit,this.curRow.kind_dictText=t.kind_dictText,this.curRow.useCategory=-1==t.useCategory?"":t.useCategory,this.curRow.useCategory_dictText=-1==t.useCategory?"":t.useCategory_dictText,this.curRow.amount=t.num}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory=-1==material.useCategory?"":material.useCategory,this.curRow.useCategory_dictText=-1==material.useCategory?"":material.useCategory_dictText,this.curRow.unit="",this.curRow.amount=0}}},l=s,u=a("2877"),c=Object(u["a"])(l,i,r,!1,null,null,null);t["default"]=c.exports}}]);