(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d590ccc"],{"50c3":function(e,t,a){},db1c:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{id:"trainAssetRightContent"}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchQuery.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"名称或编码"},model:{value:e.queryParam.title,callback:function(t){e.$set(e.queryParam,"title",t)},expression:"queryParam.title"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"状态"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_effective"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:10,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.searchQuery}},[e._v("查询")]),t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),t("a-button",{attrs:{disabled:1!=e.records.length},on:{click:function(t){return e.handleEdit(e.records[0])}}},[e._v("编辑")]),t("a-button",{attrs:{disabled:e.records.length<1},on:{click:e.handleDel}},[e._v("删除")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.importStructure}},[e._v("导入创建")])],1)],1)])],1)],1)],1),t("div",{staticClass:"tableHeight"},[t("vxe-table",{ref:"listTable",attrs:{border:"",resizable:"","row-id":"id",align:e.allAlign,height:"auto",data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,checkStrictly:!0},"edit-config":{trigger:"manual",mode:"row"},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}},on:{"checkbox-change":e.checkboxChange,"checkbox-all":e.checkboxChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{title:"车号",width:"100"}},[[t("div",[e._v(" "+e._s(e.value.trainId)+" ")])]],2),t("vxe-table-column",{attrs:{field:"assetName",title:"车厢","tree-node":"",width:"20%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"placeDesc",title:"位置",width:"14%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{title:"系统",width:"14%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"assetNo",title:"编码",width:"14%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"structType_dictText",title:"类型",width:"10%"}}),t("vxe-table-column",{attrs:{field:"assetTypeName",title:"设备类型",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"assetCode",title:"资产编码",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"manufNo",title:"出厂编码",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{title:"设备标签",width:"13%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"placeId",title:"所属位置",width:"10%",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"placeDesc",title:"位置描述",width:"10%",align:"left","header-align":"center"}})],1)],1),t("train-asset-type",{ref:"modalForm",attrs:{trainTypeId:e.trainTypeId,pid:e.selectPid,multiple:!0},on:{ok:e.importTarget}}),t("train-sys-item-modal",{ref:"sysModalForm",attrs:{trainId:e.trainId,trainTypeId:e.trainTypeId,parent:e.selectParent},on:{ok:e.addTarget}})],1)},n=[],s=a("2cb5"),r=a("1297"),l=a("8fad"),c={components:{TrainAssetType:s["default"],TrainSysItemModal:r["default"]},name:"TrainInfo",props:["value"],data:function(){return{records:[],trainId:"",trainTypeId:"",selectParent:{},queryParam:{code:""},allAlign:"center",tableData:[],selectTreeNode:[],selectPid:"",loading:!1}},watch:{value:{immediate:!0,handler:function(e){e&&(this.trainId=e.trainId,this.trainTypeId=e.trainTypeId,this.queryParam.code=e.trainId),this.findList()}}},created:function(){},methods:{checkboxChange:function(e){this.records=e.records},findList:function(){var e=this;Object(l["ic"])(this.queryParam).then((function(t){t.success&&(e.loading=!1,e.tableData=t.result,e.records=[])}))},findSelectList:function(){var e={code:this.trainId};Object(l["ic"])(e).then((function(e){e.success}))},loadChildrenMethod:function(e){var t=this,a=e.row,i={code:this.trainId,id:a.id,searchText:this.queryParam.searchText,status:this.queryParam.status};return new Promise((function(e){Object(l["ic"])(i).then((function(a){a.success?e(a.result):t.$message.error("".concat(a.msg))}))}))},loadSelectNodeMethod:function(e){var t=this,a={code:this.trainId,id:e.dataRef.id};return new Promise((function(e){Object(l["ic"])(a).then((function(e){if(e.success)e.result.map((function(e){t.selectTreeNode=t.selectTreeNode.concat(t.genSelectTreeNode(e))}));else t.$message.error(e.message)})),e()}))},genSelectTreeNode:function(e){return{id:e.id,pId:e.parentId,value:e.id,title:e.assetName,isLeaf:!e.hasChildren}},searchQuery:function(){this.findList()},handleAdd:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?1==t.length?this.selectParent={id:t[0].id,name:t[0].assetName}:this.$message.error("只能选择一个上级节点或者不选!"):this.selectParent={},setTimeout((function(){e.$refs.sysModalForm.add(),e.$refs.sysModalForm.title="新增"}),0)},handleEdit:function(e){this.$refs.sysModalForm.edit(e),this.$refs.sysModalForm.title="编辑"},addTarget:function(){this.loadData()},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"此操作将删除当前设备及其子级数据，是否继续？",okText:"确定",cancelText:"取消",onOk:function(){var a=t.map((function(e,t){return e.id})).join(",");Object(l["P"])({ids:a}).then((function(t){t.success?(e.$message.success(t.message),e.loadData()):e.$message.error(t.message)}))}}):this.$message.error("尚未选中任何数据!")},importStructure:function(){if(this.value&&this.value.trainId){var e=this.$refs.listTable.getCheckboxRecords();0===e.length?this.$refs.modalForm.showModal():1===e.length?(this.selectPid=e[0].id,this.$refs.modalForm.showModal()):this.$message.error("只能在一个设备下进行导入，不要选择多个设备!")}else this.$message.error("请选择要的导入的车辆!")},importTarget:function(e){var t=this,a=e.map((function(e,t){return e.id})).join(","),i={childId:a,parentId:this.selectPid,trainNo:this.trainId};this.loading=!0,Object(l["Cc"])(i).then((function(e){e.success?(t.$message.success(e.message),t.loadData()):t.$message.warning(e.message)})).finally((function(){return t.loading=!1}))},loadData:function(){this.queryParam.id="",this.findList()},handleBack:function(){this.$emit("close")}}},o=c,d=(a("ea5c"),a("2877")),h=Object(d["a"])(o,i,n,!1,null,null,null);t["default"]=h.exports},ea5c:function(e,t,a){"use strict";a("50c3")}}]);