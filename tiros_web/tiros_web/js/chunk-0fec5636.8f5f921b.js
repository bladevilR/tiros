(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fec5636","chunk-0693ce46"],{"13f1":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("a-modal",{ref:"locationModalRef",class:{"na-footer-none":2===e.modeType},attrs:{title:"库位选择",width:"80%",bodyStyle:{height:"70vh"},visible:e.visible,centered:!0,confirmLoading:e.confirmLoading,closable:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"库位选择"}},[t("a-checkbox-group",{attrs:{name:"checkboxgroup",options:e.options},on:{change:e.findList},model:{value:e.warehouseLevelList,callback:function(t){e.warehouseLevelList=t},expression:"warehouseLevelList"}})],1)],1),t("a-col",{attrs:{md:12}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 66px)"},attrs:{id:"location_table_main"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto","show-overflow":"tooltip",data:e.tableData,"tree-config":{key:"warehouseId",children:"children",expandAll:!0},"radio-config":{highlight:!0,trigger:"row"},"row-class-name":e.setRowClass},on:{"update:data":function(t){e.tableData=t},"cell-click":e.onCurrentChange}},[1===e.modeType?t("vxe-table-column",{attrs:{type:"radio",width:"40px"}}):e._e(),t("vxe-table-column",{attrs:{field:"sourceLocationName",width:"200",title:"所属组织","header-align":"center",align:"left","tree-node":""}}),t("vxe-table-column",{attrs:{width:"80",field:"warehouseLevel",title:"库位级别",formatter:e.formatLevel}}),t("vxe-table-column",{attrs:{width:"120",field:"materialTypeCode",title:"物资编码"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"130","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"tradeNo",width:"200",title:"所属批次"}}),t("vxe-table-column",{attrs:{width:"80",field:"amount",title:"当前库存"}}),t("vxe-table-column",{attrs:{width:"80",field:"usableAmount",title:"可用库存"}}),t("vxe-table-column",{attrs:{width:"160",field:"usedDetailInfo",title:"占用详情","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{width:"80",field:"price",title:"价格"}}),t("vxe-table-column",{attrs:{width:"80",field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialType_dictText",title:"物料分类"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialAttr_dictText",title:"物料属性"}}),t("vxe-table-column",{attrs:{field:"spec",title:"物料描述","min-width":"100","header-align":"center",align:"left"}})],1)],1):e._e()])},i=[],o=a("c54ca");function n(e){return u(e)||c(e)||s(e)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return d(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,t):void 0}}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function u(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,l=Array(t);a<t;a++)l[a]=e[a];return l}var m={name:"LocationList",props:{multiple:{type:Boolean,default:!1},modeType:{type:Number,default:1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,tableData:[],selectMaterialTypeId:"",warehouseLevelList:[],options:[{label:"三级库",value:3},{label:"四级库",value:4}]}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0}))},created:function(){},methods:{showModal:function(e,t,a){this.visible=!0,this.selectMaterialTypeId=e,this.findList(t,a)},findList:function(e,t){var a=this;Object(o["yb"])({warehouseLevelList:this.warehouseLevelList,materialTypeId:this.selectMaterialTypeId,applyDetailId:e,assignDetailId:t}).then((function(e){e.success&&(a.tableData=[],a.tableData=a.buildTree(e.result),a.$nextTick((function(){a.$refs.listTable.setAllTreeExpand(!0)})))}))},buildTree:function(e){var t=e.reduce((function(e,t,a){return e[t.warehouseId]=a,e}),{}),a=[];return e.forEach((function(l){if(null===l.parentId)a.push(l);else{var i=e[t[l.parentId]];i?i.children=[].concat(n(i.children||[]),[l]):a.push(l)}})),a},formatLevel:function(e){var t=e.cellValue,a=parseInt(t);return a-1},handleOk:function(){var e=this.$refs.listTable.getRadioRecord();e.children?this.$message.warn("该库位还有下级库位，请选择下级库位！"):(this.$emit("ok",e?[e]:[]),this.visible=!1)},saveOk:function(){this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},close:function(){this.visible=!1,Object.assign(this.$data,this.$options.data())},openPalletModal:function(){this.$refs.palletSelect.blur()},openlocationModal:function(){this.$refs.materialToolsModal.showModal(),this.$refs.locationSelect.blur()},onCurrentChange:function(e){var t=e.row,a=e.$event;2===this.modeType&&(t.children&&t.children.length&&!/vxe-tree--node-btn/.test(a.target.className)?this.$refs.listTable.setTreeExpand([t],!this.$refs.listTable.isTreeExpandByRow(t)):(this.$emit("ok",[t]),this.visible=!1))},setRowClass:function(e){e.row;return 2===this.modeType?"mode-type-choose":""}}},h=m,f=(a("1892"),a("2877")),p=Object(f["a"])(h,l,i,!1,null,null,null);t["default"]=p.exports},1892:function(e,t,a){"use strict";a("9424")},"2eb4":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"备料确认-".concat(e.selectInfo?e.selectInfo.materialTypeName:"","物资"),width:"90%",bodyStyle:{height:"70vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[e.readonly?e._e():t("div",{staticClass:"table-page-search-wrapper",staticStyle:{position:"relative","z-index":"100"}},[t("a-form",{attrs:{form:e.form,layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{labelCol:{span:10},wrapperCol:{span:14},label:"来源库位"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["sourceLocationName",e.validatorRules.sourceLocationName],expression:"['sourceLocationName', validatorRules.sourceLocationName]"}],ref:"locationSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:e.openlocationModal}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"发放数量"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount",e.validatorRules.amount],expression:"['amount', validatorRules.amount]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入数量",max:e.locationMaxAmount}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"存放托盘"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["palletName",e.validatorRules.palletName],expression:"['palletName', validatorRules.palletName]"}],ref:"palletSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择托盘",open:!1},on:{change:e.palletNameChange,dropdownVisibleChange:function(t){return e.openPalletModal()}}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加")]),t("span",{staticStyle:{color:"red","margin-left":"15px"}},[e._v(e._s("总量: ".concat(e.selectInfo?e.selectInfo.amount:0,";")))]),t("span",{staticStyle:{color:"red","margin-left":"5px"}},[e._v(e._s("差额：".concat(e.calcAmount)))])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 62px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",height:"auto","keep-source":"",data:e.tableData,"edit-config":e.readonly?null:{trigger:"click",mode:"cell"}},on:{"edit-actived":e.onEditActive,"edit-closed":e.onEditClosed}},[t("vxe-table-column",{attrs:{title:"物资编码"}},[e._v(" "+e._s(e.selectInfo?e.selectInfo.materialTypeCode:"")+" ")]),t("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位"}}),t("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘"}}),t("vxe-table-column",{attrs:{field:"amount",title:"发放数量",align:"center","edit-render":{name:"$input",props:{type:"number"}}}}),e.readonly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var l=a.row;return[e.isMustApply?e._e():t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.handleDel(l)}}},[e._v("删除")])]}}],null,!1,3925414073)})],1)],1):e._e(),t("LocationList",{ref:"locationModal",on:{ok:e.onSelectLocation}}),t("PalletList",{ref:"palletModal",on:{ok:e.onSelectPallet}})],1)},i=[],o=a("13f1"),n=a("9f49"),r={name:"ApplyDistributionModal",components:{LocationList:o["default"],PalletList:n["default"]},props:{readonly:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,selectInfo:null,form:this.$form.createForm(this),chooseType:2,cellLocationName:"",cellPalletName:"",locationMaxAmount:0,queryParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},tableData:[],delDataList:[],delRecordList:[],validatorRules:{sourceLocationName:{rules:[{required:!0,message:"请选择所属库位!"}]},locationName:{rules:[]},palletId:{rules:[{required:!0,message:"请选择托盘!"}]},palletName:{rules:[{required:!1,message:"请选择托盘!"}]},amount:{rules:[{required:!0,message:"请输入数量!"}]}},isMustApply:!1}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0})),this.selectInfo||this.close()},computed:{calcAmount:function(){return this.getAmount()}},watch:{},methods:{getAmount:function(){if(!this.selectInfo)return 0;var e=0;return this.tableData.forEach((function(t){e+=Number(t.amount)})),this.selectInfo.amount-e},showModal:function(e){var t=this;this.selectInfo=e,this.tableData=[],e.assignDetailList.forEach((function(e){t.tableData.push(JSON.parse(JSON.stringify(e)))})),this.queryParam.materialTypeId=this.selectInfo.materialTypeId,this.queryParam.applyDetailId=this.selectInfo.id,this.queryParam.amount=this.calcAmount,this.visible=!0,this.$nextTick((function(){t.locationMaxAmount=t.calcAmount,t.form.getFieldDecorator("amount"),t.form.setFieldsValue({amount:t.calcAmount})}))},handleOk:function(){var e=this;if(!this.isMustApply)return 0===this.calcAmount?(this.$emit("ok",this.tableData),void this.close()):void this.$confirm({content:"物料差额分配未完成，是否退出？",onOk:function(){e.$emit("ok",e.tableData),e.close()}});this.close()},handleAdd:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var l=0;if(e.tableData.forEach((function(e){l+=Number(e.amount)})),e.tableData.find((function(t){return t.sourceLocationName===e.queryParam.sourceLocationName})))return e.$message.warn("".concat(e.queryParam.sourceLocationName,"来源库位的记录已存在")),void e.$refs.listTable.setActiveCell(e.tableData.find((function(t){return t.sourceLocationName===e.queryParam.sourceLocationName})),"amount");if(0===e.locationMaxAmount)return void e.$message.warn("".concat(e.queryParam.sourceLocationName,"来源库位的库存量不足"));if(l+a.amount>Number(e.selectInfo.amount))return void e.$message.warn("选择的实际数量超过了发放数量");e.queryParam.amount=a.amount,e.tableData.push(JSON.parse(JSON.stringify(e.queryParam)))}}))},handleDel:function(e){var t=this;this.tableData.splice(this.tableData.findIndex((function(t){return t===e})),1),this.queryParam.amount=this.calcAmount,this.$nextTick((function(){t.locationMaxAmount=t.calcAmount,t.form.getFieldDecorator("amount"),t.form.setFieldsValue({amount:t.calcAmount})}))},handleCancel:function(){this.$emit("cancel"),this.close()},close:function(){this.visible=!1},openPalletModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.curRow=e,this.$refs.palletModal.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName),this.$refs.palletSelect.blur()},openlocationModal:function(e){e&&(this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,null,null),this.$refs.locationSelect.blur())},onSelectLocation:function(e){if(this.curRow)this.curRow&&(this.curRow.palletName=e[0].warehouseName,this.curRow.locationWbs=e[0].warehouseWbs,this.curRow.sourceLocationName=e[0].sourceLocationName,delete this.curRow);else if(e.length>0){var t=0;this.tableData.forEach((function(a){a.locationWbs===e[0].warehouseWbs&&(t+=a.amount)})),this.locationMaxAmount=e[0].amount-t,this.locationMaxAmount<this.queryParam.amount&&this.form.setFieldsValue({amount:this.locationMaxAmount}),this.queryParam.locationName=e[0].warehouseName,this.queryParam.locationWbs=e[0].warehouseWbs,this.queryParam.sourceLocationName=e[0].sourceLocationName,this.queryParam.tradeNo=e[0].tradeNo,this.form.setFieldsValue({locationName:e[0].warehouseName,sourceLocationName:e[0].sourceLocationName})}},palletNameChange:function(e){e||(this.queryParam.palletId=void 0,this.queryParam.palletName=void 0)},onSelectPallet:function(e){this.curRow?delete this.curRow:e.length>0&&(this.queryParam.palletId=e[0].id,this.queryParam.palletName=e[0].name,this.form.setFieldsValue({palletName:e[0].name}))},onEditActive:function(e){var t=e.row;this.cellLocationName=t.locationName,this.cellPalletName=t.palletName},onEditClosed:function(e){var t=e.row,a=0;if(this.tableData.forEach((function(e){a+=Number(e.amount)})),a>Number(this.selectInfo.amount))return this.$refs.listTable.revertData(t),void this.$message.warn("选择的实际数量超过了发放数量")}}},s=r,c=a("2877"),u=Object(c["a"])(s,l,i,!1,null,null,null);t["default"]=u.exports},"815e":function(e,t,a){},9424:function(e,t,a){},"9f49":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("a-modal",{class:{"na-footer-none":2===e.modeType},attrs:{title:"托盘选择",width:"80%",bodyStyle:{height:"70vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"托盘编码"}},[t("a-input",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"物资类型"}},[t("a-select",{ref:"materialSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"请选择物料",open:!1},on:{change:e.clearMaterialChange,dropdownVisibleChange:e.openMaterialSelectModal},model:{value:e.materialTypeName,callback:function(t){e.materialTypeName=t},expression:"materialTypeName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){t.stopPropagation(),e.queryParam.typeId=""}},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"使用状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_pallet_use_status"},model:{value:e.queryParam.useStatus,callback:function(t){e.$set(e.queryParam,"useStatus",t)},expression:"queryParam.useStatus"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"托盘状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_valid_status"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:4}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 110px)"},attrs:{id:"pallet_table_main"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto",data:e.tableData,"show-overflow":"tooltip","radio-config":{highlight:!0,trigger:"row"},"row-class-name":e.setRowClass},on:{"cell-click":e.onCurrentChange}},[1===e.modeType?t("vxe-table-column",{attrs:{type:"radio",width:"60px"}}):e._e(),t("vxe-table-column",{attrs:{field:"code",title:"托盘编码"}}),t("vxe-table-column",{attrs:{field:"name",title:"托盘名称"}}),t("vxe-table-column",{attrs:{field:"materialTypeNames",title:"物资类型","min-width":"100",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"size",title:"尺寸"}}),t("vxe-table-column",{attrs:{field:"texture",title:"材质"}}),t("vxe-table-column",{attrs:{field:"useStatus_dictText",title:"使用状态",width:"120"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注"}})],1)],1):e._e(),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.page.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}}),t("material-list",{ref:"materialForm",attrs:{multiple:!1},on:{ok:e.onSelectMaterial}})],1)},i=[],o=a("c54ca"),n=a("7164"),r={name:"PalletList",components:{MaterialList:n["default"]},props:{multiple:{type:Boolean,default:!1},modeType:{type:Number,default:1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,tableData:[],selectMaterialTypeId:"",materialTypeName:"",queryParam:{pageNo:1,pageSize:10,searchText:"",typeId:null,useStatus:null,status:null},page:{totalResult:3}}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0}))},created:function(){},methods:{showModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.visible=!0,this.selectMaterialTypeId=e,this.materialTypeName=t,this.queryParam.typeId=e,this.findList()},findList:function(){var e=this;Object(o["mb"])(this.queryParam).then((function(t){t.success&&(e.tableData=t.result.records,e.page.totalResult=t.result.total)}))},handleOk:function(){var e=this,t=this.$refs.listTable.getRadioRecord();t&&t.useStatus?this.$confirm({content:"该托盘正在使用中，确认继续选择该托盘？",okText:"确定",cancelText:"取消",onOk:function(){e.$emit("ok",t?[t]:[]),e.visible=!1}}):(this.$emit("ok",t?[t]:[]),this.visible=!1)},saveOk:function(){this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},close:function(){this.visible=!1},openMaterialSelectModal:function(e){e&&(this.$refs.materialForm.showModal(),this.$refs.materialSelect.blur())},clearMaterialChange:function(e){e||(this.queryParam.typeId=null,this.materialTypeName=null)},onSelectMaterial:function(e){e.length&&(this.queryParam.typeId=e[0].id,this.materialTypeName=e[0].name)},onCurrentChange:function(e){var t=e.row;e.$event;2===this.modeType&&(this.$emit("ok",[t]),this.visible=!1)},setRowClass:function(){return 2===this.modeType?"mode-type-choose":""}}},s=r,c=(a("b0c8"),a("2877")),u=Object(c["a"])(s,l,i,!1,null,null,null);t["default"]=u.exports},b0c8:function(e,t,a){"use strict";a("815e")}}]);