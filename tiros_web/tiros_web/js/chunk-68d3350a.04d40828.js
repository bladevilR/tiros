(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-68d3350a","chunk-ccd9324a"],{"389d":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"物资备料",width:"80%",bodyStyle:{height:"70vh"},visible:t.visible,confirmLoading:t.confirmLoading,closable:!0,forceRender:!0,destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-spin",{attrs:{spinning:t.confirmLoading}},[e("ApplyReadyComponent",{ref:"applyReady",on:{ok:t.saveOk,fail:t.saveFail,close:t.close}})],1)],1)},a=[],o=i("ff09"),r={name:"ApplyReadyModal",components:{ApplyReadyComponent:o["default"]},data:function(){return{visible:!1,confirmLoading:!1}},methods:{showModal:function(t){this.visible=!0,this.$refs.applyReady.edit(t)},handleOk:function(){this.confirmLoading=!0,this.$refs.applyReady.save()},saveOk:function(){this.$emit("ok"),this.$message.success("保存成功"),this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},close:function(){this.confirmLoading=!1,this.$emit("close"),this.visible=!1}}},s=r,l=i("2877"),c=Object(l["a"])(s,n,a,!1,null,null,null);e["default"]=c.exports},"51c5":function(t,e,i){"use strict";i("e9d9")},e9d9:function(t,e,i){},ff09:function(t,e,i){"use strict";i.r(e);var n,a=function(){var t=this,e=t._self._c;return e("div",[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"right",overflow:"hidden","margin-bottom":"8px"}},[e("a-space",[t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.autoArrange}},[t._v("自动安排库位")]),t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.arrangePan}},[t._v("批量设置托盘")])],1)],1)])],1),t.isDistribution?t._e():e("div",{staticStyle:{height:"calc(70vh - 45px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,trigger:"row",range:!0}},on:{"checkbox-change":t.checkboxChange,"checkbox-all":t.checkboxChange}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{title:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(i){var n=i.row;return[e("a",{on:{click:function(e){return e.stopPropagation(),t.openDistribution(n)}}},[t._v("发放管理")])]}}],null,!1,768125003)})],1)],1),t.isDistribution?e("div",{staticClass:"panel-main",staticStyle:{height:"calc(70vh - 45px)"}},[e("div",{staticClass:"panel-left"},[e("vxe-table",{ref:"materialTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableData,"radio-config":{highlight:!0,trigger:"row",range:!0,checkMethod:function(){return 0===t.curEditMode}}},on:{"radio-change":t.onRadioChange,"cell-click":t.onMaterialCellClick}},[e("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",width:"160",title:"物资编码"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"名称"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"80"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"80"}})],1)],1),e("div",{staticClass:"panel-right"},[e("div",{staticClass:"ant-alert ant-alert-info",staticStyle:{"margin-bottom":"16px"}},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:t.addDetail}},[t._v("添加发放库位")]),e("a-button",{on:{click:t.closeDistribution}},[t._v("关闭")]),e("span",{staticStyle:{color:"red","margin-left":"15px"}},[t._v(t._s("总量: ".concat(t.selectInfo?t.selectInfo.amount:0,";")))]),e("span",{staticStyle:{color:"red","margin-left":"5px"}},[t._v(t._s("差额：".concat(t.calcAmount)))])],1)],1),e("div",{staticStyle:{height:"calc(100% - 62px)"}},[e("vxe-table",{ref:"distributionTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableDistributionData,"edit-rules":t.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[e("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(i){var n=i.row;return[e("a-select",{ref:"locationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:function(e){return t.openlocationModal(n)}},model:{value:n.sourceLocationName,callback:function(e){t.$set(n,"sourceLocationName",e)},expression:"row.sourceLocationName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,325071706)}),e("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(i){var n=i.row;return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择托盘",open:!1},on:{dropdownVisibleChange:function(e){return t.openPalletModal()}},model:{value:n.palletName,callback:function(e){t.$set(n,"palletName",e)},expression:"row.palletName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,3015230497)}),e("vxe-table-column",{attrs:{field:"tradeNo",title:"所属批次",width:"270","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(i){var n=i.row;return[n.needChooseTradeNo?e("div",[e("a-select",{staticStyle:{width:"100%"},on:{change:function(e){return t.tradeNoCHange(n)}},model:{value:n.tradeNo,callback:function(e){t.$set(n,"tradeNo",e)},expression:"row.tradeNo"}},t._l(n.tradeNoChoiceList,(function(i,n){return e("a-select-option",{key:n,attrs:{value:i.tradeNo}},[t._v(" "+t._s(i.tradeNo)+"    "+t._s(i.price)+" ")])})),1)],1):e("div",[t._v(" "+t._s(n.tradeNo)+" ")])]}}],null,!1,2270284966)}),e("vxe-table-column",{attrs:{field:"amount",title:"发放数量",width:"120",align:"center","edit-render":{name:"$input",props:{type:"number",min:0}}}}),e("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center","show-overflow":!1},scopedSlots:t._u([{key:"default",fn:function(i){var n=i.row;return[n&&!t.$refs.distributionTable.isActiveByRow(n)?e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(n)}}},[t._v("编辑 ")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleDel(n)}}},[t._v("删除")])],1):e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(n)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(n)}}},[t._v("取消")])],1)]}}],null,!1,743031837)})],1)],1)])]):t._e(),e("ApplyDistributionModal",{ref:"distributionModal",on:{ok:t.onSuccess}}),e("PalletList",{ref:"palletModal",attrs:{modeType:2},on:{ok:t.onSelectPallet}}),e("PalletList",{ref:"palletModal2",attrs:{modeType:2},on:{ok:t.onChoosePallet}}),e("LocationList",{ref:"locationModal",attrs:{modeType:2},on:{ok:t.onSelectLocation}})],1)},o=[],r=i("c54ca"),s=i("2eb4"),l=i("4ec3"),c=i("9f49"),u=i("13f1"),d=i("8973");function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function m(t,e,i){return(e=h(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t){var e=p(t,"string");return"symbol"==f(e)?e:e+""}function p(t,e){if("object"!=f(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function o(i,n,a,o){var l=n&&n.prototype instanceof s?n:s,c=Object.create(l.prototype);return v(c,"_invoke",function(i,n,a){var o,s,l,c=0,u=a||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,i){return o=e,s=0,l=t,f.n=i,r}};function m(i,n){for(s=i,l=n,e=0;!d&&c&&!a&&e<u.length;e++){var a,o=u[e],m=f.p,h=o[2];i>3?(a=h===n)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=m&&((a=i<2&&m<o[1])?(s=0,f.v=n,f.n=o[1]):m<h&&(a=i<3||o[0]>n||n>h)&&(o[4]=i,o[5]=n,f.n=h,s=0))}if(a||i>1)return r;throw d=!0,n}return function(a,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(e=s<2?t:l)||!d;){o||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,o){if(s||(a="next"),e=o[a]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=t}else if((e=(d=f.n<0)?l:i.call(n,f))!==r)break}catch(e){o=t,s=1,l=e}finally{c=1}}return{value:e,done:d}}}(i,a,o),!0),c}var r={};function s(){}function l(){}function c(){}e=Object.getPrototypeOf;var u=[][n]?e(e([][n]())):(v(e={},n,(function(){return this})),e),d=c.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,v(t,a,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=c,v(d,"constructor",c),v(c,"constructor",l),l.displayName="GeneratorFunction",v(c,a,"GeneratorFunction"),v(d),v(d,a,"Generator"),v(d,n,(function(){return this})),v(d,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:o,m:f}})()}function v(t,e,i,n){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}v=function(t,e,i,n){function o(e,i){v(t,e,(function(t){return this._invoke(e,i,t)}))}e?a?a(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},v(t,e,i,n)}function g(t,e,i,n,a,o,r){try{var s=t[o](r),l=s.value}catch(t){return void i(t)}s.done?e(l):Promise.resolve(l).then(n,a)}function y(t){return function(){var e=this,i=arguments;return new Promise((function(n,a){var o=t.apply(e,i);function r(t){g(o,n,a,r,s,"next",t)}function s(t){g(o,n,a,r,s,"throw",t)}r(void 0)}))}}function w(t){return k(t)||L(t)||D(t)||N()}function N(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(t,e){if(t){if("string"==typeof t)return x(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?x(t,e):void 0}}function L(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function k(t){if(Array.isArray(t))return x(t)}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}var $={name:"ApplyReadyComponent",components:{ApplyDistributionModal:s["default"],PalletList:c["default"],LocationList:u["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!1},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:""}},data:function(){return{records:[],confirmLoading:!1,tableData:[],tableDistributionData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{status:[0],orderId:""},curRow:null,isDistribution:!1,selectInfo:{},addParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},curEditMode:0,validRules:{sourceLocationName:[{required:!0,message:"请选择库位",trigger:"manual"}],tradeNo:[{required:!0,message:"批次号不能为空",trigger:"manual"}],amount:[{required:!0,message:"请输入数量",trigger:"manual"}]}}},computed:{hasActiveRow:function(){return!!this.$refs.distributionTable.getActiveRecord()},calcAmount:function(){return this.getAmount()}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:(n={tradeNoCHange:function(t){var e=t.tradeNoChoiceList.filter((function(e){return e.tradeNo==t.tradeNo}));t.price=e[0].price},checkboxChange:function(t){this.records=t.records},edit:function(t){this.initDictData(),this.queryParam.orderId=t,this.findList()},findList:function(){var t=this;this.tableData=[],this.records=[],Object(r["bb"])(this.queryParam).then((function(e){e.success?(t.tableData=[].concat(w(t.tableData),w(e.result)),d["a"].joinDistributionInfo(t.tableData),t.distributionTableList=[]):t.$message.error("加载数据失败"),t.$emit("loaded")}))},autoArrange:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<=0?this.$message.warn("请先选择要进行自动安排的记录！"):this.$confirm({content:"将根据现有库存情况自动安排库位，并覆盖原有数据？",okText:"确定",cancelText:"取消",onOk:function(){var i={applyDetailIdList:[],type:0};e.forEach((function(t){i.applyDetailIdList.push(t.id)})),t.confirmLoading=!0,Object(r["k"])(i).then((function(i){if(i.success){var n=i.result.applyDetailList;t.$message.success(i.result.assignResultMessage),e.forEach((function(t){var e=n.find((function(e){return e.id===t.id}));e&&(e.sourceLocationAndPalletName="",e.assignDetailList.forEach((function(t){var i=t.sourceLocationName+" | "+t.amount;t.palletName&&(i+=" | ".concat(t.palletName)),t.tradeNo&&(i+=" | 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=i+" \n"})),Object.assign(t,e))}))}else t.$message.error(i.message);t.confirmLoading=!1}))},onCancel:function(){}})},arrangePan:function(){var t=this.$refs.listTable.getCheckboxRecords();if(t.length<=0)this.$message.warn("请先选择要进行自动安排的记录！");else{var e=t.filter((function(t){return t.assignDetailList.length<=0}));e.length>0?this.$message.warning("请先安排库位信息"):this.$refs.palletModal.showModal()}},onSelectPallet:function(t){var e=this.$refs.listTable.getCheckboxRecords();try{Array.from(e,(function(e){Array.from(e.assignDetailList,(function(e){e.palletId=t[0].id,e.palletName=t[0].name}))})),this.updateAssignInfo(),this.$message.success("设置成功")}catch(i){this.$message.error("设置失败")}},save:function(){var t=y(b().m((function t(e){var i,n,a,o,s=this;return b().w((function(t){while(1)switch(t.n){case 0:if(this.fromFlow){t.n=1;break}i=this.$refs.listTable.getCheckboxRecords(),i.length>0?this.$confirm({content:"是否确认发放选中".concat(i.length,"数据？"),onOk:function(){var t=i.map((function(t,e){return{id:t.id,palletId:t.palletName,receive:t.receive}})),e={id:s.queryParam.orderId,detailList:t};Object(r["i"])(e).then((function(t){t.success?s.$emit("ok"):s.$emit("fail",t)})).catch((function(t){s.$message.error("保存异常"),s.$emit("fail")}))}}):this.$message.error("尚未选中任何数据!"),t.n=6;break;case 1:if(!(this.tableData&&this.tableData.length>0)){t.n=5;break}if(n={id:this.queryParam.orderId,onlySave:e,detailList:this.tableData.filter((function(t){return!t.noSave}))},a=!0,o=this.tableData.filter((function(t){return 0===t.receive})),e||!o.length){t.n=3;break}return t.n=2,new Promise((function(t,e){var i=o.map((function(t){return"["+t.materialTypeName+"-"+t.materialTypeCode+"]缺少"+(t.amount-t.receive)})).join("；");s.$confirm({content:"数量不匹配提醒：  ".concat(i,"  ;  是否继续提交？"),onOk:function(){t(!0)},onCancel:function(){t(!1)}})}));case 2:a=t.v;case 3:if(a){t.n=4;break}return this.$emit("cancel"),t.a(2);case 4:r["i"].call(this,n).then((function(t){t.success?s.$emit("ok"):s.$emit("fail",t)})).catch((function(t){s.$message.error("备料保存异常"),s.$emit("fail",t)})),t.n=6;break;case 5:this.$emit("ok");case 6:return t.a(2)}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),close:function(){this.$emit("close")},initDictData:function(){var t=this;Object(l["f"])(this.dictCode,null).then((function(e){e.success&&e.result&&e.result.map((function(e){t.palletList=t.palletList.concat({label:e.text,value:e.value})}))}))},openDistribution:function(t){this.curRow=t,this.openDistribution(t)},onSuccess:function(t){var e=this;t.forEach((function(i){var n=e.tableData.find((function(t){return t.id===i.applyDetailId}));n.assignDetailList=JSON.parse(JSON.stringify(t)),n.receive=0,n.assignDetailList.forEach((function(t){n.receive+=Number(t.amount);var e=t.sourceLocationName+" | "+t.amount;t.palletName&&(e+=" | ".concat(t.palletName)),t.tradeNo&&(e+=" | 第".concat(t.tradeNo,"批次")),n.sourceLocationAndPalletName+=e+" \n"}))}))},updateAssignInfo:function(){this.tableData.forEach((function(t){t.sourceLocationAndPalletName="",t.assignDetailList.forEach((function(e){var i=e.sourceLocationName+" | "+e.amount;e.palletName&&(i+=" | ".concat(e.palletName)),e.tradeNo&&(i+=" | 第".concat(e.tradeNo,"批次")),t.sourceLocationAndPalletName+=i+" \n"}))}))}},m(m(m(m(m(m(m(m(m(m(n,"openDistribution",(function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isDistribution=!0,this.curEditMode=0,this.$nextTick((function(){t.$refs.materialTable.setRadioRow(e||t.tableData[0]||{}),t.setActiveRow(e||t.tableData[0])}))})),"closeDistribution",(function(){this.hasActiveRow?this.$message.warn("存在未保存数据，请先保存"):(this.isDistribution=!1,this.curEditMode=0)})),"setActiveRow",(function(t){var e=this;this.tableDistributionData=[],this.selectInfo={},this.selectInfo=this.tableData.find((function(e){return e.id===t.id})),this.selectInfo.assignDetailList.forEach((function(t){e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))}))})),"onRadioChange",(function(t){var e=t.row;e&&!this.hasActiveRow&&this.setActiveRow(e)})),"onMaterialCellClick",(function(t){var e=t.$event;e.stopPropagation()})),"addDetail",(function(){var t=this;if(!this.$refs.distributionTable.getActiveRecord()){this.curEditMode=1;var e={applyDetailId:this.selectInfo.id,materialTypeId:this.selectInfo.materialTypeId,amount:this.getAmount()};this.$refs.distributionTable.insertAt(e,-1).then((function(e){var i=e.row;t.$refs.distributionTable.setActiveRow(i)}))}})),"editRowEvent",(function(t){this.$refs.distributionTable.getActiveRecord()||(this.curEditMode=2,this.$refs.distributionTable.setActiveRow(t))})),"getAmount",(function(){if(!this.selectInfo)return 0;var t=0;return this.tableDistributionData.forEach((function(e){t+=Number(e.amount)})),this.selectInfo.amount-t})),"openlocationModal",(function(t){this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,t.applyDetailId,t.id)})),"onSelectLocation",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),i=e.row;i&&(i.locationName=t[0].warehouseName,i.locationWbs=t[0].warehouseWbs,i.sourceLocationName=t[0].sourceLocationName,i.tradeNo=t[0].tradeNo,i.price=t[0].price,i.needChooseTradeNo=t[0].needChooseTradeNo,i.tradeNoChoiceList=t[0].tradeNoChoiceList,i.locationNum=t[0].usableAmount,this.calcAmount>i.locationNum?i.amount=i.locationNum:this.calcAmount>0&&this.calcAmount<=i.locationNum?i.amount=this.calcAmount:i.amount=0)}})),m(m(m(m(m(n,"saveRowEvent",(function(t){var e=this;this.$refs.distributionTable.validate(t,(function(i){if(!i){if(e.tableDistributionData.find((function(e){return e.sourceLocationName===t.sourceLocationName&&e.tradeNo===t.tradeNo}))&&1===e.curEditMode)return void e.$message.warn("该仓库该批次的物资记录已存在");if("number"===typeof t.locationNum&&t.amount>t.locationNum)return void e.$message.warn("该仓库该批次的物资库存量不足");var n=0;if(e.tableDistributionData.forEach((function(e){e.sourceLocationName,t.sourceLocationName,e.tradeNo!==t.tradeNo&&(n+=Number(e.amount))})),n+Number(t.amount)>Number(e.selectInfo.amount))return void e.$message.warn("选择的实际数量超过了发放数量");1===e.curEditMode&&(t.isNew=!0,e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))),e.$refs.distributionTable.clearActived(),e.onSuccess(e.tableDistributionData),e.curEditMode=0}}))})),"cancelRowEvent",(function(t){this.$refs.distributionTable.clearActived(),1===this.curEditMode?this.$refs.distributionTable.remove(t):2===this.curEditMode&&this.$refs.distributionTable.revertData(t),this.curEditMode=0})),"handleDel",(function(t){var e=this;this.$refs.distributionTable.getActiveRecord()||(this.$confirm({content:"是否删除选中的数据？",okText:"确定",cancelText:"取消",onOk:function(){e.tableDistributionData.splice(e.tableDistributionData.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1);var i=e.tableData.find((function(e){return e.id===t.applyDetailId}));i.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName}))&&(i.receive-=i.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName})).amount,i.assignDetailList.splice(i.assignDetailList.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1)),e.$nextTick((function(){e.locationMaxAmount=e.calcAmount}))}}),this.curEditMode=0)})),"openPalletModal",(function(){this.$refs.palletModal2.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName)})),"onChoosePallet",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),i=e.row;i&&(i.palletId=t[0].id,i.palletName=t[0].name)}})))},T=$,A=(i("51c5"),i("2877")),S=Object(A["a"])(T,a,o,!1,null,"efd43ef8",null);e["default"]=S.exports}}]);