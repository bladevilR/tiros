(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8d26467e","chunk-6f12c91d"],{"0185":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bodyWrapper"},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"物资"}},[t("a-input",{attrs:{placeholder:"物资编号或名称",allowClear:""},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"物资类别"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_material_type"},model:{value:e.queryParam.materialCategory,callback:function(t){e.$set(e.queryParam,"materialCategory",t)},expression:"queryParam.materialCategory"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"是否确认"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_state"},model:{value:e.queryParam.confirm,callback:function(t){e.$set(e.queryParam,"confirm",t)},expression:"queryParam.confirm"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)])],1),t("a-row",{attrs:{gutter:24}},[t("a-col",[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")]),t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),t("a-button",{attrs:{disabled:!e.btnStatus.edit},on:{click:e.handleEdit}},[e._v("修改")]),t("a-button",{attrs:{disabled:!e.btnStatus.delJudge},on:{click:e.deleteRecord}},[e._v("删除")]),t("a-button",{attrs:{disabled:!e.btnStatus.edit},on:{click:e.handlePutStock}},[e._v("确认已入库")]),t("a-button",{attrs:{disabled:!e.btnStatus.look},on:{click:e.viewPutStockDetail}},[e._v("查看入库信息")])],1)],1)])],1)],1)],1),t("div",{style:e.tableHeight.top},[t("vxe-table",{ref:"listTable",style:e.tableHeight.bottom,attrs:{border:"",align:e.allAlign,"max-height":e.tableHeight.size,data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row"}},on:{"checkbox-change":function(t){return e.btnStatus.update()},"checkbox-all":function(t){return e.btnStatus.update()}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称",width:"200","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCategory1_dictText",title:"物资类别",width:"100","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"entryNo",title:"入库单号","min-width":"150"}}),t("vxe-table-column",{attrs:{field:"entryDate",title:"入库日期",width:"120"}}),t("vxe-table-column",{attrs:{field:"amount",align:"right","header-align":"center",title:"入库数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"80"}}),t("vxe-table-column",{attrs:{field:"price",align:"right","header-align":"center",title:"单价",width:"100"}}),t("vxe-table-column",{attrs:{field:"totalPrice",align:"right","header-align":"center",title:"金额",width:"120"}}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"selfWarehouseName2",title:"二级库",width:"100"}}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"selfWarehouseName",title:"存放库位",width:"120"}}),t("vxe-table-column",{attrs:{field:"confirm_dictText",title:"已确认？",width:"100"}}),t("vxe-table-column",{attrs:{field:"confirmUserName",title:"确认人",width:"100"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"物资描述","min-width":"220","header-align":"center",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("put-stock-item-modal",{ref:"modalForm",on:{ok:function(t){return e.loadData()}}}),t("PutStocktemModal",{ref:"modalForms",on:{ok:function(t){return e.loadData()}}}),t("PutStockViewModal",{ref:"viewDetails"}),t("j-import-modal",{ref:"importModal",attrs:{sum:1,url:"/import/materialEntryOrder"},on:{ok:function(t){return e.loadData()}}})],1)},r=[],n=a("c54ca"),l=a("e830"),o=a("ab1b"),s=a("4df6"),d=a("7c93"),c=a("54f6"),u={name:"List",components:{PutStockItemModal:l["default"],JImportModal:d["default"],PutStocktemModal:o["default"],PutStockViewModal:s["default"]},data:function(){return{component:null,queryParam:{confirm:"",entryClass:"",materialCategory:"",warehouseId:"",searchText:"",pageNo:1,pageSize:10},totalResult:0,allAlign:"center",tableData:[],btnStatus:new c["a"](this,"listTable",{attrs:[{key:"edit",judge:function(e){return 1!==e.confirm}},{key:"look",judge:function(e){return 1==e.confirm}},{key:"delJudge",isDel:!0,judge:function(e){return 1!==e.confirm}}]}),tableHeight:{top:"height: calc(100vh - 267px)",bottom:"height: calc(100vh - 267px)",size:"100%"}}},created:function(){this.findList()},methods:{viewPutStockDetail:function(){var e=this.$refs.listTable.getCheckboxRecords();if(e&&e.length){var t=e[0];this.$refs.viewDetails.showModal(t)}},handlePutStock:function(){var e=this.$refs.listTable.getCheckboxRecords();if(1===e.length){var t=e[0];if(1===e[0].confirm)return void this.$message.warn("该物资已入库,不可重复确认入库!");this.$refs.modalForms.edit(t),this.$refs.modalForms.title="确认入库"}else e.length>1?this.$message.error("只能选择一条数据!"):this.$message.error("尚未选中任何数据!")},findList:function(){var e=this;this.queryParam.lineId=this.lineId,Object(n["pb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.btnStatus.update()}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},loadData:function(){this.findList(),this.$emit("load")},handleAdd:function(){this.$refs.modalForm.add(),this.$refs.modalForm.title="新增"},handleEdit:function(e){var t=this.$refs.listTable.getCheckboxRecords();1!==t[0].confirm?e.id?(this.$refs.modalForm.edit(e),this.$refs.modalForm.title="编辑"):1==t.length?(this.$refs.modalForm.edit(t[0]),this.$refs.modalForm.title="编辑"):this.$message.error("请选中一项数据!"):this.$message.warn("该物资已入库,不可修改!")},deleteRecord:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();if(t.length>0){var a=t.filter((function(e){return 1===e.confirm}));if(a.length>0)return void this.$message.warn("已确认入库的物资不能进行删除");this.$confirm({content:"是否删除选中".concat(t.length,"数据？"),onOk:function(){var a=t.map((function(e,t){return e.id})).join(",");Object(n["u"])("ids="+a).then((function(t){e.findList(),e.$message.success(t.message)}))}})}else this.$message.error("尚未选中任何数据!")}}},f=u,h=a("2877"),m=Object(h["a"])(f,i,r,!1,null,null,null);t["default"]=m.exports},"0dd8":function(e,t,a){"use strict";a("e637")},"13f1":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{ref:"locationModalRef",class:{"na-footer-none":2===e.modeType},attrs:{title:"库位选择",width:"80%",bodyStyle:{height:"70vh"},visible:e.visible,centered:!0,confirmLoading:e.confirmLoading,closable:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"库位选择"}},[t("a-checkbox-group",{attrs:{name:"checkboxgroup",options:e.options},on:{change:e.findList},model:{value:e.warehouseLevelList,callback:function(t){e.warehouseLevelList=t},expression:"warehouseLevelList"}})],1)],1),t("a-col",{attrs:{md:12}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 66px)"},attrs:{id:"location_table_main"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto","show-overflow":"tooltip",data:e.tableData,"tree-config":{key:"warehouseId",children:"children",expandAll:!0},"radio-config":{highlight:!0,trigger:"row"},"row-class-name":e.setRowClass},on:{"update:data":function(t){e.tableData=t},"cell-click":e.onCurrentChange}},[1===e.modeType?t("vxe-table-column",{attrs:{type:"radio",width:"40px"}}):e._e(),t("vxe-table-column",{attrs:{field:"sourceLocationName",width:"200",title:"所属组织","header-align":"center",align:"left","tree-node":""}}),t("vxe-table-column",{attrs:{width:"80",field:"warehouseLevel",title:"库位级别",formatter:e.formatLevel}}),t("vxe-table-column",{attrs:{width:"120",field:"materialTypeCode",title:"物资编码"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"130","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"tradeNo",width:"200",title:"所属批次"}}),t("vxe-table-column",{attrs:{width:"80",field:"amount",title:"当前库存"}}),t("vxe-table-column",{attrs:{width:"80",field:"usableAmount",title:"可用库存"}}),t("vxe-table-column",{attrs:{width:"160",field:"usedDetailInfo",title:"占用详情","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{width:"80",field:"price",title:"价格"}}),t("vxe-table-column",{attrs:{width:"80",field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialType_dictText",title:"物料分类"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialAttr_dictText",title:"物料属性"}}),t("vxe-table-column",{attrs:{field:"spec",title:"物料描述","min-width":"100","header-align":"center",align:"left"}})],1)],1):e._e()])},r=[],n=a("c54ca");function l(e){return c(e)||d(e)||s(e)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return u(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?u(e,t):void 0}}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function c(e){if(Array.isArray(e))return u(e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}var f={name:"LocationList",props:{multiple:{type:Boolean,default:!1},modeType:{type:Number,default:1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,tableData:[],selectMaterialTypeId:"",warehouseLevelList:[],options:[{label:"三级库",value:3},{label:"四级库",value:4}]}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0}))},created:function(){},methods:{showModal:function(e,t,a){this.visible=!0,this.selectMaterialTypeId=e,this.findList(t,a)},findList:function(e,t){var a=this;Object(n["yb"])({warehouseLevelList:this.warehouseLevelList,materialTypeId:this.selectMaterialTypeId,applyDetailId:e,assignDetailId:t}).then((function(e){e.success&&(a.tableData=[],a.tableData=a.buildTree(e.result),a.$nextTick((function(){a.$refs.listTable.setAllTreeExpand(!0)})))}))},buildTree:function(e){var t=e.reduce((function(e,t,a){return e[t.warehouseId]=a,e}),{}),a=[];return e.forEach((function(i){if(null===i.parentId)a.push(i);else{var r=e[t[i.parentId]];r?r.children=[].concat(l(r.children||[]),[i]):a.push(i)}})),a},formatLevel:function(e){var t=e.cellValue,a=parseInt(t);return a-1},handleOk:function(){var e=this.$refs.listTable.getRadioRecord();e.children?this.$message.warn("该库位还有下级库位，请选择下级库位！"):(this.$emit("ok",e?[e]:[]),this.visible=!1)},saveOk:function(){this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},close:function(){this.visible=!1,Object.assign(this.$data,this.$options.data())},openPalletModal:function(){this.$refs.palletSelect.blur()},openlocationModal:function(){this.$refs.materialToolsModal.showModal(),this.$refs.locationSelect.blur()},onCurrentChange:function(e){var t=e.row,a=e.$event;2===this.modeType&&(t.children&&t.children.length&&!/vxe-tree--node-btn/.test(a.target.className)?this.$refs.listTable.setTreeExpand([t],!this.$refs.listTable.isTreeExpandByRow(t)):(this.$emit("ok",[t]),this.visible=!1))},setRowClass:function(e){e.row;return 2===this.modeType?"mode-type-choose":""}}},h=f,m=(a("1892"),a("2877")),p=Object(m["a"])(h,i,r,!1,null,null,null);t["default"]=p.exports},1892:function(e,t,a){"use strict";a("9424")},"4df6":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{title:"入库明细查看",width:1100,visible:e.visible,destroyOnClose:!0},on:{cancel:function(t){e.visible=!1}}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("div",{staticClass:"descriptionBox"},[t("a-descriptions",{attrs:{bordered:"",column:6}},[t("a-descriptions-item",{attrs:{label:"物资编码",span:2}},[e._v(e._s(e.detailData.materialTypeCode))]),t("a-descriptions-item",{attrs:{label:"物资名称",span:2}},[e._v(e._s(e.detailData.materialTypeName))]),t("a-descriptions-item",{attrs:{label:"入库数量",span:2}},[e._v(e._s(e.detailData.amount))]),t("a-descriptions-item",{attrs:{label:"二级库位",span:2}},[e._v(e._s(e.detailData.selfWarehouseName))]),t("a-descriptions-item",{attrs:{label:"生产日期",span:2}},[e._v(e._s(e.detailData.productionDate))]),t("a-descriptions-item",{attrs:{label:"失效日期",span:2}},[e._v(e._s(e.detailData.expirDate))]),t("a-descriptions-item",{attrs:{label:"有效期",span:2}},[e._v(e._s(e.detailData.expirDay))]),t("a-descriptions-item",{attrs:{label:"物资属性",span:2}},[e._v(e._s(e.detailData.materialAttr))])],1)],1),t("div",[t("a-divider",{attrs:{orientation:"left"}},[e._v(" 入库明细 ")]),t("div",{staticStyle:{height:"200px"}},[t("vxe-table",{ref:"listTable",attrs:{height:"auto",align:"center",border:"",data:e.detailList,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"show-overflow":"tooltip"}},[t("vxe-table-column",{attrs:{type:"seq",width:"80",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"amount",title:"入库数量",width:"200"}}),t("vxe-table-column",{attrs:{field:"selfWarehouseName",title:"移入四级库"}})],1)],1)],1)])],1)],1)},r=[],n=a("c54ca"),l={name:"PutStockViewModal",data:function(){return{visible:!1,confirmLoading:!1,detailData:{},detailList:[]}},created:function(){},methods:{showModal:function(e){var t=this;this.visible=!0,this.confirmLoading=!0,Object(n["Q"])({entryDetailId:e.id}).then((function(e){e.success&&(t.detailData=e.result,t.detailList=e.result.levelFourDetail),t.confirmLoading=!1})).catch((function(e){t.confirmLoading=!1}))}}},o=l,s=(a("fd28"),a("2877")),d=Object(s["a"])(o,i,r,!1,null,"3e2092e5",null);t["default"]=d.exports},"4f36":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{visible:e.visible,title:"库位选择",centered:"",bodyStyle:{maxHeight:"60vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"scroll-main"},[e.treeData.length?t("a-tree",{attrs:{checkStrictly:"","tree-data":e.treeData,"default-selected-keys":e.defaultSelectedKeys,replaceFields:{title:"name",key:"id"}},on:{select:e.handleTreeSelect}}):e._e()],1)])},r=[],n=a("c54ca"),l={name:"WareHouseTree",props:{multiple:{type:Boolean,default:!0},id:{type:String,default:""}},data:function(){return{queryParam:{bookId:""},treeData:[],visible:!1,defaultSelectedKeys:[],selectRecords:[],treeNodeId:""}},methods:{showModal:function(e){this.treeNodeId=e,this.visible=!0,this.findList()},findList:function(){var e=this;Object(n["Eb"])().then((function(t){t.success&&(e.treeNodeId?e.treeData=[e.getNode(t.result,e.treeNodeId)]:e.treeData=t.result,id?e.defaultSelectedKeys[0]=id:e.defaultSelectedKeys[0]=t.result[0].id)}))},handleTreeSelect:function(e,t){var a=this,i=t.selectedNodes;this.selectRecords=[],e.forEach((function(e,t){var r={id:e,name:i[t].data.props.name};a.selectRecords.push(r)}))},handleOk:function(){this.$emit("ok",this.selectRecords),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},getNode:function(e,t){var a={};function i(e,t){e.map((function(e){e.id==t?a=e:e.children&&i(e.children,t)}))}return i(e,t),a}}},o=l,s=(a("0dd8"),a("2877")),d=Object(s["a"])(o,i,r,!1,null,"28ec9b42",null);t["default"]=d.exports},"54f6":function(e,t,a){"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function l(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e){var t=s(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t){if("object"!=i(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}a.d(t,"a",(function(){return d}));var d=function(){function e(t,a){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),this.options={attrs:[]},Object.assign(this.options,n),this.options.attrs.find((function(e){return"edit"===e.key}))||this.options.attrs.push({key:"edit"}),this.options.attrs.forEach((function(e){Object.hasOwnProperty.call(e,"key")&&(i[e.key]=!1),Object.hasOwnProperty.call(e,"judge")||(e["judge"]=function(e){return!0})})),this.del=!1,this.nextTick=t.$nextTick,this.refs=t.$refs,this.refName=a,t.$nextTick((function(){i.vxeTable=t.$refs[a]}))}return l(e,[{key:"editRow",get:function(){if(this.edit){var e=this.vxeTable.getCheckboxRecords();return e.length?e[0]:{}}return{}}},{key:"update",value:function(){var e=this;this.nextTick((function(){e.vxeTable||(e.vxeTable=e.refs[e.refName]);var t=e.vxeTable.getCheckboxRecords();e.del=t.length>0,e.options.attrs.forEach((function(a){for(var i in a)Object.hasOwnProperty.call(a,i)&&(a["isDel"]?t.length?e[a.key]=t.length>0&&a.judge(t[0]):e[a.key]=!1:t.length?e[a.key]=1===t.length&&a.judge(t[0]):e[a.key]=!1)}))}))}}])}()},"65b0":function(e,t,a){},"7c93":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"导入EXCEL",width:600,visible:e.visible,confirmLoading:e.uploading},on:{cancel:e.handleClose}},[t("a-upload",{attrs:{name:"file",multiple:!1,accept:".xls,.xlsx",fileList:e.fileList,remove:e.handleRemove,beforeUpload:e.beforeUpload}},[t("a-button",{attrs:{disabled:e.fileList.length>=e.sum}},[t("a-icon",{attrs:{type:"upload"}}),e._v(" 选择导入文件 ")],1)],1),t("template",{slot:"footer"},[t("a-button",{on:{click:e.handleClose}},[e._v("关闭")]),t("a-button",{attrs:{type:"primary",disabled:0===e.fileList.length,loading:e.uploading},on:{click:e.handleImport}},[e._v(" "+e._s(e.uploading?"导入中...":"开始导入")+" ")])],1)],2)},r=[],n=a("0fea");function l(e){return c(e)||d(e)||s(e)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return u(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?u(e,t):void 0}}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function c(e){if(Array.isArray(e))return u(e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}var f={name:"JImportModal",props:{url:{type:String,default:"",required:!1},biz:{type:String,default:"",required:!1},sum:{type:Number,default:6}},data:function(){return{visible:!1,uploading:!1,fileList:[],uploadAction:"",foreignKeys:""}},watch:{url:function(e){e&&(this.uploadAction=e)}},created:function(){this.uploadAction=this.url},methods:{handleClose:function(){this.visible=!1},show:function(e){this.fileList=[],this.uploading=!1,this.visible=!0,this.foreignKeys=e},handleRemove:function(e){var t=this.fileList.indexOf(e),a=this.fileList.slice();a.splice(t,1),this.fileList=a},beforeUpload:function(e){return this.fileList=[].concat(l(this.fileList),[e]),!1},handleImport:function(){var e=this,t=this.fileList,a=new FormData;this.biz&&a.append("isSingleTableImport",this.biz),this.foreignKeys&&this.foreignKeys.length>0&&a.append("foreignKeys",this.foreignKeys),t.forEach((function(e){a.append("file",e)})),this.uploading=!0,Object(n["j"])(this.uploadAction,a).then((function(t){e.uploading=!1,t.success?(e.$message.success(t.message),e.visible=!1,e.$emit("ok")):e.$message.warning(t.message)}))}}},h=f,m=a("2877"),p=Object(m["a"])(h,i,r,!1,null,"1a506ff3",null);t["default"]=p.exports},9424:function(e,t,a){},ab1b:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{dialogStyle:{top:"85px"},title:e.title,width:900,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物资编码"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["materialTypeCode",e.validatorRules.materialTypeCode],expression:"['materialTypeCode', validatorRules.materialTypeCode]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,disabled:""}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物资名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["materialTypeName",e.validatorRules.materialTypeName],expression:"['materialTypeName', validatorRules.materialTypeName]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,disabled:""}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"入库数量"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["confirmAmount",e.validatorRules.confirmAmount],expression:"['confirmAmount', validatorRules.confirmAmount]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,disabled:"",max:9999999}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"二级库位"}},[t("j-tree-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["selfWarehouseId",e.validatorRules.selfWarehouseId],expression:"['selfWarehouseId', validatorRules.selfWarehouseId]",modifiers:{trim:!0}}],attrs:{disabled:"",placeholder:"请选择存放位置",dict:"bu_mtr_warehouse,name,id",pidField:"parent_id"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"生产日期"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["productionDate",e.validatorRules.productionDate],expression:"['productionDate', validatorRules.productionDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","disabled-date":e.disabledStartDate},on:{openChange:e.handleStartOpenChange}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"失效日期"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["expirDate",e.validatorRules.expirDate],expression:"['expirDate', validatorRules.expirDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","disabled-date":e.disabledEndDate,open:e.endOpen},on:{change:e.handleExpirDate,openChange:e.handleEndOpenChange}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"有效期"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["expirDay"],expression:"['expirDay']",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入有效期",min:0,max:99999999},on:{change:e.expirDayChange}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物资属性"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["materialAttr"],expression:"['materialAttr']",modifiers:{trim:!0}}],attrs:{placeholder:"请选择物资属性",dictCode:"bu_material_attr",triggerChange:!0}})],1)],1)],1)],1),t("div",[t("a-divider",{attrs:{orientation:"left"}},[e._v(" 入库明细 ")]),t("a-row",{staticStyle:{"margin-bottom":"12px"},attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-space",[t("a-button",{on:{click:e.addDetailItem}},[e._v("新增")]),t("a-button",{on:{click:e.delDetailItem}},[e._v("删除")])],1)],1)],1),t("div",{staticStyle:{height:"200px"}},[t("vxe-table",{ref:"listTable",attrs:{height:"auto",align:"center",border:"",data:e.detailList,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"show-overflow":"tooltip"}},[t("vxe-table-column",{attrs:{type:"seq",width:"80",fixed:"left"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"amount",title:"入库数量",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("div",{on:{click:function(e){e.stopPropagation()}}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"输入入库数量",min:0},model:{value:i.amount,callback:function(t){e.$set(i,"amount",t)},expression:"row.amount"}})],1)]}}])}),t("vxe-table-column",{attrs:{field:"selfWarehouseId",title:"移入四级库"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row,r=a.rowIndex;return[t("div",{on:{click:function(e){e.stopPropagation()}}},[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(t){return e.openWareHouseTree(r)}},model:{value:i.selfWarehouseName,callback:function(t){e.$set(i,"selfWarehouseName",t)},expression:"row.selfWarehouseName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)]}}])})],1)],1)],1)],1)],1),t("WareHouseTree",{ref:"wareHouseTree",on:{ok:e.onSelectLocation}})],1)},r=[],n=a("c1df"),l=a.n(n),o=(a("5c3a"),a("c54ca")),s=a("b098"),d=a("ca00"),c=a("4f36");function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}var f={name:"PutStockItemModal",components:{JTreeSelect:s["default"],WareHouseTree:c["default"]},data:function(){return{rowIndex:null,title:"操作",visible:!1,buMaterialEntryDetailId:"",model:{},endOpen:!1,labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:15}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{materialTypeCode:{rules:[{required:!0}]},materialTypeName:{rules:[{required:!0}]},confirmAmount:{rules:[{required:!0,message:"请输入库数量!"}]},selfWarehouseId:{rules:[{required:!0,message:"请选择存放位置!"}]}},detailList:[]}},created:function(){},methods:{moment:l.a,expirDayChange:function(e){var t=this.form.getFieldValue("productionDate");if(e&&t){var a=l()(t).add(e-1,"days");this.form.setFieldsValue({expirDate:a})}},openWareHouseTree:function(e){this.rowIndex=e;var t=this.form.getFieldValue("selfWarehouseId");this.$refs.wareHouseTree.showModal(t)},onSelectLocation:function(e){e.length>0&&(this.detailList[this.rowIndex].selfWarehouseId=e[0].id,this.detailList[this.rowIndex].selfWarehouseName=e[0].name)},validatirEvent:function(){var e=!0,t=0,a=JSON.parse(JSON.stringify(this.detailList));if(a.length>0)for(var i=0,r=a.length;i<r;i++){var n=a[i];if(n.amount<=0){e=!1,this.$message.warning("明细序号 ".concat(i+1," 的入库数量不能小于1"));break}if(!n.selfWarehouseId){e=!1,this.$message.warning("明细序号 ".concat(i+1," 的移入四级库位不能为空"));break}delete a[i].selfWarehouseName,delete a[i]._XID,t+=n.amount}else e=!1,this.$message.warning("请添加入库明细");var l=this.form.getFieldValue("confirmAmount");return e&&t!=l?(e=!1,this.$message.warning("司机库位的总库存量".concat(t>l?"大":"小","于入库数量"))):this.model.confirmVO=a,e},addDetailItem:function(){this.detailList.push({amount:0,selfWarehouseId:"",selfWarehouseName:""})},delDetailItem:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?t.forEach((function(t){for(var a=0;a<e.detailList.length;a++){var i=e.detailList[a];t._XID==i._XID&&e.detailList.splice(a,1)}})):this.$message.error("尚未选中任何数据!")},edit:function(e){var t=this;this.form.resetFields(),this.visible=!0,"object"===u(e)?(this.buMaterialEntryDetailId=e.id,this.model.entryOrderId=e.entryOrderId,this.$nextTick((function(){t.form.setFieldsValue({materialTypeCode:e.materialTypeCode,materialTypeName:e.materialTypeName,confirmAmount:e.amount,selfWarehouseId:e.selfWarehouseId,productionDate:e.productionDate,expirDate:e.expirDate,expirDay:e.expirDay,confirmVO:[]}),e.expirDate&&e.productionDate&&t.handleExpirDate(e.expirDate)}))):this.buMaterialEntryDetailId=e},handleExpirDate:function(e){var t=this,a=this.form.getFieldValue("productionDate");if(a){var i=this.moment(a),r=this.moment(e),n=r.diff(i,"day")+1;this.$nextTick((function(){t.form.setFieldsValue({expirDay:n})}))}else this.$message.warn("请选择生产日期!")},disabledStartDate:function(e){var t=this.form.getFieldValue("expirDate");return!(!e||!t)&&e.valueOf()>t.valueOf()},disabledEndDate:function(e){var t=this.form.getFieldValue("productionDate");return!(!e||!t)&&t.valueOf()>=e.valueOf()},handleStartOpenChange:function(e){e||(this.endOpen=!0)},handleEndOpenChange:function(e){this.endOpen=e},handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,i){if(!a){if(!e.validatirEvent())return!1;var r=Object.assign(t.model,i,{productionDate:Object(d["e"])(i.productionDate)?"":l()(i.productionDate).format("YYYY-MM-DD"),expirDate:Object(d["e"])(i.expirDate)?"":l()(i.expirDate).format("YYYY-MM-DD")});r["buMaterialEntryDetailId"]=e.buMaterialEntryDetailId,e.$confirm({content:"确认入库后不可修改，是否确认？",onOk:function(){return t.confirmLoading=!0,Object(o["P"])(r).then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok"),t.close()):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1}))},okText:"确认",cancelText:"取消"})}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},h=f,m=a("2877"),p=Object(m["a"])(h,i,r,!1,null,null,null);t["default"]=p.exports},b0cd:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"选择部门",width:e.modalWidth,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭"},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{tip:"Loading...",spinning:!1}},[t("a-input-search",{staticStyle:{"margin-bottom":"1px"},attrs:{placeholder:"请输入部门名称按回车进行搜索"},on:{search:e.onSearch}}),t("a-tree",{attrs:{checkable:"",treeData:e.treeData,checkStrictly:!0,autoExpandParent:e.autoExpandParent,expandedKeys:e.expandedKeys,checkedKeys:e.checkedKeys},on:{check:e.onCheck,select:e.onSelect,expand:e.onExpand},scopedSlots:e._u([{key:"title",fn:function(a){var i=a.title;return[i.indexOf(e.searchValue)>-1?t("span",[e._v(" "+e._s(i.substr(0,i.indexOf(e.searchValue)))+" "),t("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchValue))]),e._v(" "+e._s(i.substr(i.indexOf(e.searchValue)+e.searchValue.length))+" ")]):t("span",[e._v(e._s(i))])]}}])})],1)],1)},r=[],n=a("4ec3");function l(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=d(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,l=!0,o=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return l=e.done,e},e:function(e){o=!0,n=e},f:function(){try{l||null==a.return||a.return()}finally{if(o)throw n}}}}function o(e){return u(e)||c(e)||d(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){if(e){if("string"==typeof e)return f(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?f(e,t):void 0}}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function u(e){if(Array.isArray(e))return f(e)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}var h={name:"JSelectDepartModal",props:["modalWidth","multi","rootOpened","departId"],data:function(){return{visible:!1,confirmLoading:!1,treeData:[],autoExpandParent:!0,expandedKeys:[],dataList:[],checkedKeys:[],checkedRows:[],searchValue:""}},created:function(){this.loadDepart()},watch:{departId:function(){this.initDepartComponent()},visible:{handler:function(){this.departId?this.checkedKeys=this.departId.split(","):this.checkedKeys=[]}}},methods:{show:function(){this.visible=!0,this.checkedRows=[],this.checkedKeys=[]},loadDepart:function(){var e=this;Object(n["H"])().then((function(t){if(t.success){var a=o(t.result);e.reWriterWithSlot(a),e.treeData=a,e.initDepartComponent(),e.rootOpened&&e.initExpandedKeys(t.result)}}))},initDepartComponent:function(){var e="";if(this.departId){var t,a=this.departId,i=l(this.dataList);try{for(i.s();!(t=i.n()).done;){var r=t.value;a.indexOf(r.key)>=0&&(e+=","+r.title)}}catch(n){i.e(n)}finally{i.f()}e&&(e=e.substring(1))}this.$emit("initComp",e)},reWriterWithSlot:function(e){var t,a=l(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i.children&&i.children.length>0){this.reWriterWithSlot(i.children);var r=Object.assign({},i);r.children={},this.dataList.push(r)}else this.dataList.push(i),i.scopedSlots={title:"title"}}}catch(n){a.e(n)}finally{a.f()}},initExpandedKeys:function(e){if(e&&e.length>0){var t,a=[],i=l(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.children&&r.children.length>0&&a.push(r.id)}}catch(n){i.e(n)}finally{i.f()}this.expandedKeys=[].concat(a)}else this.expandedKeys=[]},onCheck:function(e,t){var a=this;if(this.multi)this.checkedKeys=e.checked,this.checkedRows=this.getCheckedRows(this.checkedKeys);else{var i=e.checked.filter((function(e){return a.checkedKeys.indexOf(e)<0}));this.checkedKeys=o(i),this.checkedRows=0===this.checkedKeys.length?[]:[t.node.dataRef]}},onSelect:function(e,t){var a=[];if(a.push(e[0]),this.checkedKeys&&0!==this.checkedKeys.length&&this.multi){var i,r=t.node.dataRef.key;if(this.checkedKeys.indexOf(r)>=0)this.checkedKeys=this.checkedKeys.filter((function(e){return e!==r}));else(i=this.checkedKeys).push.apply(i,a)}else this.checkedKeys=[].concat(a),this.checkedRows=[t.node.dataRef];this.checkedRows=this.getCheckedRows(this.checkedKeys)},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},handleSubmit:function(){this.checkedKeys&&0!=this.checkedKeys.length?this.$emit("ok",this.checkedRows,this.checkedKeys.join(",")):this.$emit("ok",""),this.handleClear()},handleCancel:function(){this.handleClear()},handleClear:function(){this.visible=!1,this.checkedKeys=[]},getParentKey:function(e,t){for(var a,i=0;i<t.length;i++){var r=t[i];r.children&&(r.children.some((function(t){return t.key===e}))?a=r.key:this.getParentKey(e,r.children)&&(a=this.getParentKey(e,r.children)))}return a},onSearch:function(e){var t=this,a=this.dataList.map((function(a){return a.title.indexOf(e)>-1?t.getParentKey(a.key,t.treeData):null})).filter((function(e,t,a){return e&&a.indexOf(e)===t}));Object.assign(this,{expandedKeys:a,searchValue:e,autoExpandParent:!0})},getCheckedRows:function(e){var t,a=function(e,t){var i,r=l(e);try{for(r.s();!(i=r.n()).done;){var n=i.value;if(n.id===t)return n;if(n.children instanceof Array){var o=a(n.children,t);if(null!=o)return o}}}catch(s){r.e(s)}finally{r.f()}return null},i=[],r=l(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,o=a(this.treeData,n);null!=o&&i.push(o)}}catch(s){r.e(s)}finally{r.f()}return i}}},m=h,p=a("2877"),b=Object(p["a"])(m,i,r,!1,null,"4907a211",null);t["default"]=b.exports},c94f:function(e,t,a){"use strict";a("fef4")},e637:function(e,t,a){},e830:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("j-modal",{attrs:{title:e.title,width:"70%",visible:e.visible,confirmLoading:e.confirmLoading,fullscreen:"",destroyOnClose:!0,cancelText:"关闭"},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{staticStyle:{margin:"0"},attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"入库单号"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["entryNo"],expression:"['entryNo']",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{placeholder:"入库单号,自动生成",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"移入日期"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["entryDate",e.validatorRules.entryDate],expression:"['entryDate', validatorRules.entryDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"移入部门"}},[t("j-select-depart",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["entryDeptId",e.validatorRules.entryDeptId],expression:"['entryDeptId', validatorRules.entryDeptId]",modifiers:{trim:!0}}],attrs:{placeholder:"请选择移入部门",rootOpened:!1}})],1)],1)],1),t("a-row",{staticStyle:{margin:"0",padding:"0 12px"},attrs:{gutter:24}},[t("a-divider",{staticStyle:{margin:"0 0 12px","font-size":"14px"},attrs:{orientation:"left"}},[e._v(" 入库明细 ")]),t("a-row",{staticStyle:{"margin-bottom":"12px"},attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-button",{staticStyle:{"margin-right":"12px"},on:{click:e.addDetailItem}},[e._v("新增")]),t("a-button",{on:{click:e.delDetailItem}},[e._v("删除")])],1)],1),t("div",{style:e.tableHeight.top},[t("vxe-table",{ref:"listTable",attrs:{height:e.tableHeight.size,align:"center",border:"",data:e.detailList,"show-overflow":"tooltip","edit-rules":e.validRules,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a-input",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物资",open:!1},on:{click:function(t){return e.openMaterialSelectModal(i)}},model:{value:i.materialTypeCode,callback:function(t){e.$set(i,"materialTypeCode",t)},expression:"row.materialTypeCode"}},[t("a-icon",{attrs:{slot:"suffix",type:"ellipsis"},slot:"suffix"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a-input",{staticStyle:{width:"100%"},attrs:{placeholder:"输入物资名称",disabled:""},model:{value:i.materialTypeName,callback:function(t){e.$set(i,"materialTypeName",t)},expression:"row.materialTypeName"}})]}}])}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"物资描述",width:"300"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a-input",{staticStyle:{width:"100%"},attrs:{placeholder:"输入物资描述",disabled:""},model:{value:i.materialTypeSpec,callback:function(t){e.$set(i,"materialTypeSpec",t)},expression:"row.materialTypeSpec"}})]}}])}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a-input",{staticStyle:{width:"100%"},attrs:{placeholder:"输入单位",disabled:""},model:{value:i.materialTypeUnit,callback:function(t){e.$set(i,"materialTypeUnit",t)},expression:"row.materialTypeUnit"}})]}}])}),t("vxe-table-column",{attrs:{field:"amount",title:"入库数量",width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"输入入库数量",min:0},model:{value:i.amount,callback:function(t){e.$set(i,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"price",title:"入库单价",width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"输入入库单价",min:0},model:{value:i.price,callback:function(t){e.$set(i,"price",t)},expression:"row.price"}})]}}])}),t("vxe-table-column",{attrs:{field:"ebsWarehouseLevl2",title:"移入二级库"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("j-dict-select-tag",{attrs:{dictCode:"bu_mtr_warehouse,name,id,wh_level='3'"},model:{value:i.ebsWarehouseLevl2,callback:function(t){e.$set(i,"ebsWarehouseLevl2",t)},expression:"row.ebsWarehouseLevl2"}})]}}])}),t("vxe-table-column",{attrs:{field:"selfWarehouseName",title:"目标库位",width:"220"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(t){return e.openWareHouseTree(i)}},model:{value:i.selfWarehouseName,callback:function(t){e.$set(i,"selfWarehouseName",t)},expression:"row.selfWarehouseName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])})],1)],1)],1)],1)],1),t("WareHouseTree",{ref:"wareHouseTree",on:{ok:e.onSelectLocation}}),t("material-list",{ref:"modalForm",attrs:{multiple:!1},on:{ok:e.onSelectMaterial}})],1)},r=[],n=a("c1df"),l=a.n(n),o=a("c54ca"),s=a("fe54"),d=a("13f1"),c=a("7164"),u=a("b098"),f=a("4f36"),h={name:"PutStockItemModal",components:{JSelectDepart:s["default"],JTreeSelect:u["default"],LocationList:d["default"],MaterialList:c["default"],WareHouseTree:f["default"]},data:function(){return{title:"操作",visible:!1,model:{},detailItem:{},detailList:[],labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:14}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{entryDate:{rules:[{required:!0,message:"请选择移入日期!"}]},entryDeptId:{rules:[{required:!0,message:"请选择移入部门!"}]}},validRules:{amount:[{required:!0,message:"请输入入库数量！"}],price:[{required:!0,message:"请输入入库单价！"}],ebsWarehouseLevl2:[{required:!0,message:"请选择二级库！"}],selfWarehouseId:[{required:!0,message:"请选择目标库位！"}]},tableHeight:{top:"height: calc(100vh - 265px)",bottom:"height: calc(100vh - 265px)",size:"100%"},selectDetailRecordIndex:0}},created:function(){},methods:{add:function(){this.edit({})},edit:function(e){var t=this;this.form.resetFields(),this.visible=!0,this.model=Object.assign({},e),e.id&&(this.$nextTick((function(){t.form.setFieldsValue({entryNo:t.model.entryNo,entryDate:t.model.entryDate,entryDeptId:t.model.entryDeptId})})),this.detailList.push({materialTypeId:e.materialTypeId,materialTypeCode:e.materialTypeCode,materialTypeName:e.materialTypeName,materialTypeSpec:e.materialTypeSpec,materialTypeUnit:e.materialTypeUnit,price:e.price,amount:e.amount,ebsWarehouseLevl2:e.ebsWarehouseLevl2,selfWarehouseId:e.selfWarehouseId,selfWarehouseName:e.selfWarehouseName}))},addDetailItem:function(){this.detailList.push({materialTypeCode:"",price:"",amount:"",ebsWarehouseLevl2:"",selfWarehouseId:""})},delDetailItem:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?t.forEach((function(t){for(var a=0;a<e.detailList.length;a++){var i=e.detailList[a];t._XID==i._XID&&e.detailList.splice(a,1)}})):this.$message.error("尚未选中任何数据!")},openMaterialSelectModal:function(e){this.detailItem=e,this.$refs.modalForm.showModal()},onSelectMaterial:function(e){if(e&&e.length>0){var t=e[0],a=0;if(this.detailList.map((function(e){if(e.materialTypeCode===t.code)return a=1,!1})),1===a)return void this.$message.error("你选择的物料已经在列表中存在，请选择其他物料");this.detailItem.materialTypeId=t.id,this.detailItem.materialTypeCode=t.code,this.detailItem.materialTypeName=t.name,this.detailItem.materialTypeSpec=t.spec,this.detailItem.materialTypeUnit=t.unit,this.detailItem.price=t.price,this.detailItem.amount="",this.detailItem.ebsWarehouseLevl2="",this.detailItem.selfWarehouseId=""}},openlocationModal:function(e){this.detailItem=e,this.$refs.locationModal.showModal(this.detailItem.materialTypeId,null,null)},onSelectLocation:function(e){e.length&&this.selectDetailRecordIndex>-1&&(this.detailList[this.selectDetailRecordIndex].selfWarehouseId=e[0].id,this.detailList[this.selectDetailRecordIndex].selfWarehouseName=e[0].name,this.form.getFieldDecorator("selfWarehouseName"),this.form.setFieldsValue({selfWarehouseName:e[0].name}))},openWareHouseTree:function(e){e.ebsWarehouseLevl2?(this.selectDetailRecordIndex=this.detailList.findIndex((function(t){return t.materialTypeId===e.materialTypeId})),this.$refs.wareHouseTree.showModal(e.ebsWarehouseLevl2)):this.$message.warn("请选择二级库位")},handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,i){if(!a){if(0==e.detailList.length)return t.$message.warning("入库明细列表不能为空！"),!1;for(var r=0;r<e.detailList.length;r++){var n=e.detailList[r];for(var s in n)if(""==n[s])return t.$message.warning("入库明细数据不能为空！"),!1}t.confirmLoading=!0;var d,c=Object.assign(t.model,i,{detailList:e.detailList,entryDate:l()(i.entryDate).format("YYYY-MM-DD")});d=(t.model.id,Object(o["ac"])(c)),d.then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok"),t.close()):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1}))}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.detailList=[],this.visible=!1}}},m=h,p=a("2877"),b=Object(p["a"])(m,i,r,!1,null,null,null);t["default"]=b.exports},fd28:function(e,t,a){"use strict";a("65b0")},fe54:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"components-input-demo-presuffix"},[t("a-input",{attrs:{placeholder:"请点击选择部门",readOnly:"",disabled:e.disabled},on:{click:e.openModal},model:{value:e.departNames,callback:function(t){e.departNames=t},expression:"departNames"}},[t("a-icon",{attrs:{slot:"prefix",type:"cluster",title:"部门选择控件"},slot:"prefix"}),e.departIds?t("a-icon",{attrs:{slot:"suffix",type:"close-circle",title:"清空"},on:{click:e.handleEmpty},slot:"suffix"}):e._e()],1),t("j-select-depart-modal",{ref:"innerDepartSelectModal",attrs:{"modal-width":e.modalWidth,multi:e.multi,rootOpened:e.rootOpened,"depart-id":e.departIds},on:{ok:e.handleOK,initComp:e.initComp}})],1)},r=[],n=a("b0cd"),l={name:"JSelectDepart",components:{JSelectDepartModal:n["default"]},props:{modalWidth:{type:Number,default:500,required:!1},multi:{type:Boolean,default:!1,required:!1},rootOpened:{type:Boolean,default:!0,required:!1},value:{type:String,required:!1},disabled:{type:Boolean,required:!1,default:!1},customReturnField:{type:String,default:"id"}},data:function(){return{visible:!1,confirmLoading:!1,departNames:"",departIds:""}},mounted:function(){this.departIds=this.value},watch:{value:function(e){"id"===this.customReturnField&&(this.departIds=e)}},methods:{initComp:function(e){this.departNames=e},openModal:function(){this.$refs.innerDepartSelectModal.show()},handleOK:function(e,t){var a=this,i="";!e&&e.length<=0?(this.departNames="",this.departIds=""):(i=e.map((function(e){return e[a.customReturnField]})).join(","),this.departNames=e.map((function(e){return e["departName"]})).join(","),this.departIds=t),this.$emit("change",i)},getDepartNames:function(){return this.departNames},handleEmpty:function(){this.handleOK("")}},model:{prop:"value",event:"change"}},o=l,s=(a("c94f"),a("2877")),d=Object(s["a"])(o,i,r,!1,null,"4d448922",null);t["default"]=d.exports},fef4:function(e,t,a){}}]);