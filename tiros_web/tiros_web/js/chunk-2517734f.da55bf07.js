(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2517734f"],{"28cb":function(e,t,a){},d12d:function(e,t,a){"use strict";a("28cb")},e5d4:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{id:"farPlanItemContent"}},[t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("基本信息")]),t("a-form",{attrs:{form:e.form}},[t("j-form-container",{attrs:{disabled:e.isReadonly}},[t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"标题"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["title",e.validatorRules.title],expression:"['title', validatorRules.title]",modifiers:{trim:!0}}],attrs:{disabled:e.disabled,placeholder:"请输入内容"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆段"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["depotId",e.validatorRules.depotId],expression:"['depotId', validatorRules.depotId]",modifiers:{trim:!0}}],attrs:{disabled:e.disabled,triggerChange:!0,placeholder:"请选择",dictCode:"bu_mtr_depot,name,id"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车间"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workshopId",e.validatorRules.workshopId],expression:"['workshopId', validatorRules.workshopId]",modifiers:{trim:!0}}],attrs:{disabled:e.disabled,triggerChange:!0,placeholder:"请选择",dictCode:"bu_mtr_workshop,name,id"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"开始年份"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["startYear",e.validatorRules.startYear],expression:"['startYear', validatorRules.startYear]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{disabled:e.disabled,mode:"year",placeholder:"请选择年份",format:"YYYY",open:e.startYearPickShow},on:{panelChange:e.startPanelChange,openChange:e.startOpenChange}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"结束年份"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["endYear",e.validatorRules.endYear],expression:"['endYear', validatorRules.endYear]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{disabled:e.disabled,mode:"year",placeholder:"请选择年份",format:"YYYY",open:e.endYearPickShow},on:{panelChange:e.endPanelChange,openChange:e.endOpenChange}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"备注"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["remark",e.validatorRules.remark],expression:"['remark', validatorRules.remark]",modifiers:{trim:!0}}],attrs:{disabled:e.disabled}})],1)],1)],1)],1)],1)],1),e.basicInfoIsOk?[t("a-form",{attrs:{form:e.detailInfoForm,disabled:e.isReadonly}},e._l(e.detailTotal,(function(a,r){return t("div",{key:r,staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("计划明细信息")]),t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-item",{attrs:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:e.wrapperCol,label:"明细标题"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["title_"+r,e.validatorRules.detailTitle],expression:"['title_' + index, validatorRules.detailTitle]",modifiers:{trim:!0}}],attrs:{disabled:e.isReadonly||e.disabled}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路"}},[t("line-select-list",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["line_"+r,e.validatorRules.detailLineId],expression:"['line_' + index, validatorRules.detailLineId]",modifiers:{trim:!0}}],attrs:{disabled:e.isReadonly||e.disabled}})],1)],1)],1),t("div",{staticStyle:{"border-bottom":"1px solid #cccccc","margin-bottom":"25px"}}),t("j-form-container",{attrs:{disabled:e.isReadonly||e.disabled}},[t("table",{staticClass:"detailTable"},[t("tr",[t("th",{attrs:{width:"80px"}}),e._l(e.yearArr,(function(a,r){return t("th",{key:r,staticStyle:{"text-align":"center"}},[e._v(" "+e._s(a)+" ")])}))],2),t("tr",[t("td",{attrs:{colspan:e.yearArr.length+1}},[t("hr",{staticStyle:{height:"1px",border:"none","border-top":"1px solid #dcdfe6"}})])]),t("tr",[t("td",[e._v("架修数")]),e._l(e.yearArr,(function(a,i){return t("td",{key:i,staticStyle:{"text-align":"center"}},[t("a-form-item",[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:[e.getInputModel(r,a,0),e.validatorRules.detailMiddleRepair],expression:"[\n                      getInputModel(index, year, 0),\n                      validatorRules.detailMiddleRepair,\n                    ]",modifiers:{trim:!0}}],attrs:{disabled:e.disabled,min:0,max:99999999}})],1)],1)}))],2),t("tr",[t("td",{staticStyle:{"text-align":"center"},attrs:{colspan:e.yearArr.length+1}},[t("hr",{staticStyle:{height:"1px",border:"none","border-top":"1px solid #dcdfe6"}})])]),t("tr",[t("td",[e._v("大修数")]),e._l(e.yearArr,(function(a,i){return t("td",{key:i,staticStyle:{"text-align":"center"}},[t("a-form-item",[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:[e.getInputModel(r,a,1),e.validatorRules.detailHighRepair],expression:"[\n                      getInputModel(index, year, 1),\n                      validatorRules.detailHighRepair,\n                    ]",modifiers:{trim:!0}}],attrs:{disabled:e.disabled,min:0,max:99999999}})],1)],1)}))],2)])])],1)})),0)]:e._e(),t("div",{staticClass:"addDiv"},[t("a-space",[e.fromFlow||e.isReadonly?e._e():t("a",{on:{click:function(t){return t.stopPropagation(),e.addDetail.apply(null,arguments)}}},[e._v("添加明细")]),e.fromFlow||e.isReadonly?e._e():t("a",{on:{click:function(t){return t.stopPropagation(),e.subDetail.apply(null,arguments)}}},[e._v("减少明细")])])],1)],2)},i=[],l=a("c1df"),o=a.n(l),n=a("b47d"),s=a("ca00"),d=a("5633");function m(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=p(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,n=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){n=!0,l=e},f:function(){try{o||null==a.return||a.return()}finally{if(n)throw l}}}}function p(e,t){if(e){if("string"==typeof e)return c(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var u={name:"planListItem",components:{LineSelectList:d["default"]},data:function(){return{form:this.$form.createForm(this,{onValuesChange:this.changeField}),detailInfoForm:this.$form.createForm(this,{name:"detailInfoForm"}),disabled:!1,title:"操作",confirmLoading:!1,planId:"",model:{},startYear:null,endYear:null,startYearPickShow:!1,endYearPickShow:!1,basicInfoIsOk:!1,detailTotal:0,tempDetailList:[],labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:16}},labelCol1:{xs:{span:24},sm:{span:2}},wrapperCol1:{xs:{span:24},sm:{span:20}},validatorRules:{title:{rules:[{required:!0,message:"请输入标题!"},{max:32,message:"输入长度不能超过32字符!"}]},depotId:{rules:[{required:!0,message:"请选择车辆段!"}]},workshopId:{rules:[{required:!0,message:"请选择车间!"}]},startYear:{rules:[{required:!0,message:"请选择开始年份!"}]},endYear:{rules:[{required:!0,message:"请选择结束年份!"}]},remark:{rules:[{max:255,message:"输入长度不能超过255字符!"}]},detailTitle:{rules:[{required:!0,message:"请输入明细标题!"},{max:32,message:"输入长度不能超过32字符!"}]},detailLineId:{rules:[{required:!0,message:"请选择线路!"}]},detailMiddleRepair:{rules:[{required:!0,message:"请输入架修数量!"}]},detailHighRepair:{rules:[{required:!0,message:"请输入大修数量!"}]}}}},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1}},mounted:function(){this.businessKey&&this.show(this.businessKey)},methods:{moment:o.a,show:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.disabled=a,this.planId=e,this.form&&this.detailInfoForm&&(this.detailInfoForm.resetFields(),this.form.resetFields()),this.startYear=null,this.endYear=null,Object(s["e"])(this.planId)?this.$emit("loaded"):Object(n["Y"])({id:this.planId}).then((function(e){var a=e.result,r={title:a.title,depotId:a.depotId,workshopId:a.workshopId,startYear:o()(a.startYear||new Date,"YYYY"),endYear:o()(a.endYear||new Date,"YYYY"),remark:a.remark};if(t.$nextTick((function(){t.form.setFieldsValue(r)})),t.startYear=parseInt(a.startYear),t.endYear=parseInt(a.endYear),a.detailList.length){t.detailInfoForm&&t.detailInfoForm.resetFields(),t.detailTotal=a.detailList.length,t.tempDetailList=a.detailList,t.basicInfoIsOk=!0;var i={};if(t.detailInfoForm)a.detailList.forEach((function(e,t){var a={},r={},l={},o=e.middleRepair.split("#"),n=e.hightRepair.split("#");o.forEach((function(e){var r="ref_"+t+"_0_"+e.split(":")[0];a[r]=e.split(":")[1]})),n.forEach((function(e){var a="ref_"+t+"_1_"+e.split(":")[0];r[a]=e.split(":")[1]})),l["title_"+t]=e.title,l["line_"+t]=e.lineId;var s={};Object.assign(s,a,r,l),Object.assign(i,s)})),t.$nextTick((function(){t.detailInfoForm.setFieldsValue(i)}));else{var l=a.detailList,n=[],s=function(e){for(var t=e.split("#"),a=0,r=t.length;a<r;a++)t[a]=t[a].split(":");return t};Array.from(l,(function(e,t){e.hightRepair=s(e.hightRepair),e.middleRepair=s(e.middleRepair);var a={title:e.title,lineName:e.lineName,year:"",hightRepair_type:"大修",hightRepair_num:"",middleRepair_type:"架修",middleRepair_num:""};Array.from(e.hightRepair,(function(t,r){var i=e.middleRepair[r];t[0]==i[0]&&(a.year=t[0],a.hightRepair_num=t[1],a.middleRepair_num=i[1],n.push(JSON.parse(JSON.stringify(a))))}))})),t.tableDatas=n,t.detailInfoFormCopy=l}}t.$emit("loaded")}))},save:function(e){var t=this;this.form.validateFields((function(a,r){if(!a){for(var i=[],l=0;l<t.detailTotal;l++){for(var d={title:t.detailInfoForm.getFieldValue("title_"+l),lineId:t.detailInfoForm.getFieldValue("line_"+l)},p=0;p<=1;p++){var c="";if("0"==p){var u,f=m(t.yearArr);try{for(f.s();!(u=f.n()).done;){var h=u.value,v="ref_"+l+"_"+p+"_"+h;if(!(t.detailInfoForm.getFieldValue(v)>=0&&t.detailInfoForm.getFieldValue("title_"+l)&&t.detailInfoForm.getFieldValue("line_"+l)))return t.$message.warning("请填写完整计划明细信息"),!1;c=c+h+":"+t.detailInfoForm.getFieldValue(v)+"#"}}catch(a){f.e(a)}finally{f.f()}d.middleRepair=c.slice(0,c.length-1)}else if("1"==p){var b,g=m(t.yearArr);try{for(g.s();!(b=g.n()).done;){var w=b.value,Y="ref_"+l+"_"+p+"_"+w;if(!(t.detailInfoForm.getFieldValue(Y)>=0))return t.$message.warning("请填写完整计划明细信息"),!1;c=c+w+":"+t.detailInfoForm.getFieldValue(Y)+"#"}}catch(a){g.e(a)}finally{g.f()}d.hightRepair=c.slice(0,c.length-1)}}i.push(d)}var y={};Object.assign(y,r,{endYear:o()(r.endYear).format("YYYY"),startYear:o()(r.startYear).format("YYYY"),detailList:i}),Object(s["e"])(t.planId)?Object(n["d"])(y).then((function(a){a.success?(t.close(),t.fromFlow?(e.res=a,t.$emit("ok",e)):t.$emit("ok")):(e.res=a,t.fromFlow?t.$emit("fail",e):t.$emit("fail"))})):(Object.assign(y,{id:t.planId}),Object(n["I"])(y).then((function(a){a.success?(t.close(),t.fromFlow?(e.res=a,t.$emit("ok",e)):t.$emit("ok")):t.fromFlow?t.$emit("fail",e):t.$emit("fail")})))}}))},getInputModel:function(e,t,a){var r="ref_"+e+"_"+a+"_"+t;return r},addDetail:function(){var e=this;this.form.validateFields((function(t,a){t?e.basicInfoIsOk=!1:(e.basicInfoIsOk=!0,e.detailTotal++)}))},subDetail:function(){this.detailTotal>0&&this.detailTotal--},delSubDetailRow:function(e){},changeField:function(e,t){var a=Object.keys(t)[0];"startYear"!=a&&"endYear"!=a||(this.detailTotal=0,this[a]=parseInt(o()(t[a]).format("YYYY")))},startOpenChange:function(e){this.startYearPickShow=e},startPanelChange:function(e){this.form.setFieldsValue({startYear:e}),this.startYearPickShow=!1},endOpenChange:function(e){this.endYearPickShow=e},endPanelChange:function(e){this.form.setFieldsValue({endYear:e}),this.endYearPickShow=!1},close:function(){}},computed:{yearArr:function(){var e=[];if(this.startYear&&this.startYear&&this.endYear>=this.startYear)for(var t=this.startYear;t<=this.endYear;t++)e.push(t);return e},tableData:function(){var e=[],t={name:"架修数",id:"0",num:0},a={name:"大修数",id:"1",num:0};return e.push(t),e.push(a),e}}},f=u,h=(a("d12d"),a("2877")),v=Object(h["a"])(f,r,i,!1,null,null,null);t["default"]=v.exports}}]);