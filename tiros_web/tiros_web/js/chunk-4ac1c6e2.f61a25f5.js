(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ac1c6e2","chunk-ccd9324a","chunk-2d0ba8aa","chunk-2d22d5d2"],{"0da1":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"test-class",style:"height: calc(100% - ".concat(t.getButtonShow()?"47px":"4px",");")},[2!==t.operator&&3!==t.operator?e("div",{attrs:{"na-flex-height-full":""}},[t.getButtonShow()?e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:8}},[e("a-form-item",{attrs:{label:"物料:"}},[e("a-input",{attrs:{placeholder:"物资编码或名称",allowClear:""},on:{change:t.sortTable},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),e("a-form-item",{attrs:{label:"物料分类:"}},[e("j-dict-select-tag",{staticStyle:{width:"160px"},attrs:{dictCode:"bu_material_type",triggerChange:"",hiddenArray:[1]},on:{change:t.sortTable},model:{value:t.searchCategory,callback:function(e){t.searchCategory=e},expression:"searchCategory"}})],1),e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")]),t._e()],1)],1)],1)],1)],1):t._e(),e("div",{attrs:{"na-flex-height-full":""}},[4!==t.operator?e("vxe-table",{ref:"listTable",staticClass:"mytable-style",attrs:{border:"",align:"center","max-height":"auto","row-class-name":t.rowClassName,data:t.taskMaterials,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"filter-config":{showIcon:!1}},on:{"update:data":function(e){t.taskMaterials=e},blur:function(e){t.$refs.listTable&&t.$refs.listTable.clearValidate()}}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",fixed:"left",width:"40"}}),t.tasks&&t.tasks.length>1&&4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("a-select",{staticStyle:{width:"100%"},on:{change:t.taskSelectChange,blur:function(e){t.$refs.listTable&&t.$refs.listTable.clearValidate()}},model:{value:i.orderTaskId,callback:function(e){t.$set(i,"orderTaskId",e)},expression:"row.orderTaskId"}},t._l(t.tasks,(function(a,i){return e("a-select-option",{key:i,attrs:{value:a.id}},[t._v(" "+t._s(a.taskName)+" ")])})),1)]}}],null,!1,4191658598)}):t._e(),e("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"},filters:[{data:""}],"filter-method":t.customStringFilterMethod,width:"130"},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{focus:function(e){return t.openMaterialSelectModal(i)}},model:{value:i.code,callback:function(e){t.$set(i,"code",e)},expression:"row.code"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,2681050691)}),e("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center",width:"200"},scopedSlots:t._u([{key:"edit",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.name)+" ")]}}],null,!1,1805491503)}),e("vxe-table-column",{attrs:{field:"spec",title:"规格",align:"left","header-align":"center"}}),4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"systemName",title:"所属系统",width:"150","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:t.systemDictCode,allowClear:!1},on:{blur:function(e){return t.$refs.listTable.clearValidate()},select:t.onSystemChange},model:{value:i.systemId,callback:function(e){t.$set(i,"systemId",e)},expression:"row.systemId"}})]}}],null,!1,694104271)}):t._e(),4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工位",open:!1},on:{dropdownVisibleChange:function(e){return t.openStationSelectModal()}},model:{value:i.workstationName,callback:function(e){t.$set(i,"workstationName",e)},expression:"row.workstationName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,1073727607)}):t._e(),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"},width:"100"},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type",hiddenArray:[-1],allowClear:!1},on:{blur:function(e){return t.$refs.listTable.clearValidate()},select:t.onCategoryChange},model:{value:i.useCategory,callback:function(e){t.$set(i,"useCategory",e)},expression:"row.useCategory"}})]}}],null,!1,2054472936)}),t._e(),t._e(),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"},width:"120",align:"right","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:999999},model:{value:i.amount,callback:function(e){t.$set(i,"amount",e)},expression:"row.amount"}})]}}],null,!1,4050415892)}),4===t.orderType&&-1===t.operator?e("vxe-table-column",{attrs:{field:"issueAmount",title:"发放数量",width:"120",align:"right","header-align":"center"}}):t._e(),4===t.orderType||5===t.orderType||-1!==t.operator&&5!==t.operator&&6!==t.operator?t._e():e("vxe-table-column",{attrs:{field:"actAmount",title:"实际消耗",width:"120",align:"right","header-align":"center"}}),1===t.operator&&t.showStock?e("vxe-table-column",{attrs:{field:"stock",title:"当前库存",width:"120",align:"right","header-align":"center"}}):t._e(),e("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"80"},scopedSlots:t._u([{key:"edit",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.unit)+" ")]}}],null,!1,1773474126)}),4===t.orderType||5===t.orderType||-1!==t.operator&&5!==t.operator&&6!==t.operator?t._e():e("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",width:"120",align:"right","header-align":"center"}}),0===t.operator||1===t.operator||4!==t.orderType&&5!==t.orderType&&1!==t.orderType?t._e():e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380"}}),1===t.operator&&4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"canReplace",title:"可替换物资",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[e("a-tooltip",{attrs:{placement:"top"}},[e("template",{slot:"title"},[e("span",[t._v(t._s(i.canReplaceSpec))])]),e("span",[t._v(t._s(i.canReplace))])],2)]}}],null,!1,3190429626)}):t._e(),t.getButtonShow()?e("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[t.$refs.listTable.isActiveByRow(i)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(i)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(i)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(i)}}},[t._v("编辑")])]]}}],null,!1,1311980394)}):t._e()],1):e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:t.taskMaterials,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"filter-config":{showIcon:!1}},on:{"update:data":function(e){t.taskMaterials=e},blur:function(e){t.$refs.listTable&&t.$refs.listTable.clearValidate()}}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",fixed:"left",width:"40"}}),t.tasks&&t.tasks.length>1&&4!==t.orderType?e("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left"}}):t._e(),e("vxe-table-column",{attrs:{field:"code",title:"物料编码",filters:[{data:""}],"filter-method":t.customStringFilterMethod,width:"130"}}),e("vxe-table-column",{attrs:{field:"name",title:"物料名称",align:"left","header-align":"center",width:"200"}}),4!==t.orderType?e("vxe-table-column",{attrs:{field:"opType_dictText",title:"领用类型",width:"100"}}):t._e(),4!==t.orderType?e("vxe-table-column",{attrs:{field:"systemName",title:"所属系统",width:"150"}}):t._e(),4!==t.orderType?e("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150"}}):t._e(),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"120",align:"right","header-align":"center"}}),0!==t.operator&&1!==t.operator?e("vxe-table-column",{attrs:{width:"120",field:"actAmount",title:"实际消耗","edit-render":{name:"$input",props:{type:"number",min:0}},align:"right","header-align":"center"}}):t._e(),e("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"80"}}),0!==t.operator&&1!==t.operator?e("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",width:"120"}}):t._e(),e("vxe-table-column",{attrs:{field:"spec",title:"规格",align:"left","header-align":"center"}}),0===t.operator||1===t.operator||4!==t.orderType&&1!==t.orderType?t._e():e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380"}}),t.getButtonShow()||4===t.operator?e("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[t.$refs.listTable.isActiveByRow(i)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(i)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(i)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(i)}}},[t._v("编辑")])]]}}],null,!1,1311980394)}):t._e()],1)],1)],1):t._e(),2===t.operator?e("div",[t.workOrderId?e("apply-ready-component",{ref:"applyReady",attrs:{"business-key":t.workOrderId,fromFlow:!0,"order-type":t.orderType},on:{ok:t.saveOk,fail:t.saveFail,cancel:t.onCancel,loaded:t.onLoaded}}):t._e()],1):t._e(),3===t.operator?e("div",[t.workOrderId?e("apply-confirm-component",{ref:"applyConfirm",attrs:{"business-key":t.workOrderId,fromFlow:!0,"order-type":t.orderType},on:{ok:t.saveOk,fail:t.saveFail,cancel:t.onCancel,loaded:t.onLoaded}}):t._e()],1):t._e(),e("material-list",{ref:"modalForm",attrs:{repairProgramId:t.repairProgramId,lineId:t.lineId,multiple:!1,mode:t.selectMode,"group-id":t.groupId,"type-code-list":t.mTypeCode,"show-type-code":t.filterType},on:{ok:t.onSelectMaterial}}),e("material-list",{ref:"modalFormMultiple",attrs:{repairProgramId:t.repairProgramId,lineId:t.lineId,multiple:!0,mode:t.selectMode,"group-id":t.groupId,"type-code-list":t.mTypeCode,"show-type-code":t.filterType},on:{ok:t.onSelectMaterialMultiple}}),e("task-select-modal",{ref:"taskSelectModal",on:{ok:t.onSelectTask}}),e("work-station-list",{ref:"stationSelectModal",attrs:{"group-id":t.groupId},on:{ok:t.onSelectStation}})],1)},r=[],o=a("7164"),n=a("383b"),l=a("ff09"),s=a("f6d0"),c=a("ca00"),u=a("b47d"),d=a("8fad"),f=a("1158");function h(t){return g(t)||b(t)||p(t)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){if(t){if("string"==typeof t)return y(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?y(t,e):void 0}}function b(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function g(t){if(Array.isArray(t))return y(t)}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=Array(e);a<e;a++)i[a]=t[a];return i}var v={name:"TaskMaterials",components:{TaskSelectModal:n["default"],MaterialList:o["default"],ApplyReadyComponent:l["default"],ApplyConfirmComponent:s["default"],WorkStationList:f["default"]},props:{taskMaterials:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0},workOrderId:{type:String,default:null},orderType:{type:Number,default:null},lineId:{type:[Number,String],default:null},planId:{type:[Number,String],default:null},repairId:{type:[Number,String],default:null},groupId:{type:[Number,String],default:null}},watch:{orderType:{handler:function(){0!==this.operator&&1!==this.operator||(4===this.orderType||5===this.orderType?(this.selectMode=[1,2],this.mTypeCode=[2,3,-1],this.filterType=!0):(this.selectMode=[1,2],1===this.operator&&(this.selectMode=[3].concat(h(this.selectMode))),this.mTypeCode=[2,3,-1],this.filterType=!0))},immediate:!0},repairId:{immediate:!0,handler:function(t){this.repairProgramId=t}},planId:{immediate:!0,handler:function(t){var e=this;this.selectMode.indexOf(2)>-1&&t&&!this.repairId&&Object(u["rb"])(t).then((function(t){t.success&&t.result&&(e.repairProgramId=t.result.repairProgramId)}))}}},data:function(){return{systemDictCode:"",repairProgramId:"",showStock:!1,curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择物料",trigger:"manual"}],opType:[{required:!1}],opType_dictText:[{required:!1}],useCategory_dictText:[{required:!0,message:"类别必须选择",trigger:"manual"}],needDispatchin_dictText:[{required:!0,message:"是否发料必须选择",trigger:"manual"}],amount:[{required:!0,message:"数量必须填写",trigger:"manual"}],systemName:[{required:!0,message:"所属系统必须选择",trigger:"manual"}],workstationName:[{required:!0,message:"所属工位必须选择",trigger:"manual"}]},tableHeight:{top:"height:100%",bottom:"height: calc(100vh - 160px)",size:"auto"},searchText:"",searchCategory:null,selectMode:[1,2,3],mTypeCode:[-1],filterType:!1,trainTypeId:""}},mounted:function(){var t=this;2!==this.operator&&3!==this.operator&&(this.$nextTick((function(){t.sortTable()})),this.$emit("loaded")),this.lineId&&Object(d["vb"])({lineId:this.lineId}).then((function(e){e.success?(t.trainTypeId=e.result.trainTypeId,t.systemDictCode="bu_train_asset_type,name,id,train_type_id='"+t.trainTypeId+"' AND struct_type=1"):t.systemDictCode=""}))},methods:{onLoaded:function(t){this.$emit("loaded")},onCategoryChange:function(t,e){var a=this.$refs.listTable.getActiveRecord();a.row.useCategory_dictText=e?e.title:void 0,this.$forceUpdate()},onSystemChange:function(t,e){var a=this.$refs.listTable.getActiveRecord();a.row.systemId=t,a.row.systemName=e?e.title:void 0,this.$forceUpdate()},onDispatchChange:function(t,e){var a=this.$refs.listTable.getActiveRecord();a.row.needDispatchin_dictText=e?e.title:void 0,this.$forceUpdate()},save:function(t){2!==this.operator?3===this.operator?this.$refs.applyConfirm&&this.$refs.applyConfirm.save?this.$refs.applyConfirm.save(t):this.$emit("fail",new Error("数据尚未加载完成，请稍后操作！")):this.$emit("fail",new Error("无效的操作类型，请联系关联员！")):this.$refs.applyReady&&this.$refs.applyReady.save?this.$refs.applyReady.save(t):this.$emit("fail",new Error("数据尚未加载完成，请稍后操作！"))},saveOk:function(){this.$emit("ok")},saveFail:function(t){this.$emit("fail",t)},onCancel:function(){this.$emit("cancel")},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||2===this.operator)},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.find((function(t){return 1===t.isGenOrder}))?this.$message.warn("已生成单据的临时新增类型数据不能删除"):e.length>0?this.$confirm({content:"是否删除选中".concat(e.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){e.map((function(e){t.taskMaterials.map((function(a,i){e.id===a.id&&t.taskMaterials.splice(i,1)}))}))}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(t){this.curEditMode=2,this.curRow=t,this.$refs.listTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.taskMaterials.map((function(a,i){t.id===a.id&&e.taskMaterials.splice(i,1)}))},openStationSelectModal:function(){this.$refs.stationSelectModal.showModal()},onSelectStation:function(t){var e=this.$refs.listTable.getActiveRecord();t.length&&e&&(e.row.workstationId=t[0].id,e.row.workstationName=t[0].name),this.$forceUpdate()},saveRowEvent:function(t){var e=this;this.$refs.listTable.validate(t,(function(a){if(a)for(var i in a){var r=a[i];r.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else{if(t.actAmount>t.amount)return void e.$message.error("实际消耗不能大于所需数量");1===e.curEditMode&&e.taskMaterials.push(t),e.$refs.listTable.clearActived(),e.curEditMode=0}}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},openMaterialSelectModal:function(t){this.curRow=t,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur(),this.$refs.listTable.clearValidate()},onSelectMaterial:function(t){var e=this;if(t&&t.length>0){var a=t[0];t.forEach((function(i,r){if(e.taskMaterials.find((function(t){return t.materialTypeId===i.id})))e.$message.warn("你选择的".concat(i.name,"已经在列表中存在"));else if(r>0){var o={id:Object(c["p"])(),orderTaskId:e.curRow.orderTaskId,taskName:e.curRow.taskName,opType:2,opType_dictText:"临时新增",needDispatchin:4===e.orderType||5===e.orderType?1:0,needDispatchin_dictText:4===e.orderType||5===e.orderType?"是":"否",code:i.code,materialTypeId:i.id,name:i.name,kind:i.kind,unit:i.unit,kind_dictText:i.kind_dictText,useCategory:i.category1?i.category1:null,useCategory_dictText:i.category1?i.category1_dictText:"",amount:i.num,actAmount:0};e.taskMaterials.push(o)}else e.curRow.code=a.code,e.curRow.name=a.name,e.curRow.materialTypeId=a.id,e.curRow.kind=a.kind,e.curRow.unit=a.unit,e.curRow.kind_dictText=a.kind_dictText,e.curRow.useCategory=a.category1?a.category1:null,e.curRow.useCategory_dictText=a.category1?a.category1_dictText:"",e.curRow.amount=a.num,e.curRow.actAmount=0,t.length>1&&(e.$refs.listTable.clearActived(),1===e.curEditMode&&e.taskMaterials.push(e.curRow),e.curEditMode=0)}))}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory="",this.curRow.useCategory_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.actAmount=0,this.curRow.needDispatchin=1,this.needDispatchin_dictText="是"},onSelectMaterialMultiple:function(t){var e=this;if(t&&t.length>0){var a=this.taskMaterials;t.forEach((function(t,i){var r={id:Object(c["p"])(),opType:1,opType_dictText:"额定物资",needDispatchin:4===e.orderType||5===e.orderType?1:0,needDispatchin_dictText:4===e.orderType||5===e.orderType?"是":"否",code:t.code,materialTypeId:t.id,name:t.name,kind:t.kind,unit:t.unit,kind_dictText:t.kind_dictText,useCategory:t.category1?t.category1:null,useCategory_dictText:t.category1?t.category1_dictText:"",amount:t.num,actAmount:0,isGenOrder:0,spec:t.spec};if(a.find((function(e){return e.materialTypeId===t.id}))){if(4===e.orderType||5===e.orderType)return void e.$message.warn("你选择的".concat(t.name,"已经在列表中存在"));e.$confirm({title:"确认添加",content:"你选择的".concat(t.name,"已经在列表中存在，是否重复添加？"),onOk:function(){e.insertNewMaterial(r)}})}else e.insertNewMaterial(r)}))}},insertNewMaterial:function(t){this.selectTask?Object.assign(t,{orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}):this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName}),this.$refs.listTable.insertAt(t,-1),this.taskMaterials.push(t)},openTaskSelectModal:function(t){this.curRow=t,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(t){if(t&&t.length>0){var e=t[0];this.curRow.orderTaskId=e.id,this.curRow.taskName=e.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(t,e){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[e.key].taskName},clearValidate:function(){var t=this;this.$nextTick((function(){t.$refs.listTable&&t.$refs.listTable.clearValidate()}))},checkMaterialShow:function(t){t.row;return""},sortTable:function(){if(this.$refs.listTable){var t=this.$refs.listTable.getColumnByField("code"),e=t.filters[0];e.checked=!0,this.$refs.listTable.updateData()}},customStringFilterMethod:function(t){var e=t.row,a=new RegExp(this.searchText),i=new RegExp(this.searchText);return 0!==this.operator&&1!==this.operator?(a.test(e.code)||i.test(e.name))&&(e.useCategory==this.searchCategory||!this.searchCategory)&&(1===e.opType||2===e.opType&&1===e.isGenOrder):(a.test(e.code)||i.test(e.name))&&(e.useCategory==this.searchCategory||!this.searchCategory)&&(1===e.opType||2===e.opType)},refreshTable:function(){this.showStock=!0,this.$refs.listTable.updateData()},rowClassName:function(t){var e=t.row;t.rowIndex;if(e.noenough&&1===e.noenough)return"row-red"}}},w=v,k=(a("74e8"),a("2877")),T=Object(k["a"])(w,i,r,!1,null,null,null);e["default"]=T.exports},"383b":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"70%",title:"任务选择",centered:"",visible:t.visible,bodyStyle:{height:"70vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:t.tasks,"max-height":"100%","show-overflow":"ellipsis","radio-config":t.multiple?{}:{trigger:"row"},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{type:"seq",title:"任务编号",width:"100"}}),e("vxe-table-column",{attrs:{field:"taskName",title:"任务名称",align:"left"}}),e("vxe-table-column",{attrs:{field:"workTime",title:"预计工时",align:"right",width:"100"}}),e("vxe-table-column",{attrs:{field:"taskContent",title:"任务要求",align:"left"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left",width:"200"}})],1)],1)},r=[],o={name:"TaskSelectModal",props:{multiple:{type:Boolean,default:!1}},data:function(){return{visible:!1,tasks:[]}},methods:{showModal:function(t){this.tasks=t,this.visible=!0},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},n=o,l=a("2877"),s=Object(l["a"])(n,i,r,!1,null,"161bbc55",null);e["default"]=s.exports},"51c5":function(t,e,a){"use strict";a("e9d9")},"74e8":function(t,e,a){"use strict";a("b2bb")},b2bb:function(t,e,a){},e9d9:function(t,e,a){},f6d0:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[t.fromFlow?t._e():e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:12,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden","margin-bottom":"8px"}},[e("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:t.save}},[t._v("确认领用")]),e("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.close}},[t._v("关闭")])],1)])],1),e("div",{staticStyle:{height:"calc(70vh - 45px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,range:!0}}},[e("vxe-table-column",{attrs:{type:"seq",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"确认状态",width:"100"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}})],1)],1),e("ApplyDistributionModal",{ref:"distributionModal",attrs:{dataList:t.distributionTableList},on:{ok:t.onSuccess}})],1)},r=[],o=a("c54ca"),n=a("2eb4"),l=a("8973");function s(t){return f(t)||d(t)||u(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"==typeof t)return h(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(t,e):void 0}}function d(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function f(t){if(Array.isArray(t))return h(t)}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=Array(e);a<e;a++)i[a]=t[a];return i}var m={name:"ApplyConfirmComponent",components:{ApplyDistributionModal:n["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:null}},data:function(){return{tableData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{orderId:"",status:[1]}}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:{edit:function(t){this.queryParam.orderId=t,this.findList()},findList:function(){var t=this;this.tableData=[],Object(o["bb"])(this.queryParam).then((function(e){e.success?(t.tableData=[].concat(s(t.tableData),s(e.result)),l["a"].joinDistributionInfo(t.tableData)):t.$message.error("加载数据失败"),t.$emit("loaded")}))},save:function(t){var e=this;if(this.tableData&&this.tableData.length>0){var a=this.tableData.map((function(t,e){return t.id}));if(0===a.length)return this.$message.warn("没有要确认领料的物资，无法继续！"),void this.$emit("fail",{message:"没有要确认领料的物资，无法继续！"});var i={fromType:2,ids:a.join(",")};Object(o["j"])(i).then((function(t){t.success?e.$emit("ok"):e.$emit("fail",t)})).catch((function(t){e.$message.error("保存异常"),e.$emit("fail",{message:"保存异常！"})}))}else this.$emit("ok")},close:function(){this.$emit("close")},openDistribution:function(t){this.$refs.distributionModal.showModal(t)},onSuccess:function(){var t=this;this.tableData.forEach((function(e){e.receive=0,t.distributionTableList.forEach((function(t){t.applyDetailId===e.id&&(e.receive+=Number(t.amount))}))}))}}},p=m,b=a("2877"),g=Object(b["a"])(p,i,r,!1,null,"1c988508",null);e["default"]=g.exports},ff09:function(t,e,a){"use strict";a.r(e);var i,r=function(){var t=this,e=t._self._c;return e("div",[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"right",overflow:"hidden","margin-bottom":"8px"}},[e("a-space",[t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.autoArrange}},[t._v("自动安排库位")]),t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.arrangePan}},[t._v("批量设置托盘")])],1)],1)])],1),t.isDistribution?t._e():e("div",{staticStyle:{height:"calc(70vh - 45px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,trigger:"row",range:!0}},on:{"checkbox-change":t.checkboxChange,"checkbox-all":t.checkboxChange}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{title:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[e("a",{on:{click:function(e){return e.stopPropagation(),t.openDistribution(i)}}},[t._v("发放管理")])]}}],null,!1,768125003)})],1)],1),t.isDistribution?e("div",{staticClass:"panel-main",staticStyle:{height:"calc(70vh - 45px)"}},[e("div",{staticClass:"panel-left"},[e("vxe-table",{ref:"materialTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableData,"radio-config":{highlight:!0,trigger:"row",range:!0,checkMethod:function(){return 0===t.curEditMode}}},on:{"radio-change":t.onRadioChange,"cell-click":t.onMaterialCellClick}},[e("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",width:"160",title:"物资编码"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"名称"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"80"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"80"}})],1)],1),e("div",{staticClass:"panel-right"},[e("div",{staticClass:"ant-alert ant-alert-info",staticStyle:{"margin-bottom":"16px"}},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:t.addDetail}},[t._v("添加发放库位")]),e("a-button",{on:{click:t.closeDistribution}},[t._v("关闭")]),e("span",{staticStyle:{color:"red","margin-left":"15px"}},[t._v(t._s("总量: ".concat(t.selectInfo?t.selectInfo.amount:0,";")))]),e("span",{staticStyle:{color:"red","margin-left":"5px"}},[t._v(t._s("差额：".concat(t.calcAmount)))])],1)],1),e("div",{staticStyle:{height:"calc(100% - 62px)"}},[e("vxe-table",{ref:"distributionTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableDistributionData,"edit-rules":t.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[e("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("a-select",{ref:"locationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:function(e){return t.openlocationModal(i)}},model:{value:i.sourceLocationName,callback:function(e){t.$set(i,"sourceLocationName",e)},expression:"row.sourceLocationName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,325071706)}),e("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择托盘",open:!1},on:{dropdownVisibleChange:function(e){return t.openPalletModal()}},model:{value:i.palletName,callback:function(e){t.$set(i,"palletName",e)},expression:"row.palletName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,3015230497)}),e("vxe-table-column",{attrs:{field:"tradeNo",title:"所属批次",width:"270","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[i.needChooseTradeNo?e("div",[e("a-select",{staticStyle:{width:"100%"},on:{change:function(e){return t.tradeNoCHange(i)}},model:{value:i.tradeNo,callback:function(e){t.$set(i,"tradeNo",e)},expression:"row.tradeNo"}},t._l(i.tradeNoChoiceList,(function(a,i){return e("a-select-option",{key:i,attrs:{value:a.tradeNo}},[t._v(" "+t._s(a.tradeNo)+"    "+t._s(a.price)+" ")])})),1)],1):e("div",[t._v(" "+t._s(i.tradeNo)+" ")])]}}],null,!1,2270284966)}),e("vxe-table-column",{attrs:{field:"amount",title:"发放数量",width:"120",align:"center","edit-render":{name:"$input",props:{type:"number",min:0}}}}),e("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center","show-overflow":!1},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[i&&!t.$refs.distributionTable.isActiveByRow(i)?e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(i)}}},[t._v("编辑 ")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleDel(i)}}},[t._v("删除")])],1):e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(i)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(i)}}},[t._v("取消")])],1)]}}],null,!1,743031837)})],1)],1)])]):t._e(),e("ApplyDistributionModal",{ref:"distributionModal",on:{ok:t.onSuccess}}),e("PalletList",{ref:"palletModal",attrs:{modeType:2},on:{ok:t.onSelectPallet}}),e("PalletList",{ref:"palletModal2",attrs:{modeType:2},on:{ok:t.onChoosePallet}}),e("LocationList",{ref:"locationModal",attrs:{modeType:2},on:{ok:t.onSelectLocation}})],1)},o=[],n=a("c54ca"),l=a("2eb4"),s=a("4ec3"),c=a("9f49"),u=a("13f1"),d=a("8973");function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function h(t,e,a){return(e=m(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function m(t){var e=p(t,"string");return"symbol"==f(e)?e:e+""}function p(t,e){if("object"!=f(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,e||"default");if("object"!=f(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",r=a.toStringTag||"@@toStringTag";function o(a,i,r,o){var s=i&&i.prototype instanceof l?i:l,c=Object.create(s.prototype);return g(c,"_invoke",function(a,i,r){var o,l,s,c=0,u=r||[],d=!1,f={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,a){return o=e,l=0,s=t,f.n=a,n}};function h(a,i){for(l=a,s=i,e=0;!d&&c&&!r&&e<u.length;e++){var r,o=u[e],h=f.p,m=o[2];a>3?(r=m===i)&&(s=o[(l=o[4])?5:(l=3,3)],o[4]=o[5]=t):o[0]<=h&&((r=a<2&&h<o[1])?(l=0,f.v=i,f.n=o[1]):h<m&&(r=a<3||o[0]>i||i>m)&&(o[4]=a,o[5]=i,f.n=m,l=0))}if(r||a>1)return n;throw d=!0,i}return function(r,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(e=l<2?t:s)||!d;){o||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,o){if(l||(r="next"),e=o[r]){if(!(e=e.call(o,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,l<2&&(l=0)}else 1===l&&(e=o.return)&&e.call(o),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);o=t}else if((e=(d=f.n<0)?s:a.call(i,f))!==n)break}catch(e){o=t,l=1,s=e}finally{c=1}}return{value:e,done:d}}}(a,r,o),!0),c}var n={};function l(){}function s(){}function c(){}e=Object.getPrototypeOf;var u=[][i]?e(e([][i]())):(g(e={},i,(function(){return this})),e),d=c.prototype=l.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,g(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=c,g(d,"constructor",c),g(c,"constructor",s),s.displayName="GeneratorFunction",g(c,r,"GeneratorFunction"),g(d),g(d,r,"Generator"),g(d,i,(function(){return this})),g(d,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:o,m:f}})()}function g(t,e,a,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}g=function(t,e,a,i){function o(e,a){g(t,e,(function(t){return this._invoke(e,a,t)}))}e?r?r(t,e,{value:a,enumerable:!i,configurable:!i,writable:!i}):t[e]=a:(o("next",0),o("throw",1),o("return",2))},g(t,e,a,i)}function y(t,e,a,i,r,o,n){try{var l=t[o](n),s=l.value}catch(t){return void a(t)}l.done?e(s):Promise.resolve(s).then(i,r)}function v(t){return function(){var e=this,a=arguments;return new Promise((function(i,r){var o=t.apply(e,a);function n(t){y(o,i,r,n,l,"next",t)}function l(t){y(o,i,r,n,l,"throw",t)}n(void 0)}))}}function w(t){return $(t)||x(t)||T(t)||k()}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(t,e){if(t){if("string"==typeof t)return N(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?N(t,e):void 0}}function x(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function $(t){if(Array.isArray(t))return N(t)}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=Array(e);a<e;a++)i[a]=t[a];return i}var _={name:"ApplyReadyComponent",components:{ApplyDistributionModal:l["default"],PalletList:c["default"],LocationList:u["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!1},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:""}},data:function(){return{records:[],confirmLoading:!1,tableData:[],tableDistributionData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{status:[0],orderId:""},curRow:null,isDistribution:!1,selectInfo:{},addParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},curEditMode:0,validRules:{sourceLocationName:[{required:!0,message:"请选择库位",trigger:"manual"}],tradeNo:[{required:!0,message:"批次号不能为空",trigger:"manual"}],amount:[{required:!0,message:"请输入数量",trigger:"manual"}]}}},computed:{hasActiveRow:function(){return!!this.$refs.distributionTable.getActiveRecord()},calcAmount:function(){return this.getAmount()}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:(i={tradeNoCHange:function(t){var e=t.tradeNoChoiceList.filter((function(e){return e.tradeNo==t.tradeNo}));t.price=e[0].price},checkboxChange:function(t){this.records=t.records},edit:function(t){this.initDictData(),this.queryParam.orderId=t,this.findList()},findList:function(){var t=this;this.tableData=[],this.records=[],Object(n["bb"])(this.queryParam).then((function(e){e.success?(t.tableData=[].concat(w(t.tableData),w(e.result)),d["a"].joinDistributionInfo(t.tableData),t.distributionTableList=[]):t.$message.error("加载数据失败"),t.$emit("loaded")}))},autoArrange:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<=0?this.$message.warn("请先选择要进行自动安排的记录！"):this.$confirm({content:"将根据现有库存情况自动安排库位，并覆盖原有数据？",okText:"确定",cancelText:"取消",onOk:function(){var a={applyDetailIdList:[],type:0};e.forEach((function(t){a.applyDetailIdList.push(t.id)})),t.confirmLoading=!0,Object(n["k"])(a).then((function(a){if(a.success){var i=a.result.applyDetailList;t.$message.success(a.result.assignResultMessage),e.forEach((function(t){var e=i.find((function(e){return e.id===t.id}));e&&(e.sourceLocationAndPalletName="",e.assignDetailList.forEach((function(t){var a=t.sourceLocationName+" | "+t.amount;t.palletName&&(a+=" | ".concat(t.palletName)),t.tradeNo&&(a+=" | 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=a+" \n"})),Object.assign(t,e))}))}else t.$message.error(a.message);t.confirmLoading=!1}))},onCancel:function(){}})},arrangePan:function(){var t=this.$refs.listTable.getCheckboxRecords();if(t.length<=0)this.$message.warn("请先选择要进行自动安排的记录！");else{var e=t.filter((function(t){return t.assignDetailList.length<=0}));e.length>0?this.$message.warning("请先安排库位信息"):this.$refs.palletModal.showModal()}},onSelectPallet:function(t){var e=this.$refs.listTable.getCheckboxRecords();try{Array.from(e,(function(e){Array.from(e.assignDetailList,(function(e){e.palletId=t[0].id,e.palletName=t[0].name}))})),this.updateAssignInfo(),this.$message.success("设置成功")}catch(a){this.$message.error("设置失败")}},save:function(){var t=v(b().m((function t(e){var a,i,r,o,l=this;return b().w((function(t){while(1)switch(t.n){case 0:if(this.fromFlow){t.n=1;break}a=this.$refs.listTable.getCheckboxRecords(),a.length>0?this.$confirm({content:"是否确认发放选中".concat(a.length,"数据？"),onOk:function(){var t=a.map((function(t,e){return{id:t.id,palletId:t.palletName,receive:t.receive}})),e={id:l.queryParam.orderId,detailList:t};Object(n["i"])(e).then((function(t){t.success?l.$emit("ok"):l.$emit("fail",t)})).catch((function(t){l.$message.error("保存异常"),l.$emit("fail")}))}}):this.$message.error("尚未选中任何数据!"),t.n=6;break;case 1:if(!(this.tableData&&this.tableData.length>0)){t.n=5;break}if(i={id:this.queryParam.orderId,onlySave:e,detailList:this.tableData.filter((function(t){return!t.noSave}))},r=!0,o=this.tableData.filter((function(t){return 0===t.receive})),e||!o.length){t.n=3;break}return t.n=2,new Promise((function(t,e){var a=o.map((function(t){return"["+t.materialTypeName+"-"+t.materialTypeCode+"]缺少"+(t.amount-t.receive)})).join("；");l.$confirm({content:"数量不匹配提醒：  ".concat(a,"  ;  是否继续提交？"),onOk:function(){t(!0)},onCancel:function(){t(!1)}})}));case 2:r=t.v;case 3:if(r){t.n=4;break}return this.$emit("cancel"),t.a(2);case 4:n["i"].call(this,i).then((function(t){t.success?l.$emit("ok"):l.$emit("fail",t)})).catch((function(t){l.$message.error("备料保存异常"),l.$emit("fail",t)})),t.n=6;break;case 5:this.$emit("ok");case 6:return t.a(2)}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),close:function(){this.$emit("close")},initDictData:function(){var t=this;Object(s["f"])(this.dictCode,null).then((function(e){e.success&&e.result&&e.result.map((function(e){t.palletList=t.palletList.concat({label:e.text,value:e.value})}))}))},openDistribution:function(t){this.curRow=t,this.openDistribution(t)},onSuccess:function(t){var e=this;t.forEach((function(a){var i=e.tableData.find((function(t){return t.id===a.applyDetailId}));i.assignDetailList=JSON.parse(JSON.stringify(t)),i.receive=0,i.assignDetailList.forEach((function(t){i.receive+=Number(t.amount);var e=t.sourceLocationName+" | "+t.amount;t.palletName&&(e+=" | ".concat(t.palletName)),t.tradeNo&&(e+=" | 第".concat(t.tradeNo,"批次")),i.sourceLocationAndPalletName+=e+" \n"}))}))},updateAssignInfo:function(){this.tableData.forEach((function(t){t.sourceLocationAndPalletName="",t.assignDetailList.forEach((function(e){var a=e.sourceLocationName+" | "+e.amount;e.palletName&&(a+=" | ".concat(e.palletName)),e.tradeNo&&(a+=" | 第".concat(e.tradeNo,"批次")),t.sourceLocationAndPalletName+=a+" \n"}))}))}},h(h(h(h(h(h(h(h(h(h(i,"openDistribution",(function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isDistribution=!0,this.curEditMode=0,this.$nextTick((function(){t.$refs.materialTable.setRadioRow(e||t.tableData[0]||{}),t.setActiveRow(e||t.tableData[0])}))})),"closeDistribution",(function(){this.hasActiveRow?this.$message.warn("存在未保存数据，请先保存"):(this.isDistribution=!1,this.curEditMode=0)})),"setActiveRow",(function(t){var e=this;this.tableDistributionData=[],this.selectInfo={},this.selectInfo=this.tableData.find((function(e){return e.id===t.id})),this.selectInfo.assignDetailList.forEach((function(t){e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))}))})),"onRadioChange",(function(t){var e=t.row;e&&!this.hasActiveRow&&this.setActiveRow(e)})),"onMaterialCellClick",(function(t){var e=t.$event;e.stopPropagation()})),"addDetail",(function(){var t=this;if(!this.$refs.distributionTable.getActiveRecord()){this.curEditMode=1;var e={applyDetailId:this.selectInfo.id,materialTypeId:this.selectInfo.materialTypeId,amount:this.getAmount()};this.$refs.distributionTable.insertAt(e,-1).then((function(e){var a=e.row;t.$refs.distributionTable.setActiveRow(a)}))}})),"editRowEvent",(function(t){this.$refs.distributionTable.getActiveRecord()||(this.curEditMode=2,this.$refs.distributionTable.setActiveRow(t))})),"getAmount",(function(){if(!this.selectInfo)return 0;var t=0;return this.tableDistributionData.forEach((function(e){t+=Number(e.amount)})),this.selectInfo.amount-t})),"openlocationModal",(function(t){this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,t.applyDetailId,t.id)})),"onSelectLocation",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),a=e.row;a&&(a.locationName=t[0].warehouseName,a.locationWbs=t[0].warehouseWbs,a.sourceLocationName=t[0].sourceLocationName,a.tradeNo=t[0].tradeNo,a.price=t[0].price,a.needChooseTradeNo=t[0].needChooseTradeNo,a.tradeNoChoiceList=t[0].tradeNoChoiceList,a.locationNum=t[0].usableAmount,this.calcAmount>a.locationNum?a.amount=a.locationNum:this.calcAmount>0&&this.calcAmount<=a.locationNum?a.amount=this.calcAmount:a.amount=0)}})),h(h(h(h(h(i,"saveRowEvent",(function(t){var e=this;this.$refs.distributionTable.validate(t,(function(a){if(!a){if(e.tableDistributionData.find((function(e){return e.sourceLocationName===t.sourceLocationName&&e.tradeNo===t.tradeNo}))&&1===e.curEditMode)return void e.$message.warn("该仓库该批次的物资记录已存在");if("number"===typeof t.locationNum&&t.amount>t.locationNum)return void e.$message.warn("该仓库该批次的物资库存量不足");var i=0;if(e.tableDistributionData.forEach((function(e){e.sourceLocationName,t.sourceLocationName,e.tradeNo!==t.tradeNo&&(i+=Number(e.amount))})),i+Number(t.amount)>Number(e.selectInfo.amount))return void e.$message.warn("选择的实际数量超过了发放数量");1===e.curEditMode&&(t.isNew=!0,e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))),e.$refs.distributionTable.clearActived(),e.onSuccess(e.tableDistributionData),e.curEditMode=0}}))})),"cancelRowEvent",(function(t){this.$refs.distributionTable.clearActived(),1===this.curEditMode?this.$refs.distributionTable.remove(t):2===this.curEditMode&&this.$refs.distributionTable.revertData(t),this.curEditMode=0})),"handleDel",(function(t){var e=this;this.$refs.distributionTable.getActiveRecord()||(this.$confirm({content:"是否删除选中的数据？",okText:"确定",cancelText:"取消",onOk:function(){e.tableDistributionData.splice(e.tableDistributionData.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1);var a=e.tableData.find((function(e){return e.id===t.applyDetailId}));a.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName}))&&(a.receive-=a.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName})).amount,a.assignDetailList.splice(a.assignDetailList.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1)),e.$nextTick((function(){e.locationMaxAmount=e.calcAmount}))}}),this.curEditMode=0)})),"openPalletModal",(function(){this.$refs.palletModal2.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName)})),"onChoosePallet",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),a=e.row;a&&(a.palletId=t[0].id,a.palletName=t[0].name)}})))},S=_,C=(a("51c5"),a("2877")),I=Object(C["a"])(S,r,o,!1,null,"efd43ef8",null);e["default"]=I.exports}}]);