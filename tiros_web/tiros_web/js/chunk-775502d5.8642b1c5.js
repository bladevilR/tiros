(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-775502d5","chunk-8ef7daa4"],{"060d":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?t._e():e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"listTable",attrs:{border:"",align:t.allAlign,"show-overflow":"tooltip",data:t.taskRegulations,"checkbox-config":{trigger:"row",highlight:!0}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"title",title:"名称",align:"left","header-align":"center",width:"25%","tree-node":""}}),e("vxe-table-column",{attrs:{field:"type_dictText",title:"类型",width:"8%"}}),e("vxe-table-column",{attrs:{field:"method_dictText",title:"维保手段",width:"8%"}}),e("vxe-table-column",{attrs:{field:"qualityLevel",title:"质保等级",width:"8%"}}),e("vxe-table-column",{attrs:{field:"outsource_dictText",title:"是否委外",width:"6%"}}),e("vxe-table-column",{attrs:{field:"safeNotice",title:"安全提示",align:"left","header-align":"center",width:"25%"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left","header-align":"center"}})],1),e("regulation-list",{ref:"modalForm",attrs:{multiple:!0,"check-strictly":!1,"regu-id":t.reguId,"plan-id":t.planId,trainTypeId:t.trainTypeId},on:{ok:t.addRegulation}})],1)},i=[],n=a("500a"),r=a("ca00"),o=a("8fad"),s={name:"TaskRegulations",components:{RegulationList:n["default"]},props:{reguId:{type:String,default:""},planId:{type:String,default:""},trainTypeId:{type:String,default:""},taskRegulations:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{allAlign:"center"}},computed:{plan:function(){return this.$store.getters.taskForm}},methods:{handleAdd:function(){this.$refs.modalForm.showModal()},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){e.map((function(e){t.taskRegulations.map((function(a,l){e.id===a.id&&t.taskRegulations.splice(l,1)})),e.reguMaterials&&e.reguMaterials.length>0&&t.$emit("removeMaterials",e.reguMaterials),e.reguPersons&&e.reguPersons.length>0&&t.$emit("removePersons",e.reguPersons),e.reguTools&&e.reguTools.length>0&&t.$emit("removeTools",e.reguTools),1===e.mustReplace&&t.$emit("removeMustReplaces",e)}))}})},addRegulation:function(t){var e=this;t.map((function(t){if(2===t.type){var a=e.taskRegulations.findIndex((function(e){return e.reguDetailId===t.id}));a<0&&(t.reguDetailId=t.id,t.id=Object(r["p"])(),e.taskRegulations.push(t),e.$emit("change"),1===t.mustReplace&&e.$emit("addMustReplaces",t),Object(o["Ub"])({id:t.reguDetailId}).then((function(t){if(t.success){var a=t.result;a.reguMaterials&&a.reguMaterials.length>0&&e.$emit("addMaterials",a.reguMaterials),a.reguPersons&&a.reguPersons.length>0&&e.$emit("addPersons",a.reguPersons),a.reguTools&&a.reguTools.length>0&&e.$emit("addTools",a.reguTools),a.techBookDetails&&a.techBookDetails.length>0&&e.$emit("addTools",a.techBookDetails),a.techBookDetails&&a.techBookDetails.length>0&&e.$emit("addBookDetails",a.techBookDetails)}})))}}))}}},d=s,c=a("2877"),u=Object(c["a"])(d,l,i,!1,null,null,null);e["default"]=u.exports},"500a":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"90%",title:"选择规程",centered:"",visible:t.visible,bodyStyle:{height:"70vh"},confirmLoading:t.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-row",[e("a-col",{staticStyle:{"border-right":"1px dotted #D3E1F1",height:"calc(70vh - 20px)","margin-right":"8px",padding:"0px"},attrs:{md:4,sm:24}},[e("a-menu",{attrs:{mode:"inline","default-selected-keys":t.defaultKey},on:{click:t.handleMenuClick}},t._l(t.treeData,(function(a){return e("a-menu-item",{key:a.id},[e("a-icon",{attrs:{type:"container"}}),e("span",[t._v(t._s(a.name))])],1)})),1)],1),e("a-col",{attrs:{md:19,sm:24}},[this.planId?e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.findList.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:4,sm:24}},[e("a-form-item",{attrs:{label:"是否已关联"}},[e("j-dict-select-tag",{attrs:{dictCode:"bu_state","allow-clear":""},model:{value:t.tpPlanRelated,callback:function(e){t.tpPlanRelated=e},expression:"tpPlanRelated"}})],1)],1),e("a-col",{attrs:{md:3,sm:8}},[e("a-form-item",[e("a-button",{on:{click:t.findList}},[t._v("查询")])],1)],1)],1)],1)],1):t._e(),e("div",{staticStyle:{height:"calc(70vh - 20px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 20px)"},attrs:{border:"","row-id":"id","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"},"radio-config":t.multiple?{}:{trigger:"row",checkMethod:t.checkRadioMethod},"checkbox-config":t.multiple?{checkStrictly:t.checkStrictly,trigger:"row",highlight:!0}:{},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:t.loadChildrenMethod}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"title",title:"名称","tree-node":"",align:"left"}}),e("vxe-table-column",{attrs:{field:"no",title:"序号",width:"80"}}),e("vxe-table-column",{attrs:{field:"type_dictText",title:"类型",width:"100"}}),e("vxe-table-column",{attrs:{field:"method_dictText",title:"维保手段",width:"120"}}),e("vxe-table-column",{attrs:{field:"qualityLevel",title:"质保等级",width:"80"}}),e("vxe-table-column",{attrs:{field:"safeNotice",title:"安全提示",width:"160"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"120"}}),this.planId?e("vxe-table-column",{attrs:{field:"tpPlanRelatedInfo",title:"模板已关联",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){var l=a.row;return[e("div",{style:{backgroundColor:t.statusColor[l.tpPlanRelated+""],borderRadius:"4px"}},[t._v(" "+t._s(l.tpPlanRelatedInfo)+" ")])]}}],null,!1,2972306538)}):t._e()],1)],1)])],1)],1)},i=[],n=a("8fad"),r={name:"RegulationList",props:{multiple:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!0},reguId:{type:String,default:""},planId:{type:String,default:""},trainTypeId:{type:String,default:""},onlyProject:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,statusColor:{0:"#dedede",1:"#bad795"},treeData:[],curReguId:"",tableData:[],allAlign:"center",defaultKey:[],tpPlanRelated:"",formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.getTreeList()},checkRadioMethod:function(t){var e=t.row;return!this.onlyProject||1===e.type},getTreeList:function(){var t=this;this.reguId?Object(n["Tb"])(this.reguId).then((function(e){e.success?(t.curReguId=t.reguId,t.treeData=[e.result],t.getReguDetailList(t.curReguId)):t.$message.error("获取规程信息失败")})).catch((function(e){t.$message.error("获取规程信息异常")})):Object(n["Wb"])({trainTypeId:this.trainTypeId}).then((function(e){e.success?(t.defaultKey[0]=e.result[0].id,t.curReguId=e.result[0].id,t.treeData=e.result,t.getReguDetailList(t.curReguId)):t.$message.error("获取规程信息失败")})).catch((function(e){t.$message.error("获取规程信息异常")}))},findList:function(){var t=this,e={reguId:this.reguId,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};Object(n["Vb"])(e).then((function(e){t.tableData=e.result}))},getReguDetailList:function(t){var e=this,a={reguId:t,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};Object(n["Vb"])(a).then((function(t){e.tableData=t.result}))},loadChildrenMethod:function(t){var e=this,a={reguId:this.reguId,parentId:t.row.id,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};return new Promise((function(t){Object(n["Vb"])(a).then((function(a){a.success?t(a.result):e.$message.error("".concat(a.msg))}))}))},onSelect:function(t,e){var a=e.node.dataRef;t.length>0&&(this.curReguId=a.id,this.getReguDetailList(a.id))},handleMenuClick:function(t){this.getReguDetailList(t.key)},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.close()},handleCancel:function(){this.close()},close:function(){this.visible=!1}}},o=r,s=(a("5125"),a("2877")),d=Object(s["a"])(o,l,i,!1,null,"210f6b5e",null);e["default"]=d.exports},5125:function(t,e,a){"use strict";a("d059")},d059:function(t,e,a){}}]);