(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21efefe6","chunk-2c88bf26","chunk-3ed937ef"],{"39ff7":function(t,e,a){},4501:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"作业指导书",width:"100%",dialogClass:"fullDialog no-footer",visible:t.visible,footer:null},on:{cancel:t.handleCancel}},[e("div",{staticClass:"sop-body"},[e("div",{staticStyle:{display:"flex","align-content":"center","flex-wrap":"wrap"}},[t.loading?e("a-spin",{attrs:{tip:"下载中..."}}):t._e()],1),t.loading?t._e():e("div",{ref:"mainDom",staticClass:"sop-body-page"})])])},n=[],i=a("8fad"),r={name:"WorkSopView",components:{},data:function(){return{visible:!1,tableData:[],queryParam:{bookId:""},loading:!1}},created:function(){},methods:{findList:function(){},handleCancel:function(){this.visible=!1},showBook:function(t){var e=this;this.visible=!0,this.loading=!0,Object(i["ac"])({bookId:t}).then((function(t){if(t.success){var a=[];t.result.forEach((function(t){a.push(Object(i["bc"])({detailId:t.id}).then((function(t){if(t.success){var a=JSON.parse(JSON.stringify(t.result));return a}return e.$message.error(t.message),null})))})),Promise.all(a).then((function(t){t.sort((function(t,e){return t.stepNum-e.stepNum}));var a="";t.forEach((function(t){t&&(a+="<h2>".concat(t.stepNum,'<span style="margin-left:15px;margin-top: 24px;">').concat(t.stepTitle,"</span></h2>"),a+=t.stepContent||"")})),e.loading=!1,e.$nextTick.call(e,(function(){e.$refs.mainDom.innerHTML=a}))}))}}))},showSopDetail:function(t){var e=this;this.visible=!0;var a=[];t.forEach((function(t){a.push(Object(i["bc"])({detailId:t}).then((function(t){return t.success?t.result:""})))})),Promise.all(a).then((function(t){var a="";t.forEach((function(t){a+="<h2>".concat(t.stepNum,'<span style="margin-left:15px;">').concat(t.stepTitle,"</span></h2>"),a+=t.stepContent})),e.$refs.mainDom.innerHTML=a}))}}},s=r,l=(a("a9f9"),a("bca7"),a("2877")),c=Object(l["a"])(s,o,n,!1,null,"7e7655fc",null);e["default"]=c.exports},"56ea":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?e("div",{staticStyle:{height:"calc(100vh - 160px)"}},[e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.previewHander}},[t._v("预览")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"xTable",staticStyle:{height:"calc(100vh - 160px)"},attrs:{border:"",resizable:"","show-overflow":"","keep-source":"",align:"center","max-height":"auto",data:t.tableData,"checkbox-config":{highlight:!0,range:!0}},on:{"update:data":function(e){t.tableData=e}}},[e("vxe-table-column",{attrs:{type:"seq",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"taskName",title:"工单任务","edit-render":{name:"input"}},scopedSlots:t._u([{key:"default",fn:function(a){var o=a.row;return[e("span",[t._v(t._s(t.getTaskName(o.taskId)))])]}}])}),e("vxe-table-column",{attrs:{field:"bookStepNo",title:"步骤","edit-render":{name:"input"},width:"120"}}),e("vxe-table-column",{attrs:{field:"bootStepTitle",title:"步骤名称",align:"left","edit-render":{name:"input"}},scopedSlots:t._u([{key:"default",fn:function(a){var o=a.row;return[e("a",{on:{click:function(e){return e.stopPropagation(),t.showSopDeatil(o.bookDetailId)}}},[t._v(" "+t._s(o.bootStepTitle))])]}}])}),e("vxe-table-column",{attrs:{field:"bookName",title:"所属作业指导书","edit-render":{name:"input"}}})],1)],1):e("div",{staticStyle:{height:"calc(100vh - 160px)"}},[e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),t.tableData.length>0?e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.previewHander}},[t._v("预览")]):t._e(),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"xTable",staticStyle:{height:"calc(100vh - 160px)"},attrs:{border:"",resizable:"","show-overflow":"","keep-source":"",align:"center","max-height":"auto",data:t.tableData,"checkbox-config":{highlight:!0,range:!0},"edit-rules":t.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(e){t.tableData=e}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t.tasks&&t.tasks.length>1?e("vxe-table-column",{attrs:{field:"taskName",title:"工单任务","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"default",fn:function(a){var o=a.row;return[e("span",[t._v(t._s(t.getTaskName(o.taskId)))])]}},{key:"edit",fn:function(a){var o=a.row;return[e("a-select",{staticStyle:{width:"100%"},model:{value:o.taskId,callback:function(e){t.$set(o,"taskId",e)},expression:"row.taskId"}},t._l(t.tasks,(function(a,o){return e("a-select-option",{key:o,attrs:{value:a.id}},[t._v(" "+t._s(a.taskName)+" ")])})),1)]}}],null,!1,3596586730)}):t._e(),e("vxe-table-column",{attrs:{field:"bookStepNo",title:"步骤","edit-render":{name:"input"},width:"120"},scopedSlots:t._u([{key:"edit",fn:function(a){var o=a.row;return[e("a-input",{attrs:{disabled:"",placeholder:"请输入步骤序号"},model:{value:o.bookStepNo,callback:function(e){t.$set(o,"bookStepNo",e)},expression:"row.bookStepNo"}})]}}],null,!1,850517849)}),e("vxe-table-column",{attrs:{field:"bootStepTitle",title:"步骤名称",align:"left","edit-render":{name:"input"}},scopedSlots:t._u([{key:"default",fn:function(a){var o=a.row;return[e("a",{on:{click:function(e){return e.stopPropagation(),t.showSopDeatil(o.bookDetailId)}}},[t._v(" "+t._s(o.bootStepTitle))])]}},{key:"edit",fn:function(a){var o=a.row;return[e("a-select",{ref:"trainAssetSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择作业指导书",open:!1},on:{focus:function(e){return t.openAssetSelectModal(o)}},model:{value:o.bootStepTitle,callback:function(e){t.$set(o,"bootStepTitle",e)},expression:"row.bootStepTitle"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(e){return t.openAssetSelectModal(o)}},slot:"suffixIcon"})],1)]}}],null,!1,122876149)}),e("vxe-table-column",{attrs:{field:"bookName",title:"所属作业指导书",align:"left","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var o=a.row;return[e("a-input",{attrs:{disabled:"",placeholder:"请输入步骤名称"},model:{value:o.bookName,callback:function(e){t.$set(o,"bookName",e)},expression:"row.bookName"}})]}}],null,!1,3379172200)}),e("vxe-table-column",{attrs:{title:"操作",width:"160"},scopedSlots:t._u([{key:"default",fn:function(a){var o=a.row;return[t.$refs.xTable.isActiveByRow(o)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return t.saveRowEvent(o)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return t.cancelRowEvent(o)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return t.editRowEvent(o)}}},[t._v("编辑")])]]}}],null,!1,2620488658)})],1)],1),e("SopDetailList",{ref:"modalForm",attrs:{multiple:!1},on:{ok:t.onSelectBookStep}}),e("SopDetailList",{ref:"modalFormMultiple",attrs:{multiple:!0},on:{ok:t.onSelectBookStepMultiple}}),e("WorkSopView",{ref:"workSopViewModal"})],1)},n=[],i=a("85df"),r=a("4501"),s=a("ca00");function l(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",n=a.toStringTag||"@@toStringTag";function i(a,o,n,i){var l=o&&o.prototype instanceof s?o:s,u=Object.create(l.prototype);return c(u,"_invoke",function(a,o,n){var i,s,l,c=0,u=n||[],d=!1,f={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,a){return i=e,s=0,l=t,f.n=a,r}};function h(a,o){for(s=a,l=o,e=0;!d&&c&&!n&&e<u.length;e++){var n,i=u[e],h=f.p,p=i[2];a>3?(n=p===o)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((n=a<2&&h<i[1])?(s=0,f.v=o,f.n=i[1]):h<p&&(n=a<3||i[0]>o||o>p)&&(i[4]=a,i[5]=o,f.n=p,s=0))}if(n||a>1)return r;throw d=!0,o}return function(n,u,p){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,p),s=u,l=p;(e=s<2?t:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),h(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(n="next"),e=i[n]){if(!(e=e.call(i,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+n+"' method"),s=1);i=t}else if((e=(d=f.n<0)?l:a.call(o,f))!==r)break}catch(e){i=t,s=1,l=e}finally{c=1}}return{value:e,done:d}}}(a,n,i),!0),u}var r={};function s(){}function u(){}function d(){}e=Object.getPrototypeOf;var f=[][o]?e(e([][o]())):(c(e={},o,(function(){return this})),e),h=d.prototype=s.prototype=Object.create(f);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,n,"GeneratorFunction")),t.prototype=Object.create(h),t}return u.prototype=d,c(h,"constructor",d),c(d,"constructor",u),u.displayName="GeneratorFunction",c(d,n,"GeneratorFunction"),c(h),c(h,n,"Generator"),c(h,o,(function(){return this})),c(h,"toString",(function(){return"[object Generator]"})),(l=function(){return{w:i,m:p}})()}function c(t,e,a,o){var n=Object.defineProperty;try{n({},"",{})}catch(t){n=0}c=function(t,e,a,o){function i(e,a){c(t,e,(function(t){return this._invoke(e,a,t)}))}e?n?n(t,e,{value:a,enumerable:!o,configurable:!o,writable:!o}):t[e]=a:(i("next",0),i("throw",1),i("return",2))},c(t,e,a,o)}function u(t,e,a,o,n,i,r){try{var s=t[i](r),l=s.value}catch(t){return void a(t)}s.done?e(l):Promise.resolve(l).then(o,n)}function d(t){return function(){var e=this,a=arguments;return new Promise((function(o,n){var i=t.apply(e,a);function r(t){u(i,o,n,r,s,"next",t)}function s(t){u(i,o,n,r,s,"throw",t)}r(void 0)}))}}var f={props:{bookSteps:{type:Array,default:[]},businessKey:{type:String,default:null},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1}},watch:{bookSteps:{handler:function(t){this.tableData=t},immediate:!0,deep:!0}},components:{SopDetailList:i["default"],WorkSopView:r["default"]},data:function(){return{isEdit:!1,tableData:[],rowData:null,validRules:{bootStepTitle:[{required:!0,message:"请填写步骤名称",trigger:"manual"}],bookName:[{required:!0,message:"请选择作业指导书",trigger:"manual"}]}}},methods:{previewHander:function(){var t=this.$refs.xTable.getCheckboxRecords().length<=0?this.tableData:this.$refs.xTable.getCheckboxRecords();if(t.length<=0)this.$message.warning("没有可预览的作业指导书");else{var e=t.map((function(t){return t.bookDetailId})).join(",");this.showSopDeatil(e)}},getTaskName:function(t){for(var e,a=0,o=this.tasks.length;a<o;a++)this.tasks[a].id===t&&(e=this.tasks[a].taskName);return e},onSelectBookStep:function(t){if(!(t.length<=0)){var e=t[0];this.tableData.find((function(t){return t.bookDetailId===e.id}))?this.$message.error("".concat(e.stepTitle,"步骤已经添加了")):(this.rowData.bookDetailId=e.id,this.rowData.bookName=e.bookName,this.rowData.bookStepNo=e.stepNum,this.rowData.bootStepContent=e.stepContent,this.rowData.bootStepTitle=e.stepTitle,this.rowData.techBookId=e.bookId)}},showSopDeatil:function(t){this.$refs.workSopViewModal.showSopDetail(t.split(","))},saveRowEvent:function(t){var e=this,a=this.$refs.xTable;a.validate(t,(function(o){if(o)for(var n in o){var i=o[n];i.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else a.clearActived(),e.isEdit||e.tableData.push(t),e.$emit("update:bookSteps",e.tableData)}))},editRowEvent:function(t){this.isEdit=!0,this.$refs.xTable.setActiveCell(t,"bootStepTitle")},cancelRowEvent:function(){var t=d(l().m((function t(e){var a;return l().w((function(t){while(1)switch(t.n){case 0:return a=this.$refs.xTable,t.n=1,a.clearActived();case 1:this.isEdit?a.revertData(e):a.remove(e);case 2:return t.a(2)}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleAdd:function(){var t=d(l().m((function t(){return l().w((function(t){while(1)switch(t.n){case 0:if(!this.$refs.xTable.getActiveRecord()){t.n=1;break}return this.$message.warning("请先保存数据"),t.a(2);case 1:this.isEdit=!1,this.$refs.modalFormMultiple.showModal();case 2:return t.a(2)}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onSelectBookStepMultiple:function(t){var e=this,a=(this.$refs.xTable,this.tasks.length>0&&this.tasks[0]);t.forEach((function(t,o,n){for(var i=0,r=0,l=e.tableData.length;r<l;r++){var c=e.tableData[r];if(c.bookDetailId==t.id){i=1;break}}if(0===i){var u={id:Object(s["p"])(),belongOrderTask:1,workOrderId:e.businessKey,taskName:a?a.taskName:"",taskId:a?a.id:"",bookDetailId:t.id,bootStepContent:t.stepContent,bookStepNo:t.stepNum,bootStepTitle:t.stepTitle,bookName:t.bookName,techBookId:t.bookId};e.$refs.xTable.insertAt(u,-1),e.tableData.push(u)}}))},openAssetSelectModal:function(t){this.rowData=t,this.$refs.modalForm.showModal(),this.$refs.trainAssetSelect.blur()},handleDel:function(){var t=this,e=this.$refs.xTable.getCheckboxRecords();e.length>0?this.$confirm({content:"是否删除选中".concat(e.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){e.map((function(e){t.tableData.map((function(a,o){e.id===a.id&&t.tableData.splice(o,1)}))})),t.$emit("update:bookSteps",t.tableData)}}):this.$message.error("尚未选中任何数据!")}}},h=f,p=a("2877"),b=Object(p["a"])(h,o,n,!1,null,"7836274e",null);e["default"]=b.exports},"61ca":function(t,e,a){"use strict";a("c35c")},"85df":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"90%",visible:t.visible,title:"作业指导步骤选择",centered:"",bodyStyle:{height:"80vh"},confirmLoading:t.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("na-splitter",{staticClass:"booksetp-body",staticStyle:{},attrs:{defaultSize:300}},[e("div",{staticStyle:{"overflow-y":"auto","overflow-x":"hidden","padding-right":"2px",height:"100%"},attrs:{slot:"left-panel"},slot:"left-panel"},[e("a-card",{attrs:{id:"bookStepsContent",height:"100%"}},[e("div",{staticClass:"typeTitle"},[t._v("作业指导书")]),e("a-input-search",{staticStyle:{margin:"8px 0",width:"90%"},attrs:{placeholder:"输入名称"},model:{value:t.serchValue,callback:function(e){t.serchValue=e},expression:"serchValue"}}),e("div",{staticStyle:{width:"70%",margin:"0 auto","min-height":"100%"}},[e("a-tree",{attrs:{showLine:"",selectedKeys:t.selectedKeys,"tree-data":t.showTreeData,replaceFields:{title:"fileName",key:"id"}},on:{select:t.onSelect}})],1)],1)],1),e("div",{staticStyle:{"padding-left":"5px","padding-right":"3px"},attrs:{slot:"right-panel"},slot:"right-panel"},[e("div",{staticStyle:{height:"100%"}},[e("vxe-table",{ref:"listTable",staticStyle:{},attrs:{border:"","row-id":"id",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","radio-config":{trigger:"row"},"checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"stepNum",title:"步骤",width:"120px"}}),e("vxe-table-column",{attrs:{field:"stepTitle",title:"标题",align:"left","header-align":"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.stepTitle)+" ")]}}])})],1)],1)])])],1)},n=[],i=a("8fad"),r={name:"SopDetailList",props:{multiple:{type:Boolean,default:!0},id:{type:String,default:""}},data:function(){return{fileType:[],queryParam:{bookId:""},allAlign:"center",totalResult:0,treeKey:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[],showTreeData:[],serchValue:"",selectedKeys:[]}},watch:{serchValue:function(){var t=this;this.showTreeData=this.treeData.map((function(e){return e.fileName.indexOf(t.serchValue)>-1?e:null})).filter((function(t){return t}))}},methods:{selectTree:function(){var t=this;Object(i["cc"])({pageNo:1,pageSize:1e3,searchText:""}).then((function(e){e.success&&(t.treeData=e.result.records,t.showTreeData=e.result.records,t.treeData.length>0&&(t.queryParam.bookId=t.treeData[0].id,t.selectedKeys[0]=t.treeData[0].id,t.selectData=t.treeData[0],t.findList()))}))},showModal:function(){this.visible=!0,this.selectTree()},onSelect:function(t,e){if(t.length){var a=e.node.dataRef;this.queryParam.bookId=a.id,this.selectedKeys[0]=a.id,this.selectData=a,this.findList()}},findList:function(){var t=this;Object(i["ac"])(this.queryParam).then((function(e){t.tableData=e.result}))},handleOk:function(){var t=this,e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),Array.from(e,(function(e){e.bookName=t.selectData.fileName})),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=r,l=(a("61ca"),a("2877")),c=Object(l["a"])(s,o,n,!1,null,null,null);e["default"]=c.exports},a9f9:function(t,e,a){"use strict";a("d392")},bca7:function(t,e,a){"use strict";a("39ff7")},c35c:function(t,e,a){},d392:function(t,e,a){}}]);