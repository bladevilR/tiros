(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-aceff70c","chunk-775502d5","chunk-8ef7daa4","chunk-2d238a23","chunk-2d21d872","chunk-2d238054"],{"060d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"listTable",attrs:{border:"",align:e.allAlign,"show-overflow":"tooltip",data:e.taskRegulations,"checkbox-config":{trigger:"row",highlight:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"title",title:"名称",align:"left","header-align":"center",width:"25%","tree-node":""}}),t("vxe-table-column",{attrs:{field:"type_dictText",title:"类型",width:"8%"}}),t("vxe-table-column",{attrs:{field:"method_dictText",title:"维保手段",width:"8%"}}),t("vxe-table-column",{attrs:{field:"qualityLevel",title:"质保等级",width:"8%"}}),t("vxe-table-column",{attrs:{field:"outsource_dictText",title:"是否委外",width:"6%"}}),t("vxe-table-column",{attrs:{field:"safeNotice",title:"安全提示",align:"left","header-align":"center",width:"25%"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left","header-align":"center"}})],1),t("regulation-list",{ref:"modalForm",attrs:{multiple:!0,"check-strictly":!1,"regu-id":e.reguId,"plan-id":e.planId,trainTypeId:e.trainTypeId},on:{ok:e.addRegulation}})],1)},i=[],n=a("500a"),l=a("ca00"),o=a("8fad"),s={name:"TaskRegulations",components:{RegulationList:n["default"]},props:{reguId:{type:String,default:""},planId:{type:String,default:""},trainTypeId:{type:String,default:""},taskRegulations:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{allAlign:"center"}},computed:{plan:function(){return this.$store.getters.taskForm}},methods:{handleAdd:function(){this.$refs.modalForm.showModal()},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){t.map((function(t){e.taskRegulations.map((function(a,r){t.id===a.id&&e.taskRegulations.splice(r,1)})),t.reguMaterials&&t.reguMaterials.length>0&&e.$emit("removeMaterials",t.reguMaterials),t.reguPersons&&t.reguPersons.length>0&&e.$emit("removePersons",t.reguPersons),t.reguTools&&t.reguTools.length>0&&e.$emit("removeTools",t.reguTools),1===t.mustReplace&&e.$emit("removeMustReplaces",t)}))}})},addRegulation:function(e){var t=this;e.map((function(e){if(2===e.type){var a=t.taskRegulations.findIndex((function(t){return t.reguDetailId===e.id}));a<0&&(e.reguDetailId=e.id,e.id=Object(l["p"])(),t.taskRegulations.push(e),t.$emit("change"),1===e.mustReplace&&t.$emit("addMustReplaces",e),Object(o["Ub"])({id:e.reguDetailId}).then((function(e){if(e.success){var a=e.result;a.reguMaterials&&a.reguMaterials.length>0&&t.$emit("addMaterials",a.reguMaterials),a.reguPersons&&a.reguPersons.length>0&&t.$emit("addPersons",a.reguPersons),a.reguTools&&a.reguTools.length>0&&t.$emit("addTools",a.reguTools),a.techBookDetails&&a.techBookDetails.length>0&&t.$emit("addTools",a.techBookDetails),a.techBookDetails&&a.techBookDetails.length>0&&t.$emit("addBookDetails",a.techBookDetails)}})))}}))}}},c=s,u=a("2877"),d=Object(u["a"])(c,r,i,!1,null,null,null);t["default"]=d.exports},"0db6":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.taskTools,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskTools=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},on:{focus:function(t){return e.openToolSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openToolSelectModal(r)}},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.category1_dictText)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{maxLength:201,placeholder:"请输入备注"},on:{change:function(t){return e.remarkChangeValue(r)}},model:{value:r.remark,callback:function(t){e.$set(r,"remark",t)},expression:"row.remark"}})]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)})],1),t("ToolTypeSelect",{ref:"modalForm",attrs:{multiple:!1},on:{ok:e.onSelectTool}}),t("ToolTypeSelect",{ref:"modalFormMultiple",attrs:{multiple:!0,batch:!0},on:{ok:e.onSelectToolMultiple}})],1)},i=[],n=a("a4db"),l=a("ca00"),o={name:"TaskTools",components:{ToolTypeSelect:n["default"]},props:{taskTools:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择工器具"}],amount:[{required:!0,message:"数量必须填写"}],remark:[{max:200,type:"string",message:"备注不能超过200个字符"}]}}},methods:{remarkChangeValue:function(e){var t=e.remark;t.length>200&&this.$message.error("备注不能超过200个字符")},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){t.map((function(t){e.taskTools.map((function(a,r){t.id===a.id&&e.taskTools.splice(r,1)}))}))}})},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskTools.map((function(a,r){e.id===a.id&&t.taskTools.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var i=a[r];i.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.taskTools.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openToolSelectModal:function(e){this.curRow=e,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur()},onSelectToolMultiple:function(e){var t=this;e.forEach((function(a,r){if(t.taskTools.find((function(e){return e.toolTypeId===a.id})))t.$message.warn("你选择的".concat(a.name,"已经在列表中存在"));else{var i={id:Object(l["p"])(),code:a.code,toolTypeId:a.toolTypeId||a.id,name:a.name,kind:a.kind,unit:a.unit,kind_dictText:a.kind_dictText,category1:a.category1,category1_dictText:a.category1_dictText,amount:a.num};1==e.length?t.$refs.listTable.insertAt(i,-1).then((function(e){var a=e.row;t.$refs.listTable.setActiveCell(a,"amount")})):(t.$refs.listTable.insertAt(i,-1),t.taskTools.push(i))}}))},onSelectTool:function(e){if(e&&e.length>0){var t=e[0],a=0;if(this.taskTools.map((function(e){if(e.toolTypeId===t.id)return a=1,!1})),1===a)return void this.$message.error("你选择的工器具已经在列表中存在，请选择其他工器具");this.curRow.code=t.code,this.curRow.toolTypeId=t.id,this.curRow.name=t.name,this.curRow.kind=t.kind,this.curRow.unit=t.unit,this.curRow.kind_dictText=t.kind_dictText,this.curRow.category1=t.category1,this.curRow.category1_dictText=t.category1_dictText,this.curRow.amount=t.num}else this.curRow.code="",this.curRow.toolTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.category1="",this.curRow.category1_dictText="",this.curRow.unit="",this.curRow.amount=0}}},s=o,c=a("2877"),u=Object(c["a"])(s,r,i,!1,null,null,null);t["default"]=u.exports},"500a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:"选择规程",centered:"",visible:e.visible,bodyStyle:{height:"70vh"},confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-row",[t("a-col",{staticStyle:{"border-right":"1px dotted #D3E1F1",height:"calc(70vh - 20px)","margin-right":"8px",padding:"0px"},attrs:{md:4,sm:24}},[t("a-menu",{attrs:{mode:"inline","default-selected-keys":e.defaultKey},on:{click:e.handleMenuClick}},e._l(e.treeData,(function(a){return t("a-menu-item",{key:a.id},[t("a-icon",{attrs:{type:"container"}}),t("span",[e._v(e._s(a.name))])],1)})),1)],1),t("a-col",{attrs:{md:19,sm:24}},[this.planId?t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"是否已关联"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_state","allow-clear":""},model:{value:e.tpPlanRelated,callback:function(t){e.tpPlanRelated=t},expression:"tpPlanRelated"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1):e._e(),t("div",{staticStyle:{height:"calc(70vh - 20px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 20px)"},attrs:{border:"","row-id":"id","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"},"radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{checkStrictly:e.checkStrictly,trigger:"row",highlight:!0}:{},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"title",title:"名称","tree-node":"",align:"left"}}),t("vxe-table-column",{attrs:{field:"no",title:"序号",width:"80"}}),t("vxe-table-column",{attrs:{field:"type_dictText",title:"类型",width:"100"}}),t("vxe-table-column",{attrs:{field:"method_dictText",title:"维保手段",width:"120"}}),t("vxe-table-column",{attrs:{field:"qualityLevel",title:"质保等级",width:"80"}}),t("vxe-table-column",{attrs:{field:"safeNotice",title:"安全提示",width:"160"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"120"}}),this.planId?t("vxe-table-column",{attrs:{field:"tpPlanRelatedInfo",title:"模板已关联",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("div",{style:{backgroundColor:e.statusColor[r.tpPlanRelated+""],borderRadius:"4px"}},[e._v(" "+e._s(r.tpPlanRelatedInfo)+" ")])]}}],null,!1,2972306538)}):e._e()],1)],1)])],1)],1)},i=[],n=a("8fad"),l={name:"RegulationList",props:{multiple:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!0},reguId:{type:String,default:""},planId:{type:String,default:""},trainTypeId:{type:String,default:""},onlyProject:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,statusColor:{0:"#dedede",1:"#bad795"},treeData:[],curReguId:"",tableData:[],allAlign:"center",defaultKey:[],tpPlanRelated:"",formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.getTreeList()},checkRadioMethod:function(e){var t=e.row;return!this.onlyProject||1===t.type},getTreeList:function(){var e=this;this.reguId?Object(n["Tb"])(this.reguId).then((function(t){t.success?(e.curReguId=e.reguId,e.treeData=[t.result],e.getReguDetailList(e.curReguId)):e.$message.error("获取规程信息失败")})).catch((function(t){e.$message.error("获取规程信息异常")})):Object(n["Wb"])({trainTypeId:this.trainTypeId}).then((function(t){t.success?(e.defaultKey[0]=t.result[0].id,e.curReguId=t.result[0].id,e.treeData=t.result,e.getReguDetailList(e.curReguId)):e.$message.error("获取规程信息失败")})).catch((function(t){e.$message.error("获取规程信息异常")}))},findList:function(){var e=this,t={reguId:this.reguId,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};Object(n["Vb"])(t).then((function(t){e.tableData=t.result}))},getReguDetailList:function(e){var t=this,a={reguId:e,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};Object(n["Vb"])(a).then((function(e){t.tableData=e.result}))},loadChildrenMethod:function(e){var t=this,a={reguId:this.reguId,parentId:e.row.id,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};return new Promise((function(e){Object(n["Vb"])(a).then((function(a){a.success?e(a.result):t.$message.error("".concat(a.msg))}))}))},onSelect:function(e,t){var a=t.node.dataRef;e.length>0&&(this.curReguId=a.id,this.getReguDetailList(a.id))},handleMenuClick:function(e){this.getReguDetailList(e.key)},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.visible=!1}}},o=l,s=(a("5125"),a("2877")),c=Object(s["a"])(o,r,i,!1,null,"210f6b5e",null);t["default"]=c.exports},5125:function(e,t,a){"use strict";a("d059")},"5bbd":function(e,t,a){},6419:function(e,t,a){},"6c57":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-tabs",{attrs:{"na-flex-height-full":""}},[t("a-tab-pane",{key:"1",attrs:{tab:"基本信息"}},[t("ViewTaskBasicInfo",{attrs:{taskInfo:e.taskInfo}})],1),t("a-tab-pane",{key:"2",attrs:{tab:"关联规程"}},[t("TaskRegulations",{attrs:{"task-regulations":e.taskInfo.repairPlanReguInfo,"read-only":!0}})],1),t("a-tab-pane",{key:"3",attrs:{tab:"任务必换件"}},[t("TaskMustReplaces",{attrs:{"must-replaces":e.taskInfo.mustReplaces,"read-only":!0}})],1),t("a-tab-pane",{key:"4",attrs:{tab:"任务物料"}},[t("TaskMaterials",{attrs:{"task-materials":e.taskInfo.materials,"read-only":!0}})],1),t("a-tab-pane",{key:"5",attrs:{tab:"任务工器具"}},[t("TaskTools",{attrs:{"task-tools":e.taskInfo.tools,"read-only":!0}})],1),t("a-tab-pane",{key:"6",attrs:{tab:"人员需求"}},[t("TaskPersons",{attrs:{"task-persons":e.taskInfo.persons,"read-only":!0}})],1)],1)},i=[],n=a("fe32"),l=a("060d"),o=a("a051"),s=a("0db6"),c=a("ffe2"),u=a("d24b"),d=a("b47d"),f={name:"ViewTaskComponent",components:{ViewTaskBasicInfo:n["default"],TaskRegulations:l["default"],TaskMustReplaces:o["default"],TaskMaterials:c["default"],TaskTools:s["default"],TaskPersons:u["default"]},props:["taskId"],data:function(){return{taskInfo:{}}},mounted:function(){this.loadTaskInfo()},methods:{loadTaskInfo:function(){var e=this;Object(d["ub"])(this.taskId).then((function(t){t.success&&(e.taskInfo=t.result)}))}}},h=f,m=a("2877"),p=Object(m["a"])(h,r,i,!1,null,"b0dd4ed6",null);t["default"]=p.exports},"7ba1":function(e,t,a){"use strict";a("5bbd")},a051:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"listTable",attrs:{border:"",align:e.allAlign,"keep-source":!0,data:e.mustReplaces,"edit-rules":e.validRules,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"checkbox-config":{trigger:"row",highlight:!0}},on:{"update:data":function(t){e.mustReplaces=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150",align:"left","edit-render":{name:"input"},"header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择必换件",open:!1},on:{focus:function(t){return e.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openMaterialSelectModal(r)}},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{"edit-render":{name:"$input",props:{type:"number"}},field:"amount",title:"数量",width:"150"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"spec",title:"必换件描述",align:"left","header-align":"center"}}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)})],1),t("must-material",{ref:"modalFormRadio",attrs:{lineId:e.lineId,repairProId:e.repairProId,multiple:!1},on:{ok:e.addMustReplacesRadio}}),t("must-material",{ref:"modalForm",attrs:{lineId:e.lineId,repairProId:e.repairProId,multiple:!0},on:{ok:e.addMustReplaces}})],1)},i=[],n=a("de56"),l=a("ca00"),o={name:"TaskMustReplace",components:{MustMaterial:n["default"]},props:{repairProId:{default:""},lineId:{default:""},mustReplaces:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,allAlign:"center",validRules:{code:[{required:!0,message:"请选必换件"}],name:[{required:!0,message:"请选择必换件"}],amount:[{required:!0,message:"数量必须填写"}]}}},computed:{plan:function(){return this.$store.getters.planForm}},methods:{saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var i=a[r];i.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.mustReplaces.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},handleAdd:function(){this.curEditMode=1,this.$refs.modalForm.showModal()},openMaterialSelectModal:function(e){this.curRow=e,this.$refs.modalFormRadio.showModal(),this.$refs.formSelect.blur()},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<1?this.$message.warning("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){t.map((function(t){e.mustReplaces.map((function(a,r){t.id===a.id&&e.mustReplaces.splice(r,1)}))}))}})},addMustReplacesRadio:function(e){if(e&&e.length){var t=e[0],a=0;if(this.mustReplaces.map((function(e){if(e.mustReplaceId===t.id)return a=1,!1})),1===a)return void this.$message.warning("你选择的物料已经在列表中存在，请选择其他物料");var r=JSON.parse(JSON.stringify(t));r.mustReplaceId=r.id,r.id=Object(l["p"])(),r.amount=r.needAmount,Object.assign(this.curRow,r)}},addMustReplaces:function(e){var t=this;e.map((function(a){var r=t.mustReplaces.findIndex((function(e){return e.mustReplaceId===a.id}));if(r<0){var i=JSON.parse(JSON.stringify(a));i.mustReplaceId=i.id,i.id=Object(l["p"])(),i.amount=i.needAmount,1==e.length?t.$refs.listTable.insertAt(i,-1).then((function(e){var a=e.row;t.$refs.listTable.setActiveCell(a,"code")})):(t.$refs.listTable.insertAt(i,-1),t.mustReplaces.push(i))}else t.$message.warning("你选择的".concat(a.name,"已经在列表中存在，请选择其他物料"))}))}}},s=o,c=a("2877"),u=Object(c["a"])(s,r,i,!1,null,null,null);t["default"]=u.exports},a4db:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:e.title,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"搜索"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"分类"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_tools_type",disabledArray:e.canSelectType},model:{value:e.queryParam.category1,callback:function(t){e.$set(e.queryParam,"category1",t)},expression:"queryParam.category1"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":e.onCellClick}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别",width:"150"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"150"}}),e.batch?t("vxe-table-column",{attrs:{field:"num",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}):e._e()],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},i=[],n=a("c54ca"),l={name:"ToolTypeSelect",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:function(){return[4,5,6]}},batch:{type:Boolean,default:!1}},data:function(){return{title:"工器具类型选择",queryParam:{type:"2",searchText:"",category1:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.category1=this.canSelectType[0]),this.findList()},findList:function(){var e=this;this.loading=!0,Object(n["Cb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"num",1)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},checkRadioMethod:function(e){var t=e.row;return!this.canSelectType||-1!==this.canSelectType.indexOf(t.category1)},onCellClick:function(e){var t=e.row,a=e.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([t],!0)}}},o=l,s=(a("7ba1"),a("2877")),c=Object(s["a"])(o,r,i,!1,null,"df2d4508",null);t["default"]=c.exports},b209:function(e,t,a){"use strict";a("6419")},d059:function(e,t,a){},d24b:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"personsTable",attrs:{border:"",align:"center",data:e.taskPersons,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0},"edit-rules":e.validRules,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskPersons=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需人数",width:"150","edit-render":{name:"input"},align:"right","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:100},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"requirePostion",title:"岗位要求",width:"300","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请输入岗位需求",maxLength:201},on:{change:function(t){return e.remarkChangeValue(r)}},model:{value:r.requirePostion,callback:function(t){e.$set(r,"requirePostion",t)},expression:"row.requirePostion"}})]}}])}),t("vxe-table-column",{attrs:{field:"requireTech",title:"技能要求",width:"300","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请输入技能要求",maxLength:201},on:{change:function(t){return e.remarkChangeValue(r)}},model:{value:r.requireTech,callback:function(t){e.$set(r,"requireTech",t)},expression:"row.requireTech"}})]}}])}),t("vxe-table-column",{attrs:{field:"requireCertificate",title:"证书要求",width:"300","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请输入证书要求",maxLength:201},on:{change:function(t){return e.remarkChangeValue(r)}},model:{value:r.requireCertificate,callback:function(t){e.$set(r,"requireCertificate",t)},expression:"row.requireCertificate"}})]}}])}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{maxLength:201,placeholder:"请输入备注"},on:{change:function(t){return e.remarkChangeValue(r)}},model:{value:r.remark,callback:function(t){e.$set(r,"remark",t)},expression:"row.remark"}})]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.personsTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1754853870)})],1)],1)},i=[],n=a("ca00"),l={name:"TaskPersons",props:{taskPersons:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,validRules:{amount:[{required:!0,message:"数量必须填写",trigger:"blur"}],requirePostion:[{max:200,type:"string",message:"不能超过200个字符"}],requireTech:[{max:200,type:"string",message:"不能超过200个字符"}],requireCertificate:[{max:200,type:"string",message:"不能超过200个字符"}],remark:[{max:200,type:"string",message:"不能超过200个字符"}]}}},methods:{remarkChangeValue:function(e){var t=e.remark;t.length>200&&this.$message.error("备注不能超过200个字符")},handleAdd:function(){var e=this;if(!this.$refs.personsTable.getActiveRecord()){this.curEditMode=1;var t={id:Object(n["p"])()};this.$refs.personsTable.insertAt(t,-1).then((function(t){var a=t.row;return e.$refs.personsTable.setActiveCell(a,"amount")}))}},handleDel:function(){var e=this,t=this.$refs.personsTable.getCheckboxRecords();t.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){t.map((function(t){e.taskPersons.map((function(a,r){t.id===a.id&&e.taskPersons.splice(r,1)}))}))}})},editRowEvent:function(e){this.curEditMode=2,this.$refs.personsTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskPersons.map((function(a,r){e.id===a.id&&t.taskPersons.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.personsTable.validate(e,(function(a){if(a)for(var r in a){var i=a[r];i.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.taskPersons.push(e),t.$refs.personsTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.personsTable.clearActived(),1===this.curEditMode?this.$refs.personsTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0}}},o=l,s=a("2877"),c=Object(s["a"])(o,r,i,!1,null,"2d8bdafd",null);t["default"]=c.exports},de56:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:"必换件选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:4,sm:12}},[t("a-form-item",{attrs:{label:"必换件"}},[t("a-input",{attrs:{allowClear:"",placeholder:"必换件编码或者名称"},model:{value:e.willChangeQueryParam.searchText,callback:function(t){e.$set(e.willChangeQueryParam,"searchText",t)},expression:"willChangeQueryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:3,sm:24}},[t("a-form-item",{attrs:{label:"所属线路"}},[t("line-select-list",{model:{value:e.willChangeQueryParam.lineId,callback:function(t){e.$set(e.willChangeQueryParam,"lineId",t)},expression:"willChangeQueryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"所属修程"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_repair_program,name,id"},model:{value:e.willChangeQueryParam.repairProgramId,callback:function(t){e.$set(e.willChangeQueryParam,"repairProgramId",t)},expression:"willChangeQueryParam.repairProgramId"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"所属系统"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_train_asset_type,name,id,struct_type=1 and parent_id is null"},model:{value:e.willChangeQueryParam.sysId,callback:function(t){e.$set(e.willChangeQueryParam,"sysId",t)},expression:"willChangeQueryParam.sysId"}})],1)],1),t("a-col",{attrs:{md:3,sm:24}},[t("a-form-item",{attrs:{label:"班组"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择班组",dictCode:e.dictGroupStr},model:{value:e.willChangeQueryParam.groupId,callback:function(t){e.$set(e.willChangeQueryParam,"groupId",t)},expression:"willChangeQueryParam.groupId"}})],1)],1),t("a-col",{attrs:{md:3,sm:24}},[t("a-form-item",{attrs:{label:"工位"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:e.dictCodeStrWork},model:{value:e.willChangeQueryParam.workstationId,callback:function(t){e.$set(e.willChangeQueryParam,"workstationId",t)},expression:"willChangeQueryParam.workstationId"}})],1)],1),t("a-col",{attrs:{md:2,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 80px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"必换件编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"name",title:"必换件名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"spec",title:"必换件描述",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"groupName",title:"所属班组",width:"150"}}),t("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"线路",width:"150"}}),t("vxe-table-column",{attrs:{field:"repairProgramName",title:"修程",width:"150"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}),t("vxe-table-column",{attrs:{field:"amount",title:"当前库存",width:"150"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.willChangeQueryParam.pageNo,"page-size":e.willChangeQueryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.willChangeQueryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.willChangeQueryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.willChangeQueryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.willChangeQueryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},i=[],n=a("c54ca"),l=a("b098"),o=a("5633"),s={name:"MaterialList",components:{JTreeSelect:l["default"],LineSelectList:o["default"]},props:{repairProId:{default:""},lineId:{default:""},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1,required:!1},defaultCheckedKeys:{type:String,default:""}},watch:{repairProId:{handler:function(e){this.willChangeQueryParam.repairProgramId=e},immediate:!0},lineId:{handler:function(e){this.willChangeQueryParam.lineId=e},immediate:!0},defaultCheckedKeys:{immediate:!0,handler:function(e){this.queryParam.warehouseId=e}},"willChangeQueryParam.groupId":function(e,t){this.dictCodeStrWork=e?"bu_mtr_workstation,name,id,id in (select workstation_id from bu_group_workstation where group_id='".concat(e,"')"):"bu_mtr_workstation,name,id"}},data:function(){return{dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",dictCodeStrWork:"bu_mtr_workstation,name,id",queryParam:{type:"1",category1:"",searchText:"",attr:null,warehouseId:"",pageNo:1,pageSize:10},willChangeQueryParam:{searchText:"",lineId:"",repairProgramId:"",sysId:"",groupId:"",workstationId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0;var t="";t=Object(n["Hb"])(this.willChangeQueryParam),t.then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"amount",t.needAmount)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.willChangeQueryParam.pageNo=t,this.willChangeQueryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},c=s,u=(a("b209"),a("2877")),d=Object(u["a"])(c,r,i,!1,null,"5e23c825",null);t["default"]=d.exports},fe32:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-descriptions",[t("a-descriptions-item",{attrs:{label:"任务名称"}},[e._v(e._s(e.taskInfo.taskName))]),t("a-descriptions-item",{attrs:{label:"作业手段"}},[e._v(e._s(e.taskInfo.method_dictText))]),t("a-descriptions-item",{attrs:{label:"作业工时"}},[e._v(e._s(e.taskInfo.workTime))]),t("a-descriptions-item",{attrs:{label:"作业系统"}},[e._v(e._s(e.taskInfo.systemName))]),t("a-descriptions-item",{attrs:{label:"作业设备"}},[e._v(e._s(e.taskInfo.assetTypeName))]),t("a-descriptions-item",{attrs:{label:"开始日期"}},[e._v(e._s(e.taskInfo.startTime))]),t("a-descriptions-item",{attrs:{label:"结束日期"}},[e._v(e._s(e.taskInfo.finishTime))]),t("a-descriptions-item",{attrs:{label:"作业工班"}},[e._v(e._s(e.taskInfo.workGroupName))]),t("a-descriptions-item",{attrs:{label:"作业工位"}},[e._v(e._s(e.taskInfo.workStations))]),t("a-descriptions-item",{attrs:{label:"备注"}},[e._v(e._s(e.taskInfo.remark))])],1)},i=[],n={name:"ViewTaskBasicInfo",props:["taskInfo"]},l=n,o=a("2877"),s=Object(o["a"])(l,r,i,!1,null,"cb5a7436",null);t["default"]=s.exports},ffe2:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.taskMaterials,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"cell",highlight:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskMaterials=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{focus:function(t){return e.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openMaterialSelectModal(r)}},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type",hiddenArray:[-1],allowClear:!1},on:{select:e.onCategoryChange,blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:r.useCategory,callback:function(t){e.$set(r,"useCategory",t)},expression:"row.useCategory"}})]}}])}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{maxLength:201,placeholder:"请输入备注"},on:{change:function(t){return e.remarkChangeValue(r)}},model:{value:r.remark,callback:function(t){e.$set(r,"remark",t)},expression:"row.remark"}})]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)})],1),t("material-list",{ref:"modalForm",attrs:{typeCodeList:[2,3],multiple:!1},on:{ok:e.onSelectMaterial}}),t("material-list",{ref:"modalFormMultiple",attrs:{typeCodeList:[2,3],multiple:!0},on:{ok:e.onSelectMaterialMultiple}})],1)},i=[],n=a("7164"),l=a("ca00"),o={name:"TaskMaterials",components:{MaterialList:n["default"]},props:{taskMaterials:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择物料"}],useCategory_dictText:[{required:!0,message:"请选择类别"}],amount:[{required:!0,message:"数量必须填写"}],remark:[{max:200,type:"string",message:"备注不能超过200个字符"}]},isvalid:!1}},methods:{validAllEvent:function(){var e=this;return new Promise((function(t,a){e.$refs.listTable.validate(!0).then((function(e){t(!0)})).catch((function(a){t(!1),e.curEditMode=2}))}))},onCategoryChange:function(e,t){var a=this.$refs.listTable.getActiveRecord();a.row.useCategory_dictText=t?t.title:void 0,this.$forceUpdate()},remarkChangeValue:function(e){var t=e.remark;t.length>200&&this.$message.error("备注不能超过200个字符")},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){t.map((function(t){e.taskMaterials.map((function(a,r){t.id===a.id&&e.taskMaterials.splice(r,1)}))}))}})},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskMaterials.map((function(a,r){e.id===a.id&&t.taskMaterials.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var i=a[r];i.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.taskMaterials.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openMaterialSelectModal:function(e){this.curRow=e,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur()},onSelectMaterialMultiple:function(e){var t=this;if(e&&e.length>0){var a=this.taskMaterials;e.forEach((function(r,i){if(a.find((function(e){return e.materialTypeId===r.id})))t.$message.warn("你选择的".concat(r.name,"已经在列表中存在"));else{var n={id:Object(l["p"])(),code:r.code,materialTypeId:r.id,name:r.name,kind:r.kind,unit:r.unit,kind_dictText:r.kind_dictText,useCategory:-1==r.useCategory?"":r.useCategory,useCategory_dictText:-1==r.useCategory?"":r.useCategory_dictText,amount:r.num};1==e.length?t.$refs.listTable.insertAt(n,-1).then((function(e){var a=e.row;t.$refs.listTable.setActiveCell(a,"amount")})):(t.$refs.listTable.insertAt(n,-1),t.taskMaterials.push(n))}}))}},onSelectMaterial:function(e){if(e&&e.length>0){var t=e[0],a=0;if(this.taskMaterials.map((function(e){if(e.materialTypeId===t.id)return a=1,!1})),1===a)return void this.$message.error("你选择的物料已经在列表中存在，请选择其他物料");this.curRow.code=t.code,this.curRow.materialTypeId=t.id,this.curRow.name=t.name,this.curRow.kind=t.kind,this.curRow.unit=t.unit,this.curRow.kind_dictText=t.kind_dictText,this.curRow.useCategory=-1==t.useCategory?"":t.useCategory,this.curRow.useCategory_dictText=-1==t.useCategory?"":t.useCategory_dictText,this.curRow.amount=t.num}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory=-1==material.useCategory?"":material.useCategory,this.curRow.useCategory_dictText=-1==material.useCategory?"":material.useCategory_dictText,this.curRow.unit="",this.curRow.amount=0}}},s=o,c=a("2877"),u=Object(c["a"])(s,r,i,!1,null,null,null);t["default"]=u.exports}}]);