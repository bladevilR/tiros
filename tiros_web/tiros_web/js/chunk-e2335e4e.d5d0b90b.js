(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e2335e4e"],{"03be":function(t,n,e){"use strict";e("a71c")},a71c:function(t,n,e){},d5ab:function(t,n,e){"use strict";e.r(n);var c=function(){var t=this,n=t._self._c;return n("a-modal",{attrs:{title:"编辑作业指导书正文",width:"96%",maskClosable:!1,footer:null,bodyStyle:t.modalBodyStyle,dialogStyle:{top:"10px"},wrapClassName:"tech-book-editor-modal"},model:{value:t.visible,callback:function(n){t.visible=n},expression:"visible"}},[n("div",{staticClass:"editor-toolbar"},[n("a-space",[n("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleSave}},[t._v("保存")]),n("a-dropdown",[n("a-button",[t._v("插入模板")]),n("a-menu",{attrs:{slot:"overlay"},on:{click:t.handleInsertTemplate},slot:"overlay"},[n("a-menu-item",{key:"cover"},[t._v("封面")]),n("a-menu-item",{key:"changeRecord"},[t._v("文件变更记录卡")]),n("a-menu-item",{key:"processFlow"},[t._v("工艺流程图")]),n("a-menu-item",{key:"preWork"},[t._v("作业前准备")]),n("a-menu-item",{key:"processStep"},[t._v("工序工步")]),n("a-menu-item",{key:"tools"},[t._v("工具工装")]),n("a-menu-item",{key:"consumables"},[t._v("消耗料")]),n("a-menu-item",{key:"materialDetail"},[t._v("物料明细")]),n("a-menu-item",{key:"torqueList"},[t._v("扭力值清单")]),n("a-menu-item",{key:"appendix"},[t._v("附录")])],1)],1),n("a-button",{on:{click:t.handleRebuild}},[t._v("重新生成模板")]),n("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.handleExport}},[t._v("导出规范Word")]),n("a-button",{on:{click:t.handleClose}},[t._v("关闭")])],1),n("a-space",[n("a-button",{attrs:{size:"small"},on:{click:t.insertPageBreak}},[t._v("插入分页符")])],1),n("div",{staticClass:"tips"},[t._v(" 当前模板："+t._s(t.record.fileName||"-")+"（版本："+t._s(t.record.fileVer||"-")+"） ")])],1),n("div",{staticClass:"editor-body"},[n("j-editor",{attrs:{height:t.editorHeight},model:{value:t.contentHtml,callback:function(n){t.contentHtml=n},expression:"contentHtml"}})],1)])},o=[],a=e("a061"),d=e("8fad"),r="border-collapse:collapse;width:100%;border:1px solid #000;font-family:宋体,SimSun;font-size:10.5pt;",i="border:1px solid #000;background:#e7e6e6;padding:4px;text-align:center;font-weight:bold;vertical-align:middle;",s="border:1px solid #000;padding:4px;vertical-align:top;",l="page-break-after:always;";function h(t){var n=t||{};return'\n<div style="'.concat(l,'text-align:center;padding-top:80px;">\n  <h1 style="font-size:26pt;margin-bottom:40px;font-family:宋体;font-weight:bold;">').concat(n.fileName||"作业指导书",'</h1>\n  <table border="1" cellspacing="0" cellpadding="8" style="').concat(r,'margin-top:60px;width:80%;margin-left:auto;margin-right:auto;">\n    <tr>\n      <td style="').concat(i,'width:25%;">文件编号</td>\n      <td style="').concat(s,'width:25%;">').concat(n.fileNo||"",'</td>\n      <td style="').concat(i,'width:25%;">版本号</td>\n      <td style="').concat(s,'width:25%;">').concat(n.fileVer||"1.0",'</td>\n    </tr>\n    <tr>\n      <td style="').concat(i,'">编制人</td>\n      <td style="').concat(s,'">').concat(n.creatorName||"",'</td>\n      <td style="').concat(i,'">编制日期</td>\n      <td style="').concat(s,'">').concat(n.exeTime||"",'</td>\n    </tr>\n    <tr>\n      <td style="').concat(i,'">审核人</td>\n      <td style="').concat(s,'">').concat(n.reviewerName||"",'</td>\n      <td style="').concat(i,'">审批人</td>\n      <td style="').concat(s,'">').concat(n.approverName||"",'</td>\n    </tr>\n    <tr>\n      <td style="').concat(i,'">项目号</td>\n      <td style="').concat(s,'">{{PROJECT_NO}}</td>\n      <td style="').concat(i,'">文件名称</td>\n      <td style="').concat(s,'">{{FILE_NAME}}</td>\n    </tr>\n  </table>\n</div>\n')}function y(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">文件变更记录卡</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}} &nbsp; 项目号：{{PROJECT_NO}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(r,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(i,'width:8%;">序号</th>\n      <th style="').concat(i,'width:15%;">变更日期</th>\n      <th style="').concat(i,'width:37%;">变更内容</th>\n      <th style="').concat(i,'width:15%;">变更人</th>\n      <th style="').concat(i,'width:15%;">审批人</th>\n      <th style="').concat(i,'width:10%;">版本</th>\n    </tr>\n    <tr><td style="').concat(s,'">1</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">2</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">3</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n  </table>\n</div>\n')}function p(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">工艺流程图</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <div style="border:2px dashed #666;min-height:300px;padding:20px;text-align:center;color:#666;background:#f9f9f9;margin-top:10px;">\n    <p style="font-family:宋体;font-size:11pt;">（请在此处插入工艺流程图或相关图片）</p>\n  </div>\n</div>\n')}function u(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">消耗料清单</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(r,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(i,'width:8%;">序号</th>\n      <th style="').concat(i,'width:15%;">物料编码</th>\n      <th style="').concat(i,'width:25%;">物料名称</th>\n      <th style="').concat(i,'width:20%;">规格型号</th>\n      <th style="').concat(i,'width:8%;">单位</th>\n      <th style="').concat(i,'width:8%;">数量</th>\n      <th style="').concat(i,'width:16%;">备注</th>\n    </tr>\n    <tr><td style="').concat(s,'">1</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">2</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">3</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n  </table>\n</div>\n')}function m(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">物料明细表</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(r,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(i,'width:8%;">序号</th>\n      <th style="').concat(i,'width:12%;">物料编��</th>\n      <th style="').concat(i,'width:20%;">物料名称</th>\n      <th style="').concat(i,'width:15%;">规格型号</th>\n      <th style="').concat(i,'width:8%;">单位</th>\n      <th style="').concat(i,'width:8%;">数量</th>\n      <th style="').concat(i,'width:12%;">单价(元)</th>\n      <th style="').concat(i,'width:17%;">备注</th>\n    </tr>\n    <tr><td style="').concat(s,'">1</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">2</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n  </table>\n</div>\n')}function f(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">作业前准备</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(r,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(i,'width:10%;">序号</th>\n      <th style="').concat(i,'width:50%;">检查项目</th>\n      <th style="').concat(i,'width:20%;">标准/要求</th>\n      <th style="').concat(i,'width:20%;">确认结果</th>\n    </tr>\n    <tr><td style="').concat(s,'">1</td><td style="').concat(s,'">人员资质确认</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">2</td><td style="').concat(s,'">工具工装检查</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">3</td><td style="').concat(s,'">物料准备确认</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">4</td><td style="').concat(s,'">安全防护确认</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n  </table>\n</div>\n')}function b(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">工序工步</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(r,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(i,'width:8%;">工序号</th>\n      <th style="').concat(i,'width:8%;">工步号</th>\n      <th style="').concat(i,'width:35%;">作业内容</th>\n      <th style="').concat(i,'width:20%;">技术要求</th>\n      <th style="').concat(i,'width:14%;">工具/工装</th>\n      <th style="').concat(i,'width:15%;">备注</th>\n    </tr>\n    <tr><td style="').concat(s,'">1</td><td style="').concat(s,'">1</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'"></td><td style="').concat(s,'">2</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">2</td><td style="').concat(s,'">1</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n  </table>\n</div>\n')}function g(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">工具工装清单</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(r,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(i,'width:10%;">序号</th>\n      <th style="').concat(i,'width:18%;">工具编码</th>\n      <th style="').concat(i,'width:24%;">工具名称</th>\n      <th style="').concat(i,'width:20%;">规格型号</th>\n      <th style="').concat(i,'width:10%;">数量</th>\n      <th style="').concat(i,'width:18%;">备注</th>\n    </tr>\n    <tr><td style="').concat(s,'">1</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">2</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n  </table>\n</div>\n')}function v(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">扭力值清单</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <table border="1" cellspacing="0" cellpadding="6" style="').concat(r,'">\n    <tr style="background:#d9d9d9;">\n      <th style="').concat(i,'width:10%;">序号</th>\n      <th style="').concat(i,'width:25%;">安装部位</th>\n      <th style="').concat(i,'width:20%;">螺栓规格</th>\n      <th style="').concat(i,'width:15%;">扭力值(N·m)</th>\n      <th style="').concat(i,'width:15%;">工具</th>\n      <th style="').concat(i,'width:15%;">备注</th>\n    </tr>\n    <tr><td style="').concat(s,'">1</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n    <tr><td style="').concat(s,'">2</td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td><td style="').concat(s,'"></td></tr>\n  </table>\n</div>\n')}function w(){return'\n<div style="'.concat(l,'">\n  <h2 style="font-size:14pt;font-family:宋体;margin-bottom:10px;margin-top:20px;">附录</h2>\n  <p style="font-family:宋体;font-size:10.5pt;margin-bottom:10px;">文件编号：{{FILE_NO}} &nbsp; 文件名称：{{FILE_NAME}} &nbsp; 版本：{{FILE_VER}}</p>\n  <div style="border:1px solid #333;min-height:250px;padding:15px;color:#666;background:#fafafa;margin-top:10px;">\n    <p style="font-family:宋体;font-size:10.5pt;color:#999;">（请在此处填写附录内容，可插入图片、其他表格、补充说明等）</p>\n  </div>\n</div>\n')}function E(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,n,e="function"==typeof Symbol?Symbol:{},c=e.iterator||"@@iterator",o=e.toStringTag||"@@toStringTag";function a(e,c,o,a){var i=c&&c.prototype instanceof r?c:r,s=Object.create(i.prototype);return x(s,"_invoke",function(e,c,o){var a,r,i,s=0,l=o||[],h=!1,y={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(n,e){return a=n,r=0,i=t,y.n=e,d}};function p(e,c){for(r=e,i=c,n=0;!h&&s&&!o&&n<l.length;n++){var o,a=l[n],p=y.p,u=a[2];e>3?(o=u===c)&&(i=a[(r=a[4])?5:(r=3,3)],a[4]=a[5]=t):a[0]<=p&&((o=e<2&&p<a[1])?(r=0,y.v=c,y.n=a[1]):p<u&&(o=e<3||a[0]>c||c>u)&&(a[4]=e,a[5]=c,y.n=u,r=0))}if(o||e>1)return d;throw h=!0,c}return function(o,l,u){if(s>1)throw TypeError("Generator is already running");for(h&&1===l&&p(l,u),r=l,i=u;(n=r<2?t:i)||!h;){a||(r?r<3?(r>1&&(y.n=-1),p(r,i)):y.n=i:y.v=i);try{if(s=2,a){if(r||(o="next"),n=a[o]){if(!(n=n.call(a,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,r<2&&(r=0)}else 1===r&&(n=a.return)&&n.call(a),r<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),r=1);a=t}else if((n=(h=y.n<0)?i:e.call(c,y))!==d)break}catch(n){a=t,r=1,i=n}finally{s=1}}return{value:n,done:h}}}(e,o,a),!0),s}var d={};function r(){}function i(){}function s(){}n=Object.getPrototypeOf;var l=[][c]?n(n([][c]())):(x(n={},c,(function(){return this})),n),h=s.prototype=r.prototype=Object.create(l);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,x(t,o,"GeneratorFunction")),t.prototype=Object.create(h),t}return i.prototype=s,x(h,"constructor",s),x(s,"constructor",i),i.displayName="GeneratorFunction",x(s,o,"GeneratorFunction"),x(h),x(h,o,"Generator"),x(h,c,(function(){return this})),x(h,"toString",(function(){return"[object Generator]"})),(E=function(){return{w:a,m:y}})()}function x(t,n,e,c){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}x=function(t,n,e,c){function a(n,e){x(t,n,(function(t){return this._invoke(n,e,t)}))}n?o?o(t,n,{value:e,enumerable:!c,configurable:!c,writable:!c}):t[n]=e:(a("next",0),a("throw",1),a("return",2))},x(t,n,e,c)}function _(t,n,e,c,o,a,d){try{var r=t[a](d),i=r.value}catch(t){return void e(t)}r.done?n(i):Promise.resolve(i).then(c,o)}function N(t){return function(){var n=this,e=arguments;return new Promise((function(c,o){var a=t.apply(n,e);function d(t){_(a,c,o,d,r,"next",t)}function r(t){_(a,c,o,d,r,"throw",t)}d(void 0)}))}}var k=["{{FILE_NO}}","{{FILE_NAME}}","{{FILE_VER}}","{{PROJECT_NO}}"],L={name:"TechBookEditorModal",components:{JEditor:a["default"]},data:function(){return{visible:!1,record:{},contentHtml:"",loading:!1,editorHeight:520}},computed:{modalBodyStyle:function(){return{height:"calc(100vh - 120px)",overflow:"hidden"}}},methods:{handleInsertTemplate:function(t){var n=t.key,e={cover:h,changeRecord:y,processFlow:p,preWork:f,processStep:b,tools:g,consumables:u,materialDetail:m,torqueList:v,appendix:w},c=e[n];if(c){var o=this.resolveTemplatePlaceholders(c(this.record||{}));this.contentHtml=(this.contentHtml||"")+o}},resolveTemplatePlaceholders:function(t){var n=t||"",e={"{{FILE_NO}}":this.record&&this.record.fileNo?this.record.fileNo:"","{{FILE_NAME}}":this.record&&this.record.fileName?this.record.fileName:"","{{FILE_VER}}":this.record&&this.record.fileVer?this.record.fileVer:"","{{PROJECT_NO}}":this.record&&(this.record.projectNo||this.record.project||this.record.fileNo)?this.record.projectNo||this.record.project||this.record.fileNo:""};return k.forEach((function(t){n=n.split(t).join(e[t])})),n},insertPageBreak:function(){var t='<div style="page-break-after:always;"><span style="color:#999;">—— 分页 ——</span></div>';this.contentHtml=(this.contentHtml||"")+t},open:function(){var t=N(E().m((function t(n){var e,c,o,a,r,i;return E().w((function(t){while(1)switch(t.p=t.n){case 0:if(this.record=n||{},e=0===this.record.status||2===this.record.status,this.contentHtml=n.contentHtml||"",this.visible=!0,this.setEditorHeight(),window.addEventListener("resize",this.setEditorHeight),this.contentHtml||!this.record.id){t.n=5;break}return this.loading=!0,t.p=1,t.n=2,Object(d["ac"])({bookId:this.record.id});case 2:return c=t.v,o=c&&c.result?c.result:[],a=o.map((function(t){return Object(d["bc"])({detailId:t.id})})),t.n=3,Promise.all(a);case 3:if(r=t.v,i=r.filter((function(t){return t&&t.success})).map((function(t){return t.result})).sort((function(t,n){return(t.stepNum||0)-(n.stepNum||0)})),this.contentHtml=this.renderTemplate(this.record,i),!e){t.n=4;break}return t.n=4,Object(d["Ad"])(this.record.id,this.contentHtml);case 4:return t.p=4,this.loading=!1,t.f(4);case 5:return t.a(2)}}),t,this,[[1,,4,5]])})));function n(n){return t.apply(this,arguments)}return n}(),handleSave:function(){var t=this;if(this.record.id){var n=2===this.record.status||0===this.record.status&&2!==this.record.reviewStatus;n?(this.loading=!0,Object(d["Ad"])(this.record.id,this.contentHtml).then((function(n){n.success?(t.$message.success("正文已保存"),t.$emit("saved"),t.handleClose()):t.$message.error(n.message||"保存失败")})).finally((function(){t.loading=!1}))):this.$message.warning("仅草稿、审核中、审批中状态可编辑保存")}else this.$message.warning("未选择指导书")},handleExport:function(){var t=N(E().m((function t(){var n,e,c,o,a,d;return E().w((function(t){while(1)switch(t.p=t.n){case 0:if(this.contentHtml){t.n=1;break}return this.$message.warning("暂无正文内容，无法导出"),t.a(2);case 1:return this.loading=!0,t.p=2,t.n=3,this.$axios({method:"post",url:"http://localhost:8081/api/techmanual/export-word",data:{htmlContent:this.contentHtml,manualName:this.record.fileName||"作业指导书",fileNo:this.record.fileNo||"",fileVer:this.record.fileVer||"1.0",projectNo:this.record.projectNo||this.record.project||""},responseType:"blob"});case 3:n=t.v,e="".concat(this.record.fileName||"作业指导书",".docx"),c=n.data,o=window.URL.createObjectURL(c),a=document.createElement("a"),a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(o),this.$message.success("导出成功！"),t.n=5;break;case 4:t.p=4,d=t.v,this.$message.error("导出失败："+(d.message||"未知错误"));case 5:return t.p=5,this.loading=!1,t.f(5);case 6:return t.a(2)}}),t,this,[[2,4,5,6]])})));function n(){return t.apply(this,arguments)}return n}(),handleRebuild:function(){var t=this;this.record.id?this.$confirm({title:"重新生成模板",content:"将根据步骤/物料/工器具重新生成正文，当前编辑内容会被覆盖，是否继续？",onOk:function(){var n=N(E().m((function n(){var e,c,o,a,r;return E().w((function(n){while(1)switch(n.p=n.n){case 0:return t.loading=!0,n.p=1,n.n=2,Object(d["ac"])({bookId:t.record.id});case 2:return e=n.v,c=e&&e.result?e.result:[],o=c.map((function(t){return Object(d["bc"])({detailId:t.id})})),n.n=3,Promise.all(o);case 3:return a=n.v,r=a.filter((function(t){return t&&t.success})).map((function(t){return t.result})).sort((function(t,n){return(t.stepNum||0)-(n.stepNum||0)})),t.contentHtml=t.renderTemplate(t.record,r),n.n=4,Object(d["Ad"])(t.record.id,t.contentHtml);case 4:t.$message.success("已重新生成");case 5:return n.p=5,t.loading=!1,n.f(5);case 6:return n.a(2)}}),n,null,[[1,,5,6]])})));function e(){return n.apply(this,arguments)}return e}()}):this.$message.warning("未选择指导书")},handleClose:function(){this.visible=!1,this.record={},this.contentHtml="",this.loading=!1,window.removeEventListener("resize",this.setEditorHeight)},setEditorHeight:function(){var t=window.innerHeight||900;this.editorHeight=Math.max(420,t-220)},renderTemplate:function(t,n){if(!n||0===n.length)return"";var e='\n        <h1 style="text-align:center;">'.concat(t.fileName||"作业指导书",'</h1>\n        <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">\n          <tr>\n            <td style="width:15%;">文件编号</td><td style="width:35%;">').concat(t.fileNo||"",'</td>\n            <td style="width:15%;">版本</td><td style="width:35%;">').concat(t.fileVer||"","</td>\n          </tr>\n          <tr>\n            <td>线路</td><td>").concat(t.lineName||"","</td>\n            <td>修程</td><td>").concat(t.repairProgramName||"",'</td>\n          </tr>\n          <tr>\n            <td>实施日期</td><td colspan="3">').concat(t.exeTime||"","</td>\n          </tr>\n        </table>\n        <h2>工序工步</h2>\n      "),c=(n||[]).map((function(t,n){var e=t.stepContent?"<div>".concat(t.stepContent,"</div>"):"<div>（无内容）</div>",c=t.materialList&&t.materialList.length?'\n          <h4>物料</h4>\n          <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">\n            <tr><th>编码</th><th>名称</th><th>规格</th><th>单位</th><th>数量</th></tr>\n            '.concat(t.materialList.map((function(t){return"\n              <tr>\n                <td>".concat(t.code||"","</td>\n                <td>").concat(t.name||"","</td>\n                <td>").concat(t.spec||"","</td>\n                <td>").concat(t.unit||"","</td>\n                <td>").concat(t.amount||"","</td>\n              </tr>")})).join(""),"\n          </table>"):"",o=t.toolList&&t.toolList.length?'\n          <h4>工器具</h4>\n          <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">\n            <tr><th>编码</th><th>名称</th><th>规格</th><th>单位</th><th>数量</th></tr>\n            '.concat(t.toolList.map((function(t){return"\n              <tr>\n                <td>".concat(t.code||"","</td>\n                <td>").concat(t.name||"","</td>\n                <td>").concat(t.spec||"","</td>\n                <td>").concat(t.unit||"","</td>\n                <td>").concat(t.amount||"","</td>\n              </tr>")})).join(""),"\n          </table>"):"";return"\n          <h3>步骤".concat(t.stepNum||n+1,"：").concat(t.stepTitle||"","</h3>\n          ").concat(e,"\n          ").concat(c,"\n          ").concat(o,"\n        ")})).join("");return e+c}}},I=L,O=(e("03be"),e("2877")),F=Object(O["a"])(I,c,o,!1,null,"b3ed834c",null);n["default"]=F.exports}}]);