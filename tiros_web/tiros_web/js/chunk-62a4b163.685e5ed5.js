(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62a4b163","chunk-4def5374"],{"310d":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[e("a-modal",{attrs:{title:"车辆设备选择",width:"80%",bodyStyle:{height:"83vh"},visible:t.visible,confirmLoading:t.confirmLoading,closable:!0,centered:"",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.close}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchQuery.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"名称"}},[e("a-input",{attrs:{placeholder:"名称或编码"},model:{value:t.queryParam.title,callback:function(e){t.$set(t.queryParam,"title",e)},expression:"queryParam.title"}})],1)],1),e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"线路"}},[e("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:t.changeLine},model:{value:t.lineId_A,callback:function(e){t.lineId_A=e},expression:"lineId_A"}})],1)],1),e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"车辆"}},[e("j-dict-select-seach-tag",{attrs:{triggerChange:!0,dictCode:t.dictTrainStr},model:{value:t.trainNo_A,callback:function(e){t.trainNo_A=e},expression:"trainNo_A"}})],1)],1),e("a-col",{attrs:{md:5,sm:24}},[e("a-form-item",{attrs:{label:"状态"}},[e("j-dict-select-tag",{attrs:{triggerChange:!0,placeholder:"请选择状态",dictCode:"bu_valid_status"},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}})],1)],1),e("a-col",{attrs:{md:5,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[e("a-space",[e("a-button",{on:{click:t.searchQuery}},[t._v("查询")])],1)],1)])],1)],1)],1),e("div",{staticClass:"tableHeight"},[e("vxe-table",{ref:"listTable",attrs:{border:"",resizable:"","row-id":"id",align:t.allAlign,height:"auto",data:t.tableData,"show-overflow":"tooltip","max-height":"100%","radio-config":{trigger:t.multiple?"default":"row",highlight:!0,checkMethod:t.checkRadioMethod},"checkbox-config":{trigger:t.multiple?"row":"default",highlight:!0,checkStrictly:!0,checkMethod:t.checkRadioMethod},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:t.loadChildrenMethod}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"name",title:"名称","tree-node":"",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"code",title:"编码",width:"180"}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",align:"center","header-align":"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[e("div",{style:{backgroundColor:t.statusColor[i.status+""],borderRadius:"4px"}},[t._v(" "+t._s(i.status_dictText)+" ")])]}}])}),e("vxe-table-column",{attrs:{field:"maximoAssetType",title:"maximo设备类型",width:"150",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"locationName",title:"位置",width:"400",align:"left","header-align":"center"}})],1)],1)])],1)},r=[],n=a("8fad"),s={props:{multiple:{type:Boolean,default:!0},trainNo:{type:[Number,String]},lineId:{type:[Number,String]}},data:function(){return{statusColor:{0:"#dedede",1:"#bad795"},dictTrainStr:"",trainNo_A:void 0,lineId_A:void 0,allAlign:"center",tableData:[],visible:!1,confirmLoading:!1,queryParam:{trainNo:"",searchText:"",status:1}}},created:function(){},methods:{changeLine:function(t,e){this.dictTrainStr="",t&&(this.dictTrainStr="bu_train_info,train_no,train_no,line_id="+t+"|train_struct_id")},checkRadioMethod:function(t){t.row;return!0},searchQuery:function(){this.findList()},loadChildrenMethod:function(t){var e=this,a=t.row,i={trainNo:this.trainNo_A,parentId:a.id,searchText:this.queryParam.searchText,status:this.queryParam.status};return new Promise((function(t){Object(n["kc"])(i).then((function(a){a.success?t(a.result):e.$message.error("".concat(a.msg))}))}))},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),Array.from(t,(function(t,e){t.assetName=t.name})),this.$emit("ok",t),this.visible=!1},showModal:function(){this.visible=!0,this.lineId_A=this.lineId,this.trainNo_A=this.trainNo,this.findList()},close:function(){this.visible=!1},findList:function(){var t=this;this.queryParam.trainNo=this.trainNo_A,this.loading=!0,Object(n["kc"])(this.queryParam).then((function(e){e.success&&(t.loading=!1,t.tableData=e.result)}))}}},o=s,l=(a("4677"),a("2877")),c=Object(l["a"])(o,i,r,!1,null,"3967f3d4",null);e["default"]=c.exports},"412f":function(t,e,a){},4677:function(t,e,a){"use strict";a("412f")},"88c7":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{style:"height: calc(100% - ".concat(t.getButtonShow()?"47px":"4px",");")},[t.getButtonShow()?e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1):t._e(),e("div",{attrs:{"na-flex-height-full":""}},[e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:t.targetDeviceList,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(e){t.targetDeviceList=e},blur:function(e){return t.$refs.listTable.clearValidate()}}},[e("vxe-table-column",{attrs:{type:"seq",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t.tasks&&t.tasks.length>1?e("vxe-table-column",{attrs:{field:"orderTaskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var i=a.row;return[e("a-select",{staticStyle:{width:"100%"},on:{change:t.taskSelectChange,blur:function(e){return t.$refs.listTable.clearValidate()}},model:{value:i.orderTaskId,callback:function(e){t.$set(i,"orderTaskId",e)},expression:"row.orderTaskId"}},t._l(t.tasks,(function(a,i){return e("a-select-option",{key:i,attrs:{value:a.id}},[t._v(" "+t._s(a.taskName)+" ")])})),1)]}}],null,!1,2503425894)}):t._e(),e("vxe-table-column",{attrs:{field:"trainAssetName",title:"名称","tree-node":"",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"trainAssetNo",title:"编码",width:"12%"}}),e("vxe-table-column",{attrs:{field:"trainAssetStructType_dictText",title:"类型",width:"10%"}}),t.getButtonShow()&&t.tasks.length>1?e("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.row;return[t.$refs.listTable.isActiveByRow(i)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(i)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(i)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(i)}}},[t._v("编辑")])]]}}],null,!1,1311980394)}):t._e()],1)],1),e("CarDeviceSelectNew",{ref:"trainAssetSelectModal",attrs:{trainNo:t.trainNo,lineId:t.lineId,multiple:!0},on:{ok:t.onSelectToolMultiple}})],1)},r=[],n=a("310d");function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){c(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function c(t,e,a){return(e=u(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function u(t){var e=d(t,"string");return"symbol"==s(e)?e:e+""}function d(t,e){if("object"!=s(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,e||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var f={name:"targetDeviceListOrder",components:{CarDeviceSelectNew:n["default"]},props:{lineId:{type:[String,Number],default:""},trainNo:{type:[String,Number],default:""},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},forms:{type:Array,default:function(){return[]}},operator:{type:Number,default:0}},data:function(){return{curEditMode:0,curRow:null,targetDeviceList:[]}},watch:{tasks:{handler:function(t){if(t&&t.length){for(var e=[],a=function(a){t[a].equipments&&t[a].equipments.forEach((function(i){e.push(l(l({},i),{},{orderTaskName:t[a].taskName}))}))},i=0,r=t.length;i<r;i++)a(i);this.targetDeviceList=e}},deep:!0,immediate:!0}},methods:{updateTask:function(){var t=this,e=JSON.parse(JSON.stringify(this.tasks));Array.from(e,(function(e,a){e.equipments=t.targetDeviceList.filter((function(t){return e.id==t.orderTaskId}))})),this.$emit("update:tasks",e)},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||4===this.operator)},handleAdd:function(){this.curEditMode=1,this.$refs.trainAssetSelectModal.showModal()},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length>0?this.$confirm({content:"是否删除选中".concat(e.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){e.map((function(e){t.targetDeviceList.map((function(a,i){e._XID===a._XID&&t.targetDeviceList.splice(i,1)}))})),t.updateTask()}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(t){this.curEditMode=2,this.$refs.listTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.targetDeviceList.map((function(a,i){t.id===a.id&&e.targetDeviceList.splice(i,1)}))},saveRowEvent:function(t){var e=this;this.$refs.listTable.validate(t,(function(a){if(a)for(var i in a){var r=a[i];r.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 1===e.curEditMode&&e.targetDeviceList.push(t),e.$refs.listTable.clearActived(),e.curEditMode=0,e.updateTask()}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},onSelectToolMultiple:function(t){var e=this;t.forEach((function(t,a){if(e.targetDeviceList.find((function(e){return e.trainAssetId===t.id})))e.$message.warn("你选择的".concat(t.name,"已经在列表中存在"));else{var i={trainAssetName:t.name,trainAssetId:t.id,trainAssetNo:t.code,trainAssetStructType_dictText:t.maximoAssetType};e.tasks.length&&Object.assign(i,{orderTaskId:e.tasks[0].id,orderTaskName:e.tasks[0].taskName}),e.$refs.listTable.insertAt(i,-1),e.targetDeviceList.push(i),e.updateTask()}}))},taskSelectChange:function(t,e){this.$refs.listTable.getActiveRecord().row.orderTaskName=this.tasks[e.key].taskName,this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(t){}))},clearValidate:function(){this.$refs.listTable.clearValidate()}}},h=f,m=a("2877"),p=Object(m["a"])(h,i,r,!1,null,null,null);e["default"]=p.exports}}]);