(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8060996e"],{"0dd8":function(e,t,a){"use strict";a("e637")},"4f36":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{visible:e.visible,title:"库位选择",centered:"",bodyStyle:{maxHeight:"60vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"scroll-main"},[e.treeData.length?t("a-tree",{attrs:{checkStrictly:"","tree-data":e.treeData,"default-selected-keys":e.defaultSelectedKeys,replaceFields:{title:"name",key:"id"}},on:{select:e.handleTreeSelect}}):e._e()],1)])},i=[],l=a("c54ca"),o={name:"WareHouseTree",props:{multiple:{type:Boolean,default:!0},id:{type:String,default:""}},data:function(){return{queryParam:{bookId:""},treeData:[],visible:!1,defaultSelectedKeys:[],selectRecords:[],treeNodeId:""}},methods:{showModal:function(e){this.treeNodeId=e,this.visible=!0,this.findList()},findList:function(){var e=this;Object(l["Eb"])().then((function(t){t.success&&(e.treeNodeId?e.treeData=[e.getNode(t.result,e.treeNodeId)]:e.treeData=t.result,id?e.defaultSelectedKeys[0]=id:e.defaultSelectedKeys[0]=t.result[0].id)}))},handleTreeSelect:function(e,t){var a=this,r=t.selectedNodes;this.selectRecords=[],e.forEach((function(e,t){var i={id:e,name:r[t].data.props.name};a.selectRecords.push(i)}))},handleOk:function(){this.$emit("ok",this.selectRecords),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},getNode:function(e,t){var a={};function r(e,t){e.map((function(e){e.id==t?a=e:e.children&&r(e.children,t)}))}return r(e,t),a}}},s=o,n=(a("0dd8"),a("2877")),d=Object(n["a"])(s,r,i,!1,null,"28ec9b42",null);t["default"]=d.exports},ab1b:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{dialogStyle:{top:"85px"},title:e.title,width:900,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物资编码"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["materialTypeCode",e.validatorRules.materialTypeCode],expression:"['materialTypeCode', validatorRules.materialTypeCode]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,disabled:""}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物资名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["materialTypeName",e.validatorRules.materialTypeName],expression:"['materialTypeName', validatorRules.materialTypeName]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,disabled:""}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"入库数量"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["confirmAmount",e.validatorRules.confirmAmount],expression:"['confirmAmount', validatorRules.confirmAmount]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:0,disabled:"",max:9999999}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"二级库位"}},[t("j-tree-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["selfWarehouseId",e.validatorRules.selfWarehouseId],expression:"['selfWarehouseId', validatorRules.selfWarehouseId]",modifiers:{trim:!0}}],attrs:{disabled:"",placeholder:"请选择存放位置",dict:"bu_mtr_warehouse,name,id",pidField:"parent_id"}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"生产日期"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["productionDate",e.validatorRules.productionDate],expression:"['productionDate', validatorRules.productionDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","disabled-date":e.disabledStartDate},on:{openChange:e.handleStartOpenChange}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"失效日期"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["expirDate",e.validatorRules.expirDate],expression:"['expirDate', validatorRules.expirDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","disabled-date":e.disabledEndDate,open:e.endOpen},on:{change:e.handleExpirDate,openChange:e.handleEndOpenChange}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"有效期"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["expirDay"],expression:"['expirDay']",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入有效期",min:0,max:99999999},on:{change:e.expirDayChange}})],1)],1),t("a-col",{attrs:{md:12,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物资属性"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["materialAttr"],expression:"['materialAttr']",modifiers:{trim:!0}}],attrs:{placeholder:"请选择物资属性",dictCode:"bu_material_attr",triggerChange:!0}})],1)],1)],1)],1),t("div",[t("a-divider",{attrs:{orientation:"left"}},[e._v(" 入库明细 ")]),t("a-row",{staticStyle:{"margin-bottom":"12px"},attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-space",[t("a-button",{on:{click:e.addDetailItem}},[e._v("新增")]),t("a-button",{on:{click:e.delDetailItem}},[e._v("删除")])],1)],1)],1),t("div",{staticStyle:{height:"200px"}},[t("vxe-table",{ref:"listTable",attrs:{height:"auto",align:"center",border:"",data:e.detailList,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"show-overflow":"tooltip"}},[t("vxe-table-column",{attrs:{type:"seq",width:"80",fixed:"left"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"amount",title:"入库数量",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("div",{on:{click:function(e){e.stopPropagation()}}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"输入入库数量",min:0},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})],1)]}}])}),t("vxe-table-column",{attrs:{field:"selfWarehouseId",title:"移入四级库"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row,i=a.rowIndex;return[t("div",{on:{click:function(e){e.stopPropagation()}}},[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(t){return e.openWareHouseTree(i)}},model:{value:r.selfWarehouseName,callback:function(t){e.$set(r,"selfWarehouseName",t)},expression:"row.selfWarehouseName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)]}}])})],1)],1)],1)],1)],1),t("WareHouseTree",{ref:"wareHouseTree",on:{ok:e.onSelectLocation}})],1)},i=[],l=a("c1df"),o=a.n(l),s=(a("5c3a"),a("c54ca")),n=a("b098"),d=a("ca00"),c=a("4f36");function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}var m={name:"PutStockItemModal",components:{JTreeSelect:n["default"],WareHouseTree:c["default"]},data:function(){return{rowIndex:null,title:"操作",visible:!1,buMaterialEntryDetailId:"",model:{},endOpen:!1,labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:15}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{materialTypeCode:{rules:[{required:!0}]},materialTypeName:{rules:[{required:!0}]},confirmAmount:{rules:[{required:!0,message:"请输入库数量!"}]},selfWarehouseId:{rules:[{required:!0,message:"请选择存放位置!"}]}},detailList:[]}},created:function(){},methods:{moment:o.a,expirDayChange:function(e){var t=this.form.getFieldValue("productionDate");if(e&&t){var a=o()(t).add(e-1,"days");this.form.setFieldsValue({expirDate:a})}},openWareHouseTree:function(e){this.rowIndex=e;var t=this.form.getFieldValue("selfWarehouseId");this.$refs.wareHouseTree.showModal(t)},onSelectLocation:function(e){e.length>0&&(this.detailList[this.rowIndex].selfWarehouseId=e[0].id,this.detailList[this.rowIndex].selfWarehouseName=e[0].name)},validatirEvent:function(){var e=!0,t=0,a=JSON.parse(JSON.stringify(this.detailList));if(a.length>0)for(var r=0,i=a.length;r<i;r++){var l=a[r];if(l.amount<=0){e=!1,this.$message.warning("明细序号 ".concat(r+1," 的入库数量不能小于1"));break}if(!l.selfWarehouseId){e=!1,this.$message.warning("明细序号 ".concat(r+1," 的移入四级库位不能为空"));break}delete a[r].selfWarehouseName,delete a[r]._XID,t+=l.amount}else e=!1,this.$message.warning("请添加入库明细");var o=this.form.getFieldValue("confirmAmount");return e&&t!=o?(e=!1,this.$message.warning("司机库位的总库存量".concat(t>o?"大":"小","于入库数量"))):this.model.confirmVO=a,e},addDetailItem:function(){this.detailList.push({amount:0,selfWarehouseId:"",selfWarehouseName:""})},delDetailItem:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?t.forEach((function(t){for(var a=0;a<e.detailList.length;a++){var r=e.detailList[a];t._XID==r._XID&&e.detailList.splice(a,1)}})):this.$message.error("尚未选中任何数据!")},edit:function(e){var t=this;this.form.resetFields(),this.visible=!0,"object"===u(e)?(this.buMaterialEntryDetailId=e.id,this.model.entryOrderId=e.entryOrderId,this.$nextTick((function(){t.form.setFieldsValue({materialTypeCode:e.materialTypeCode,materialTypeName:e.materialTypeName,confirmAmount:e.amount,selfWarehouseId:e.selfWarehouseId,productionDate:e.productionDate,expirDate:e.expirDate,expirDay:e.expirDay,confirmVO:[]}),e.expirDate&&e.productionDate&&t.handleExpirDate(e.expirDate)}))):this.buMaterialEntryDetailId=e},handleExpirDate:function(e){var t=this,a=this.form.getFieldValue("productionDate");if(a){var r=this.moment(a),i=this.moment(e),l=i.diff(r,"day")+1;this.$nextTick((function(){t.form.setFieldsValue({expirDay:l})}))}else this.$message.warn("请选择生产日期!")},disabledStartDate:function(e){var t=this.form.getFieldValue("expirDate");return!(!e||!t)&&e.valueOf()>t.valueOf()},disabledEndDate:function(e){var t=this.form.getFieldValue("productionDate");return!(!e||!t)&&t.valueOf()>=e.valueOf()},handleStartOpenChange:function(e){e||(this.endOpen=!0)},handleEndOpenChange:function(e){this.endOpen=e},handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,r){if(!a){if(!e.validatirEvent())return!1;var i=Object.assign(t.model,r,{productionDate:Object(d["e"])(r.productionDate)?"":o()(r.productionDate).format("YYYY-MM-DD"),expirDate:Object(d["e"])(r.expirDate)?"":o()(r.expirDate).format("YYYY-MM-DD")});i["buMaterialEntryDetailId"]=e.buMaterialEntryDetailId,e.$confirm({content:"确认入库后不可修改，是否确认？",onOk:function(){return t.confirmLoading=!0,Object(s["P"])(i).then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok"),t.close()):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1}))},okText:"确认",cancelText:"取消"})}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},f=m,h=a("2877"),p=Object(h["a"])(f,r,i,!1,null,null,null);t["default"]=p.exports},e637:function(e,t,a){},f886:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{"body-style":e.cardStyle}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"物资"}},[t("a-input",{attrs:{placeholder:"请输入物资编码或者名称",allowClear:""},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"物资类别"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_material_type"},model:{value:e.queryParam.materialCategory,callback:function(t){e.$set(e.queryParam,"materialCategory",t)},expression:"queryParam.materialCategory"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"是否新增"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_entryClass_type"},model:{value:e.queryParam.entryClass,callback:function(t){e.$set(e.queryParam,"entryClass",t)},expression:"queryParam.entryClass"}})],1)],1),t("a-col",{attrs:{md:6,sm:8}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")]),t("a-button",{attrs:{type:"primary"},on:{click:e.handlePutStock}},[e._v("确认已入库")])],1)],1)])],1)],1)],1),t("div",{staticStyle:{height:"calc(100vh - 250px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 250px)"},attrs:{border:"","auto-resize":"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row"}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40",align:"center"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"12%"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称",width:"12%"}}),t("vxe-table-column",{attrs:{field:"selfWarehouseName",title:"库位",width:"10%"}}),t("vxe-table-column",{attrs:{field:"materialTypeCategory1_dictText",title:"类别",width:"10%"}}),t("vxe-table-column",{attrs:{field:"entryDate",title:"入库日期",width:"10%",align:"right","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"entryNo",title:"批次",width:"10%",align:"right","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"8%"}}),t("vxe-table-column",{attrs:{field:"price",title:"入库单价",width:"10%",align:"right","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"amount",title:"入库数量",width:"10%",align:"right","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"entryClass_dictText",title:"入库类别",width:"8%"}}),t("vxe-table-column",{attrs:{field:"confirm_dictText",title:"确认入库？",width:"10%"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"物料描述",width:"20%"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("put-stock-item-modal",{ref:"modalForm",on:{ok:function(t){return e.loadData()}}})],1)},i=[],l=a("c54ca"),o=a("ab1b"),s={name:"RightPutStock",components:{PutStockItemModal:o["default"]},props:["value"],data:function(){return{selectRow:null,queryParam:{searchText:"",materialCategory:null,entryClass:null,warehouseId:"",pageNo:1,pageSize:10},totalResult:0,allAlign:"center",tableData:[],cardStyle:{padding:"10px",height:"calc(100vh - 120px)"}}},created:function(){this.findList()},watch:{value:{immediate:!0,handler:function(e){this.queryParam.warehouseId=e,this.tableData=[],this.findList()}}},methods:{findList:function(){var e=this;this.loading=!0,Object(l["ob"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handlePutStock:function(){var e=this.$refs.listTable.getCheckboxRecords();if(1===e.length){var t=e[0].id;if(1===e[0].confirm)return void this.$message.warn("该物资已入库,不可重复确认入库!");this.$refs.modalForm.edit(t),this.$refs.modalForm.title="确认入库"}else e.length>1?this.$message.error("只能选择一条数据!"):this.$message.error("尚未选中任何数据!")},loadData:function(){this.findList(),this.$emit("selectTree")},clearRadioRow:function(){this.selectRow=null,this.$refs.listTable.clearRadioRow()},radioChange:function(e){var t=e.row;this.selectRow=t}}},n=s,d=a("2877"),c=Object(d["a"])(n,r,i,!1,null,null,null);t["default"]=c.exports}}]);