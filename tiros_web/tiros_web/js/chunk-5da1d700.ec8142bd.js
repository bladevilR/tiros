(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5da1d700","chunk-7f6b358b","chunk-47ab454d"],{"1cd5":function(e,t,a){},"1d42":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"工序编码"}},[t("a-input",{attrs:{placeholder:"请输入工序编码",allowClear:""},model:{value:e.queryParam.processNo,callback:function(t){e.$set(e.queryParam,"processNo",t)},expression:"queryParam.processNo"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"工序名称"}},[t("a-input",{attrs:{placeholder:"请输入工序名称",allowClear:""},model:{value:e.queryParam.processName,callback:function(t){e.$set(e.queryParam,"processName",t)},expression:"queryParam.processName"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"类型"}},[t("a-select",{attrs:{placeholder:"请选择工序类型",allowClear:""},model:{value:e.queryParam.processType,callback:function(t){e.$set(e.queryParam,"processType",t)},expression:"queryParam.processType"}},[t("a-select-option",{attrs:{value:""}},[e._v("全部")]),t("a-select-option",{attrs:{value:"1"}},[e._v("拆卸")]),t("a-select-option",{attrs:{value:"2"}},[e._v("检修")]),t("a-select-option",{attrs:{value:"3"}},[e._v("安装")])],1)],1)],1),e.advanced?[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"车型"}},[t("a-input",{attrs:{placeholder:"请输入车型",allowClear:""},model:{value:e.queryParam.trainType,callback:function(t){e.$set(e.queryParam,"trainType",t)},expression:"queryParam.trainType"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"标准工时(分钟)"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.queryParam.standardDuration,callback:function(t){e.$set(e.queryParam,"standardDuration",t)},expression:"queryParam.standardDuration"}})],1)],1)]:e._e(),t("a-col",{attrs:{md:6,sm:8}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),t("a-button",{attrs:{disabled:1!=e.selectRows.length},on:{click:function(t){return e.handleView(e.selectRows[0])}}},[e._v("查看")]),t("a-button",{attrs:{disabled:1!=e.selectRows.length},on:{click:function(t){return e.handleEdit(e.selectRows[0])}}},[e._v("编辑")]),t("a-button",{attrs:{disabled:e.selectRows.length<1},on:{click:e.handleDelete}},[e._v("删除")]),t("a-button",{attrs:{disabled:e.selectRows.length<1},on:{click:e.handleExportPDF}},[e._v("导出PDF")]),t("a-button",{on:{click:e.handleExport}},[e._v("导出Excel")]),t("a-upload",{attrs:{name:"file",showUploadList:!1,multiple:!1,headers:e.tokenHeader,action:e.importExcelUrl},on:{change:e.handleImportExcel}},[t("a-button",[e._v("导入")])],1),t("a-button",{on:{click:e.handleSearch}},[e._v("查询")]),t("a",{on:{click:function(t){e.advanced=!e.advanced}}},[e._v(" "+e._s(e.advanced?"收起":"展开")+" "),t("a-icon",{attrs:{type:e.advanced?"up":"down"}})],1)],1)],1)])],2)],1)],1),t("div",{staticStyle:{height:"calc(100vh - 225px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 225px)"},attrs:{border:"","auto-resize":"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}},on:{"checkbox-change":e.checkboxChange,"checkbox-all":e.checkboxChange}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"processNo",title:"工序编码",width:"15%","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"processName",title:"工序名称",width:"20%","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"processType",title:"工序类型",width:"12%","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return["1"===a.row.processType?t("span",[e._v("拆卸")]):"2"===a.row.processType?t("span",[e._v("检修")]):"3"===a.row.processType?t("span",[e._v("安装")]):t("span",[e._v(e._s(a.row.processType))])]}}])}),t("vxe-table-column",{attrs:{field:"standardDuration",title:"标准工时(分钟)",width:"15%","header-align":"center",align:"right"}}),t("vxe-table-column",{attrs:{field:"trainType",title:"车型",width:"15%","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"createTime",title:"创建日期",width:"18%",formatter:e.formatDate}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"15%","header-align":"center",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("standard-process-modal",{ref:"processModal",on:{ok:function(t){return e.loadData()}}}),t("standard-process-view-modal",{ref:"viewModal"})],1)},s=[],n=a("c1df"),o=a.n(n),i=(a("5c3a"),a("be6a")),l=a("b86a"),c=a("8fad"),p=a("0fea"),u=a("2b0e"),d=a("9fb0");function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){b(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function b(e,t,a){return(t=v(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function v(e){var t=g(e,"string");return"symbol"==m(t)?t:t+""}function g(e,t){if("object"!=m(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var y={name:"StandardProcess",components:{StandardProcessModal:i["default"],StandardProcessViewModal:l["default"]},computed:{importExcelUrl:function(){return"".concat(window._CONFIG["domianURL"],"/base/standard-process/importExcel")}},data:function(){return{selectRows:[],advanced:!1,tokenHeader:{"X-Access-Token":u["default"].ls.get(d["a"])},queryParam:{processNo:"",processName:"",processType:"",trainType:"",standardDuration:void 0,pageNo:1,pageSize:10},totalResult:0,allAlign:"center",tableData:[],loading:!1}},created:function(){this.loadData()},methods:{checkboxChange:function(e){this.selectRows=e.records},loadData:function(){var e=this;this.loading=!0,Object(c["Yc"])(this.queryParam).then((function(t){t.success&&(e.tableData=t.result.records||[],e.totalResult=t.result.total||0)})).finally((function(){e.loading=!1}))},handleSearch:function(){this.queryParam.pageNo=1,this.loadData()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.loadData()},handleAdd:function(){this.$refs.processModal.add()},handleView:function(e){this.$refs.viewModal.view(e)},handleEdit:function(e){this.$refs.processModal.edit(e)},handleDelete:function(){var e=this;0!==this.selectRows.length?this.$confirm({title:"删除确认",content:"确认删除选中的标准工序吗？",onOk:function(){var t=e.selectRows.map((function(e){return e.id})).join(",");Object(c["fb"])({ids:t}).then((function(t){t.success?(e.$message.success("删除成功"),e.selectRows=[],e.loadData()):e.$message.error(t.message||"删除失败")}))}}):this.$message.warning("请先选择要删除的记录")},handleExport:function(){var e=this,t=h({},this.queryParam);Object(p["b"])("/base/standard-process/exportXls",t).then((function(t){if(t){var a=new Blob([t],{type:"application/vnd.ms-excel"}),r=window.URL.createObjectURL(a),s=document.createElement("a");s.style.display="none",s.href=r,s.setAttribute("download","标准工序.xls"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}else e.$message.warning("文件下载失败")}))},handleExportPDF:function(){var e=this;if(0!==this.selectRows.length){this.$message.loading("正在生成PDF，请稍候...",0);var t=this.selectRows.map((function(e){return e.id})).join(",");Object(p["b"])("/base/standard-process/exportPdf",{ids:t}).then((function(t){if(e.$message.destroy(),t){var a=new Blob([t],{type:"application/pdf"}),r=window.URL.createObjectURL(a),s=document.createElement("a");s.style.display="none",s.href=r,s.setAttribute("download","标准工序.pdf"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r),e.$message.success("PDF导出成功")}else e.$message.warning("PDF生成失败")})).catch((function(){e.$message.destroy(),e.$message.error("PDF导出失败")}))}else this.$message.warning("请先选择要导出的记录")},handleImportExcel:function(e){"done"===e.file.status?e.file.response&&e.file.response.success?(this.$message.success(e.file.response.message||"".concat(e.file.name," 导入成功")),this.loadData()):this.$message.error(e.file.response?e.file.response.message:"导入失败"):"error"===e.file.status&&this.$message.error("文件上传失败")},formatDate:function(e){return e.createTime?o()(e.createTime).format("YYYY-MM-DD HH:mm:ss"):""}}},w=y,k=(a("e278"),a("2877")),P=Object(k["a"])(w,r,s,!1,null,"426037c0",null);t["default"]=P.exports},2220:function(e,t,a){"use strict";a("1cd5")},"27b7":function(e,t,a){},b86a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"查看标准工序",width:900,visible:e.visible,footer:null},on:{cancel:e.handleCancel}},[t("a-descriptions",{attrs:{bordered:"",column:2,size:"small"}},[t("a-descriptions-item",{attrs:{label:"工序编码"}},[e._v(e._s(e.model.processNo))]),t("a-descriptions-item",{attrs:{label:"工序名称"}},[e._v(e._s(e.model.processName))]),t("a-descriptions-item",{attrs:{label:"工序类型"}},["1"===e.model.processType?t("span",[e._v("拆卸")]):"2"===e.model.processType?t("span",[e._v("检修")]):"3"===e.model.processType?t("span",[e._v("安装")]):t("span",[e._v(e._s(e.model.processType))])]),t("a-descriptions-item",{attrs:{label:"车型"}},[e._v(e._s(e.model.trainType||"-"))]),t("a-descriptions-item",{attrs:{label:"标准工时(分钟)"}},[e._v(e._s(e.model.standardDuration||0))]),t("a-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.formatDate(e.model.createTime)))])],1),t("a-divider",[e._v("工序步骤")]),0===e.stepRows.length?t("div",{staticStyle:{"text-align":"center",padding:"20px",color:"#999"}},[e._v(" 暂无步骤信息 ")]):t("div",{staticClass:"step-list"},e._l(e.stepRows,(function(a,r){return t("div",{key:r,staticClass:"step-item"},[t("div",{staticClass:"step-header"},[t("a-tag",{attrs:{color:"blue"}},[e._v("步骤 "+e._s(a.stepNo))]),t("span",{staticClass:"step-name"},[e._v(e._s(a.name))])],1),a.content?t("div",{staticClass:"step-content"},[t("strong",[e._v("内容：")]),e._v(e._s(a.content)+" ")]):e._e(),a.checkPoint?t("div",{staticClass:"step-content"},[t("strong",[e._v("检验点：")]),e._v(e._s(a.checkPoint)+" ")]):e._e(),a.remark?t("div",{staticClass:"step-content"},[t("strong",[e._v("备注：")]),e._v(e._s(a.remark)+" ")]):e._e(),a.imageUrl?t("div",{staticClass:"step-image"},[t("img",{attrs:{src:a.imageUrl,alt:"步骤图片"}})]):e._e()])})),0),e.model.remark?t("a-divider",[e._v("备注")]):e._e(),e.model.remark?t("div",{staticStyle:{padding:"12px",background:"#fafafa","border-radius":"4px"}},[e._v(" "+e._s(e.model.remark)+" ")]):e._e()],1)},s=[],n=a("c1df"),o=a.n(n),i={name:"StandardProcessViewModal",data:function(){return{visible:!1,model:{},stepRows:[]}},methods:{view:function(e){this.visible=!0,this.model=Object.assign({},e),this.stepRows=this.parseStepRows(e.processSteps,e.processImages)},handleCancel:function(){this.visible=!1,this.model={},this.stepRows=[]},parseStepRows:function(e,t){var a=String(t||"").split(",").map((function(e){return e.trim()})).filter(Boolean);if(!e)return[];try{var r=JSON.parse(e);return Array.isArray(r)&&0!==r.length?r.map((function(e,t){return{stepNo:e.stepNo||t+1,name:(e.name||e.stepName||"").trim(),content:(e.content||e.desc||e.description||"").trim(),checkPoint:(e.checkPoint||"").trim(),imageUrl:(e.imageUrl||a[t]||"").trim(),remark:(e.remark||"").trim()}})):[]}catch(s){return[]}},formatDate:function(e){return e?o()(e).format("YYYY-MM-DD HH:mm:ss"):"-"}}},l=i,c=(a("2220"),a("2877")),p=Object(c["a"])(l,r,s,!1,null,"b35e1d6e",null);t["default"]=p.exports},be6a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:900,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form-model",{ref:"form",attrs:{model:e.model,rules:e.validatorRules,"label-col":{span:6},"wrapper-col":{span:16}}},[t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"配置提示","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-alert",{attrs:{type:"info","show-icon":"",message:"支持按步骤配置图文内容；步骤可新增、删除、排序，支持本地上传图片。"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序编码",prop:"processNo"}},[t("a-input",{attrs:{placeholder:"请输入工序编码"},model:{value:e.model.processNo,callback:function(t){e.$set(e.model,"processNo",t)},expression:"model.processNo"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序名称",prop:"processName"}},[t("a-input",{attrs:{placeholder:"请输入工序名称"},model:{value:e.model.processName,callback:function(t){e.$set(e.model,"processName",t)},expression:"model.processName"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序类型",prop:"processType"}},[t("a-select",{attrs:{placeholder:"请选择工序类型"},model:{value:e.model.processType,callback:function(t){e.$set(e.model,"processType",t)},expression:"model.processType"}},[t("a-select-option",{attrs:{value:"1"}},[e._v("拆卸")]),t("a-select-option",{attrs:{value:"2"}},[e._v("检修")]),t("a-select-option",{attrs:{value:"3"}},[e._v("安装")])],1)],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"车型"}},[t("a-input",{attrs:{placeholder:"请输入车型"},model:{value:e.model.trainType,callback:function(t){e.$set(e.model,"trainType",t)},expression:"model.trainType"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"标准工时(分钟)"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.model.standardDuration,callback:function(t){e.$set(e.model,"standardDuration",t)},expression:"model.standardDuration"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"工序图示"}},[t("a-input",{attrs:{value:e.stepImageSummary,disabled:"",placeholder:"根据步骤中的图片URL自动生成"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"工序步骤","label-col":{span:3},"wrapper-col":{span:20}}},[t("div",{staticClass:"process-step-wrapper"},[t("div",{staticClass:"process-step-scroll"},e._l(e.stepRows,(function(a,r){return t("div",{key:a.uid||r,staticClass:"process-step-item"},[t("a-row",{attrs:{gutter:8}},[t("a-col",{attrs:{span:4}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,precision:0,placeholder:"序号"},model:{value:a.stepNo,callback:function(t){e.$set(a,"stepNo",t)},expression:"step.stepNo"}})],1),t("a-col",{attrs:{span:8}},[t("a-input",{attrs:{placeholder:"步骤名称（必填）"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"step.name"}})],1),t("a-col",{attrs:{span:8}},[t("a-space",[t("a-input",{staticStyle:{width:"200px"},attrs:{placeholder:"步骤图片URL"},model:{value:a.imageUrl,callback:function(t){e.$set(a,"imageUrl",t)},expression:"step.imageUrl"}}),t("j-image-upload",{attrs:{text:"上传",isMultiple:!1,bizPath:"/standard-process/step"},model:{value:a.imageUrl,callback:function(t){e.$set(a,"imageUrl",t)},expression:"step.imageUrl"}})],1)],1),t("a-col",{attrs:{span:4}},[t("a-button",{attrs:{danger:"",block:"",disabled:1===e.stepRows.length},on:{click:function(t){return e.removeStepRow(r)}}},[e._v("删除")])],1)],1),t("a-row",{staticStyle:{"margin-top":"8px"},attrs:{gutter:8}},[t("a-col",{attrs:{span:12}},[t("a-input",{attrs:{placeholder:"检验点（选填）"},model:{value:a.checkPoint,callback:function(t){e.$set(a,"checkPoint",t)},expression:"step.checkPoint"}})],1),t("a-col",{attrs:{span:12}},[t("a-input",{attrs:{placeholder:"步骤备注（选填）"},model:{value:a.remark,callback:function(t){e.$set(a,"remark",t)},expression:"step.remark"}})],1)],1),t("a-row",{staticStyle:{"margin-top":"8px"}},[t("a-col",{attrs:{span:24}},[t("a-textarea",{attrs:{rows:2,placeholder:"步骤详细内容（可填）"},model:{value:a.content,callback:function(t){e.$set(a,"content",t)},expression:"step.content"}})],1)],1)],1)})),0),t("a-space",{staticStyle:{"margin-top":"8px"}},[t("a-button",{attrs:{size:"small",type:"dashed",icon:"plus"},on:{click:e.addStepRow}},[e._v("新增步骤")]),t("a-button",{attrs:{size:"small"},on:{click:e.normalizeStepRows}},[e._v("按序号排序")])],1)],1)])],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"备注","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:2,placeholder:"请输入备注"},model:{value:e.model.remark,callback:function(t){e.$set(e.model,"remark",t)},expression:"model.remark"}})],1)],1)],1)],1)],1)],1)},s=[],n=a("8fad"),o=a("e610");function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return(t=u(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function u(e){var t=d(e,"string");return"symbol"==i(t)?t:t+""}function d(e,t){if("object"!=i(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var m={name:"StandardProcessModal",components:{JImageUpload:o["default"]},computed:{stepImageSummary:function(){return(this.stepRows||[]).map((function(e){return(e.imageUrl||"").trim()})).filter(Boolean).join(",")}},data:function(){return{title:"",visible:!1,confirmLoading:!1,model:{},stepRows:[],validatorRules:{processNo:[{required:!0,message:"请输入工序编码",trigger:"blur"}],processName:[{required:!0,message:"请输入工序名称",trigger:"blur"}]}}},methods:{add:function(){this.title="新增标准工序",this.visible=!0,this.model={processType:"1",standardDuration:0},this.stepRows=[this.createEmptyStepRow(1)]},edit:function(e){this.title="编辑标准工序",this.visible=!0,this.model=Object.assign({},e),this.stepRows=this.parseStepRows(e.processSteps,e.processImages)},handleOk:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.normalizeStepRows();var a=e.buildPayloadSteps(e.stepRows);if(!a.length)return void e.$message.warning("请至少配置一个步骤名称");var r=Object.assign({},e.model);r.processSteps=JSON.stringify(a),r.processImages=a.map((function(e){return(e.imageUrl||"").trim()})).filter(Boolean).join(","),e.confirmLoading=!0;var s=r.id?Object(n["Xd"])(r):Object(n["Dd"])(r);s.then((function(t){t.success?(e.$message.success(r.id?"修改成功":"新增成功"),e.visible=!1,e.$emit("ok")):e.$message.error(t.message||"操作失败")})).finally((function(){e.confirmLoading=!1}))}}))},handleCancel:function(){this.visible=!1,this.$refs.form.resetFields(),this.stepRows=[]},addStepRow:function(){var e=(this.stepRows||[]).length+1;this.stepRows.push(this.createEmptyStepRow(e))},removeStepRow:function(e){this.stepRows.splice(e,1),0===this.stepRows.length&&this.stepRows.push(this.createEmptyStepRow(1)),this.normalizeStepRows()},normalizeStepRows:function(){var e=this;this.stepRows=(this.stepRows||[]).map((function(t,a){var r=e.toPositiveInt(t.stepNo);return{uid:t.uid||e.newUid(),stepNo:r>0?r:a+1,name:(t.name||"").trim(),content:(t.content||"").trim(),checkPoint:(t.checkPoint||"").trim(),imageUrl:(t.imageUrl||"").trim(),remark:(t.remark||"").trim()}})).sort((function(e,t){return e.stepNo-t.stepNo})),0===this.stepRows.length&&this.stepRows.push(this.createEmptyStepRow(1))},parseStepRows:function(e,t){var a=this,r=String(t||"").split(",").map((function(e){return e.trim()})).filter(Boolean),s=function(){var t=String(e||"").split("\n").map((function(e){return e.trim()})).filter(Boolean);return t.length?t.map((function(e,t){return c(c({},a.createEmptyStepRow(t+1)),{},{name:e,imageUrl:r[t]||""})})):[a.createEmptyStepRow(1)]};if(!e)return[this.createEmptyStepRow(1)];try{var n=JSON.parse(e);return Array.isArray(n)&&0!==n.length?n.map((function(e,t){return{uid:a.newUid(),stepNo:a.toPositiveInt(e.stepNo)||t+1,name:(e.name||e.stepName||"").trim(),content:(e.content||e.desc||e.description||"").trim(),checkPoint:(e.checkPoint||"").trim(),imageUrl:(e.imageUrl||r[t]||"").trim(),remark:(e.remark||"").trim()}})):s()}catch(o){return s()}},buildPayloadSteps:function(e){var t=this;return(e||[]).map((function(e){return{stepNo:t.toPositiveInt(e.stepNo),name:(e.name||"").trim(),content:(e.content||"").trim(),checkPoint:(e.checkPoint||"").trim(),imageUrl:(e.imageUrl||"").trim(),remark:(e.remark||"").trim()}})).filter((function(e){return e.name||e.content||e.imageUrl||e.checkPoint||e.remark})).map((function(e,t){return c(c({},e),{},{stepNo:e.stepNo>0?e.stepNo:t+1})}))},createEmptyStepRow:function(e){return{uid:this.newUid(),stepNo:e||1,name:"",content:"",checkPoint:"",imageUrl:"",remark:""}},toPositiveInt:function(e){var t=Number(e);return Number.isNaN(t)||t<=0?0:Math.floor(t)},newUid:function(){return"step_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8))}}},f=m,h=(a("c9c7"),a("2877")),b=Object(h["a"])(f,r,s,!1,null,"7d101734",null);t["default"]=b.exports},c9c7:function(e,t,a){"use strict";a("f2f7")},e278:function(e,t,a){"use strict";a("27b7")},e610:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-upload",{attrs:{name:"file",listType:"picture-card",multiple:e.isMultiple,action:e.uploadAction,headers:e.headers,data:{fileName:e.bizPath},fileList:e.fileList,beforeUpload:e.beforeUpload,disabled:e.disabled,isMultiple:e.isMultiple,showUploadList:e.isMultiple},on:{change:e.handleChange,preview:e.handlePreview}},[!e.isMultiple&&e.picUrl?t("img",{staticStyle:{height:"104px","max-width":"300px"},attrs:{src:e.getAvatarView()}}):t("div",[t("a-icon",{attrs:{type:e.uploadLoading?"loading":"plus"}}),t("div",{staticClass:"ant-upload-text"},[e._v(e._s(e.text))])],1),t("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:function(t){return e.handleCancel()}}},[t("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1)},s=[],n=a("2b0e"),o=a("9fb0"),i=a("0fea"),l=function(){return"-"+parseInt(1e4*Math.random()+1,10)},c=function(e){if(e.lastIndexOf("\\")>=0){var t=new RegExp("\\\\","g");e=e.replace(t,"/")}return e.substring(e.lastIndexOf("/")+1)},p={name:"JImageUpload",data:function(){return{uploadAction:window._CONFIG["fileServiceUrl"]+"/oss/file/upload",uploadLoading:!1,picUrl:!1,headers:{},fileList:[],previewImage:"",previewVisible:!1}},props:{text:{type:String,required:!1,default:"上传"},bizPath:{type:String,required:!1,default:"/img"},value:{type:[String,Array],required:!1},disabled:{type:Boolean,required:!1,default:!1},isMultiple:{type:Boolean,required:!1,default:!1}},watch:{value:function(e){e instanceof Array?this.initFileList(e.join(",")):this.initFileList(e)}},created:function(){var e=n["default"].ls.get(o["a"]);this.headers={"X-Access-Token":e}},methods:{initFileList:function(e){if(e&&0!=e.length){this.picUrl=!0;for(var t=[],a=e.split(","),r=function(e){var r;Object(i["f"])(a[e]).then((function(s){r=s,t.push({uid:l(),name:c(a[e]),status:"done",url:r,response:{status:"history",message:a[e]}})}))},s=0;s<a.length;s++)r(s);this.fileList=t}else this.fileList=[]},beforeUpload:function(e){var t=e.type;if(t.indexOf("image")<0)return this.$message.warning("请上传图片"),!1},handleChange:function(e){this.picUrl=!1;var t=e.fileList;"done"===e.file.status?e.file.response.success&&(this.picUrl=!0,t=t.map((function(e){return e.response&&(e.url=e.response.result),e}))):"error"===e.file.status?this.$message.error("".concat(e.file.name," 上传失败.")):"removed"===e.file.status&&this.handleDelete(e.file),this.fileList=t,"done"!==e.file.status&&"removed"!==e.file.status||this.handlePathChange()},handlePreview:function(e){this.previewImage=e.url||e.thumbUrl,this.previewVisible=!0},getAvatarView:function(){if(this.fileList.length>0){var e=this.fileList[0].url;return e}},handlePathChange:function(){var e=this.fileList,t="";e&&0!=e.length||(t="");var a=[];if(this.isMultiple)for(var r=0;r<e.length;r++)a.push(e[r].response.result);else a.push(e[e.length-1].response.result);a.length>0&&(t=a.join(",")),this.$emit("change",t)},handleDelete:function(e){},handleCancel:function(){this.close(),this.previewVisible=!1},close:function(){}},model:{prop:"value",event:"change"}},u=p,d=a("2877"),m=Object(d["a"])(u,r,s,!1,null,"1ef1dc4c",null);t["default"]=m.exports},f2f7:function(e,t,a){}}]);