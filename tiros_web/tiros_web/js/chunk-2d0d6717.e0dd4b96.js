(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d6717"],{7327:function(e,t,a){"use strict";function i(e){if(null==e)throw new TypeError("Cannot destructure "+e)}a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"devicesTable",attrs:{border:"","keep-source":"",align:"center",data:e.taskDevices,"checkbox-config":{trigger:"row",highlight:!0},"edit-rules":e.validRules,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"assetCode",title:"设备编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",open:!1},on:{dropdownVisibleChange:function(t){return e.openMaterial(i)}},model:{value:i.assetCode,callback:function(t){e.$set(i,"assetCode",t)},expression:"row.assetCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"assetName",title:"设备名称",width:"300"}}),t("vxe-table-column",{attrs:{field:"startTime",title:"开始时间","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){return i(a),[t("a-time-picker",{attrs:{format:"HH:mm"},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})]}}])}),t("vxe-table-column",{attrs:{field:"endTime",title:"结束时间","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){return i(a),[t("a-time-picker",{attrs:{format:"HH:mm"},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})]}}])}),t("vxe-table-column",{attrs:{field:"timeLen",title:"需求时长","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:1e7},model:{value:i.timeLen,callback:function(t){e.$set(i,"timeLen",t)},expression:"row.timeLen"}})]}}])}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var i=a.row;return[t("a-input",{attrs:{placeholder:"请输入备注"},model:{value:i.remark,callback:function(t){e.$set(i,"remark",t)},expression:"row.remark"}})]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[e.$refs.devicesTable.isActiveByRow(i)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(i)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(i)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(i)}}},[e._v("编辑")])]]}}],null,!1,2065044451)})],1),t("material-list",{ref:"materialForm",attrs:{multiple:!1},on:{ok:e.onSelectMaterial}})],1)},s=[],r=a("ca00"),o=a("7164"),l={name:"TaskDevices",components:{MaterialList:o["default"]},props:{taskDevices:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,validRules:{assetCode:[{required:!0,message:"请选择",trigger:"blur"}]},curRow:{},startDate:null,endDate:null}},methods:{handleAdd:function(){var e=this;if(!this.$refs.devicesTable.getActiveRecord()){this.startDate=null,this.endDate=null,this.curEditMode=1;var t={id:Object(r["p"])()};this.$refs.devicesTable.insertAt(t,-1).then((function(t){var a=t.row;return e.$refs.devicesTable.setActiveCell(a,"assetCode")}))}},handleDel:function(){var e=this,t=this.$refs.devicesTable.getCheckboxRecords();t.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){t.map((function(t){e.taskDevices.map((function(a,i){t.id===a.id&&e.taskDevices.splice(i,1)}))}))}})},editRowEvent:function(e){this.curEditMode=2,this.startDate=this.$moment(e.startTime,"HH:mm"),this.endDate=this.$moment(e.endTime,"HH:mm"),this.$refs.devicesTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskDevices.map((function(a,i){e.id===a.id&&t.taskDevices.splice(i,1)}))},saveRowEvent:function(e){var t=this;this.$refs.devicesTable.validate(e,(function(a){if(a)for(var i in a){var n=a[i];n.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else e.startTime=t.$moment(t.startDate).format("HH:mm"),e.endTime=t.$moment(t.endDate).format("HH:mm"),1===t.curEditMode&&t.taskDevices.push(e),t.$refs.devicesTable.clearActived(),t.curEditMode=0,t.startDate=null,t.endDate=null}))},cancelRowEvent:function(e){this.$refs.devicesTable.clearActived(),e.startTime=null,e.endTime=null,1===this.curEditMode?this.$refs.devicesTable.remove(e):2===this.curEditMode&&this.$refs.devicesTable.revertData(e),this.curEditMode=0},openMaterial:function(e){this.curRow=e,this.$refs.materialForm.showModal()},onSelectMaterial:function(e){e.length&&(this.curRow.assetCode="010011080006",this.curRow.assetName="测试",this.curRow.specAssetId="3b98cd5515af4a54cd1322f19692c63d")}}},c=l,d=a("2877"),u=Object(d["a"])(c,n,s,!1,null,"1c2ff7a4",null);t["default"]=u.exports}}]);