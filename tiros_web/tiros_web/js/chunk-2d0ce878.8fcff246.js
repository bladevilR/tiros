(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ce878"],{"609a":function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:900,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form-model",{ref:"form",attrs:{model:e.model,rules:e.validatorRules,"label-col":{span:6},"wrapper-col":{span:16}}},[t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"通知单号",prop:"noticeNo"}},[t("a-input",{attrs:{placeholder:"请输入通知单号"},model:{value:e.model.noticeNo,callback:function(t){e.$set(e.model,"noticeNo",t)},expression:"model.noticeNo"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"通知单标题",prop:"title"}},[t("a-input",{attrs:{placeholder:"请输入通知单标题"},model:{value:e.model.title,callback:function(t){e.$set(e.model,"title",t)},expression:"model.title"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"通知类型",prop:"noticeType"}},[t("a-select",{attrs:{placeholder:"请选择通知类型"},model:{value:e.model.noticeType,callback:function(t){e.$set(e.model,"noticeType",t)},expression:"model.noticeType"}},[t("a-select-option",{attrs:{value:"1"}},[e._v("技术类")]),t("a-select-option",{attrs:{value:"2"}},[e._v("变更类")])],1)],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"状态"}},[t("a-input",{attrs:{value:e.statusText,disabled:""}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"适用车型",prop:"trainType"}},[t("a-input",{attrs:{placeholder:"请输入车型"},model:{value:e.model.trainType,callback:function(t){e.$set(e.model,"trainType",t)},expression:"model.trainType"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"适用线别",prop:"line"}},[t("a-input",{attrs:{placeholder:"请输入线别"},model:{value:e.model.line,callback:function(t){e.$set(e.model,"line",t)},expression:"model.line"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"涉及列车总数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.model.totalTrains,callback:function(t){e.$set(e.model,"totalTrains",t)},expression:"model.totalTrains"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"已完成列车数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,disabled:!0},model:{value:e.model.completedTrains,callback:function(t){e.$set(e.model,"completedTrains",t)},expression:"model.completedTrains"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"作业范围","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:2,placeholder:"请输入作业范围描述"},model:{value:e.model.scope,callback:function(t){e.$set(e.model,"scope",t)},expression:"model.scope"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"通知内容","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:4,placeholder:"请输入通知内容"},model:{value:e.model.content,callback:function(t){e.$set(e.model,"content",t)},expression:"model.content"}})],1)],1)],1),"1"===e.model.noticeType?t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"关联作业记录表","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-select",{attrs:{mode:"multiple",value:e.relatedFormIdList,placeholder:"请选择需随工单下发的作业记录表",allowClear:"",showSearch:"",optionFilterProp:"children",maxTagCount:4,notFoundContent:e.formOptionLoading?"加载中...":void 0},on:{change:e.onRelatedFormsChange,dropdownVisibleChange:e.onRelatedFormsDropdown}},e._l(e.relatedFormOptions,(function(o){return t("a-select-option",{key:o.id,attrs:{value:o.id}},[e._v(" "+e._s(o.code?"".concat(o.code," - ").concat(o.title):o.title)+" ")])})),1)],1)],1)],1):e._e(),"1"===e.model.noticeType||"2"===e.model.noticeType?t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"关联附件","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-select",{attrs:{mode:"multiple",value:e.relatedDocIdList,placeholder:e.docSelectPlaceholder,allowClear:"",showSearch:"",optionFilterProp:"children",maxTagCount:4,notFoundContent:e.docOptionLoading?"加载中...":void 0},on:{change:e.onRelatedDocsChange,dropdownVisibleChange:e.onRelatedDocsDropdown}},e._l(e.relatedDocOptions,(function(o){return t("a-select-option",{key:o.id,attrs:{value:o.id}},[e._v(" "+e._s(o.name)+" ")])})),1)],1)],1)],1):e._e(),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"编制人"}},[t("a-input",{attrs:{placeholder:"请输入编制人"},model:{value:e.model.creator,callback:function(t){e.$set(e.model,"creator",t)},expression:"model.creator"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"核对人"}},[t("a-input",{attrs:{placeholder:"请输入核对人"},model:{value:e.model.checker,callback:function(t){e.$set(e.model,"checker",t)},expression:"model.checker"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"备注","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-textarea",{attrs:{rows:2,placeholder:"请输入备注"},model:{value:e.model.remark,callback:function(t){e.$set(e.model,"remark",t)},expression:"model.remark"}})],1)],1)],1),e.showProgressHint?t("a-row",[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"执行提示","label-col":{span:3},"wrapper-col":{span:20}}},[t("a-alert",{attrs:{type:"info","show-icon":"",message:"技术类生产通知单发布后，将通过关联工单自动统计完成进度（已完成列车数/总列车数）"}})],1)],1)],1):e._e()],1)],1)],1)},l=[],r=o("8fad"),n={name:"ProductionNoticeModal",computed:{statusText:function(){var e={0:"草稿",1:"审核中",2:"已发布",3:"已关闭"};return e[this.model.status]||"草稿"},showProgressHint:function(){return"1"===this.model.noticeType},docSelectPlaceholder:function(){return"2"===this.model.noticeType?"请选择需通知查看/下载的关联工艺文件":"请选择需随工单下发的附件"}},data:function(){return{title:"",visible:!1,confirmLoading:!1,model:{},relatedFormIdList:[],relatedDocIdList:[],relatedFormOptions:[],relatedDocOptions:[],formOptionLoading:!1,docOptionLoading:!1,validatorRules:{noticeNo:[{required:!0,message:"请输入通知单号",trigger:"blur"}],title:[{required:!0,message:"请输入通知单标题",trigger:"blur"}],noticeType:[{required:!0,message:"请选择通知类型",trigger:"change"}]}}},methods:{add:function(){this.title="新增生产通知单",this.visible=!0,this.model={status:"0",totalTrains:0,completedTrains:0,progress:"0%"},this.relatedFormIdList=[],this.relatedDocIdList=[],this.relatedFormOptions=[],this.relatedDocOptions=[],this.loadRelatedFormOptions(),this.loadRelatedDocOptions()},edit:function(e){this.title="编辑生产通知单",this.visible=!0,this.model=Object.assign({},e),this.relatedFormIdList=this.parseIdCsv(e.relatedFormIds),this.relatedDocIdList=this.parseIdCsv(e.relatedDocIds),this.relatedFormOptions=[],this.relatedDocOptions=[],this.ensureSelectedFormOptions(),this.ensureSelectedDocOptions(),this.loadRelatedFormOptions(),this.loadRelatedDocOptions()},handleOk:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.model.relatedFormIds=e.joinIds(e.relatedFormIdList),e.model.relatedDocIds=e.joinIds(e.relatedDocIdList),e.confirmLoading=!0;var o=e.model.id?Object(r["Td"])(e.model):Object(r["sd"])(e.model);o.then((function(t){t.success?(e.$message.success(e.model.id?"修改成功":"新增成功"),e.visible=!1,e.$emit("ok")):e.$message.error(t.message||"操作失败")})).finally((function(){e.confirmLoading=!1}))}}))},handleCancel:function(){this.visible=!1,this.$refs.form.resetFields(),this.relatedFormIdList=[],this.relatedDocIdList=[]},onRelatedFormsChange:function(e){this.relatedFormIdList=e||[]},onRelatedDocsChange:function(e){this.relatedDocIdList=e||[]},onRelatedFormsDropdown:function(e){e&&this.loadRelatedFormOptions()},onRelatedDocsDropdown:function(e){e&&this.loadRelatedDocOptions()},loadRelatedFormOptions:function(){var e=this;this.formOptionLoading=!0,Object(r["Tc"])({pageNo:1,pageSize:200}).then((function(t){if(t&&t.success){var o=t.result&&t.result.records?t.result.records:[];e.relatedFormOptions=o.map((function(e){return{id:e.id,code:e.code,title:e.title||e.name||e.code||e.id}})),e.ensureSelectedFormOptions()}})).finally((function(){e.formOptionLoading=!1}))},loadRelatedDocOptions:function(){var e=this;this.docOptionLoading=!0,Object(r["Ab"])({pageNo:1,pageSize:200}).then((function(t){if(t&&t.success){var o=t.result&&t.result.records?t.result.records:[];e.relatedDocOptions=o.filter((function(e){return 1===Number(e.isFile)})).map((function(e){return{id:e.id,name:e.name||e.id,type:e.type,savepath:e.savepath,fileSize:e.fileSize}})),e.ensureSelectedDocOptions()}})).finally((function(){e.docOptionLoading=!1}))},ensureSelectedFormOptions:function(){var e=this,t={};(this.relatedFormOptions||[]).forEach((function(e){t[e.id]=!0})),(this.relatedFormIdList||[]).forEach((function(o){t[o]||e.relatedFormOptions.push({id:o,code:"",title:"已关联记录表(".concat(o,")")})}))},ensureSelectedDocOptions:function(){var e=this,t={};(this.relatedDocOptions||[]).forEach((function(e){t[e.id]=!0})),(this.relatedDocIdList||[]).forEach((function(o){t[o]||e.relatedDocOptions.push({id:o,name:"已关联附件(".concat(o,")")})}))},parseIdCsv:function(e){return e?String(e).split(",").map((function(e){return e.trim()})).filter(Boolean):[]},joinIds:function(e){return(e||[]).map((function(e){return String(e).trim()})).filter(Boolean).join(",")}}},i=n,s=o("2877"),d=Object(s["a"])(i,a,l,!1,null,null,null);t["default"]=d.exports}}]);