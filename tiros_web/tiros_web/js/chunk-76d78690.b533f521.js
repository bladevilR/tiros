(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76d78690"],{"2edf":function(t,e,n){t.exports=n.p+"img/station_gray.6be0cf86.png"},"3bcd":function(t,e,n){"use strict";n.d(e,"P",(function(){return i})),n.d(e,"N",(function(){return o})),n.d(e,"F",(function(){return c})),n.d(e,"J",(function(){return a})),n.d(e,"t",(function(){return u})),n.d(e,"i",(function(){return v})),n.d(e,"j",(function(){return g})),n.d(e,"h",(function(){return j})),n.d(e,"g",(function(){return k})),n.d(e,"l",(function(){return I})),n.d(e,"c",(function(){return y})),n.d(e,"e",(function(){return O})),n.d(e,"f",(function(){return w})),n.d(e,"d",(function(){return A})),n.d(e,"b",(function(){return S})),n.d(e,"x",(function(){return N})),n.d(e,"z",(function(){return M})),n.d(e,"w",(function(){return D})),n.d(e,"H",(function(){return T})),n.d(e,"I",(function(){return W})),n.d(e,"y",(function(){return z})),n.d(e,"A",(function(){return Z})),n.d(e,"B",(function(){return R})),n.d(e,"M",(function(){return L})),n.d(e,"r",(function(){return G})),n.d(e,"E",(function(){return E})),n.d(e,"k",(function(){return l})),n.d(e,"D",(function(){return f})),n.d(e,"u",(function(){return d})),n.d(e,"L",(function(){return s})),n.d(e,"a",(function(){return h})),n.d(e,"K",(function(){return x})),n.d(e,"m",(function(){return Y})),n.d(e,"p",(function(){return J})),n.d(e,"o",(function(){return U})),n.d(e,"G",(function(){return p})),n.d(e,"v",(function(){return m})),n.d(e,"C",(function(){return b})),n.d(e,"n",(function(){return B})),n.d(e,"q",(function(){return Q})),n.d(e,"s",(function(){return P})),n.d(e,"O",(function(){return _}));var r=n("0fea"),i=function(t){return Object(r["d"])("/produce/train/history/tree/line-train",t)},o=function(t){return Object(r["d"])("/produce/train/history/maximo-asset/list-child",t)},c=function(t){return Object(r["d"])("/produce/train/history/train/get",t)},a=function(t){return Object(r["d"])("/produce/train/history/train/period",t)},u=function(t){return Object(r["d"])("/produce/train/history/maximo-asset/get",t)},s=function(t){return Object(r["d"])("/produce/train/history/work/page",t)},d=function(t){return Object(r["d"])("/produce/train/history/measure/page",t)},l=function(t){return Object(r["d"])("/produce/train/history/fault/page",t)},f=function(t){return Object(r["d"])("/produce/train/history/forms/page",t)},h=function(t){return Object(r["d"])("/produce/train/history/change/page",t)},p=function(t){return Object(r["d"])("/produce/train/history/train/period",t)},m=function(t){return Object(r["d"])("/produce/train/history/workLeaveRecord/page",t)},b=function(t){return Object(r["d"])("/produce/train/history/workRectify/page",t)},v=function(t){return Object(r["d"])("/produce/fault/detail/count",t)},g=function(t){return Object(r["d"])("/produce/fault/detail/page",t)},I=function(t){return Object(r["d"])("/produce/fault/statistics",t)},j=function(t){return Object(r["j"])("/produce/fault/compare",t)},k=function(t){return Object(r["d"])("/produce/fault/time-effect/data",t)},y=function(t){return Object(r["d"])("/produce/cost/detail/count",t)},O=function(t){return Object(r["d"])("/produce/cost/detail/page",t)},w=function(t){return Object(r["j"])("/produce/cost/statistics",t)},A=function(t){return Object(r["d"])("/produce/cost/compare/count-6year",t)},S=function(t){return Object(r["j"])("/produce/cost/compare",t)},N=function(t){return Object(r["d"])("/produce/plan/list",t)},M=function(t){return Object(r["d"])("/produce/plan/task/listByPlanId/".concat(t))},D=function(t){return Object(r["d"])("/produce/plan/get/".concat(t))},T=function(t){return Object(r["d"])("/serialPlan/plan/get/".concat(t))},W=function(t){return Object(r["d"])("/produce/plan/task/get/".concat(t))},z=function(t){return Object(r["d"])("/produce/plan/regu/list/".concat(t))},Z=function(t){return Object(r["d"])("/produce/plan/train-struct/list/".concat(t))},R=function(t){return Object(r["d"])("/produce/plan/train-struct/orders/".concat(t))},L=function(t){return Object(r["d"])("/workshop/list",t)},G=function(t){return Object(r["d"])("/produce/workshop/fault/latest",t)},E=function(t){return Object(r["d"])("/produce/workshop/workstation/list",t)},x=function(t){return Object(r["d"])("/produce/workshop/train-track",t)},Y=function(t){return Object(r["d"])("/produce/kpi/group",t)},J=function(t){return Object(r["d"])("/produce/kpi/user",t)},U=function(t){return Object(r["d"])("/produce/kpi/plan/list",t)},B=function(t){return Object(r["d"])("/produce/kpi/plan/get",t)},Q=function(t){return Object(r["d"])("/serialPlan/plan/material/lack",t)},P=function(t){return Object(r["d"])("/board/plan-group-statistic/get-last-working-plan",t)},_=function(t){return Object(r["d"])("/board/plan-group-statistic/list",t)}},5786:function(t,e,n){t.exports=n.p+"img/magic.deee3b0e.svg"},5990:function(t,e,n){},a1e9:function(t,e,n){t.exports=n.p+"img/train.52b4938b.png"},b20e:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{ref:"rootWrapper",staticStyle:{height:"100%"}},[0!==t.leftPx?e("div",{style:{position:"absolute",top:1,left:t.leftPx,zIndex:999,cursor:"pointer"}},[e("a-dropdown",{attrs:{trigger:["click"]}},[e("img",{attrs:{src:n("5786")},on:{click:function(t){return t.preventDefault()}}}),e("a-menu",{staticStyle:{"min-width":"110px"},attrs:{slot:"overlay"},slot:"overlay"},t._l(t.workshops,(function(n){return e("a-menu-item",{key:n.id,on:{click:function(e){return t.selectShop(n)}}},[t._v(t._s(n.name)+" ")])})),1)],1)],1):t._e(),e("div",{staticStyle:{height:"35px",overflow:"auto"}},t._l(t.faults,(function(n){return e("div",{key:n.id},[t._v(t._s(n.faultAssetName))])})),0),e("div",{ref:"wrapDiv",staticStyle:{width:"100%",height:"calc(100% - 37px)",position:"relative"}},[e("canvas",{ref:"myCanvas",attrs:{id:"myCanvas"}}),e("div",{ref:"hoverPop",staticClass:"hoverPop"},[t.hoverItem&&"station"===t.hoverItem.type?e("div",[t._v(" 工位编号："+t._s(t.hoverItem.code)),e("br"),t._v(" 工位名称："+t._s(t.hoverItem.name)),e("br"),t._v(" 作业班组："+t._s(t.hoverItem.groupName)),e("br"),t._v(" 作业内容："+t._s(t.hoverItem.content)),e("br"),t._v(" 开始时间："+t._s(t.hoverItem.startTime)),e("br"),t._v(" 作业状态："+t._s(t.hoverItem.workStatus)),e("br"),t._v(" 工班班长："+t._s(t.hoverItem.monitor)),e("br")]):t._e()])])])},i=[],o=n("7a94"),c=n("3bcd");o["fabric"].NamedImage=o["fabric"].util.createClass(o["fabric"].Image,{type:"named-image",initialize:function(t,e){this.callSuper("initialize",t,e),e&&this.set("name",e.name)&&this.set("id",e.id)&&this.set("code",e.code)&&this.set("iType",e.iType)},toObject:function(){return o["fabric"].util.object.extend(this.callSuper("toObject"),{id:this.id,code:this.code,name:this.name,iType:this.iType})}}),o["fabric"].NamedImage.fromObject=function(t,e){o["fabric"].util.loadImage(t.src,(function(n){e&&e(new o["fabric"].NamedImage(n,t))}))};var a=["",n("b755"),n("ffc6"),n("2edf")],u={1:"正常作业中",2:"发现故障",3:"无作业"},s=[n("a1e9"),n("b875")],d={name:"monitor",data:function(){return{canvas:null,dragItem:null,hoverItem:null,contextObj:null,imgSize:{w:30,h:30},workshops:[],workShop:null,faults:[],stationMap:{},leftPx:0,intervalId:null}},mounted:function(){var t=this;setTimeout((function(){t.reSizeCanvas(),t.loadWorkShops()}),300)},activated:function(){var t=this;this.intervalId=setInterval((function(){t.loadStationInfo(),t.loadTrackTrainInfo()}),5e3)},methods:{loadWorkShops:function(){var t=this;Object(c["M"])({}).then((function(e){e.success?(t.leftPx=t.$refs.rootWrapper.offsetLeft,t.workshops=e.result,t.workshops.length>0&&(t.workShop=t.workshops[0],t.loadWorkshop(),t.loadTrackTrainInfo(),t.loadFaults())):t.$message.error("加载车间数据失败")})).catch((function(e){t.$message.error("加载车间数据异常")}))},loadFaults:function(){var t=this;if(this.workShop){var e={workshopId:this.workShop.id,num:3};Object(c["r"])(e).then((function(e){e.success?t.faults=e.result:t.$message.error("加载最新故障数据失败")})).catch((function(e){t.$message.error("加载最新故障数据异常")}))}},loadWorkshop:function(){var t=this;if(this.clearCanvas(),this.workShop)if(this.workShop.graphAddress)try{this.canvas.loadFromJSON(this.workShop.graphAddress,(function(){t.canvas.forEachObject((function(e){if(e.set("selectable",!1),"named-image"===e.get("type")&&t.setStationImg(e,a[3]),"group"===e.get("type"))for(var n=0;n<e._objects.length;n++){var r=e._objects[n];"named-image"===r.get("type")&&("station"===r.iType?t.setStationImg(r,a[3]):r.iType)}}));var e=t.canvas.backgroundImage.width*t.canvas.backgroundImage.scaleX,n=t.canvas.backgroundImage.height*t.canvas.backgroundImage.scaleY,r=t.$refs.wrapDiv.clientWidth,i=n/e,o=Math.min(r/e,r*i/n);t.canvas.setZoom(o)}))}catch(e){this.$message.error("加载车间平面图JSON异常, 该车间或许没有设置平面图")}else this.$message.error("加载车间平面图JSON异常, 该车间或许没有设置平面图")},loadStationInfo:function(){var t=this;if(this.workShop){var e={workStatus:null,workshopId:this.workShop.id,workstationNo:""};Object(c["E"])(e).then((function(e){if(e.success){var n=e.result;t.stationMap={},n.forEach((function(e){t.stationMap["ST_"+e.id]=e})),t.canvas.forEachObject((function(e){"named-image"!==e.get("type")&&"group"!==e.get("type")||t.updateStation(e)}))}else t.$message.error("查询工位状态信息失败")})).catch((function(e){t.$message.error("查询工位状态信息异常")}))}},loadTrackTrainInfo:function(){var t=this;Object(c["K"])({}).then((function(e){if(e.success){var n=e.result;n||(n=[]),t.canvas.forEachObject((function(e){if("group"===e.get("type"))for(var r=function(){var r=e._objects[i];if("named-image"===r.get("type")&&"track"===r.iType){var o=r.code,c=n.filter((function(t){return t.trackCode===o}));c&&c.length>0?t.setTrackImg(r,s[0],c[0].trainNo):t.setTrackImg(r,s[1],"无")}},i=0;i<e._objects.length;i++)r()}))}}))},updateStation:function(t){if("group"===t.get("type"))for(var e=0;e<t._objects.length;e++)this.updateStation(t._objects[e]);if("named-image"===t.get("type")&&t.id){var n=this.stationMap["ST_"+t.id];n&&n.workStatus&&a[n.workStatus]&&this.setStationImg(t,a[n.workStatus])}},setStationImg:function(t,e){var n=this;o["fabric"].util.loadImage(e,(function(e){if(e){t.scaleX=1,t.scaleY=1;var r=n.imgSize.w/e.naturalWidth,i=n.imgSize.w/e.naturalHeight;t.setElement&&(t.setElement(e,{scaleX:r,scaleY:i}),n.canvas.renderAll())}}))},setTrackImg:function(t,e,n){var r=this;if(t.group._objects){var i=t.group._objects;if(2==i.length){var c=new o["fabric"].Text(n,{top:9,right:0,fontSize:15,fontWeight:"bold",fill:"red"});c.set("selectable",!1),t.group.add(c)}else 3===i.length&&(i[2].text=n)}o["fabric"].util.loadImage(e,(function(e){if(e){t.scaleX=1,t.scaleY=1,e.width=800,e.height=30;var n=800/e.naturalWidth,i=30/e.naturalHeight;t.setElement&&(t.setElement(e,{scaleX:n,scaleY:i}),r.canvas.renderAll())}}))},reSizeCanvas:function(){var t=this,e=this.$refs.wrapDiv.clientWidth,n=this.$refs.wrapDiv.clientHeight;this.$refs.myCanvas.width=e,this.$refs.myCanvas.height=n,this.canvas=new o["fabric"].Canvas("myCanvas"),this.canvas.on("mouse:over",this.mouseHover),this.canvas.on("mouse:out",this.mouseOut),this.canvas.on("mouse:down",this.onMouseDown),this.canvas.on("mouse:wheel",(function(e){if(e.e.shiftKey){var n=(e.e.deltaY>0?.001:-.001)+t.canvas.getZoom();n=Math.max(.1,n),n=Math.min(3,n),t.canvas.setZoom(n)}})),this.loadWorkshop()},mouseHover:function(t){var e=this.$refs.hoverPop,n=e.style.display;if(e&&"none"===n)if(t.target){var r=t.e.offsetY+10,i=t.e.offsetX+10,o=this.$refs.wrapDiv.clientHeight,c=o-r;if(c<200&&(r-=c+10),t.target._objects&&t.target._objects.length>0){var a=t.target._objects[0];if(a.iType&&"station"===a.iType){this.hoverItem={id:a.id,code:a.code,name:a.name,type:a.iType};var s=this.stationMap["ST_"+a.id];if(s){var d=Object.assign({groupName:"",content:"",startTime:"",workStatus:"",monitor:""},s);d.workStatus&&(d.workStatus=u[d.workStatus+""]),this.hoverItem=Object.assign(d,this.hoverItem)}else this.hoverItem.workStatus=u["3"];e.style.left=i+"px",e.style.top=r+"px",e.style.display="block"}}}else this.hoverItem=null,e.style.display="none"},onMouseDown:function(t){var e=this.$refs.hoverPop;e&&(e.style.display="none"),this.hoverItem=null},mouseOut:function(t){var e=this.$refs.hoverPop,n=e.style.display;e&&"block"===n&&t.target&&(e.style.display="none")},selectShop:function(t){this.workShop=t,this.loadWorkshop(),this.loadFaults()},clearCanvas:function(){var t=this;this.canvas.forEachObject((function(e){t.canvas.remove(e)}))}},beforeRouteLeave:function(t,e,n){clearInterval(this.intervalId),n()}},l=d,f=(n("c81c"),n("2877")),h=Object(f["a"])(l,r,i,!1,null,"ae2f6b08",null);e["default"]=h.exports},b755:function(t,e,n){t.exports=n.p+"img/station_green.6e658b48.png"},b875:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAeCAIAAAGWNOo9AAAACXBIWXMAAC4jAAAuIwF4pT92AAAGymlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTExLTMwVDE1OjIyOjI2KzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTAzLTE3VDEwOjUyOjQ0KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMS0wMy0xN1QxMDo1Mjo0NCswODowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4MTYwOTU0YS0xZDMzLWQxNDktOWJkNS1jZTI3NTU1N2Y4NmYiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDowZThiMmUxMi1mNDU0LWNmNDktOGQwMC0zZmViNDQ5NjMxYWEiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo3Y2QyYzc3Ni0yODA4LTcyNDMtYWYzNi00OGU5NjgwMzIzMWEiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjdjZDJjNzc2LTI4MDgtNzI0My1hZjM2LTQ4ZTk2ODAzMjMxYSIgc3RFdnQ6d2hlbj0iMjAyMC0xMS0zMFQxNToyMjoyNiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNWMxODI1Zi0wODgwLTAxNDUtOTU1OS1kOTgzNGViZmI3NTIiIHN0RXZ0OndoZW49IjIwMjAtMTEtMzBUMTU6MjI6MjYrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODE2MDk1NGEtMWQzMy1kMTQ5LTliZDUtY2UyNzU1NTdmODZmIiBzdEV2dDp3aGVuPSIyMDIxLTAzLTE3VDEwOjUyOjQ0KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+JB6HuQAAAGBJREFUWIXtlMEJACEMBI39l5aiLCA+srCKyMwzhHHE4yIzR2HWkTiN6t0s9kYbl1Byfq/V15L9vdR9R9uBuJ538U3gwoXrpsv5zzHivKIRshTIUiBLgSwFshTIUng0awFsKxEoQtxChQAAAABJRU5ErkJggg=="},c81c:function(t,e,n){"use strict";n("5990")}}]);