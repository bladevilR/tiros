(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29aa84e8","chunk-4fded5ff","chunk-9fd19682","chunk-0f12fa96","chunk-0c51ea96","chunk-e557ef9e","chunk-362cc4ab","chunk-01a27526","chunk-ad0db6b8","chunk-acc24a18","chunk-e557ef9e","chunk-4ac1c6e2","chunk-44854239","chunk-4a823ccf","chunk-0fec5636","chunk-2cfa5258","chunk-3d128b8f","chunk-0950fc2f","chunk-ce23dd1e","chunk-c7b1b1f0","chunk-7a713f58","chunk-1beda669","chunk-2bc23118","chunk-7dbbe398","chunk-42391c95","chunk-72e72170","chunk-535429be","chunk-c47b85c2","chunk-2cc43f66","chunk-0693ce46","chunk-ccd9324a","chunk-7b75ea18","chunk-cf5f982e","chunk-15662996","chunk-65151992","chunk-2d0b8e53","chunk-2d0ba8aa","chunk-2d22d5d2"],{"009c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:"90%",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0,centered:"",bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"表单:"}},[t("a-input",{attrs:{placeholder:"表单名称或编码",allowClear:""},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"表单类型:"}},[t("a-select",{attrs:{allowClear:""},model:{value:e.queryParam.formTypeList,callback:function(t){e.$set(e.queryParam,"formTypeList",t)},expression:"queryParam.formTypeList"}},[t("a-select-option",{attrs:{value:3}},[e._v(" 作业记录表")]),t("a-select-option",{attrs:{value:1}},[e._v(" 数据记录表")]),t("a-select-option",{attrs:{value:4}},[e._v(" 检查记录表")])],1)],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"选择工位"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"请选择工位",open:!1},on:{dropdownVisibleChange:function(t){return e.openStationSelectModal()},change:e.onStationChange},model:{value:e.stationName,callback:function(t){e.stationName=t},expression:"stationName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:9,sm:8}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")]),t("a-button",{on:{click:e.openFormModal}},[e._v("从模板添加")]),t("a-button",{attrs:{disabled:!e.btnStatus.edit},on:{click:function(t){return e.openFormEditModal(e.btnStatus.editRow)}}},[e._v("修改")]),t("a-button",{attrs:{loading:e.deleteLoading,disabled:e.records.length<=0},on:{click:e.deleteForm}},[e._v("删除")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 90px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 90px)"},attrs:{border:"","max-height":"100%",align:"center",data:e.tableData,"radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"show-overflow":"tooltip"},on:{"checkbox-change":e.rowSelectChange,"checkbox-all":e.rowSelectChange}},[t("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"60"}}),e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"planName",title:"列计划",align:"left","header-align":"center",width:"180"}}),t("vxe-table-column",{attrs:{field:"title",title:"表单名称","min-width":"220",align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[1!==e.operator?t("span",[e._v(e._s(r.title))]):t("a",{on:{click:function(t){return t.stopPropagation(),e.jumpInfo(r)}}},[e._v(e._s(r.title))])]}}])}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"code",title:"表单编码",width:"120"}}),t("vxe-table-column",{attrs:{field:"formType_dictText",title:"表单类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(3!==a.formType?a.formType_dictText:1===a.workRecordType?"作业记录表(老)":"作业记录表(新)")+" ")]}}])}),t("vxe-table-column",{attrs:{field:"reguName",title:"所属规程",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.reguName)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.reguName,callback:function(t){e.$set(r,"reguName",t)},expression:"row.reguName"}})]}}])}),t("vxe-table-column",{attrs:{field:"reguVersion",title:"规程版本",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.reguVersion)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.reguVersion,callback:function(t){e.$set(r,"reguVersion",t)},expression:"row.reguVersion"}})]}}])}),t("vxe-table-column",{attrs:{field:"trainStructName",title:"关联设备","min-width":"150",align:"left","header-align":"center"}})],1)],1),t("JobCheckTableView",{ref:"jobCheckTableView"}),t("RecordTableView",{ref:"recordTableView"}),t("FormViewModal",{ref:"formViewModal"}),t("ViewWorkForm",{ref:"viewWorkForm",attrs:{operator:e.operator}}),t("TaskFormModel",{ref:"taskFormModel",attrs:{repairId:e.repairId,operator:e.operator,checkList:e.tableData,trainNo:e.trainNo,"plan-id":e.planId,"line-id":e.lineId},on:{ok:e.onAddForm}}),t("work-station-list",{ref:"stationSelectModal",on:{ok:e.onSelectStation}}),t("task-form-edit-model",{ref:"taskFormEditModel",attrs:{"line-id":e.lineId,"train-no":e.trainNo},on:{ok:e.findList}})],1)},o=[],i=a("37582"),n=a("e42a"),l=a("8fad"),s=a("3dbe"),c=a("aaa8"),u=a("7e9e"),d=a("88da"),f=a("60c8"),h=a("1158"),m=a("54f6"),p=a("0c04");function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?g(Object(a),!0).forEach((function(t){y(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function y(e,t,a){return(t=k(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function k(e){var t=w(e,"string");return"symbol"==b(t)?t:t+""}function w(e,t){if("object"!=b(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var T={name:"TaskFormSelectModel",components:{FormsList:i["default"],CarDeviceSelect:n["default"],TaskFormModel:f["default"],WorkStationList:h["default"],TaskFormEditModel:p["default"],ViewWorkForm:d["default"],JobCheckTableView:c["default"],RecordTableView:u["default"],FormViewModal:s["default"]},props:{trainNo:{type:String,default:""},lineId:{type:String,default:""},workOrderTaskId:{type:String,default:""},workOrderId:{type:String,default:""},repairId:{type:[Number,String],default:null},operator:{type:[String,Number],default:""},checkList:{type:Array,default:function(){return[]}},multiple:{type:Boolean,default:!0}},data:function(){return{records:[],deleteLoading:!1,title:"列计划已有表单实例",confirmLoading:!1,visible:!1,tableData:[],stationName:"",queryParam:{formTypeList:"",planId:"",searchText:"",workstationId:null},totalResult:0,planId:"",btnStatus:new m["a"](this,"listTable")}},methods:{jumpInfo:function(e){var t=v(v({},e),{},{planFormId:e.planFormId,instType:e.formType,formObjId:e.formObjId,formInstId:e.id,workRecordType:e.workRecordType,formName:e.title,workOrderId:this.workOrderId,workOrderTaskId:this.workOrderTaskId});delete t.id,this.$refs.viewWorkForm.showModal(t,this.trainNo)},deleteForm:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords(),a=t.map((function(e){return{formType:e.formType,formInstId:e.id,planId:e.planId}}));this.deleteLoading=!0,Object(l["R"])(a).then((function(t){t.success?(e.$message.success("删除成功"),e.findList()):e.$message.warning(t.message),e.deleteLoading=!1})).catch((function(t){e.deleteLoading=!1}))},rowSelectChange:function(e){var t=e.records;this.records=t,this.btnStatus.update()},findList:function(){var e=this;Object(l["sb"])(this.queryParam).then((function(t){t.success?(e.tableData=t.result||[],e.records=[]):e.$message.warn(t.message)}))},showModal:function(e){this.queryParam.planId=e,this.tableData=[],this.findList(),this.visible=!0},openFormEditModal:function(e){this.$refs.taskFormEditModel.edit(e)},handleOk:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();if(t.length){var a=t.filter((function(t){var a=e.checkList.find((function(e){return e.formInstId===t.id}));return a&&e.$message.warn("".concat(t.title,"已经添加了")),a}));if(a.length>0)return;t.length>0&&(this.$emit("ok",t),this.visible=!1)}else this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},openFormModal:function(){this.$refs.taskFormModel.showModal(this.queryParam.planId)},onAddForm:function(e){this.findList()},openStationSelectModal:function(){this.$refs.stationSelectModal.showModal()},onSelectStation:function(e){e.length&&(this.queryParam.workstationId=e[0].id,this.stationName=e[0].name)},onStationChange:function(e){e||(this.queryParam.workstationId=null)}}},x=T,C=(a("8cf3"),a("2877")),S=Object(C["a"])(x,r,o,!1,null,"787457a7",null);t["default"]=S.exports},"05d5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"表单查看-"+e.trainNo+"车 "+e.formName,centered:"",visible:e.visible,width:"100%",footer:null,dialogClass:"fullDialog no-title no-footer",destroyOnClose:!0},on:{cancel:function(t){e.visible=!1}}},[t("div",{staticClass:"table-page-body",staticStyle:{height:"calc(100% - 50px)"}},[t("div",{attrs:{id:"luckysheet"}})])])},o=[],i=a("8fad"),n=a("b9c3"),l=a("7268"),s={name:"FormTemplate",data:function(){return{formName:"",trainNo:"",groupName:"",visible:!1,fileUrl:"",tableData:[],defaultOptions:{container:"luckysheet",title:"sheet",column:26,row:50,lang:"zh",allowEdit:!1,showinfobar:!1,sheetFormulaBar:!1,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!1}}},beforeDestroy:function(){luckysheet.destroy()},methods:{initSheet:function(e){var t=JSON.parse(JSON.stringify(this.defaultOptions));t.data=[e],luckysheet.destroy(),luckysheet.create(t)},showModal:function(e){this.formName=e.formObjName,this.groupName=e.groupName,this.loadOnlineFormDetail(e.id,e.formInstId),this.visible=!0},showModal2:function(e,t,a,r){this.formName=e,this.groupName=t,this.loadOnlineFormDetail("task2InstId",a),this.visible=!0},loadOnlineFormDetail:function(e,t){var a=this,r={task2InstId:e,formInstId:t,needValues:!1};Object(n["Q"])(r).then((function(e){if(e.success){var t=e.result;if(a.trainNo=t.trainNo,t&&t.result)try{var r=JSON.parse(t.result);Object(i["rb"])(t.formObjId).then((function(e){if(e.success){var o=JSON.parse(e.result);r&&(o.data=[],o.celldata=luckysheet.transToCellData(r)),a.initSheet(o),setTimeout((function(){l["a"].setRangeConditionalOncell(t.formObjId,t.id)}),200)}else a.$message.error("获取表单模板数据失败")}))}catch(o){return void a.$message.error("转换表单填写结果异常")}else a.$message.error("获取作业表单数据失败")}else a.$message.error("获取记录表内容错误")})).catch((function(e){a.$message.error("获取记录表内容异常")}))}}},c=s,u=(a("5577"),a("2877")),d=Object(u["a"])(c,r,o,!1,null,"7efb72d8",null);t["default"]=d.exports},"0743":function(e,t,a){},"0ac6":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-tabs",{attrs:{"default-active-key":"1"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("a-tab-pane",{key:"1",staticClass:"descriptionBox",attrs:{tab:"基本信息"}},[t("a-descriptions",{attrs:{bordered:""}},[t("a-descriptions-item",{attrs:{label:"工单编号"}},[e._v(e._s(e.model.orderCode))]),t("a-descriptions-item",{attrs:{label:"工单名称"}},[e._v(e._s(e.model.orderName))]),t("a-descriptions-item",{attrs:{label:"工单类型"}},[e._v(e._s(e.model.orderType_dictText))]),e.showPanel?t("a-descriptions-item",{attrs:{label:"列计划"}},[e._v(e._s(e.model.planName))]):e._e(),e.showPanel?t("a-descriptions-item",{attrs:{label:"所属线路"}},[e._v(e._s(e.model.lineName))]):e._e(),e.showPanel?t("a-descriptions-item",{attrs:{label:"作业车号"}},[e._v(e._s(e.model.trainNo))]):e._e(),e.showPanel?t("a-descriptions-item",{attrs:{label:"作业班组"}},[e._v(e._s(e.model.groupName))]):e._e(),t("a-descriptions-item",{attrs:{label:"开始日期"}},[e._v(e._s(e.model.startTime))]),t("a-descriptions-item",{attrs:{label:"结束日期"}},[e._v(e._s(e.model.finishTime))]),t("a-descriptions-item",{attrs:{label:"工单状态"}},[e._v(e._s(e.model.orderStatus_dictText))]),e.showPanel?t("a-descriptions-item",{attrs:{label:"作业进度"}},[e._v(e._s(e.model.workStatus_dictText))]):e._e(),t("a-descriptions-item",{attrs:{label:"财务项目"}},[e._v(e._s(e.model.fdProjectCode)+" - "+e._s(e.model.fdProjectName))]),t("a-descriptions-item",{attrs:{label:"财务任务"}},[e._v(e._s(e.model.fdTaskCode)+" - "+e._s(e.model.fdTaskName))]),t("a-descriptions-item",{attrs:{label:"备注"}},[e._v(e._s(e.model.remark))])],1)],1),e.showPanel?t("a-tab-pane",{key:"2",attrs:{tab:"作业任务"}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("div",{staticClass:"tableHeight"},[t("vxe-table",{ref:"TaskListTable",attrs:{border:"",align:"center",data:e.tableDataTask,"show-overflow":"ellipsis","checkbox-config":{highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row"}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",title:"任务编号",width:"80"}}),t("vxe-table-column",{attrs:{field:"taskType_dictText",title:"任务类型",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"任务名称","header-align":"center",align:"left","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[[1,2,3].includes(r.taskType)&&r.taskObjId||[6,7,8].includes(r.taskType)?t("a",{on:{click:function(t){return t.stopPropagation(),e.viewTask(r)}}},[e._v(e._s(r.taskName))]):t("span",[e._v(e._s(r.taskName))])]}}],null,!1,906375684)}),t("vxe-table-column",{attrs:{field:"taskStatus_dictText",title:"任务状态",align:"center",width:"100"}}),t("vxe-table-column",{attrs:{field:"workTime",title:"预计工时",align:"center",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskContent",title:"任务要求","header-align":"center",align:"left","min-width":"180"}}),t("vxe-table-column",{attrs:{field:"important_dictText",title:"重要任务?",width:"100"}}),t("vxe-table-column",{attrs:{field:"method_dictText",title:"作业手段",width:"100"}}),t("vxe-table-column",{attrs:{field:"trainAssetName",title:"作业设备","min-width":"180","header-align":"center",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getAssestName(a))+" ")]}}],null,!1,1030380770)}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left"}})],1),t("task-book-steps-modal",{ref:"bookStepsModal"})],1)])],1):e._e(),e.showPanel?t("a-tab-pane",{key:"12",attrs:{tab:"目标设备"}},[t("TargetDeviceListOrder",{attrs:{tasks:e.tableDataTask,"read-only":!0}})],1):e._e(),e.showPanel?t("a-tab-pane",{key:"6",attrs:{tab:"作业表单"}},[t("TaskForms",{attrs:{"task-forms":e.tableDataForms,tasks:e.tableDataTask,trainNo:e.model.trainNo,"read-only":!0,operator:e.operator},on:{"update:taskForms":function(t){e.tableDataForms=t},"update:task-forms":function(t){e.tableDataForms=t}}})],1):e._e(),t("a-tab-pane",{key:"4",attrs:{tab:"作业物资"}},[t("TaskMaterials",{attrs:{"order-type":e.model.orderType,operator:-1,"task-materials":e.tableDataMaterial,tasks:e.tableDataTask,"read-only":!0},on:{"update:taskMaterials":function(t){e.tableDataMaterial=t},"update:task-materials":function(t){e.tableDataMaterial=t}}})],1),e.showPanel?t("a-tab-pane",{key:"5",attrs:{tab:"工器具"}},[t("TaskTools",{attrs:{"task-tools":e.tableDataTools,tasks:e.tableDataTask,"read-only":!0},on:{"update:taskTools":function(t){e.tableDataTools=t},"update:task-tools":function(t){e.tableDataTools=t}}})],1):e._e(),e.showPanel?t("a-tab-pane",{key:"9",attrs:{tab:"作业工时"}},[t("TaskWorkTime",{attrs:{staffArranges:e.tableStaffArranges,"work-order-id":e.orderId,tasks:e.tableDataTask,"read-only":!0},on:{"update:staffArranges":function(t){e.tableStaffArranges=t},"update:staff-arranges":function(t){e.tableStaffArranges=t}}})],1):e._e(),e.showPanel?t("a-tab-pane",{key:"3",attrs:{tab:"作业工位"}},[t("TaskStations",{attrs:{stations:e.tableDataStation,tasks:e.tableDataTask,"read-only":!0},on:{"update:stations":function(t){e.tableDataStation=t}}})],1):e._e(),e.showPanel?t("a-tab-pane",{key:"10",attrs:{tab:"作业指导书"}},[t("TaskWorkSteps",{attrs:{readOnly:!0,bookSteps:e.bookSteps,tasks:e.tableDataTask},on:{"update:bookSteps":function(t){e.bookSteps=t},"update:book-steps":function(t){e.bookSteps=t}}})],1):e._e(),e.showPanel?t("a-tab-pane",{key:"8",attrs:{tab:"附件"}},[t("TaskAttached",{attrs:{files:e.tableAttachedFiles,"read-only":!0},on:{"update:files":function(t){e.tableAttachedFiles=t}}})],1):e._e(),t("view-plan-task-item",{ref:"viewPlanTaskModal"}),t("breakdown-detail-modal",{ref:"breakdownDetail"}),t("view-rectify-task-item",{ref:"ViewRectifyTaskItem"}),t("outin-detail",{ref:"outInDetail"}),t("supervise-item-detail-modal",{ref:"superviseDetail"})],1)},o=[],i=a("1be3"),n=a("3281"),l=a("0da1"),s=a("36e5"),c=a("842a"),u=a("92da"),d=a("56ea"),f=a("2fc4"),h=a("6971"),m=a("b47d"),p=a("3c06"),b=a("b9c3"),g=a("3143"),v=a("4734"),y=a("b8d8"),k=a("1aa7"),w=a("c0a8"),T=a("88c7"),x=a("8973"),C={name:"ViewWorkOrderComponent",components:{TaskTools:i["default"],TaskMaterials:l["default"],OrderReturn:s["default"],TaskForms:c["default"],TaskStations:u["default"],TaskTechFiles:f["default"],TaskWorkSteps:d["default"],TaskAttached:h["default"],TaskWorkTime:p["default"],TaskBookStepsModal:g["default"],ViewPlanTaskItem:v["default"],ViewRectifyTaskItem:y["default"],BreakdownDetailModal:n["default"],OutinDetail:k["default"],SuperviseItemDetailModal:w["default"],TargetDeviceListOrder:T["default"]},data:function(){return{bookSteps:[],operator:0,confirmLoading:!1,activeTab:"1",orderId:"",model:{},tableDataTask:[],taskMaps:{},tableDataStation:[],tableDataMaterial:[],tableDataTools:[],tableDataForms:[],tableDataFiles:[],tableAttachedFiles:[],tableStaffArranges:[],labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}},labelCol1:{xs:{span:24},sm:{span:3}},wrapperCol1:{xs:{span:24},sm:{span:21}}}},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1},attributes:{type:Object,default:function(){return{}}}},computed:{showPanel:function(){return this.model.id&&!(4===this.model.orderType||5===this.model.orderType)},getAssestName:function(){return function(e){if(!e.equipments)return"";var t=e.equipments.map((function(e){return e.trainAssetName})).join("，");return t}}},mounted:function(){this.businessKey&&this.show(this.businessKey),this.attributes&&(this.attributes.isVerify&&1===this.attributes.isVerify&&(this.operator=1),this.attributes.isMaterial&&1===this.attributes.isMaterial&&(this.operator=2),this.attributes.isConfirm&&1===this.attributes.isConfirm&&(this.operator=3),this.attributes.isSubmit&&1===this.attributes.isSubmit&&(this.operator=4),this.attributes.isCheck&&1===this.attributes.isCheck&&(this.operator=6),this.attributes.isClose&&1===this.attributes.isClose&&(this.operator=5)),2!==this.operator&&3!==this.operator||(this.activeTab="4"),6===this.operator&&(this.activeTab="6")},methods:{show:function(e){this.orderId=e,this.loadWorkOrderDetail(e)},close:function(){this.$emit("close"),this.visible=!1},handleWorkForm:function(e){var t=this;this.confirmLoading=!0,Object(b["I"])(e.id).then((function(e){e.success?t.$refs.bookStepsModal.show(e.result):t.$message.error("请求数据失败!")})).finally((function(){return t.confirmLoading=!1}))},loadWorkOrderDetail:function(e){var t=this;Object(m["yb"])(e).then((function(e){if(e.success){t.tableStaffArranges.length=0;var a=e.result;t.model=Object.assign({},a),t.tableDataTask=a.tasks,t.tableDataStation=a.workstations,t.tableDataMaterial=a.materials,x["a"].joinDistributionInfo(t.tableDataMaterial),t.tableDataTools=a.tools,t.tableDataForms=a.forms,t.tableDataFiles=a.techFiles,t.tableAttachedFiles=a.annexList,a.workstations.forEach((function(e){e.staffArrangeList.forEach((function(e){t.tableStaffArranges.push(e)}))})),t.bookSteps=a.bookSteps,t.tableDataTask.forEach((function(e){t.taskMaps["T"+e.id]=e.taskName})),t.handleTaskName(t.tableDataStation),t.handleTaskName(t.tableDataTools),t.handleTaskName(t.tableDataMaterial),t.handleTaskName(t.tableDataFiles)}else t.$message.warning(e.message);t.$emit("loaded")}))},handleTaskName:function(e){var t=this;e.forEach((function(e){e.taskName=t.taskMaps["T"+e.orderTaskId]}))},viewTask:function(e){switch(e.taskType){case 1:this.$refs.viewPlanTaskModal.view(e),this.$refs.viewPlanTaskModal.title="计划任务查看-".concat(e.taskName);break;case 2:this.$refs.breakdownDetail.show(e.taskObjId);break;case 3:this.$refs.ViewRectifyTaskItem.view(e),this.$refs.ViewRectifyTaskItem.title="故障任务查看-".concat(e.taskName);break;case 6:this.showOutInView(e);break;case 7:this.showOutInView(e);break;case 8:this.$refs.superviseDetail.showByTask(e);break;default:break}},showOutInView:function(e){(6===e.taskType||7===e.taskType)&&(this.$refs.outInDetail.title="委外送修任务查看-".concat(e.taskName)),this.$refs.outInDetail.showByTaskId(e.id)}}},S=C,I=(a("198d"),a("2877")),_=Object(I["a"])(S,r,o,!1,null,"9389bf78",null);t["default"]=_.exports},"0c04":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0,centered:""},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"标题"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["title",e.validatorRules.title],expression:"[ 'title', validatorRules.title]",modifiers:{trim:!0}}]})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆设备"}},[t("div",{on:{click:e.openAssetSelectModal}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["trainStructName",e.validatorRules.trainStructName],expression:"['trainStructName', validatorRules.trainStructName]",modifiers:{trim:!0}}],ref:"trainAssetSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择作业目标设备",open:!1}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1)],1)],1),t("CarDeviceSelectNew",{ref:"trainAssetSelectModal",attrs:{trainNo:e.trainNo,lineId:e.lineId,multiple:!1,canSelectType:[2,3,4]},on:{ok:e.onTrainAssetSelect,cancel:e.onCancelTrainAssetSelect}})],1)],1)},o=[],i=a("310d"),n=a("b47d"),l={name:"TaskFormEditModel",components:{CarDeviceSelectNew:i["default"]},props:["lineId","trainNo"],data:function(){return{title:"编辑",visible:!1,trainStructId:"",model:{},confirmLoading:!1,form:this.$form.createForm(this),labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}},validatorRules:{title:{rules:[{required:!0,message:"请输入标题!"},{max:64,message:"输入长度不能超过64字符!"}]},trainStructName:{rules:[{required:!0,message:"请选择车辆设备!"}]}}}},methods:{edit:function(e){var t=this;this.form.resetFields(),this.model=Object.assign({},e),this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue({title:t.model.title,trainStructName:t.model.structDetailName}),t.trainStructId=t.model.trainStructId}))},handleOk:function(){var e=this;e.form.validateFields((function(t,a){if(!t){e.confirmLoading=!0;var r=Object.assign(e.model,a,{trainStructId:e.trainStructId,formType:e.model.formType});Object(n["Qb"])(r).then((function(t){t.success?(e.$message.success(t.message),e.$emit("ok"),e.close()):e.$message.warning(t.message)})).finally((function(){e.confirmLoading=!1}))}}))},openAssetSelectModal:function(){this.$refs.trainAssetSelectModal.showModal()},onTrainAssetSelect:function(e){var t=this;if(e.length){var a=e[0];this.trainStructId=a.id,this.$nextTick((function(){t.form.setFieldsValue({trainStructName:a.assetName})}))}},onCancelTrainAssetSelect:function(){},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},s=l,c=a("2877"),u=Object(c["a"])(s,r,o,!1,null,"5f227585",null);t["default"]=u.exports},"0d5f":function(e,t,a){"use strict";a("796c")},"0da1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"test-class",style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[2!==e.operator&&3!==e.operator?t("div",{attrs:{"na-flex-height-full":""}},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:8}},[t("a-form-item",{attrs:{label:"物料:"}},[t("a-input",{attrs:{placeholder:"物资编码或名称",allowClear:""},on:{change:e.sortTable},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),t("a-form-item",{attrs:{label:"物料分类:"}},[t("j-dict-select-tag",{staticStyle:{width:"160px"},attrs:{dictCode:"bu_material_type",triggerChange:"",hiddenArray:[1]},on:{change:e.sortTable},model:{value:e.searchCategory,callback:function(t){e.searchCategory=t},expression:"searchCategory"}})],1),t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")]),e._e()],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[4!==e.operator?t("vxe-table",{ref:"listTable",staticClass:"mytable-style",attrs:{border:"",align:"center","max-height":"auto","row-class-name":e.rowClassName,data:e.taskMaterials,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"filter-config":{showIcon:!1}},on:{"update:data":function(t){e.taskMaterials=t},blur:function(t){e.$refs.listTable&&e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",fixed:"left",width:"40"}}),e.tasks&&e.tasks.length>1&&4!==e.orderType&&5!==e.orderType?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange,blur:function(t){e.$refs.listTable&&e.$refs.listTable.clearValidate()}},model:{value:r.orderTaskId,callback:function(t){e.$set(r,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,4191658598)}):e._e(),t("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"},filters:[{data:""}],"filter-method":e.customStringFilterMethod,width:"130"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{focus:function(t){return e.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,2681050691)}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center",width:"200"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}],null,!1,1805491503)}),t("vxe-table-column",{attrs:{field:"spec",title:"规格",align:"left","header-align":"center"}}),4!==e.orderType&&5!==e.orderType?t("vxe-table-column",{attrs:{field:"systemName",title:"所属系统",width:"150","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:e.systemDictCode,allowClear:!1},on:{blur:function(t){return e.$refs.listTable.clearValidate()},select:e.onSystemChange},model:{value:r.systemId,callback:function(t){e.$set(r,"systemId",t)},expression:"row.systemId"}})]}}],null,!1,694104271)}):e._e(),4!==e.orderType&&5!==e.orderType?t("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工位",open:!1},on:{dropdownVisibleChange:function(t){return e.openStationSelectModal()}},model:{value:r.workstationName,callback:function(t){e.$set(r,"workstationName",t)},expression:"row.workstationName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,1073727607)}):e._e(),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"},width:"100"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type",hiddenArray:[-1],allowClear:!1},on:{blur:function(t){return e.$refs.listTable.clearValidate()},select:e.onCategoryChange},model:{value:r.useCategory,callback:function(t){e.$set(r,"useCategory",t)},expression:"row.useCategory"}})]}}],null,!1,2054472936)}),e._e(),e._e(),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"},width:"120",align:"right","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}],null,!1,4050415892)}),4===e.orderType&&-1===e.operator?t("vxe-table-column",{attrs:{field:"issueAmount",title:"发放数量",width:"120",align:"right","header-align":"center"}}):e._e(),4===e.orderType||5===e.orderType||-1!==e.operator&&5!==e.operator&&6!==e.operator?e._e():t("vxe-table-column",{attrs:{field:"actAmount",title:"实际消耗",width:"120",align:"right","header-align":"center"}}),1===e.operator&&e.showStock?t("vxe-table-column",{attrs:{field:"stock",title:"当前库存",width:"120",align:"right","header-align":"center"}}):e._e(),t("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"80"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}],null,!1,1773474126)}),4===e.orderType||5===e.orderType||-1!==e.operator&&5!==e.operator&&6!==e.operator?e._e():t("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",width:"120",align:"right","header-align":"center"}}),0===e.operator||1===e.operator||4!==e.orderType&&5!==e.orderType&&1!==e.orderType?e._e():t("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380"}}),1===e.operator&&4!==e.orderType&&5!==e.orderType?t("vxe-table-column",{attrs:{field:"canReplace",title:"可替换物资",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("a-tooltip",{attrs:{placement:"top"}},[t("template",{slot:"title"},[t("span",[e._v(e._s(r.canReplaceSpec))])]),t("span",[e._v(e._s(r.canReplace))])],2)]}}],null,!1,3190429626)}):e._e(),e.getButtonShow()?t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1):t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:e.taskMaterials,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"filter-config":{showIcon:!1}},on:{"update:data":function(t){e.taskMaterials=t},blur:function(t){e.$refs.listTable&&e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",fixed:"left",width:"40"}}),e.tasks&&e.tasks.length>1&&4!==e.orderType?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left"}}):e._e(),t("vxe-table-column",{attrs:{field:"code",title:"物料编码",filters:[{data:""}],"filter-method":e.customStringFilterMethod,width:"130"}}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称",align:"left","header-align":"center",width:"200"}}),4!==e.orderType?t("vxe-table-column",{attrs:{field:"opType_dictText",title:"领用类型",width:"100"}}):e._e(),4!==e.orderType?t("vxe-table-column",{attrs:{field:"systemName",title:"所属系统",width:"150"}}):e._e(),4!==e.orderType?t("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150"}}):e._e(),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"120",align:"right","header-align":"center"}}),0!==e.operator&&1!==e.operator?t("vxe-table-column",{attrs:{width:"120",field:"actAmount",title:"实际消耗","edit-render":{name:"$input",props:{type:"number",min:0}},align:"right","header-align":"center"}}):e._e(),t("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"80"}}),0!==e.operator&&1!==e.operator?t("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",width:"120"}}):e._e(),t("vxe-table-column",{attrs:{field:"spec",title:"规格",align:"left","header-align":"center"}}),0===e.operator||1===e.operator||4!==e.orderType&&1!==e.orderType?e._e():t("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380"}}),e.getButtonShow()||4===e.operator?t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1)],1)],1):e._e(),2===e.operator?t("div",[e.workOrderId?t("apply-ready-component",{ref:"applyReady",attrs:{"business-key":e.workOrderId,fromFlow:!0,"order-type":e.orderType},on:{ok:e.saveOk,fail:e.saveFail,cancel:e.onCancel,loaded:e.onLoaded}}):e._e()],1):e._e(),3===e.operator?t("div",[e.workOrderId?t("apply-confirm-component",{ref:"applyConfirm",attrs:{"business-key":e.workOrderId,fromFlow:!0,"order-type":e.orderType},on:{ok:e.saveOk,fail:e.saveFail,cancel:e.onCancel,loaded:e.onLoaded}}):e._e()],1):e._e(),t("material-list",{ref:"modalForm",attrs:{repairProgramId:e.repairProgramId,lineId:e.lineId,multiple:!1,mode:e.selectMode,"group-id":e.groupId,"type-code-list":e.mTypeCode,"show-type-code":e.filterType},on:{ok:e.onSelectMaterial}}),t("material-list",{ref:"modalFormMultiple",attrs:{repairProgramId:e.repairProgramId,lineId:e.lineId,multiple:!0,mode:e.selectMode,"group-id":e.groupId,"type-code-list":e.mTypeCode,"show-type-code":e.filterType},on:{ok:e.onSelectMaterialMultiple}}),t("task-select-modal",{ref:"taskSelectModal",on:{ok:e.onSelectTask}}),t("work-station-list",{ref:"stationSelectModal",attrs:{"group-id":e.groupId},on:{ok:e.onSelectStation}})],1)},o=[],i=a("7164"),n=a("383b"),l=a("ff09"),s=a("f6d0"),c=a("ca00"),u=a("b47d"),d=a("8fad"),f=a("1158");function h(e){return g(e)||b(e)||p(e)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(e,t){if(e){if("string"==typeof e)return v(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?v(e,t):void 0}}function b(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function g(e){if(Array.isArray(e))return v(e)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var y={name:"TaskMaterials",components:{TaskSelectModal:n["default"],MaterialList:i["default"],ApplyReadyComponent:l["default"],ApplyConfirmComponent:s["default"],WorkStationList:f["default"]},props:{taskMaterials:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0},workOrderId:{type:String,default:null},orderType:{type:Number,default:null},lineId:{type:[Number,String],default:null},planId:{type:[Number,String],default:null},repairId:{type:[Number,String],default:null},groupId:{type:[Number,String],default:null}},watch:{orderType:{handler:function(){0!==this.operator&&1!==this.operator||(4===this.orderType||5===this.orderType?(this.selectMode=[1,2],this.mTypeCode=[2,3,-1],this.filterType=!0):(this.selectMode=[1,2],1===this.operator&&(this.selectMode=[3].concat(h(this.selectMode))),this.mTypeCode=[2,3,-1],this.filterType=!0))},immediate:!0},repairId:{immediate:!0,handler:function(e){this.repairProgramId=e}},planId:{immediate:!0,handler:function(e){var t=this;this.selectMode.indexOf(2)>-1&&e&&!this.repairId&&Object(u["rb"])(e).then((function(e){e.success&&e.result&&(t.repairProgramId=e.result.repairProgramId)}))}}},data:function(){return{systemDictCode:"",repairProgramId:"",showStock:!1,curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择物料",trigger:"manual"}],opType:[{required:!1}],opType_dictText:[{required:!1}],useCategory_dictText:[{required:!0,message:"类别必须选择",trigger:"manual"}],needDispatchin_dictText:[{required:!0,message:"是否发料必须选择",trigger:"manual"}],amount:[{required:!0,message:"数量必须填写",trigger:"manual"}],systemName:[{required:!0,message:"所属系统必须选择",trigger:"manual"}],workstationName:[{required:!0,message:"所属工位必须选择",trigger:"manual"}]},tableHeight:{top:"height:100%",bottom:"height: calc(100vh - 160px)",size:"auto"},searchText:"",searchCategory:null,selectMode:[1,2,3],mTypeCode:[-1],filterType:!1,trainTypeId:""}},mounted:function(){var e=this;2!==this.operator&&3!==this.operator&&(this.$nextTick((function(){e.sortTable()})),this.$emit("loaded")),this.lineId&&Object(d["vb"])({lineId:this.lineId}).then((function(t){t.success?(e.trainTypeId=t.result.trainTypeId,e.systemDictCode="bu_train_asset_type,name,id,train_type_id='"+e.trainTypeId+"' AND struct_type=1"):e.systemDictCode=""}))},methods:{onLoaded:function(e){this.$emit("loaded")},onCategoryChange:function(e,t){var a=this.$refs.listTable.getActiveRecord();a.row.useCategory_dictText=t?t.title:void 0,this.$forceUpdate()},onSystemChange:function(e,t){var a=this.$refs.listTable.getActiveRecord();a.row.systemId=e,a.row.systemName=t?t.title:void 0,this.$forceUpdate()},onDispatchChange:function(e,t){var a=this.$refs.listTable.getActiveRecord();a.row.needDispatchin_dictText=t?t.title:void 0,this.$forceUpdate()},save:function(e){2!==this.operator?3===this.operator?this.$refs.applyConfirm&&this.$refs.applyConfirm.save?this.$refs.applyConfirm.save(e):this.$emit("fail",new Error("数据尚未加载完成，请稍后操作！")):this.$emit("fail",new Error("无效的操作类型，请联系关联员！")):this.$refs.applyReady&&this.$refs.applyReady.save?this.$refs.applyReady.save(e):this.$emit("fail",new Error("数据尚未加载完成，请稍后操作！"))},saveOk:function(){this.$emit("ok")},saveFail:function(e){this.$emit("fail",e)},onCancel:function(){this.$emit("cancel")},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||2===this.operator)},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.find((function(e){return 1===e.isGenOrder}))?this.$message.warn("已生成单据的临时新增类型数据不能删除"):t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.taskMaterials.map((function(a,r){t.id===a.id&&e.taskMaterials.splice(r,1)}))}))}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(e){this.curEditMode=2,this.curRow=e,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskMaterials.map((function(a,r){e.id===a.id&&t.taskMaterials.splice(r,1)}))},openStationSelectModal:function(){this.$refs.stationSelectModal.showModal()},onSelectStation:function(e){var t=this.$refs.listTable.getActiveRecord();e.length&&t&&(t.row.workstationId=e[0].id,t.row.workstationName=e[0].name),this.$forceUpdate()},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else{if(e.actAmount>e.amount)return void t.$message.error("实际消耗不能大于所需数量");1===t.curEditMode&&t.taskMaterials.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openMaterialSelectModal:function(e){this.curRow=e,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur(),this.$refs.listTable.clearValidate()},onSelectMaterial:function(e){var t=this;if(e&&e.length>0){var a=e[0];e.forEach((function(r,o){if(t.taskMaterials.find((function(e){return e.materialTypeId===r.id})))t.$message.warn("你选择的".concat(r.name,"已经在列表中存在"));else if(o>0){var i={id:Object(c["p"])(),orderTaskId:t.curRow.orderTaskId,taskName:t.curRow.taskName,opType:2,opType_dictText:"临时新增",needDispatchin:4===t.orderType||5===t.orderType?1:0,needDispatchin_dictText:4===t.orderType||5===t.orderType?"是":"否",code:r.code,materialTypeId:r.id,name:r.name,kind:r.kind,unit:r.unit,kind_dictText:r.kind_dictText,useCategory:r.category1?r.category1:null,useCategory_dictText:r.category1?r.category1_dictText:"",amount:r.num,actAmount:0};t.taskMaterials.push(i)}else t.curRow.code=a.code,t.curRow.name=a.name,t.curRow.materialTypeId=a.id,t.curRow.kind=a.kind,t.curRow.unit=a.unit,t.curRow.kind_dictText=a.kind_dictText,t.curRow.useCategory=a.category1?a.category1:null,t.curRow.useCategory_dictText=a.category1?a.category1_dictText:"",t.curRow.amount=a.num,t.curRow.actAmount=0,e.length>1&&(t.$refs.listTable.clearActived(),1===t.curEditMode&&t.taskMaterials.push(t.curRow),t.curEditMode=0)}))}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory="",this.curRow.useCategory_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.actAmount=0,this.curRow.needDispatchin=1,this.needDispatchin_dictText="是"},onSelectMaterialMultiple:function(e){var t=this;if(e&&e.length>0){var a=this.taskMaterials;e.forEach((function(e,r){var o={id:Object(c["p"])(),opType:1,opType_dictText:"额定物资",needDispatchin:4===t.orderType||5===t.orderType?1:0,needDispatchin_dictText:4===t.orderType||5===t.orderType?"是":"否",code:e.code,materialTypeId:e.id,name:e.name,kind:e.kind,unit:e.unit,kind_dictText:e.kind_dictText,useCategory:e.category1?e.category1:null,useCategory_dictText:e.category1?e.category1_dictText:"",amount:e.num,actAmount:0,isGenOrder:0,spec:e.spec};if(a.find((function(t){return t.materialTypeId===e.id}))){if(4===t.orderType||5===t.orderType)return void t.$message.warn("你选择的".concat(e.name,"已经在列表中存在"));t.$confirm({title:"确认添加",content:"你选择的".concat(e.name,"已经在列表中存在，是否重复添加？"),onOk:function(){t.insertNewMaterial(o)}})}else t.insertNewMaterial(o)}))}},insertNewMaterial:function(e){this.selectTask?Object.assign(e,{orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}):this.tasks.length&&Object.assign(e,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName}),this.$refs.listTable.insertAt(e,-1),this.taskMaterials.push(e)},openTaskSelectModal:function(e){this.curRow=e,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(e){if(e&&e.length>0){var t=e[0];this.curRow.orderTaskId=t.id,this.curRow.taskName=t.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[t.key].taskName},clearValidate:function(){var e=this;this.$nextTick((function(){e.$refs.listTable&&e.$refs.listTable.clearValidate()}))},checkMaterialShow:function(e){e.row;return""},sortTable:function(){if(this.$refs.listTable){var e=this.$refs.listTable.getColumnByField("code"),t=e.filters[0];t.checked=!0,this.$refs.listTable.updateData()}},customStringFilterMethod:function(e){var t=e.row,a=new RegExp(this.searchText),r=new RegExp(this.searchText);return 0!==this.operator&&1!==this.operator?(a.test(t.code)||r.test(t.name))&&(t.useCategory==this.searchCategory||!this.searchCategory)&&(1===t.opType||2===t.opType&&1===t.isGenOrder):(a.test(t.code)||r.test(t.name))&&(t.useCategory==this.searchCategory||!this.searchCategory)&&(1===t.opType||2===t.opType)},refreshTable:function(){this.showStock=!0,this.$refs.listTable.updateData()},rowClassName:function(e){var t=e.row;e.rowIndex;if(t.noenough&&1===t.noenough)return"row-red"}}},k=y,w=(a("74e8"),a("2877")),T=Object(w["a"])(k,r,o,!1,null,null,null);t["default"]=T.exports},"0e7b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障代码选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"请输入编码和描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 82px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",height:"auto",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkMethod}:{},"tree-config":{lazy:!1,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"fltCode",align:"left","header-align":"center",title:"故障代码",width:"260","tree-node":""}}),t("vxe-table-column",{attrs:{field:"fltLevel_dictText",title:"类型",width:"150"}}),t("vxe-table-column",{attrs:{field:"fltName",title:"代码描述",align:"left","header-align":"center"}})],1)],1)])},o=[],i=a("b47d"),n=a("ca00"),l=a("a396");function s(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=c(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return n=e.done,e},e:function(e){l=!0,i=e},f:function(){try{n||null==a.return||a.return()}finally{if(l)throw i}}}}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var d={name:"FaultCodeList",components:{FaultCategoryList:l["default"]},props:{multiple:{type:Boolean,default:!0},type:{type:String,default:""}},data:function(){return{categoryCode:"",queryParam:{searchText:""},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(e){this.visible=!0,this.queryParam.categoryId=e,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["bb"])(this.queryParam).then((function(t){t.success?(e.tableData=e.listToTreeList(t.result),e.$nextTick((function(){e.tableData.length&&e.$refs.listTable.setTreeExpand(e.tableData.find((function(e){return e.children})),!0)}))):e.$message.error(t.message)}))},loadChildrenMethod:function(e){var t=e.row;return Object(i["cb"])({code:t.fltCode}).then((function(e){return e.success?((e.result||[]).forEach((function(e){e.children=[]})),e.result||[]):[]}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.categoryCode="",this.queryParam.searchText="",this.queryParam.categoryId=""},openSelectTypeModal:function(){this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur()},addCategoryTarget:function(e){Object(n["e"])(e)?this.queryParam.categoryId="":(this.queryParam.categoryId=e[0].id,this.categoryCode=e[0].categoryCode)},checkMethod:function(e){var t=e.row;return"unit"!=this.type||3==t.fltLevel},listToTreeList:function(e){if(!e||!e.length)return[];var t,a={},r=s(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;a[o.fltCode]=o}}catch(n){r.e(n)}finally{r.f()}for(var i=0;i<e.length;i++)e[i].parentCode&&a[e[i].parentCode]&&(a[e[i].parentCode].children||(a[e[i].parentCode].children=[]),a[e[i].parentCode].children.push(e[i]),e.splice(i,1),i--);return e.sort((function(e,t){return e.fltCode-t.fltCode})),e}}},f=d,h=(a("191b"),a("2877")),m=Object(h["a"])(f,r,o,!1,null,"e6e31b9e",null);t["default"]=m.exports},"10f9":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("TablePrint",{ref:"tablePrint"}),t("LuckySheetPrint",{ref:"luckySheetPrint",attrs:{luckySheetId:e.luckySheetId},on:{sheetPrintOk:function(t){return e.$emit("sheetPrintOk")}}}),t("JobCheckTableExport",{ref:"jobCheckPrint"})],1)},o=[],i=a("90f1"),n=a("e89a"),l=a("3cf2"),s=a("b7b4"),c=a("b9c3"),u=a("8fad"),d={name:"WorkRecordPrint",components:{TablePrint:i["default"],JobCheckTableExport:l["default"],LuckySheetPrint:n["default"]},props:{luckySheetId:{type:String,default:"lsPrint"}},data:function(){return{}},created:function(){},methods:{print:function(e){switch(e.instType){case 1:this.loadOnlineFormDetail(e.id,e.formInstId);break;case 3:1===e.workRecordType?this.loadRecordTableDetail(e.id,e.formInstId):2===e.workRecordType&&this.loadWorkRecordForm(e,!0);break;case 4:this.loadWorkFormDetail(e.task2InstId,e.formInstId)}},loadWorkRecordForm:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(u["rb"])(e.formObjId).then((function(r){if(r.success){var o=JSON.parse(r.result);if(!a)return void t.$refs.luckySheetPrint.printBySheet(o);Object(c["U"])(e.formInstId).then((function(e){if(e.success&&e.result){var a=JSON.parse(e.result);o.data=[],o.celldata=luckysheet.transToCellData(a)}t.$refs.luckySheetPrint.printBySheet(o)}))}else t.$message.error("获取作业记录表模板数据失败")}))},loadRecordTableDetail:function(e,t){var a=this;Object(c["R"])({task2InstId:e,formInstId:t,needChecks:!0,needCategory:!0,allItems:!0}).then((function(e){e.success&&e.result?(a.$nextTick((function(){e.result.categoryList&&e.result.categoryList.sort((function(e,t){return e.recIndex-t.recIndex})),a.$refs.tablePrint.printByData(e.result)})),a.visible=!0):a.$message.error("加载记录数据异常")}))},loadWorkFormDetail:function(e,t){var a=this;Object(s["x"])({task2InstId:e,formInstId:t}).then((function(e){e.success&&e.result?a.$refs.jobCheckPrint.printByRow(e.result):a.$message.error("加载记录数据异常")}))},loadOnlineFormDetail:function(e,t){var a=this;Object(c["Q"])({task2InstId:e,formInstId:t,needValues:!1}).then((function(e){try{if(e.success&&e.result){var t=e.result,r=JSON.parse(t.result);a.$nextTick((function(){Object(u["rb"])(t.formObjId).then((function(e){if(e.success){var t=JSON.parse(e.result);r&&(t.celldata=luckysheet.transToCellData(r)),a.$refs.luckySheetPrint.printBySheet(t)}}))}))}else a.$message.error("加载记录数据异常")}catch(o){a.$message.error("加载记录数据异常")}}))},printNoData:function(e){try{switch(e.instType){case 1:this.loadOnlineDetailNoData(e.formInstId);break;case 3:1===e.workRecordType?this.loadRecordDetailNoData(e.formInstId):2===e.workRecordType&&this.loadWorkRecordForm(e,!1);break;case 4:this.loadCheckDetailNoData(e.formInstId)}}catch(t){}},loadRecordDetailNoData:function(e){var t=this;Object(u["xb"])({id:e}).then((function(e){e.success&&e.result?(t.$nextTick((function(){e.result.categoryList&&e.result.categoryList.sort((function(e,t){return e.recIndex-t.recIndex})),t.$refs.tablePrint.printByData(e.result)})),t.visible=!0):t.$message.error("加载记录数据异常")}))},loadCheckDetailNoData:function(e){var t=this;Object(s["y"])({id:e}).then((function(e){try{e.success&&e.result?(t.$refs.jobCheckPrint.printByRow(e.result),t.visible=!0):t.$message.error("加载记录数据异常")}catch(a){t.$message.error("加载记录数据异常")}}))},loadOnlineDetailNoData:function(e){var t=this;this.visible=!0,Object(u["rb"])(e).then((function(e){if(e.success){var a=JSON.parse(e.result);t.$refs.luckySheetPrint.printBySheet(a)}}))}}},f=d,h=a("2877"),m=Object(h["a"])(f,r,o,!1,null,null,null);t["default"]=m.exports},"13f1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{ref:"locationModalRef",class:{"na-footer-none":2===e.modeType},attrs:{title:"库位选择",width:"80%",bodyStyle:{height:"70vh"},visible:e.visible,centered:!0,confirmLoading:e.confirmLoading,closable:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"库位选择"}},[t("a-checkbox-group",{attrs:{name:"checkboxgroup",options:e.options},on:{change:e.findList},model:{value:e.warehouseLevelList,callback:function(t){e.warehouseLevelList=t},expression:"warehouseLevelList"}})],1)],1),t("a-col",{attrs:{md:12}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 66px)"},attrs:{id:"location_table_main"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto","show-overflow":"tooltip",data:e.tableData,"tree-config":{key:"warehouseId",children:"children",expandAll:!0},"radio-config":{highlight:!0,trigger:"row"},"row-class-name":e.setRowClass},on:{"update:data":function(t){e.tableData=t},"cell-click":e.onCurrentChange}},[1===e.modeType?t("vxe-table-column",{attrs:{type:"radio",width:"40px"}}):e._e(),t("vxe-table-column",{attrs:{field:"sourceLocationName",width:"200",title:"所属组织","header-align":"center",align:"left","tree-node":""}}),t("vxe-table-column",{attrs:{width:"80",field:"warehouseLevel",title:"库位级别",formatter:e.formatLevel}}),t("vxe-table-column",{attrs:{width:"120",field:"materialTypeCode",title:"物资编码"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"130","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"tradeNo",width:"200",title:"所属批次"}}),t("vxe-table-column",{attrs:{width:"80",field:"amount",title:"当前库存"}}),t("vxe-table-column",{attrs:{width:"80",field:"usableAmount",title:"可用库存"}}),t("vxe-table-column",{attrs:{width:"160",field:"usedDetailInfo",title:"占用详情","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{width:"80",field:"price",title:"价格"}}),t("vxe-table-column",{attrs:{width:"80",field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialType_dictText",title:"物料分类"}}),t("vxe-table-column",{attrs:{width:"100",field:"materialAttr_dictText",title:"物料属性"}}),t("vxe-table-column",{attrs:{field:"spec",title:"物料描述","min-width":"100","header-align":"center",align:"left"}})],1)],1):e._e()])},o=[],i=a("c54ca");function n(e){return u(e)||c(e)||s(e)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return d(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,t):void 0}}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function u(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var f={name:"LocationList",props:{multiple:{type:Boolean,default:!1},modeType:{type:Number,default:1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,tableData:[],selectMaterialTypeId:"",warehouseLevelList:[],options:[{label:"三级库",value:3},{label:"四级库",value:4}]}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0}))},created:function(){},methods:{showModal:function(e,t,a){this.visible=!0,this.selectMaterialTypeId=e,this.findList(t,a)},findList:function(e,t){var a=this;Object(i["yb"])({warehouseLevelList:this.warehouseLevelList,materialTypeId:this.selectMaterialTypeId,applyDetailId:e,assignDetailId:t}).then((function(e){e.success&&(a.tableData=[],a.tableData=a.buildTree(e.result),a.$nextTick((function(){a.$refs.listTable.setAllTreeExpand(!0)})))}))},buildTree:function(e){var t=e.reduce((function(e,t,a){return e[t.warehouseId]=a,e}),{}),a=[];return e.forEach((function(r){if(null===r.parentId)a.push(r);else{var o=e[t[r.parentId]];o?o.children=[].concat(n(o.children||[]),[r]):a.push(r)}})),a},formatLevel:function(e){var t=e.cellValue,a=parseInt(t);return a-1},handleOk:function(){var e=this.$refs.listTable.getRadioRecord();e.children?this.$message.warn("该库位还有下级库位，请选择下级库位！"):(this.$emit("ok",e?[e]:[]),this.visible=!1)},saveOk:function(){this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},close:function(){this.visible=!1,Object.assign(this.$data,this.$options.data())},openPalletModal:function(){this.$refs.palletSelect.blur()},openlocationModal:function(){this.$refs.materialToolsModal.showModal(),this.$refs.locationSelect.blur()},onCurrentChange:function(e){var t=e.row,a=e.$event;2===this.modeType&&(t.children&&t.children.length&&!/vxe-tree--node-btn/.test(a.target.className)?this.$refs.listTable.setTreeExpand([t],!this.$refs.listTable.isTreeExpandByRow(t)):(this.$emit("ok",[t]),this.visible=!1))},setRowClass:function(e){e.row;return 2===this.modeType?"mode-type-choose":""}}},h=f,m=(a("1892"),a("2877")),p=Object(m["a"])(h,r,o,!1,null,null,null);t["default"]=p.exports},"14d0":function(e,t,a){"use strict";a("de37")},1892:function(e,t,a){"use strict";a("9424")},"190e":function(e,t,a){"use strict";a("c984")},"191b":function(e,t,a){"use strict";a("d4ad")},"198d":function(e,t,a){"use strict";a("246f")},"1a6f":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{style:e.containerHeightStyle},[t("div",{staticClass:"info-wrapper info-top-wrapper",staticStyle:{"margin-top":"10px"}},[t("h4",[e._v("故障信息")]),t("a-descriptions",{attrs:{size:"default",bordered:"",column:6}},[t("a-descriptions-item",{attrs:{label:"故障编号",span:2}},[e._v(" "+e._s(e.detail.faultSn)+" ")]),t("a-descriptions-item",{attrs:{label:"发现时间",span:2}},[e._v(" "+e._s(e.detail.happenTime)+" ")]),t("a-descriptions-item",{attrs:{label:"线路",span:2}},[e._v(" "+e._s(e.detail.lineName)+" ")]),t("a-descriptions-item",{attrs:{label:"车辆",span:2}},[e._v(" "+e._s(e.detail.trainNo)+" ")]),t("a-descriptions-item",{attrs:{label:"系统",span:2}},[e._v(" "+e._s(e.detail.sysName)+" ")]),t("a-descriptions-item",{attrs:{label:"子系统",span:2}},[e._v(" "+e._s(e.detail.subSysName)+" ")]),t("a-descriptions-item",{attrs:{label:"部件",span:2}},[e._v(" "+e._s(e.detail.faultAssetName)+" ")]),t("a-descriptions-item",{attrs:{label:"发现阶段",span:2}},[e._v(" "+e._s(e.detail.phase_dictText)+" ")]),t("a-descriptions-item",{attrs:{label:"故障等级",span:2}},[e._v(" "+e._s(e.detail.faultLevel_dictText)+" ")]),t("a-descriptions-item",{attrs:{label:"是否正线",span:2}},[e._v(" "+e._s(e.detail.faultOnline_dictText)+" ")]),t("a-descriptions-item",{attrs:{label:"是否委外",span:2}},[e._v(" "+e._s(e.detail.outsource_dictText)+" ")]),1==e.detail.outsource?t("a-descriptions-item",{attrs:{label:"所属厂商",span:6}},[e._v(" "+e._s(e.detail.outSupplierName)+" ")]):e._e(),t("a-descriptions-item",{attrs:{label:"列计划",span:6}},[e._v(" "+e._s(e.detail.planName)+" ")]),t("a-descriptions-item",{attrs:{label:"故障描述",span:6}},[e._v(" "+e._s(e.detail.faultDesc)+" ")]),t("a-descriptions-item",{attrs:{label:"故障代码",span:6}},[e._v(" "+e._s(e.detail.faultCodeCode)+" "),t("span",{staticStyle:{color:"#c1c1c1","margin-left":"20px"}},[e._v(" （ "),t("a-space",[e._l(e.getFaultdetailList,(function(a,r){return t("span",{key:r},[e._v("故障"+e._s(a.fltLevel_dictText)+"："+e._s(a.fltCode)+"-"+e._s(a.fltName)+"；")])})),t("span",[e._v("故障部件："+e._s(e.detail.faultCodeCode)+"-"+e._s(e.detail.faultCodeCodeDes))])],2),e._v(" ） ")],1)]),t("a-descriptions-item",{attrs:{label:"故障状态",span:6}},[e._v(" "+e._s(e.detail.status_dictText)+" ")])],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("提报信息")]),t("a-descriptions",{attrs:{bordered:"",column:6}},[t("a-descriptions-item",{attrs:{label:"提报班组",span:2}},[e._v(" "+e._s(e.detail.reportGroupName)+" ")]),t("a-descriptions-item",{attrs:{label:"提报人员",span:2}},[e._v(" "+e._s(e.detail.reportUserName)+" ")]),t("a-descriptions-item",{attrs:{label:"提报时间",span:2}},[e._v(" "+e._s(e.detail.reportTime)+" ")]),t("a-descriptions-item",{attrs:{label:"责任工程师",span:2}},[e._v(" "+e._s(e.detail.dutyEngineerName)+" ")])],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("处理信息")]),t("a-descriptions",{attrs:{bordered:"",column:6}},[t("a-descriptions-item",{attrs:{label:"处理班组",span:2}},[e._v(" "+e._s(e.handleModel.solutionGroupName)+" ")]),t("a-descriptions-item",{attrs:{label:"处理人员",span:2}},[e._v(" "+e._s(e.handleModel.solutionUserName)+" ")]),t("a-descriptions-item",{attrs:{label:"处理时间",span:2}},[e._v(" "+e._s(e.handleModel.solutionTime)+" ")]),t("a-descriptions-item",{attrs:{label:"处理结果",span:6}},[e._v(" "+e._s(e.detail.handleStatus_dictText)+" ")]),t("a-descriptions-item",{attrs:{label:"关闭时间",span:2}},[e._v(" "+e._s(e.detail.closeTime)+" ")]),t("a-descriptions-item",{attrs:{label:"关闭人员",span:4}},[e._v(" "+e._s(e.detail.closeUserName)+" ")]),t("a-descriptions-item",{attrs:{label:"原因描述",span:4}},[e._v(" "+e._s(e.handleModel.reasonDesc)+" ")]),t("a-descriptions-item",{attrs:{label:"措施描述",span:4}},[e._v(" "+e._s(e.handleModel.solutionDesc)+" ")])],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("附件")]),0===e.annexList.length?t("div",[e._v("暂无数据")]):t("div",e._l(e.annexList,(function(a,r){return t("ul",{key:r},[t("li",[t("a-icon",{attrs:{type:"file"}}),t("a",{on:{click:function(t){return e.handleSeeing(a)}}},[e._v(" "+e._s(a.name))])],1)])})),0)]),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}})],1)])},o=[],i=a("b47d"),n=a("ca00"),l=a("353a"),s={data:function(){return{fileName:"",annexList:[],detail:{},handleModel:{},getFaultdetailList:[],containerHeightStyle:{height:this.height,overflowY:"auto"}}},components:{DocPreviewModal:l["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1},height:{type:String,default:"100%"}},mounted:function(){this.businessKey&&this.show(this.businessKey)},methods:{getFaultdetail:function(e){var t=this;this.getFaultdetailLoading=!0,Object(i["db"])({code:e}).then((function(e){e.success&&e.result.length&&(t.getFaultdetailList=e.result.filter((function(e){return 0!=e.fltLevel&&3!=e.fltLevel}))),t.getFaultdetailLoading=!1,t.$emit("loaded")})).catch((function(e){t.getFaultdetailLoading=!1}))},show:function(e){var t=this;Object(n["e"])(e)||Object(i["P"])({id:e}).then((function(e){var a=e.result;t.detail=a,a.faultCodeId&&t.getFaultdetail(a.faultCodeId),t.annexList=a.annexList,Object(n["e"])(a.handleRecordList)||(t.handleModel=a.handleRecordList[0]),t.$emit("loaded")}))},handleSeeing:function(e){this.fileName=e.name,this.$refs.docPreview.handleFilePath(e.savepath)}}},c=s,u=(a("3206"),a("2877")),d=Object(u["a"])(c,r,o,!1,null,"21f53256",null);t["default"]=d.exports},"1aa7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"交接单详情",width:"85%",visible:e.visible,confirmLoading:e.confirmLoading,dialogClass:"fullDialog no-footer",destroyOnClose:!0,footer:null},on:{cancel:e.handleCancel}},[t("div",{staticClass:"content"},[t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("交接信息")]),t("a-descriptions",{attrs:{bordered:""}},[t("a-descriptions-item",{attrs:{label:"交接单号"}},[e._v(" "+e._s(e.outInDetail.billNo)+" ")]),t("a-descriptions-item",{attrs:{label:"线路"}},[e._v(" "+e._s(e.outInDetail.lineName)+" ")]),t("a-descriptions-item",{attrs:{label:"车号"}},[e._v(" "+e._s(e.outInDetail.trainNo)+" ")]),t("a-descriptions-item",{attrs:{label:"交接单名"}},[e._v(" "+e._s(e.outInDetail.outinName)+" ")]),t("a-descriptions-item",{attrs:{label:"交接日期"}},[e._v(" "+e._s(e.outInDetail.transferDate)+" ")]),t("a-descriptions-item",{attrs:{label:"作业班组"}},[e._v(" "+e._s(e.outInDetail.sendGroupName)+" ")]),t("a-descriptions-item",{attrs:{label:"移交人"}},[e._v(" "+e._s(e.outInDetail.transferUserName)+" ")]),t("a-descriptions-item",{attrs:{label:"接收人"}},[e._v(" "+e._s(e.outInDetail.receiveUserName)+" ")]),t("a-descriptions-item",{attrs:{label:"工程师"}},[e._v(" "+e._s(e.outInDetail.engineerName)+" ")]),t("a-descriptions-item",{attrs:{label:0==e.outInDetail.billType?"接收厂商":"移交厂商"}},[e._v(" "+e._s(e.outInDetail.supplierName)+" ")])],1)],1)]),t("div",{staticClass:"content"},[t("div",{staticClass:"info-wrapper info-top-wrapper",staticStyle:{"margin-bottom":"0"}},[t("h4",[e._v("交接部件")]),t("div",{staticStyle:{height:"calc(100vh - 385px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",height:"auto",align:e.allAlign,data:e.outInAsset,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40",align:"center"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"线路",width:"100"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",width:"100"}}),t("vxe-table-column",{attrs:{field:"assetName","header-align":"center",align:"left",title:"委外部件","min-width":"120"}}),t("vxe-table-column",{attrs:{field:"assetNo",title:"部件编号","min-width":"120"}}),t("vxe-table-column",{attrs:{field:"facadeStatus_dictText",title:"外观状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"mixtoolStatus_dictText",title:"工装状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"fault_dictText",title:"是否存在故障",width:"110"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","header-align":"center",align:"left"}})],1)],1)])])])},o=[],i=(a("c1df"),a("b9c3")),n={name:"OutinDetail",data:function(){return{dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",outInDetail:{},outInAsset:[],totalResult:0,allAlign:"center",billType:0,form:this.$form.createForm(this),visible:!1,confirmLoading:!1,validatorRules:{engineerId:{rules:[{required:!0,message:"请选择工程师!"}]},trainNo:{rules:[{required:!0,message:"请选择车号!"}]},sendGroupId:{rules:[{required:!0,message:"请选择作业班组!"}]},receiveUser:{rules:[{required:!0,message:"请输入接车人!"}]},lineId:{rules:[{required:!0,message:"请选择所属线路!"}]}},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}}},methods:{show:function(e){this.visible=!0,this.outInDetail=e,this.outInAsset=e.outinDetails,this.billType=e.billType,this.edit(this.outInDetail)},showByTaskId:function(e){var t=this;Object(i["z"])({id:e}).then((function(e){e.success&&t.show(e.result)}))},edit:function(e){this.model=Object.assign({},e)},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=n,s=(a("6ad7"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"6b4c9904",null);t["default"]=c.exports},"1be3":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:e.taskTools,"keep-source":!0,"edit-rules":e.validRules,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskTools=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange,blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:r.orderTaskId,callback:function(t){e.$set(r,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,2503425894)}):e._e(),t("vxe-table-column",{attrs:{field:"code",title:"工器具类型编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"toolSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},on:{focus:function(t){return e.openToolSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.category1_dictText)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}])}),4===e.operator?t("vxe-table-column",{attrs:{field:"assetCode",title:"工器具资产编码",align:"left","edit-render":{name:"input"},formatter:e.serialNoFormatter},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("div",{on:{click:function(t){return t.stopPropagation(),e.openToolRealitySelectModal(r)}}},[t("a-select",{ref:"toolRealitySelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},model:{value:r.assetCode,callback:function(t){e.$set(r,"assetCode",t)},expression:"row.assetCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return t.stopPropagation(),e.openToolRealitySelectModal(r)}},slot:"suffixIcon"})],1)],1)]}}],null,!1,3869199305)}):e._e(),e.getButtonShow()?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1)],1),t("ToolTypeSelect",{ref:"modalForm",attrs:{multiple:!1,batch:!0},on:{ok:e.onSelectTool}}),t("ToolTypeSelect",{ref:"modalFormMultiple",attrs:{multiple:!0,batch:!0},on:{ok:e.onSelectToolMultiple}}),t("ToolsList",{ref:"modalRealityForm",attrs:{multiple:!1},on:{ok:e.onRealitySelectTool}}),t("task-select-modal",{ref:"taskSelectModal",on:{ok:e.onSelectTask}})],1)},o=[],i=a("a4db"),n=a("383b"),l=a("d425"),s=a("ca00"),c={name:"TaskTools",components:{ToolTypeSelect:i["default"],TaskSelectModal:n["default"],ToolsList:l["default"]},props:{taskTools:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},forms:{type:Array,default:function(){return[]}},operator:{type:Number,default:0}},data:function(){return{curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择工器具",trigger:"manual"}],amount:[{required:!0,message:"数量必须填写",trigger:"manual"}]},tableHeight:{top:"height: calc(100vh - 160px)",bottom:"height: calc(100vh - 160px)",size:"100%"}}},methods:{getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||4===this.operator)},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.taskTools.map((function(a,r){t.id===a.id&&e.taskTools.splice(r,1)}))}))}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskTools.map((function(a,r){e.id===a.id&&t.taskTools.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.taskTools.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openToolSelectModal:function(e){this.curRow=e,this.$refs.modalForm.showModal(),this.$refs.toolSelect.blur(),this.$refs.listTable.clearValidate()},openToolRealitySelectModal:function(e){this.curRow=e,this.$refs.modalRealityForm.showModal(e.toolTypeId),this.$refs.toolRealitySelect.blur()},onSelectToolMultiple:function(e){var t=this;e.forEach((function(e,a){if(t.taskTools.find((function(t){return t.toolTypeId===e.id})))t.$message.warn("你选择的".concat(e.name,"已经在列表中存在"));else{var r={id:Object(s["p"])(),code:e.code,toolTypeId:e.toolTypeId||e.id,name:e.name,kind:e.kind,unit:e.unit,kind_dictText:e.kind_dictText,category1:e.category1,category1_dictText:e.category1_dictText,amount:e.num,toolId:"",measure:6===e.category1?1:0};t.selectTask?Object.assign(r,{orderTaskId:t.selectTask.id,taskName:t.selectTask.taskName}):t.tasks.length&&Object.assign(r,{orderTaskId:t.tasks[0].id,taskName:t.tasks[0].taskName}),t.$refs.listTable.insertAt(r,-1),t.taskTools.push(r)}}))},onSelectTool:function(e){var t=this;if(e&&e.length>0){var a=e[0];e.forEach((function(r,o){if(t.taskTools.find((function(e){return e.toolTypeId===r.id})))t.$message.warn("你选择的".concat(r.name,"已经在列表中存在"));else if(o>0){var i={id:Object(s["p"])(),orderTaskId:t.curRow.orderTaskId,taskName:t.curRow.taskName,code:r.code,toolTypeId:r.toolTypeId||r.id,name:r.name,kind:r.kind,unit:r.unit,kind_dictText:r.kind_dictText,category1:r.category1,category1_dictText:r.category1_dictText,amount:r.num,toolId:"",measure:6===r.category1?1:0};t.taskTools.push(i)}else t.curRow.code=a.code,t.curRow.toolTypeId=a.toolTypeId,a.toolTypeId||(t.curRow.toolTypeId=a.id),t.curRow.name=a.name,t.curRow.kind=a.kind,t.curRow.unit=a.unit,t.curRow.kind_dictText=a.kind_dictText,t.curRow.category1=a.category1,t.curRow.category1_dictText=a.category1_dictText,t.curRow.amount=a.num,t.curRow.toolId="",t.curRow.measure=6===a.category1?1:0,e.length>1&&(t.$refs.listTable.clearActived(),1===t.curEditMode&&t.taskTools.push(t.curRow),t.curEditMode=0)}))}else this.curRow.code="",this.curRow.toolTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.category1="",this.curRow.category1_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.toolId="",this.curRow.measure="";this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},onRealitySelectTool:function(e){if(e&&e.length>0){var t=e[0];if(this.curRow.toolTypeId!==t.materialTypeId&&6!==t.category1)return void this.$message.error("你选择的工器具与需求类型不一样");this.$refs.listTable.getActiveRecord().row.toolId=t.id,this.$refs.listTable.getActiveRecord().row.assetCode=t.assetCode}},openTaskSelectModal:function(e){this.curRow=e,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(e){if(e&&e.length>0){var t=e[0];this.curRow.orderTaskId=t.id,this.curRow.taskName=t.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[t.key].taskName,this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},formSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.workRecordInstName=this.forms[t.key].formName,this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},serialNoFormatter:function(e){var t=e.cellValue;return t||"无"},clearValidate:function(){this.$refs.listTable.clearValidate()}}},u=c,d=a("2877"),f=Object(d["a"])(u,r,o,!1,null,null,null);t["default"]=f.exports},"246f":function(e,t,a){},"25e0":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,centered:"",width:500,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查日期"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["checkDate",e.validatorRules.checkDate],expression:"['checkDate', validatorRules.checkDate]"}],staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD",placeholder:"选择检查日期"},on:{change:e.changeCheckDate}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查结果"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["checkResult",e.validatorRules.checkResult],expression:"['checkResult', validatorRules.checkResult]"}],attrs:{triggerChange:!0,placeholder:"请选择检查结果",dictCode:"bu_work_order_record_result"}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"质量负责人"}},[t("a-input",{ref:"userSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择质量负责人",open:!1},on:{click:function(t){return e.openSelectUser()}},model:{value:e.checkUserName,callback:function(t){e.checkUserName=t},expression:"checkUserName"}},[t("a-icon",{attrs:{slot:"suffix",type:"ellipsis"},slot:"suffix"})],1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"备注"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["remark"],expression:"['remark']",modifiers:{trim:!0}}],attrs:{placeholder:"请输入备注"}})],1)],1)],1),t("user-list",{ref:"userSelectModal",attrs:{multiple:!1},on:{ok:e.onSelectUser}})],1)},o=[],i=a("b245"),n=a("b7b4"),l=a("c1df"),s=a.n(l),c={name:"ConfirmForm",components:{UserList:i["default"]},data:function(){return{title:"检查确认",visible:!1,recordId:"",checkUserName:"",checkUserId:"",model:{},confirmLoading:!1,labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},form:this.$form.createForm(this),validatorRules:{checkDate:{rules:[{required:!0,message:"请选择检查日期!"}]},checkResult:{rules:[{required:!0,message:"请选择检查结果!"}]}}}},mounted:function(){},methods:{confirm:function(e){var t=this;this.form.resetFields(),this.visible=!0,this.confirmLoading=!1,this.recordId=e,this.model=Object.assign({},{checkDate:s()(new Date).format("YYYY-MM-DD")}),this.$nextTick((function(){t.form.setFieldsValue({checkDate:t.model.checkDate})})),this.checkUserName=this.$store.getters.userInfo.realname,this.checkUserId=this.$store.getters.userInfo.id},changeCheckDate:function(e){e&&(this.model.checkDate=e)},handleOk:function(){var e=this;e.form.validateFields((function(t,a){if(!t){e.confirmLoading=!0;var r=Object.assign(e.model,a,{checkDate:s()(e.model.checkDate).format("YYYY-MM-DD"),id:e.recordId,checkUserName:e.checkUserName,checkUserId:e.checkUserId});Object(n["f"])(r).then((function(t){t.success?(e.$message.success(t.message),e.$emit("ok",r),e.close()):e.$message.warning(t.message)})).finally((function(){e.confirmLoading=!1}))}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},openSelectUser:function(){this.$refs.userSelectModal.showModal(),this.$refs.userSelect.blur()},onSelectUser:function(e){e.length&&(this.checkUserName=e[0].realname,this.checkUserId=e[0].id,this.$forceUpdate())}}},u=c,d=a("2877"),f=Object(d["a"])(u,r,o,!1,null,null,null);t["default"]=f.exports},"260f":function(e,t,a){},"2a71":function(e,t,a){"use strict";a("30f7")},"2d1c":function(e,t,a){"use strict";a("8e5e")},"2eb4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"备料确认-".concat(e.selectInfo?e.selectInfo.materialTypeName:"","物资"),width:"90%",bodyStyle:{height:"70vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[e.readonly?e._e():t("div",{staticClass:"table-page-search-wrapper",staticStyle:{position:"relative","z-index":"100"}},[t("a-form",{attrs:{form:e.form,layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{labelCol:{span:10},wrapperCol:{span:14},label:"来源库位"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["sourceLocationName",e.validatorRules.sourceLocationName],expression:"['sourceLocationName', validatorRules.sourceLocationName]"}],ref:"locationSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:e.openlocationModal}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"发放数量"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount",e.validatorRules.amount],expression:"['amount', validatorRules.amount]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入数量",max:e.locationMaxAmount}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"存放托盘"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["palletName",e.validatorRules.palletName],expression:"['palletName', validatorRules.palletName]"}],ref:"palletSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择托盘",open:!1},on:{change:e.palletNameChange,dropdownVisibleChange:function(t){return e.openPalletModal()}}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加")]),t("span",{staticStyle:{color:"red","margin-left":"15px"}},[e._v(e._s("总量: ".concat(e.selectInfo?e.selectInfo.amount:0,";")))]),t("span",{staticStyle:{color:"red","margin-left":"5px"}},[e._v(e._s("差额：".concat(e.calcAmount)))])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 62px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",height:"auto","keep-source":"",data:e.tableData,"edit-config":e.readonly?null:{trigger:"click",mode:"cell"}},on:{"edit-actived":e.onEditActive,"edit-closed":e.onEditClosed}},[t("vxe-table-column",{attrs:{title:"物资编码"}},[e._v(" "+e._s(e.selectInfo?e.selectInfo.materialTypeCode:"")+" ")]),t("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位"}}),t("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘"}}),t("vxe-table-column",{attrs:{field:"amount",title:"发放数量",align:"center","edit-render":{name:"$input",props:{type:"number"}}}}),e.readonly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.isMustApply?e._e():t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.handleDel(r)}}},[e._v("删除")])]}}],null,!1,3925414073)})],1)],1):e._e(),t("LocationList",{ref:"locationModal",on:{ok:e.onSelectLocation}}),t("PalletList",{ref:"palletModal",on:{ok:e.onSelectPallet}})],1)},o=[],i=a("13f1"),n=a("9f49"),l={name:"ApplyDistributionModal",components:{LocationList:i["default"],PalletList:n["default"]},props:{readonly:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,selectInfo:null,form:this.$form.createForm(this),chooseType:2,cellLocationName:"",cellPalletName:"",locationMaxAmount:0,queryParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},tableData:[],delDataList:[],delRecordList:[],validatorRules:{sourceLocationName:{rules:[{required:!0,message:"请选择所属库位!"}]},locationName:{rules:[]},palletId:{rules:[{required:!0,message:"请选择托盘!"}]},palletName:{rules:[{required:!1,message:"请选择托盘!"}]},amount:{rules:[{required:!0,message:"请输入数量!"}]}},isMustApply:!1}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0})),this.selectInfo||this.close()},computed:{calcAmount:function(){return this.getAmount()}},watch:{},methods:{getAmount:function(){if(!this.selectInfo)return 0;var e=0;return this.tableData.forEach((function(t){e+=Number(t.amount)})),this.selectInfo.amount-e},showModal:function(e){var t=this;this.selectInfo=e,this.tableData=[],e.assignDetailList.forEach((function(e){t.tableData.push(JSON.parse(JSON.stringify(e)))})),this.queryParam.materialTypeId=this.selectInfo.materialTypeId,this.queryParam.applyDetailId=this.selectInfo.id,this.queryParam.amount=this.calcAmount,this.visible=!0,this.$nextTick((function(){t.locationMaxAmount=t.calcAmount,t.form.getFieldDecorator("amount"),t.form.setFieldsValue({amount:t.calcAmount})}))},handleOk:function(){var e=this;if(!this.isMustApply)return 0===this.calcAmount?(this.$emit("ok",this.tableData),void this.close()):void this.$confirm({content:"物料差额分配未完成，是否退出？",onOk:function(){e.$emit("ok",e.tableData),e.close()}});this.close()},handleAdd:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var r=0;if(e.tableData.forEach((function(e){r+=Number(e.amount)})),e.tableData.find((function(t){return t.sourceLocationName===e.queryParam.sourceLocationName})))return e.$message.warn("".concat(e.queryParam.sourceLocationName,"来源库位的记录已存在")),void e.$refs.listTable.setActiveCell(e.tableData.find((function(t){return t.sourceLocationName===e.queryParam.sourceLocationName})),"amount");if(0===e.locationMaxAmount)return void e.$message.warn("".concat(e.queryParam.sourceLocationName,"来源库位的库存量不足"));if(r+a.amount>Number(e.selectInfo.amount))return void e.$message.warn("选择的实际数量超过了发放数量");e.queryParam.amount=a.amount,e.tableData.push(JSON.parse(JSON.stringify(e.queryParam)))}}))},handleDel:function(e){var t=this;this.tableData.splice(this.tableData.findIndex((function(t){return t===e})),1),this.queryParam.amount=this.calcAmount,this.$nextTick((function(){t.locationMaxAmount=t.calcAmount,t.form.getFieldDecorator("amount"),t.form.setFieldsValue({amount:t.calcAmount})}))},handleCancel:function(){this.$emit("cancel"),this.close()},close:function(){this.visible=!1},openPalletModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.curRow=e,this.$refs.palletModal.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName),this.$refs.palletSelect.blur()},openlocationModal:function(e){e&&(this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,null,null),this.$refs.locationSelect.blur())},onSelectLocation:function(e){if(this.curRow)this.curRow&&(this.curRow.palletName=e[0].warehouseName,this.curRow.locationWbs=e[0].warehouseWbs,this.curRow.sourceLocationName=e[0].sourceLocationName,delete this.curRow);else if(e.length>0){var t=0;this.tableData.forEach((function(a){a.locationWbs===e[0].warehouseWbs&&(t+=a.amount)})),this.locationMaxAmount=e[0].amount-t,this.locationMaxAmount<this.queryParam.amount&&this.form.setFieldsValue({amount:this.locationMaxAmount}),this.queryParam.locationName=e[0].warehouseName,this.queryParam.locationWbs=e[0].warehouseWbs,this.queryParam.sourceLocationName=e[0].sourceLocationName,this.queryParam.tradeNo=e[0].tradeNo,this.form.setFieldsValue({locationName:e[0].warehouseName,sourceLocationName:e[0].sourceLocationName})}},palletNameChange:function(e){e||(this.queryParam.palletId=void 0,this.queryParam.palletName=void 0)},onSelectPallet:function(e){this.curRow?delete this.curRow:e.length>0&&(this.queryParam.palletId=e[0].id,this.queryParam.palletName=e[0].name,this.form.setFieldsValue({palletName:e[0].name}))},onEditActive:function(e){var t=e.row;this.cellLocationName=t.locationName,this.cellPalletName=t.palletName},onEditClosed:function(e){var t=e.row,a=0;if(this.tableData.forEach((function(e){a+=Number(e.amount)})),a>Number(this.selectInfo.amount))return this.$refs.listTable.revertData(t),void this.$message.warn("选择的实际数量超过了发放数量")}}},s=l,c=a("2877"),u=Object(c["a"])(s,r,o,!1,null,null,null);t["default"]=u.exports},"2f2f":function(e,t,a){},"2fc4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.files,"edit-rules":e.validRules,"keep-source":!0,"show-overflow":"ellipsis","checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.files=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange},model:{value:r.orderTaskId,callback:function(t){e.$set(r,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}])}),t("vxe-table-column",{attrs:{field:"fileName",title:"文件名称","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"fileSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件",open:!1},on:{focus:function(t){return e.openFileSelectModal(r)}},model:{value:r.fileName,callback:function(t){e.$set(r,"fileName",t)},expression:"row.fileName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"fileType",title:"文件类型"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.fileType)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"fileSize",title:"文件大小",align:"right"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.fileSize)+" ")]}}])}),e.getButtonShow()?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1),t("task-select-modal",{ref:"taskSelectModal",on:{ok:e.onSelectTask}}),t("tech-file-list",{ref:"fileSelectModal",attrs:{id:"4",multiple:!1},on:{ok:e.onFileSelect}})],1)},o=[],i=a("ca00"),n=a("383b"),l=a("da42"),s={name:"TaskTechFiles",components:{TaskSelectModal:n["default"],TechFileList:l["default"]},props:{files:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0}},data:function(){return{curEditMode:0,curRow:null,validRules:{fileName:[{required:!0,message:"请选择文件"}]}}},methods:{getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator)},handleAdd:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:Object(i["p"])()};this.selectTask&&Object.assign(t,{orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"taskName")}))}},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.files.map((function(a,r){t.id===a.id&&e.files.splice(r,1)}))}))}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.files.map((function(a,r){e.id===a.id&&t.files.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.files.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openFileSelectModal:function(e){this.curRow=e,this.$refs.fileSelectModal.showModal(),this.$refs.fileSelect.blur()},onFileSelect:function(e){if(e&&e.length>0){var t=e[0];this.curRow.fileId=t.id,this.curRow.fileName=t.name,this.curRow.fileType=t.type,this.curRow.fileSize=t.size}else this.curRow.fileId="",this.curRow.fileName="",this.curRow.fileType="",this.curRow.fileSize="";this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},openTaskSelectModal:function(e){this.curRow=e,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(e){if(e&&e.length>0){var t=e[0];this.curRow.orderTaskId=t.id,this.curRow.taskName=t.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[t.key].taskName,this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))}}},c=s,u=a("2877"),d=Object(u["a"])(c,r,o,!1,null,"74f14a29",null);t["default"]=d.exports},"30f7":function(e,t,a){},"310d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{title:"车辆设备选择",width:"80%",bodyStyle:{height:"83vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:"",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.close}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchQuery.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"名称或编码"},model:{value:e.queryParam.title,callback:function(t){e.$set(e.queryParam,"title",t)},expression:"queryParam.title"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"线路"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.changeLine},model:{value:e.lineId_A,callback:function(t){e.lineId_A=t},expression:"lineId_A"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"车辆"}},[t("j-dict-select-seach-tag",{attrs:{triggerChange:!0,dictCode:e.dictTrainStr},model:{value:e.trainNo_A,callback:function(t){e.trainNo_A=t},expression:"trainNo_A"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"状态"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,placeholder:"请选择状态",dictCode:"bu_valid_status"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.searchQuery}},[e._v("查询")])],1)],1)])],1)],1)],1),t("div",{staticClass:"tableHeight"},[t("vxe-table",{ref:"listTable",attrs:{border:"",resizable:"","row-id":"id",align:e.allAlign,height:"auto",data:e.tableData,"show-overflow":"tooltip","max-height":"100%","radio-config":{trigger:e.multiple?"default":"row",highlight:!0,checkMethod:e.checkRadioMethod},"checkbox-config":{trigger:e.multiple?"row":"default",highlight:!0,checkStrictly:!0,checkMethod:e.checkRadioMethod},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称","tree-node":"",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"code",title:"编码",width:"180"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",align:"center","header-align":"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("div",{style:{backgroundColor:e.statusColor[r.status+""],borderRadius:"4px"}},[e._v(" "+e._s(r.status_dictText)+" ")])]}}])}),t("vxe-table-column",{attrs:{field:"maximoAssetType",title:"maximo设备类型",width:"150",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"locationName",title:"位置",width:"400",align:"left","header-align":"center"}})],1)],1)])],1)},o=[],i=a("8fad"),n={props:{multiple:{type:Boolean,default:!0},trainNo:{type:[Number,String]},lineId:{type:[Number,String]}},data:function(){return{statusColor:{0:"#dedede",1:"#bad795"},dictTrainStr:"",trainNo_A:void 0,lineId_A:void 0,allAlign:"center",tableData:[],visible:!1,confirmLoading:!1,queryParam:{trainNo:"",searchText:"",status:1}}},created:function(){},methods:{changeLine:function(e,t){this.dictTrainStr="",e&&(this.dictTrainStr="bu_train_info,train_no,train_no,line_id="+e+"|train_struct_id")},checkRadioMethod:function(e){e.row;return!0},searchQuery:function(){this.findList()},loadChildrenMethod:function(e){var t=this,a=e.row,r={trainNo:this.trainNo_A,parentId:a.id,searchText:this.queryParam.searchText,status:this.queryParam.status};return new Promise((function(e){Object(i["Wb"])(r).then((function(a){a.success?e(a.result):t.$message.error("".concat(a.msg))}))}))},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),Array.from(e,(function(e,t){e.assetName=e.name})),this.$emit("ok",e),this.visible=!1},showModal:function(){this.visible=!0,this.lineId_A=this.lineId,this.trainNo_A=this.trainNo,this.findList()},close:function(){this.visible=!1},findList:function(){var e=this;this.queryParam.trainNo=this.trainNo_A,this.loading=!0,Object(i["Wb"])(this.queryParam).then((function(t){t.success&&(e.loading=!1,e.tableData=t.result)}))}}},l=n,s=(a("4677"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"3967f3d4",null);t["default"]=c.exports},3143:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"100%",centered:"",title:"作业指导书",dialogClass:"fullDialog no-footer",visible:e.visible,footer:null,destroyOnClose:!0},on:{cancel:function(t){e.visible=!1}}},[t("div",{ref:"bookStepDom",staticStyle:{padding:"15px"}})])},o=[],i={name:"TaskBookStepsModal",data:function(){return{title:"操作",visible:!1,bookSteps:[]}},methods:{show:function(e){var t=this;this.visible=!0,this.bookSteps=e,this.$nextTick((function(){t.setBookStepDom()}))},setBookStepDom:function(){var e="";this.bookSteps.forEach((function(t){e+="<h2>".concat(t.bookStepNo,'<span style="margin-left:15px;">').concat(t.bootStepTitle,"</span></h2>"),e+=t.bootStepContent})),e&&(this.$refs.bookStepDom.innerHTML=e)}}},n=i,l=a("2877"),s=Object(l["a"])(n,r,o,!1,null,"3bd37bcc",null);t["default"]=s.exports},3206:function(e,t,a){"use strict";a("932f")},3281:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"详情",width:"100%",centered:"",visible:e.visible,dialogClass:"fullDialog no-footer",footer:null,destroyOnClose:!0,cancelText:"关闭"},on:{cancel:e.handleCancel}},[t("BreakdowmDetailItem",{ref:"BreakdowmDetailItem"})],1)},o=[],i=a("1a6f"),n={name:"BreakdownModal",components:{BreakdowmDetailItem:i["default"]},data:function(){return{visible:!1}},created:function(){},methods:{show:function(e){var t=this;this.visible=!0,this.$nextTick((function(){t.$refs.BreakdowmDetailItem.show(e)}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=n,s=a("2877"),c=Object(s["a"])(l,r,o,!1,null,"7dee63a6",null);t["default"]=c.exports},"353a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",visible:e.visible,title:e.title,centered:"",bodyStyle:{height:"80vh"},confirmLoading:e.confirmLoading,destroyOnClose:!0,footer:null},on:{cancel:e.handleCancel}},[t("div",[t("iframe",{staticClass:"filename",staticStyle:{height:"calc(80vh - 25px)"},attrs:{src:e.filePath,width:"100%",frameborder:"0"}})])])},o=[],i=a("e2aa"),n={name:"DocPreviewModal",props:{title:{type:String,default:"文件预览"}},data:function(){return{visible:!1,confirmLoading:!1,filePath:""}},methods:{handleFilePath:function(e){var t=this;Object(i["c"])(e).then((function(e){if(e.success){var a=e.result;t.visible=!0,t.filePath=window._CONFIG["onlinePreviewDomainURL"]+"?url="+encodeURIComponent(a)}else t.$message.warning("查看文件失败")}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=n,s=(a("9216"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"484795fd",null);t["default"]=c.exports},"36e5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",[t("a-col",[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(100vh - 220px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto",data:e.tableData,"edit-rules":e.validRules,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.tableData=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{dropdownVisibleChange:function(t){return e.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(t){e.$set(r,"code",t)},expression:"row.code"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"amount",title:"退料数量","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:1e4},model:{value:r.amount,callback:function(t){e.$set(r,"amount",t)},expression:"row.amount"}})]}}])}),t("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.unit)+" ")]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)})],1)],1),t("ReturnMaterialModal",{ref:"returnMaterialModal",on:{ok:e.onSelectReturnMaterial}})],1)},o=[],i=a("f9cc"),n=a("ca00");function l(e){return d(e)||u(e)||c(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"==typeof e)return f(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?f(e,t):void 0}}function u(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function d(e){if(Array.isArray(e))return f(e)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var h={components:{ReturnMaterialModal:i["default"]},props:{taskMaterials:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},workOrderId:{type:String,default:null},selectTask:{type:Object,default:null},tasks:{type:Array,default:function(){return[]}}},watch:{taskMaterials:{handler:function(e){var t=e;this.tableData=t.filter((function(e){return 3==e.opType}))},immediate:!0,deep:!0}},data:function(){return{curEditMode:0,tableData:[],validRules:{taskName:[{required:!0,message:"请选工单任务",trigger:"manual"}],code:[{required:!0,message:"请选择物料",trigger:"manual"}],useCategory_dictText:[{required:!0,message:"类别必须选择",trigger:"manual"}],amount:[{required:!0,message:"数量必须填写",trigger:"manual"}],actAmount:[{required:2===this.opType,message:"数量必须填写",trigger:"manual"}]}}},methods:{handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.returnMaterialModal.showModal(this.workOrderId))},onSelectReturnMaterial:function(e){var t=this;e.forEach((function(e){if(t.tableData.find((function(t){return t.materialTypeId===e.materialTypeId})))t.$message.warn("".concat(e.materialTypeName,"物资已存在"));else{var a={id:Object(n["p"])(),opType:3,opType_dictText:"退还物资",orderId:t.workOrderId,code:e.materialTypeCode,materialTypeId:e.materialTypeId,name:e.materialTypeName,unit:e.materialTypeUnit,useCategory:e.useCategory,useCategory_dictText:e.useCategory_dictText,amount:e.num,actAmount:0};t.selectTask?Object.assign(a,{orderTaskId:t.selectTask.id,taskName:t.selectTask.taskName}):t.tasks.length&&Object.assign(a,{orderTaskId:t.tasks[0].id,taskName:t.tasks[0].taskName}),t.tableData.push(a)}})),this.initSubmitData()},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<=0?this.$message.warning("请选择要删除的物料"):this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.tableData.map((function(a,r){a.id===t.id&&e.tableData.splice(r,1)}))})),e.initSubmitData()}})},initSubmitData:function(){var e=this.taskMaterials.filter((function(e){return 3!=e.opType})),t=[].concat(l(e),l(this.tableData));this.$emit("update:taskMaterials",t)},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else{var i=t.taskMaterials.find((function(t){return 3!=t.opType&&t.materialTypeId===e.materialTypeId}));if(i&&i.amount<e.amount)return void t.$message.warn("退料数量不能大于领料数量");if(e.actAmount>e.amount)return void t.$message.error("实际消耗不能大于所需数量");1===t.curEditMode&&t.tableData.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)}}},m=h,p=a("2877"),b=Object(p["a"])(m,r,o,!1,null,"932269e2",null);t["default"]=b.exports},3737:function(e,t,a){"use strict";a("2f2f")},37582:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:e.title,centered:"",bodyStyle:{height:"80vh"},visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("na-splitter",{staticStyle:{height:"calc(80vh - 15px)"},attrs:{defaultSize:200}},[t("div",{staticStyle:{"overflow-y":"auto","overflow-x":"hidden","padding-right":"2px"},attrs:{slot:"left-panel"},slot:"left-panel"},[t("a-menu",{attrs:{mode:"inline","default-selected-keys":e.defaultSelect},on:{click:e.handleMenuClick}},[t("a-menu-item",{key:1},[t("a-icon",{attrs:{type:"pie-chart"}}),t("span",[e._v("数据记录表")])],1),t("a-menu-item",{key:3},[t("a-icon",{attrs:{type:"pie-chart"}}),t("span",[e._v("作业记录表【新】")])],1),t("a-menu-item",{key:4},[t("a-icon",{attrs:{type:"pie-chart"}}),t("span",[e._v("检查记录表")])],1)],1)],1),t("div",{staticStyle:{"padding-left":"5px","padding-right":"3px"},attrs:{slot:"right-panel"},slot:"right-panel"},[t("div",[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"表单名称"}},[t("a-input",{attrs:{placeholder:"请输入表单名称"},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{"label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol,label:"线路"}},[t("line-select-list",{model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{"label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol,label:"所属修程"}},[t("j-dict-select-tag",{attrs:{triggerChange:"",dictCode:"bu_repair_program,name,id"},model:{value:e.queryParam.repairProId,callback:function(t){e.$set(e.queryParam,"repairProId",t)},expression:"queryParam.repairProId"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 135px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 135px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"},"radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{title:"-",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("span",[t("a",{on:{click:function(t){return t.stopPropagation(),e.handleSeeing(r)}}},[e._v("预览")])])]}}])}),t("vxe-table-column",{attrs:{field:"title",title:3===e.formType?"作业记录表名称":1===e.formType?"数据记录表":4===e.formType?"检查记录表":"",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{width:"100",align:"left","header-align":"center",field:"code",title:"编码"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"线路",width:"100"}}),4===e.formType?t("vxe-table-column",{attrs:{field:"repairProName",title:"修程",width:"100"}}):e._e(),1===e.formType||3===e.formType?t("vxe-table-column",{attrs:{field:"repairProgramName",title:"修程",width:"100"}}):e._e(),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("div",{style:{backgroundColor:e.statusColor[r.status+""],borderRadius:"4px"}},[e._v(" "+e._s(r.status_dictText)+" ")])]}}])}),t("vxe-table-column",{attrs:{field:"reguName",title:"所属规程",width:"120"}}),t("vxe-table-column",{attrs:{field:"reguVersion",title:"规程版本",width:"100"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)]),t("RecordTableView",{ref:"recordTableView"}),t("JobCheckTableView",{ref:"jobCheckTableView"}),t("FormViewModal",{ref:"formViewModal"})],1)])],1)},o=[],i=a("b7b4"),n=a("8fad"),l=a("4ec3"),s=a("e18e"),c=a("7e9e"),u=a("aaa8"),d=a("3dbe"),f=a("5633"),h={name:"FormsList",components:{NaSplitter:s["default"],RecordTableView:c["default"],FormViewModal:d["default"],LineSelectList:f["default"],JobCheckTableView:u["default"]},props:{title:{type:String,default:"表单选择"},multiple:{type:Boolean,default:!0}},data:function(){return{fileName:"",formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}},statusColor:{0:"#dedede",1:"#bad795"},queryParam:{name:"",workstationId:"",lineId:"",repairProId:"",status:1,pageNo:1,pageSize:10},formType:3,workRecordType:2,defaultSelect:[3],dictCode:"bu_mtr_workstation,name,id",allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,stationData:[],isShowPlan:!1}},methods:{handleSeeing:function(e){var t=this;3===this.formType&&1===this.workRecordType&&this.$refs.recordTableView.show(e.id),(1===this.formType||3===this.formType&&2===this.workRecordType)&&this.$refs.formViewModal.showModal(e.id),4===this.formType&&Object(i["y"])({id:e.id}).then((function(e){if(e.success&&e.result){var a=e.result;t.$refs.jobCheckTableView.show(a)}else t.$message.error("加载记录数据异常")}))},showModal:function(e){e&&e.lineId&&(this.queryParam.lineId=e.lineId),e&&e.repairProgramId&&(this.queryParam.repairProId=e.repairProgramId),this.visible=!0,this.isShowPlan=!1,this.formType=3,this.workRecordType=2,this.defaultSelect=[3],this.findList()},showModalByPlan:function(e){this.visible=!0,this.isShowPlan=!0,this.formType=3,this.workRecordType=2,this.defaultSelect=[3],this.queryParam.planId=e,this.findList()},initDictData:function(){var e=this;Object(l["u"])(this.dictCode)?this.stationData=Object(l["u"])(this.dictCode):Object(l["f"])(this.dictCode).then((function(t){t.success&&(e.stationData=t.result)}))},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},initParamByFormType:function(){3===this.formType&&(this.queryParam.category="1328995639249358850",this.queryParam.type=1,this.workRecordType=2),1===this.formType&&(this.queryParam.category="1328995580210335746",this.queryParam.type=1,this.workRecordType=0)},findList:function(){var e=this;this.loading=!0,this.initParamByFormType(),(1===this.formType||3===this.formType&&2===this.workRecordType)&&Object(n["Ac"])(this.queryParam).then((function(t){t.success&&(e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records)})),4===this.formType&&Object(n["jc"])(this.queryParam).then((function(t){t.success&&(e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records)}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord());var t="";1===this.formType&&(t="数据记录表"),3===this.formType&&(1===this.workRecordType&&(t="作业记录表(老)"),2===this.workRecordType&&(t="作业记录表(新)")),4===this.formType&&(t="检查记录表"),this.$emit("ok",{formType:this.formType,workRecordType:this.workRecordType,formTypeName:t,forms:e}),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},handleMenuClick:function(e){this.formType!==e.key&&(this.formType=e.key,this.queryParam.name="",this.initParamByFormType(),this.findList())}}},m=h,p=(a("3737"),a("2877")),b=Object(p["a"])(m,r,o,!1,null,"1ecb454d",null);t["default"]=b.exports},"383b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"任务选择",centered:"",visible:e.visible,bodyStyle:{height:"70vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:e.tasks,"max-height":"100%","show-overflow":"ellipsis","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",title:"任务编号",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"任务名称",align:"left"}}),t("vxe-table-column",{attrs:{field:"workTime",title:"预计工时",align:"right",width:"100"}}),t("vxe-table-column",{attrs:{field:"taskContent",title:"任务要求",align:"left"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left",width:"200"}})],1)],1)},o=[],i={name:"TaskSelectModal",props:{multiple:{type:Boolean,default:!1}},data:function(){return{visible:!1,tasks:[]}},methods:{showModal:function(e){this.tasks=e,this.visible=!0},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},n=i,l=a("2877"),s=Object(l["a"])(n,r,o,!1,null,"161bbc55",null);t["default"]=s.exports},"39ff7":function(e,t,a){},"3ab9":function(e,t,a){},"3bcd":function(e,t,a){"use strict";a.d(t,"P",(function(){return o})),a.d(t,"N",(function(){return i})),a.d(t,"F",(function(){return n})),a.d(t,"J",(function(){return l})),a.d(t,"t",(function(){return s})),a.d(t,"i",(function(){return g})),a.d(t,"j",(function(){return v})),a.d(t,"h",(function(){return k})),a.d(t,"g",(function(){return w})),a.d(t,"l",(function(){return y})),a.d(t,"c",(function(){return T})),a.d(t,"e",(function(){return x})),a.d(t,"f",(function(){return C})),a.d(t,"d",(function(){return S})),a.d(t,"b",(function(){return I})),a.d(t,"x",(function(){return _})),a.d(t,"z",(function(){return N})),a.d(t,"w",(function(){return O})),a.d(t,"H",(function(){return $})),a.d(t,"I",(function(){return P})),a.d(t,"y",(function(){return j})),a.d(t,"A",(function(){return D})),a.d(t,"B",(function(){return M})),a.d(t,"M",(function(){return R})),a.d(t,"r",(function(){return L})),a.d(t,"E",(function(){return A})),a.d(t,"k",(function(){return d})),a.d(t,"D",(function(){return f})),a.d(t,"u",(function(){return u})),a.d(t,"L",(function(){return c})),a.d(t,"a",(function(){return h})),a.d(t,"K",(function(){return q})),a.d(t,"m",(function(){return F})),a.d(t,"p",(function(){return E})),a.d(t,"o",(function(){return z})),a.d(t,"G",(function(){return m})),a.d(t,"v",(function(){return p})),a.d(t,"C",(function(){return b})),a.d(t,"n",(function(){return U})),a.d(t,"q",(function(){return B})),a.d(t,"s",(function(){return V})),a.d(t,"O",(function(){return G}));var r=a("0fea"),o=function(e){return Object(r["d"])("/produce/train/history/tree/line-train",e)},i=function(e){return Object(r["d"])("/produce/train/history/maximo-asset/list-child",e)},n=function(e){return Object(r["d"])("/produce/train/history/train/get",e)},l=function(e){return Object(r["d"])("/produce/train/history/train/period",e)},s=function(e){return Object(r["d"])("/produce/train/history/maximo-asset/get",e)},c=function(e){return Object(r["d"])("/produce/train/history/work/page",e)},u=function(e){return Object(r["d"])("/produce/train/history/measure/page",e)},d=function(e){return Object(r["d"])("/produce/train/history/fault/page",e)},f=function(e){return Object(r["d"])("/produce/train/history/forms/page",e)},h=function(e){return Object(r["d"])("/produce/train/history/change/page",e)},m=function(e){return Object(r["d"])("/produce/train/history/train/period",e)},p=function(e){return Object(r["d"])("/produce/train/history/workLeaveRecord/page",e)},b=function(e){return Object(r["d"])("/produce/train/history/workRectify/page",e)},g=function(e){return Object(r["d"])("/produce/fault/detail/count",e)},v=function(e){return Object(r["d"])("/produce/fault/detail/page",e)},y=function(e){return Object(r["d"])("/produce/fault/statistics",e)},k=function(e){return Object(r["j"])("/produce/fault/compare",e)},w=function(e){return Object(r["d"])("/produce/fault/time-effect/data",e)},T=function(e){return Object(r["d"])("/produce/cost/detail/count",e)},x=function(e){return Object(r["d"])("/produce/cost/detail/page",e)},C=function(e){return Object(r["j"])("/produce/cost/statistics",e)},S=function(e){return Object(r["d"])("/produce/cost/compare/count-6year",e)},I=function(e){return Object(r["j"])("/produce/cost/compare",e)},_=function(e){return Object(r["d"])("/produce/plan/list",e)},N=function(e){return Object(r["d"])("/produce/plan/task/listByPlanId/".concat(e))},O=function(e){return Object(r["d"])("/produce/plan/get/".concat(e))},$=function(e){return Object(r["d"])("/serialPlan/plan/get/".concat(e))},P=function(e){return Object(r["d"])("/produce/plan/task/get/".concat(e))},j=function(e){return Object(r["d"])("/produce/plan/regu/list/".concat(e))},D=function(e){return Object(r["d"])("/produce/plan/train-struct/list/".concat(e))},M=function(e){return Object(r["d"])("/produce/plan/train-struct/orders/".concat(e))},R=function(e){return Object(r["d"])("/workshop/list",e)},L=function(e){return Object(r["d"])("/produce/workshop/fault/latest",e)},A=function(e){return Object(r["d"])("/produce/workshop/workstation/list",e)},q=function(e){return Object(r["d"])("/produce/workshop/train-track",e)},F=function(e){return Object(r["d"])("/produce/kpi/group",e)},E=function(e){return Object(r["d"])("/produce/kpi/user",e)},z=function(e){return Object(r["d"])("/produce/kpi/plan/list",e)},U=function(e){return Object(r["d"])("/produce/kpi/plan/get",e)},B=function(e){return Object(r["d"])("/serialPlan/plan/material/lack",e)},V=function(e){return Object(r["d"])("/board/plan-group-statistic/get-last-working-plan",e)},G=function(e){return Object(r["d"])("/board/plan-group-statistic/list",e)}},"3c06":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{attrs:{"na-flex-height-full":""}},[4!==e.operator||e.readOnly?e._e():t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("div",{style:"height: calc(100% - ".concat(4!==e.operator||e.readOnly?"4px":"45px",")")},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:e.staffArranges,"keep-source":!0,"show-overflow":"ellipsis","edit-rules":e.validRules,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.staffArranges=t}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{title:"工单任务",width:"250",align:"left","edit-render":{name:"input",enabled:4===e.operator&&1===e.curEditMode&&e.tasks.length>0}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.tasks.length>0?a.orderTaskName:e.selectTask.taskName)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange},model:{value:r.orderTaskId,callback:function(t){e.$set(r,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,3514004846)}):e._e(),t("vxe-table-column",{attrs:{field:"workstationName",width:"250",title:"工位",align:"left","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator&&1===e.curEditMode}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"stationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工位",open:!1},on:{focus:function(t){return e.openStationSelectModal(r)}},model:{value:r.workstationName,callback:function(t){e.$set(r,"workstationName",t)},expression:"row.workstationName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"userName",title:"安排人员",align:"left","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator&&1===e.curEditMode}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"userSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择人员",open:!1},on:{focus:function(t){return e.openSelectUser(r)}},model:{value:r.userName,callback:function(t){e.$set(r,"userName",t)},expression:"row.userName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"planWorkTime",title:"计划工时",align:"center","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator&&1===e.curEditMode}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.planWorkTime||"")+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:1e4,disabled:!e.isInputPlanTime},model:{value:r.planWorkTime,callback:function(t){e.$set(r,"planWorkTime",t)},expression:"row.planWorkTime"}})]}}])}),t("vxe-table-column",{attrs:{field:"workTime",title:"实际工时",align:"center","edit-render":{name:"input",enabled:!e.readOnly&&4===e.operator}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.workTime||"")+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:1e4},model:{value:r.workTime,callback:function(t){e.$set(r,"workTime",t)},expression:"row.workTime"}})]}}])}),e.readOnly?e._e():t("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([4===e.operator?{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveMaterialRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelMaterialRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",disabled:!1,size:"small"},on:{click:function(t){return t.stopPropagation(),e.editMaterialRowEvent(r)}}},[e._v("填写")])]]}}:null],null,!0)})],1)],1),t("work-station-list",{ref:"stationSelectModal",on:{ok:e.onSelectStation}}),t("user-list",{ref:"userSelectModal",attrs:{depId:e.groupId,multiple:!1},on:{ok:e.onSelectUser}})],1)},o=[],i=a("b9c3"),n=a("1158"),l=a("b245"),s={name:"TaskWorkTime",components:{UserList:l["default"],WorkStationList:n["default"]},props:{staffArranges:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0},workOrderId:{type:String,default:null}},watch:{selectTask:function(){this.refresh()}},data:function(){return{groupId:"",curEditMode:0,curRow:null,workStationDataList:[],isInputPlanTime:!0,validRules:{ordTskWkStationId:[{required:!0,message:"请选择任务",trigger:"manual"}],workstationName:[{required:!0,message:"请选择工位",trigger:"manual"}],userName:[{required:!0,message:"请选择人员",trigger:"manual"}],workTime:[{required:!0,message:"请输入实际工时",trigger:"manual"}]},workStations:[]}},created:function(){try{this.groupId=this.$store.state.user.info.departId}catch(e){}},mounted:function(){this.refresh()},methods:{refresh:function(){var e=this;try{var t=null;t=this.workOrderId?this.workOrderId:this.selectTask.orderId,t&&Object(i["S"])(t).then((function(t){t.success&&(e.workStations=t.result.workstations,e.staffArranges.length=0,e.workStations.forEach((function(t){e.selectTask?t.orderTaskId===e.selectTask.id&&t.staffArrangeList.forEach((function(t){e.staffArranges.push(t)})):t.staffArrangeList.forEach((function(t){e.staffArranges.push(t)}))})))}))}catch(a){}},checkIsAddStation:function(e){if(this.workStations){var t=this.workStations.find((function(t){return t.orderTaskId===e.orderTaskId}));t?(this.isInputPlanTime=!t.staffArrangeList.find((function(t){return t.workstationId===e.workstationId})),this.isInputPlanTime||(this.$refs.listTable.getActiveRecord().row.planWorkTime=t.workTime)):this.isInputPlanTime=!0}},getWorkStationName:function(e){var t=this.workStationDataList.find((function(t){return t.id===e.ordTskWkStationId}));return t?t.workstationName:""},editMaterialRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},saveMaterialRowEvent:function(e){var t=this;1===this.curEditMode&&this.staffArranges.find((function(t){return t.workstationId===e.workstationId&&t.userId===e.userId&&t.orderTaskId===e.orderTaskId}))?this.$message.warn("已经录入相同工位的员工工时"):this.$refs.listTable.validate(e,(function(a){a||(Object(i["ib"])([e]).then((function(a){a.success?(t.refresh(),t.$emit("ok")):(t.$refs.listTable.revertData(e),t.$message.error("保存失败"))})),t.$refs.listTable.clearActived(),t.curEditMode=0)}))},cancelMaterialRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},handleAdd:function(){var e=this;if(this.curEditMode=1,this.isInputPlanTime=!0,!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:""};this.selectTask?(Object.assign(t,{ordTskWkStationId:null,orderId:this.selectTask.orderId,orderTaskId:this.selectTask.id,userId:null,userName:null,planWorkTime:null,workTime:null,workstationId:null,workstationName:null,workstationNo:null}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"userName")}))):(Object.assign(t,{ordTskWkStationId:null,orderId:null,orderTaskId:null,userId:null,userName:null,planWorkTime:null,workTime:null,workstationId:null,workstationName:null,workstationNo:null}),this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveRow(a)})))}},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var a=[];t.map((function(t){e.staffArranges.map((function(e,r){t.id===e.id&&a.push(e.id)}))}));var r=new FormData;r.append("ids",a.toString()),Object(i["n"])(r).then((function(t){t.success?(a.forEach((function(t){e.staffArranges.map((function(a,r){t===a.id&&e.staffArranges.splice(r,1)}))})),e.$emit("ok"),e.$message.success("删除成功")):e.$message.error("删除失败")}))}}):this.$message.error("尚未选中任何数据!")},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.orderTaskId=this.tasks[t.key].id},onSelectStation:function(e){if(e&&e.length>0){var t=e[0];this.curRow.workstationId=t.id,this.curRow.workstationName=t.name,this.curRow.workstationNo=t.stationNo}else this.curRow.workstationId="",this.curRow.workstationName="",this.curRow.workstationNo="";this.checkIsAddStation(this.curRow)},openSelectUser:function(e){this.curRow=e,this.$refs.userSelectModal.showModal(),this.$refs.userSelect.blur()},onSelectUser:function(e){e.length&&(this.curRow.userId=e[0].id,this.curRow.userName=e[0].realname,this.$forceUpdate())},openStationSelectModal:function(e){this.curRow=e,this.$refs.stationSelectModal.showModal(),this.$refs.stationSelect.blur()},clearValidate:function(){this.$refs.listTable.clearValidate()}}},c=s,u=a("2877"),d=Object(u["a"])(c,r,o,!1,null,null,null);t["default"]=d.exports},"3c2d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%","overflow-x":"hidden"}},[t("a-button",{attrs:{"na-btn-type":"print",type:"primary"},on:{click:e.exportPrint}},[e._v("导出打印")]),t("div",{staticStyle:{margin:"0px",padding:"0px",width:"100%",height:"calc(100vh - 85px)"},attrs:{id:"luckysheet"}}),e.showLoading?t("div",{staticStyle:{width:"100%","text-align":"center",position:"absolute",top:"0px",height:"100%","font-size":"16px","z-index":"1000000000",background:"#fff"}},[e._m(0)]):e._e()],1)},o=[function(){var e=this,t=e._self._c;return t("div",{staticStyle:{position:"relative",top:"45%",width:"100%"}},[t("div",{staticClass:"luckysheetLoaderGif"}),t("span",[e._v("加载中...")])])}],i=a("8fad"),n=a("2410"),l=a.n(n),s=a("e24e"),c={name:"view",props:["customId","formName"],data:function(){return{showLoading:!1,defaultOptions:{container:"luckysheet",title:"sheet",column:26,row:50,lang:"zh",allowEdit:!0,showinfobar:!1,sheetFormulaBar:!1,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!1}}},beforeDestroy:function(){luckysheet.destroy()},mounted:function(){var e=this,t=l()(this.defaultOptions);t.data=[{name:"Sheet1",color:"",status:"1",order:"0",index:0,ch_width:2044,rh_height:1080}],this.customId?Object(i["rb"])(this.customId).then((function(e){if(e.success){var a=JSON.parse(e.result);a.scrollLeft=0,a.scrollTop=0,t.showtoolbarConfig={},a.config.authority={sheet:1,hintText:"禁止编辑",allowRangeList:[]},t.data=[a],luckysheet.destroy(),luckysheet.create(t)}})).catch((function(a){e.$message.error("加载表单内容异常"),luckysheet.destroy(),luckysheet.create(t)})):(luckysheet.destroy(),luckysheet.create(t))},methods:{exportPrint:function(){try{var e=this.formName;e||(e="export"),Object(s["a"])(luckysheet.getAllSheets(),e)}catch(t){}}}},u=c,d=a("2877"),f=Object(d["a"])(u,r,o,!1,null,"22edf2fe",null);t["default"]=f.exports},"3cb5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障处理措施选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",bodyStyle:{height:"80vh"},destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"故障措施编码或者描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"分类"}},[t("a-select",{ref:"categoryIdSelect",attrs:{placeholder:"请选择所属分类",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(1)}},model:{value:e.categoryCode,callback:function(t){e.categoryCode=t},expression:"categoryCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"故障代码"}},[t("a-select",{ref:"faultCodeIdSelect",attrs:{placeholder:"请选择所属故障代码",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(2)}},model:{value:e.faultCode,callback:function(t){e.faultCode=t},expression:"faultCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"故障原因"}},[t("a-select",{ref:"faultReasonIdSelect",attrs:{placeholder:"请选择所属故障原因代码",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(3)}},model:{value:e.faultReasonCode,callback:function(t){e.faultReasonCode=t},expression:"faultReasonCode"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:2,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:"序号"}}),t("vxe-table-column",{attrs:{field:"solutionCode",title:"故障措施代码",width:"150"}}),t("vxe-table-column",{attrs:{field:"solutionDesc",title:"故障措施描述",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("fault-category-list",{ref:"categorySelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-code-list",{ref:"codeSelect",attrs:{multiple:!1},on:{ok:e.addCodeTarget}}),t("fault-reason-list",{ref:"reasonSelect",attrs:{multiple:!1},on:{ok:e.addReasonTarget}})],1)},o=[],i=a("b47d"),n=a("a396"),l=a("0e7b"),s=a("6034"),c=a("ca00"),u={name:"FaultSolutionList",components:{FaultCategoryList:n["default"],FaultCodeList:l["default"],FaultReasonList:s["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{categoryCode:"",faultCode:"",faultReasonCode:"",queryParam:{searchText:"",categoryId:"",faultCodeId:"",faultReasonId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(e){this.visible=!0,this.queryParam.faultReasonId=e,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["S"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.categoryCode="",this.faultCode="",this.faultReasonCode="",this.queryParam.searchText="",this.queryParam.categoryId="",this.queryParam.faultCodeId="",this.queryParam.faultReasonId=""},openSelectTypeModal:function(e){switch(e){case 1:this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur();break;case 2:this.$refs.codeSelect.showModal(),this.$refs.faultCodeIdSelect.blur();break;case 3:this.$refs.reasonSelect.showModal(),this.$refs.faultReasonIdSelect.blur();break;default:break}},addCategoryTarget:function(e){Object(c["e"])(e)?this.queryParam.categoryId="":(this.queryParam.categoryId=e[0].id,this.categoryCode=e[0].categoryCode)},addCodeTarget:function(e){Object(c["e"])(e)?this.queryParam.faultCodeId="":(this.queryParam.faultCodeId=e[0].id,this.faultCode=e[0].fltCode)},addReasonTarget:function(e){Object(c["e"])(e)?this.queryParam.faultReasonId="":(this.queryParam.faultReasonId=e[0].id,this.faultReasonCode=e[0].reasonCode)}}},d=u,f=(a("f02c"),a("2877")),h=Object(f["a"])(d,r,o,!1,null,"4d7ca708",null);t["default"]=h.exports},"3cf2":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div")},o=[],i=a("e8ae"),n=a("21a6"),l=a("b7b4"),s="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",c={name:"JobCheckTableExport",data:function(){return{}},props:{},created:function(){},mounted:function(){},methods:{sortArray:function(e){return e.sort(this.compare("sortNo")),e},compare:function(e){return function(t,a){return t[e]-a[e]}},printByRow:function(e){e.itemList=this.sortArray(e.itemList),this.initWorkBook(e)},printById:function(e){var t=this;Object(l["y"])({id:e}).then((function(e){e.success&&(e.result.itemList=t.sortArray(e.result.itemList),t.initWorkBook(e.result))}))},initWorkBook:function(e){var t=new i["Workbook"];t.creator="GY",t.lastModifiedBy="2021-10-28",t.created=new Date,t.modified=new Date,t.lastPrinted=new Date;var a=t.addWorksheet("Sheet1",{properties:{defaultRowHeight:30,defaultColWidth:22},pageSetup:{paperSize:9}});a.addRows([["车辆连挂作业过程检查项点"]]),a.getCell("A2").value="车号："+(e.trainNo||""),a.getCell("D2").value="部件名称："+(e.assetName||""),a.getCell("G2").value="作业周期："+(e.period||""),a.getCell("A3").value="部件编号："+(e.assetNo||""),a.getCell("D3").value="作业位置："+(e.location||""),a.getCell("G3").value="作业班组："+(e.groupName||""),a.getColumn("A").width=15,a.getColumn("B").width=30,a.getColumn("C").width=60,a.mergeCells("A1:J1"),a.mergeCells("A2:C2"),a.mergeCells("D2:F2"),a.mergeCells("G2:J2"),a.mergeCells("A3:C3"),a.mergeCells("D3:F3"),a.mergeCells("G3:J3"),a.addRows([["序号","项点","检查内容","等级","检查情况","结果","作业时间","检查方式","检查人","检查时间"]]);var r=[];(e.itemList||[]).forEach((function(e,t,a){for(var o="",i=0,n=5;i<n;i++)e.checkLevel>i?o+="★":o+="☆";r.push([e.sortNo||"",e.title||"",e.content||"",o,e.checkDesc||"",e.checkUserName?e.checkResult_dictText:"",e.workTime||"",e.checkMethod||"",e.checkUserName||"",e.checkTime||""])})),a.addRows(r);var o=4+(e.itemList||[]).length+1;a.mergeCells("A".concat(o,":J").concat(o)),a.getCell("A".concat(o+1)).value="参考工艺文件",a.mergeCells("A".concat(o+1,":B").concat(o+1)),a.mergeCells("C".concat(o+1,":J").concat(o+1));var l="";(e.techLinkList||[]).forEach((function(e,t,a){l+="".concat(t+1,"、").concat(e.teckBookName).concat(t<a.length-1?"\n":"")})),a.getCell("C".concat(o+1)).value=l;var c=12*((e.techLinkList||[]).length||1)+18,u=o+2;a.mergeCells("A".concat(u,":J").concat(u)),a.mergeCells("A".concat(u+1,":G").concat(u+1)),a.getCell("A".concat(u+1)).value="不合格项汇总",a.getCell("H".concat(u+1)).value="整改情况",a.getCell("I".concat(u+1)).value="复查时间",a.getCell("J".concat(u+1)).value="复查人",(e.rectifyList||[]).forEach((function(e,t,r){a.mergeCells("A".concat(u+t+2,":G").concat(u+t+2)),a.getCell("A".concat(u+t+2)).value=e.itemInfo,a.getCell("H".concat(u+t+2)).value=e.rectifyDesc,a.getCell("I".concat(u+t+2)).value=e.reviewTime,a.getCell("J".concat(u+t+2)).value=e.reviewUserName}));var d=u+(e.rectifyList||[]).length+2;a.mergeCells("A".concat(d,":J").concat(d)),a.getCell("A".concat(d+1)).value="评定",a.mergeCells("A".concat(d+1,":B").concat(d+1)),a.mergeCells("C".concat(d+1,":J").concat(d+1));var f="";(e.judgeList||[]).forEach((function(e,t,a){f+="评定人：".concat(e.jdUserName,"；评定时间：").concat(e.jdTime,"；评定内容：").concat(e.jdContent,"；").concat(t<a.length-1?"\n":"")})),a.getCell("C".concat(d+1)).value=f;var h=12*((e.judgeList||[]).length||1)+18,m=d+2;a.mergeCells("A".concat(m,":J").concat(m));var p=["表中只列出关键项点，检查人员在检查时参照工艺文件标准执行。","检查人员必须对当天作业内容进行检查。","表中所有内容全部现场检查时填写完成，并悬挂于部件上，随部件流转。","作业时间由作业班组填写，其余由检查人员填写。“检查情况”一栏详细记录检查情况；“结果”一栏对检查合格的画“√”不合格的画“×”；“检查方式”一栏写明检查手段，如：目视、测量、操作等。","检查人员对不合格项视情节严重情况开具整改单，及时提出整改意见，并督促整改，整改完成后及时进行复查。","由检查人员、质量工程师及专业工程师对整体作业质量做出最终判定。"];a.getCell("A".concat(m+1)).value="说明",a.mergeCells("A".concat(m+1,":B").concat(m+1)),a.mergeCells("C".concat(m+1,":J").concat(m+1));var b="";p.forEach((function(e,t,a){b+="".concat(t+1,"、").concat(e).concat(t<a.length-1?"\n":"")})),a.getCell("C".concat(m+1)).value=b;var g=12*(p.length||1)+18;a._rows.forEach((function(t,r){a.getRow(r+1).height=o==r?c:d==r?h:m==r?g:30,t._cells.forEach((function(t,i){var n=a.getCell(t._address);n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},[1,2].indexOf(r)>-1||r-3>=0&&r-3<=e.itemList.length&&[1,2,4].indexOf(i)>-1||o==r&&i>=2||d>r&&u<r&&i<7||d==r&&i>=2||m==r&&i>=2?n.alignment={vertical:"middle",horizontal:"left",wrapText:!0}:n.alignment={vertical:"middle",horizontal:"center",wrapText:!0},[0,1,2,3,u].indexOf(r)>-1?(n.fill={type:"pattern",pattern:"darkGray",fgColor:{argb:"FFe9e9e9"}},n.font={name:"黑体",family:4,size:14,underline:!1,bold:!0}):n.font=r<o&&3==i?{name:"黑体",family:4,size:18,underline:!1,bold:!1}:{name:"黑体",family:4,size:12,underline:!1,bold:!1}}))})),t.xlsx.writeBuffer().then((function(t){var a=new Blob([t],{type:s});n["saveAs"](a,"".concat(e.title,".xlsx"))}))}}},u=c,d=a("2877"),f=Object(d["a"])(u,r,o,!1,null,"188fb66a",null);t["default"]=f.exports},"3dbe":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"表单查看",width:"100%",dialogClass:"fullDialog no-footer",visible:e.visible,footer:null,destroyOnClose:!0},on:{cancel:function(t){e.visible=!1}}},[t("FormView",{attrs:{"custom-id":e.customId,"form-name":e.formName}})],1)},o=[],i=a("3c2d"),n={name:"FormViewModal",components:{FormView:i["default"]},props:["formName"],data:function(){return{visible:!1,customId:null}},methods:{showModal:function(e){e&&(this.customId=e,this.visible=!0)}}},l=n,s=a("2877"),c=Object(s["a"])(l,r,o,!1,null,"65a9461c",null);t["default"]=c.exports},"3fdc":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{attrs:{"na-flex-height-full":""}},[e.isSelectDetaile?e._e():t("a-space",{staticStyle:{padding:"10px 0"}},[t("a-button",{on:{click:e.setCheckRecordTime}},[e._v("作业完成")]),t("a-button",{directives:[{name:"has",rawName:"v-has",value:"order:write:check:add",expression:"'order:write:check:add'"}],on:{click:e.openSetCheck}},[e._v("检查登记")]),t("a-button",{directives:[{name:"has",rawName:"v-has",value:"order:write:rectify:add",expression:"'order:write:rectify:add'"}],on:{click:e.openRectifyModal}},[e._v("添加整改")])],1),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"","auto-resize":"","max-height":"auto","row-id":"id",align:"center",data:e.tableData,"show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"sortNo",title:"序号",align:"center",width:"60"}}),t("vxe-table-column",{attrs:{field:"title",title:"项点","header-align":"center",align:"left",width:"160"}}),t("vxe-table-column",{attrs:{field:"content",title:"检查内容","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"checkLevel",title:"等级",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkDesc",title:"检查情况",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkResult_dictText",title:"结果",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"workTime",title:"作业时间",align:"center",width:"115"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkMethod_dictText",title:"检查方式",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkUserName",title:"检查人",align:"center",width:"80"}}),e.isSelectDetaile?e._e():t("vxe-table-column",{attrs:{field:"checkTime",title:"检查时间",align:"center",width:"115"}})],1)],1),t("a-modal",{attrs:{title:"检查",width:800,visible:e.visible,confirmLoading:e.confirmLoading,centered:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-form",{ref:"initForm",attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录名称"}},[t("a-row",{attrs:{gutter:10}},[t("a-col",{attrs:{span:14}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserName",e.validatorRules.checkUserName],expression:"['checkUserName', validatorRules.checkUserName]",modifiers:{trim:!0}}]})],1),t("a-col",{attrs:{span:10}},[t("a-button",{attrs:{type:"link"},on:{click:e.useCurrentUser}},[e._v("使用当前账号和密码")])],1)],1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录密码"}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserPwd",e.validatorRules.checkUserPwd],expression:"['checkUserPwd', validatorRules.checkUserPwd]",modifiers:{trim:!0}}]})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查方式"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["checkMethod",e.validatorRules.checkMethod],expression:"['checkMethod', validatorRules.checkMethod]"}],attrs:{triggerChange:"",placeholder:"请选择检查方式",dictCode:"bu_regu_method"}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查结果"}},[t("a-checkbox",{model:{value:e.checkResult,callback:function(t){e.checkResult=t},expression:"checkResult"}},[e._v(" 合格 ?")])],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查时间"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":{format:"HH:mm:ss",hideDisabledOptions:!0}},model:{value:e.checkQueryParam.checkTime,callback:function(t){e.$set(e.checkQueryParam,"checkTime",t)},expression:"checkQueryParam.checkTime"}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"结果描述"}},[t("a-textarea",{attrs:{"auto-size":{minRows:8,maxRows:8}},model:{value:e.checkQueryParam.checkDesc,callback:function(t){e.$set(e.checkQueryParam,"checkDesc",t)},expression:"checkQueryParam.checkDesc"}})],1)],1)],1),t("rectify-modal",{ref:"modalForm"}),t("WorkTimeModal",{ref:"workTimeModal",on:{ok:function(t){return e.findList()}}})],1)},o=[],i=a("5315"),n=a("7b165"),l=a("b9c3"),s=a("8fad"),c=a("c1df"),u=a.n(c);function d(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var s=r&&r.prototype instanceof l?r:l,c=Object.create(s.prototype);return f(c,"_invoke",function(a,r,o){var i,l,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,s=e,f.n=a,n}};function h(a,r){for(l=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,l=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(t=l<2?e:s)||!d;){i||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==n)break}catch(t){i=e,l=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function l(){}function s(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(f(t={},r,(function(){return this})),t),h=c.prototype=l.prototype=Object.create(u);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,f(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return s.prototype=c,f(h,"constructor",c),f(c,"constructor",s),s.displayName="GeneratorFunction",f(c,o,"GeneratorFunction"),f(h),f(h,o,"Generator"),f(h,r,(function(){return this})),f(h,"toString",(function(){return"[object Generator]"})),(d=function(){return{w:i,m:m}})()}function f(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}f=function(e,t,a,r){function i(t,a){f(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},f(e,t,a,r)}function h(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function m(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){h(i,r,o,n,l,"next",e)}function l(e){h(i,r,o,n,l,"throw",e)}n(void 0)}))}}var p={name:"TaskCheckForm",components:{WorkTimeModal:n["default"],RectifyModal:i["default"]},props:{taskFormsList:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},workOrderInfo:{type:Object,default:function(){}},forms:{type:Array,default:function(){return[]}},modalType:{type:Number,default:0}},computed:{isSelectDetaile:function(){return 1===this.modalType}},mounted:function(){},data:function(){return{visible:!1,confirmLoading:!1,form:this.$form.createForm(this),labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:20}},labelCol2:{xs:{span:24},sm:{span:6}},wrapperCol2:{xs:{span:24},sm:{span:16}},validatorRules:{checkUserName:{rules:[{required:!0,message:"请输入登录名称!"}]},checkUserPwd:{rules:[{required:!0,message:"请输入密码!"}]},checkMethod:{rules:[{required:!0,message:"请选择!"}]}},tableData:[],queryParam:{formInstId:"",task2InstId:""},checkQueryParam:{checkUserName:"",checkUserPwd:"",itemIds:"",checkResult:1,checkDesc:"",checkMethod:null,checkTime:void 0},checkResult:!0}},methods:{findList:function(){var e=m(d().m((function e(t,a){var r=this;return d().w((function(e){while(1)switch(e.n){case 0:return a&&(this.queryParam.formInstId=a),t&&(this.queryParam.task2InstId=t),e.a(2,Object(l["s"])(this.queryParam).then((function(e){return e.success?r.tableData=e.result.sort((function(e,t){return e.sortNo-t.sortNo})):(r.$message.error(e.message),[])})))}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),findModelDetaile:function(e){var t=this;Object(s["ic"])({id:e.formObjId}).then((function(e){e.success?t.tableData=e.result.itemList.sort((function(e,t){return e.sortNo-t.sortNo})):t.$message.error(e.message)}))},setCheckRecordTime:function(){var e=this.$refs.listTable.getCheckboxRecords().map((function(e){return e.id}));e.length?this.$refs.workTimeModal.show(e):this.$message.warn("请选择作业项目")},openSetCheck:function(){var e=m(d().m((function e(){var t,a,r=this;return d().w((function(e){while(1)switch(e.n){case 0:return e.n=1,this.checkTaskCanSubmit(1);case 1:if(t=e.v,t.success){e.n=2;break}return this.$message.warn("".concat(t.formsName,"未完成，请检查！")),this.tabFormKey=this.taskFormsList.findIndex((function(e){return e==t.checkFomrs[0]})),this.$emit("taskFormNoWork",this.tabFormKey),e.a(2);case 2:a=this.$refs.listTable.getCheckboxRecords().map((function(e){return e.id})),a.length?(this.visible=!0,this.checkQueryParam.checkUserName="",this.checkQueryParam.checkUserPwd="",this.checkQueryParam.itemIds=a.join(","),this.checkQueryParam.checkResult=1,this.checkQueryParam.checkDesc="",this.checkQueryParam.type=null,this.isIgnore=!1,this.resultCheck=!0,this.$nextTick((function(){r.form.getFieldDecorator("resultDesc"),r.form.setFieldsValue({checkUserName:r.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~",checkDesc:"",type:null})}))):this.$message.warn("请选择作业项目");case 3:return e.a(2)}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleOk:function(){var e=this;this.form.validateFields((function(t,a){t||(Object.assign(e.checkQueryParam,a),e.checkQueryParam.checkResult=e.checkResult?1:0,e.checkQueryParam.checkTime?e.checkQueryParam.checkTime=u()(e.checkQueryParam.checkTime).format("YYYY-MM-DD HH:mm:ss"):e.checkQueryParam.checkTime=null,Object(l["Z"])(e.checkQueryParam).then((function(t){t.success?(e.$message.success("保存成功"),e.visible=!1,e.findList(),e.$emit("checkEnd")):e.$message.error(t.message)})))}))},handleCancel:function(){this.visible=!1},useCurrentUser:function(){var e=this;this.$nextTick((function(){e.form.setFieldsValue({checkUserName:e.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~"})}))},openRectifyModal:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords().map((function(e){return e.content}));t.length?Object(s["Kb"])({moduleCode:"JDXZG"}).then((function(a){a.success?(e.$refs.modalForm.addByRow({orderId:e.selectTask.orderId,orderName:e.workOrderInfo.orderName,depotId:e.workOrderInfo.depotId,orderTaskId:e.selectTask.id,remark:t.join(","),rectifyNo:a.result,groupId:e.workOrderInfo.groupId,lineId:e.workOrderInfo.lineId,lineName:e.workOrderInfo.lineName,trainNo:e.workOrderInfo.trainNo,groupName:e.workOrderInfo.groupName,status:"0"}),e.$refs.modalForm.title="新增"):e.$message.error(a.message)})):this.$message.warn("请选择作业项目")},onIgnoreChange:function(){var e=this;this.$nextTick((function(){e.form.resetFields("resultDesc")}))},checkTaskCanSubmit:function(){var e=m(d().m((function e(){var t,a,r,o=this,i=arguments;return d().w((function(e){while(1)switch(e.n){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:1,!0,a={success:!0,forms:[],records:[],checkFomrs:[]},r=[],0===this.selectTask.outTask&&(1===this.selectTask.taskType||3===this.selectTask.taskType||4===this.selectTask.taskType||5===this.selectTask.taskType)){e.n=1;break}return e.a(2,a);case 1:return this.taskFormsList.forEach((function(e){3===e.instType&&1===t&&r.push(Object(l["R"])({task2InstId:e.id,formInstId:e.formInstId,needCategory:!1,needChecks:!0,orderTaskId:o.selectTask.id}).then((function(e){return e.success&&e.result?(a.forms.push(e.result),e.result.detailList):(o.$message.error("获取表单作业明细失败"),[])}))),4===e.instType&&2===t&&r.push(Object(l["s"])({task2InstId:e.id,formInstId:e.formInstId}).then((function(e){return a.forms.push(e.element),e.success&&e.result?e.result:(o.$message.error("获取表单作业明细失败"),[])})))})),e.a(2,Promise.all(r).then((function(e){return e.forEach((function(e){if(1===t){for(var r=0;r<e.length;r++){var i=e[r];i.isIgnore&&1===i.isIgnore||i.selfCheck&&i.monitorCheck&&i.guarderCheck||(a.success=!1,!1,a.records.push(i))}if(a.forms.length>0){var n=[];a.records.forEach((function(e){n.find((function(t){return t.formInstId===e.workRecordId}))||n.push(o.taskFormsList.find((function(t){return t.formInstId===e.workRecordId})))})),a.checkFomrs=n,a.formsName=n.map((function(e){return"《".concat(e.formName,"》")})).toString()}}if(2===t){for(var l=0;l<e.length;l++){var s=e[l];s.checkUserId&&s.workTime||(a.success=!1,!1,a.records.push(s))}if(a.records.length>0){var c=[];a.records.forEach((function(e){c.find((function(t){return t.formInstId===e.checkId}))||c.push(o.taskFormsList.find((function(t){return t.formInstId===e.checkId})))})),a.checkFomrs=c,a.formsName=c.map((function(e){return"《".concat(e.formName,"》")})).toString()}}})),a})))}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getIDRecords:function(){return this.$refs.listTable.getCheckboxRecords().map((function(e){return e.id})).toString()}}},b=p,g=a("2877"),v=Object(g["a"])(b,r,o,!1,null,null,null);t["default"]=v.exports},"3ff1":function(e,t,a){},"412f":function(e,t,a){},4227:function(e,t,a){},4501:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"作业指导书",width:"100%",dialogClass:"fullDialog no-footer",visible:e.visible,footer:null},on:{cancel:e.handleCancel}},[t("div",{staticClass:"sop-body"},[t("div",{staticStyle:{display:"flex","align-content":"center","flex-wrap":"wrap"}},[e.loading?t("a-spin",{attrs:{tip:"下载中..."}}):e._e()],1),e.loading?e._e():t("div",{ref:"mainDom",staticClass:"sop-body-page"})])])},o=[],i=a("8fad"),n={name:"WorkSopView",components:{},data:function(){return{visible:!1,tableData:[],queryParam:{bookId:""},loading:!1}},created:function(){},methods:{findList:function(){},handleCancel:function(){this.visible=!1},showBook:function(e){var t=this;this.visible=!0,this.loading=!0,Object(i["Mb"])({bookId:e}).then((function(e){if(e.success){var a=[];e.result.forEach((function(e){a.push(Object(i["Nb"])({detailId:e.id}).then((function(e){if(e.success){var a=JSON.parse(JSON.stringify(e.result));return a}return t.$message.error(e.message),null})))})),Promise.all(a).then((function(e){e.sort((function(e,t){return e.stepNum-t.stepNum}));var a="";e.forEach((function(e){e&&(a+="<h2>".concat(e.stepNum,'<span style="margin-left:15px;margin-top: 24px;">').concat(e.stepTitle,"</span></h2>"),a+=e.stepContent||"")})),t.loading=!1,t.$nextTick.call(t,(function(){t.$refs.mainDom.innerHTML=a}))}))}}))},showSopDetail:function(e){var t=this;this.visible=!0;var a=[];e.forEach((function(e){a.push(Object(i["Nb"])({detailId:e}).then((function(e){return e.success?e.result:""})))})),Promise.all(a).then((function(e){var a="";e.forEach((function(e){a+="<h2>".concat(e.stepNum,'<span style="margin-left:15px;">').concat(e.stepTitle,"</span></h2>"),a+=e.stepContent})),t.$refs.mainDom.innerHTML=a}))}}},l=n,s=(a("a9f9"),a("bca7"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"7e7655fc",null);t["default"]=c.exports},"45ff":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"calcHeight"})},o=[],i=a("e8ae"),n=a("21a6"),l=a("8fad"),s="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",c={name:"TableExport",data:function(){return{}},mounted:function(){},methods:{printById:function(e){var t=this;Object(l["xb"])({id:e}).then((function(e){e.success?t.initWorkBook(e.result):t.$message.error("获取记录表详情失败")})).catch((function(e){t.$message.error("获取记录表详情异常")}))},printByData:function(e){this.initWorkBook(e)},initWorkBook:function(e){var t=new i["Workbook"];t.creator="GY",t.lastModifiedBy="2021-10-28",t.created=new Date,t.modified=new Date,t.lastPrinted=new Date;var a=t.addWorksheet("Sheet1",{properties:{defaultColWidth:22,alignment:{vertical:"middle",horizontal:"left",wrapText:!0}},pageSetup:{paperSize:9}}),r=[];a.mergeCells("A1:C1"),a.getCell("A1").value="车号："+(e.trainNo||""),r.push({cell:"A1",horizontal:"left",fill:!0,size:14,bold:!0}),0===e.updown?(a.mergeCells("A2:C2"),a.getCell("A2").value="部件号："+(e.manufNo||""),r.push({cell:"A2",horizontal:"left",fill:!0,size:14,bold:!0})):1===e.updown?(a.mergeCells("A2:C2"),a.getCell("A2").value="原部件序列号："+(e.manufNo||""),r.push({cell:"A2",horizontal:"left",fill:!0,size:14,bold:!0}),a.mergeCells("A3:C3"),a.getCell("A3").value="新部件序列号："+(e.manufNoUp||""),r.push({cell:"A3",horizontal:"left",fill:!0,size:14,bold:!0})):a.mergeCells("A1:C2"),1===e.updown?a.mergeCells("D1:F3"):a.mergeCells("D1:F2"),a.getCell("D1").value=e.title||e.workRecName||"",r.push({cell:"D1",fill:!0,size:14,bold:!0}),a.mergeCells("G1:H1"),a.getCell("G1").value="作业日期："+(e.workDate||""),r.push({cell:"G1",fill:!0,horizontal:"left",size:14,bold:!0}),a.mergeCells("I1:J1"),a.getCell("I1").value="完工日期："+(e.finishDate||""),r.push({cell:"I1",fill:!0,horizontal:"left",size:14,bold:!0}),1===e.updown?a.mergeCells("G2:J3"):a.mergeCells("G2:J2"),a.getCell("G2").value="作业班组："+(e.workGroupName||""),r.push({cell:"G2",fill:!0,horizontal:"left",size:14,bold:!0}),a.getColumn("A").width=15,a.getColumn("B").width=30,a.getColumn("C").width=60,a.getColumn("D").width=15,a.getColumn("E").width=60,a.getColumn("F").width=60,a.getRow(1).height=30,a.getRow(2).height=30,a.getRow(3).height=30,1===e.updown&&(a.getRow(4).height=30);var o={A:"序号",B:"项目",C:"作业内容",D:"控制点",E:"技术要求",F:"作业情况",G:"结果",H:"自检",I:"互检",J:"专检"};for(var l in o)a.getCell(l+(1===e.updown?4:3)).value=o[l],r.push({cell:l+(1===e.updown?4:3),fill:!0,size:14,bold:!0});var c=1===e.updown?5:4,u=0;e.categoryList.forEach((function(e,t){a.getCell("A".concat(c+t)).value=e.recIndex,r.push({cell:"A".concat(c+t)}),a.mergeCells("A".concat(c+t,":A").concat(c+t+e.detailList.length-1)),a.getCell("B".concat(c+t)).value=e.reguTitle,r.push({cell:"B".concat(c+t),horizontal:"left"}),a.mergeCells("B".concat(c+t,":B").concat(c+t+e.detailList.length-1)),e.detailList.forEach((function(e,o){a.getCell("C".concat(c+t+o)).value="\n".concat(e.workContent||"","\n"),r.push({cell:"C".concat(c+t+o),horizontal:"left"}),a.getCell("D".concat(c+t+o)).value=e.checkLevel_dictText||"",r.push({cell:"D".concat(c+t+o)}),a.getCell("E".concat(c+t+o)).value="\n".concat(e.techRequire||"","\n"),r.push({cell:"E".concat(c+t+o),horizontal:"left"}),a.getCell("F".concat(c+t+o)).value=0==e.isIgnore?e.workInfo:e.ignoreDesc,r.push({cell:"F".concat(c+t+o),horizontal:"left"}),a.getCell("G".concat(c+t+o)).value=e.result?"√":"□",r.push({cell:"G".concat(c+t+o)}),a.getCell("H".concat(c+t+o)).value=e.selfCheck||"",r.push({cell:"H".concat(c+t+o)}),a.getCell("I".concat(c+t+o)).value=e.guarderCheck||"",r.push({cell:"I".concat(c+t+o)}),a.getCell("J".concat(c+t+o)).value=e.monitorCheck||"",r.push({cell:"J".concat(c+t+o)})})),c+=e.detailList.length-1,u+=e.detailList.length})),u+=1===e.updown?5:4,a.mergeCells("A".concat(u,":J").concat(u)),a.getRow(u).height=30,r.push({cell:"A".concat(u),bold:!0}),u+=1;var d=e.measureToolList||[];d.length&&(a.mergeCells("A".concat(u,":B").concat(u+d.length-1)),a.getCell("A".concat(u)).value="计量器具使用",r.push({cell:"A".concat(u)}),d.forEach((function(e,t,o){a.mergeCells("C".concat(u+t,":D").concat(u+t)),a.getCell("C".concat(u+t)).value=" \n名称："+(e.name||"")+"\n",r.push({cell:"C".concat(u+t),horizontal:"left"}),a.getCell("E".concat(u+t)).value=" \n规格型号："+(e.model||"")+"\n",r.push({cell:"E".concat(u+t),horizontal:"left"}),a.getCell("F".concat(u+t)).value=" \n出厂编号："+(e.serialNo||"")+"\n",r.push({cell:"F".concat(u+t),horizontal:"left"}),a.mergeCells("G".concat(u+t,":H").concat(u+t)),a.getCell("G".concat(u+t)).value=" \n上次检验时间："+(e.lastCheckTime||"")+"\n",r.push({cell:"G".concat(u+t),horizontal:"left"}),a.mergeCells("I".concat(u+t,":J").concat(u+t)),a.getCell("I".concat(u+t)).value=" \n下次检验时间："+(e.nextCheckTime||"")+"\n",r.push({cell:"I".concat(u+t),horizontal:"left"})})),u+=d.length,a.mergeCells("A".concat(u,":J").concat(u)),a.getRow(u).height=30,r.push({cell:"A".concat(u),bold:!0}),u+=1);var f=["控制点分为H点和W点，“H”点为该项工序操作过程必须经过专业工程师现场检查确认的工序，“W”点为班组长可在工序完工后确认的工序。","“自检”栏为作业者本人进行签字；“互检”栏由作业监护人员进行检查签字；“专检”栏由班组长进行检查签字。“质量负责人”由相关专业工程师进行签字。","“作业情况”需根据实际情况填写。若该项工序无异常则由作业者在框中填入√；若该项工序存在异常，则将实际故障情况填入框内。","“结果”栏方框在完成该项作业及检查后，由工班长进行填写。若无异常则在方框内填入√，若有异常，工班长需对故障情况进行确认，在方框内填入×，并将故障在“备注”栏进行汇总。","作业内容中有数据要求的一并填入“作业情况”栏。"];a.mergeCells("A".concat(u,":J").concat(u));var h="";f.forEach((function(e,t,a){h+="".concat(t+1,"、").concat(e).concat(t<a.length-1?"\n":"")})),h="说明：\n"+h+"\n",h="\n检查结果：".concat(0===e.checkResult?"未通过":"通过","                                        检查日期：").concat(e.checkDate||"            ","                                        质量负责人：").concat(e.checkUserName||"            ","\n\n")+h,a.getCell("A".concat(u)).value=h,r.push({cell:"A".concat(u),horizontal:"left",border:top});var m=12*(f.length+4)+18;a.getRow(u).height=m,r.forEach((function(e,t,r){var o=a.getCell(e.cell);o.alignment={vertical:"middle",horizontal:e.horizontal||"center",wrapText:!0},e.fill&&(o.fill={type:"pattern",pattern:"darkGray",fgColor:{argb:"FFe9e9e9"}}),o.font={name:"黑体",family:4,size:e.size||12,underline:!1,bold:e.bold||!1},o.padding={top:10,left:10,bottom:10,right:10},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})),t.xlsx.writeBuffer().then((function(t){var a=new Blob([t],{type:s});n["saveAs"](a,"".concat(e.title||e.workRecName,".xlsx"))}))}}},u=c,d=a("2877"),f=Object(d["a"])(u,r,o,!1,null,"dac1198a",null);t["default"]=f.exports},4677:function(e,t,a){"use strict";a("412f")},4681:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:"90%",visible:e.visible,confirmLoading:e.confirmLoading,centered:"",cancelText:"关闭",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[4===e.formObj.instType?t("div",{staticStyle:{height:"100%"},attrs:{"layout-flex":""}},[t("TaskCheckForm",{ref:"checkForm",attrs:{taskFormsList:e.taskFormItemList,modalType:1,"flex-full":""},on:{taskFormNoWork:e.onTaskFormNoWork}})],1):e._e(),3===e.formObj.instType?t("div",{staticStyle:{height:"100%"},attrs:{"layout-flex":""}},[t("div",{attrs:{"flex-full":""}},[t("vxe-table",{ref:"recordListTable",attrs:{stripe:!0,border:"","auto-resize":"","max-height":"100%","row-id":"id",align:"center",data:e.taskFormItemList,"show-overflow":"tooltip","span-method":e.mergeRowMethod,"checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{type:"index",title:"序号",align:"center",width:"60"}}),t("vxe-table-column",{attrs:{field:"reguTitle",title:"作业项目",align:"left","header-align":"center",width:"240"}}),t("vxe-table-column",{attrs:{field:"workContent",title:"检修内容",align:"left"}})],1)],1)]):e._e(),t("check-modal",{ref:"checkModalForm",attrs:{title:e.checkModalTitle},on:{ok:e.onCheckRecord}}),t("BreakdownModal",{ref:"breakdownModal",attrs:{showWorkStation:!0}})],1)},o=[],i=a("8fad"),n=a("3fdc"),l=a("d0f9"),s=(a("b9c3"),a("b47d")),c=a("ab7d");function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var s=r&&r.prototype instanceof l?r:l,c=Object.create(s.prototype);return f(c,"_invoke",function(a,r,o){var i,l,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,s=e,f.n=a,n}};function h(a,r){for(l=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,l=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(t=l<2?e:s)||!d;){i||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==n)break}catch(t){i=e,l=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function l(){}function s(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(f(t={},r,(function(){return this})),t),h=c.prototype=l.prototype=Object.create(u);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,f(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return s.prototype=c,f(h,"constructor",c),f(c,"constructor",s),s.displayName="GeneratorFunction",f(c,o,"GeneratorFunction"),f(h),f(h,o,"Generator"),f(h,r,(function(){return this})),f(h,"toString",(function(){return"[object Generator]"})),(d=function(){return{w:i,m:m}})()}function f(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}f=function(e,t,a,r){function i(t,a){f(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},f(e,t,a,r)}function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return(t=b(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function b(e){var t=g(e,"string");return"symbol"==u(t)?t:t+""}function g(e,t){if("object"!=u(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function v(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function y(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){v(i,r,o,n,l,"next",e)}function l(e){v(i,r,o,n,l,"throw",e)}n(void 0)}))}}function k(e){return C(e)||x(e)||T(e)||w()}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){if(e){if("string"==typeof e)return S(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?S(e,t):void 0}}function x(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function C(e){if(Array.isArray(e))return S(e)}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var I={name:"TaskFormDetaileModal",components:{TaskCheckForm:n["default"],checkModal:l["default"],BreakdownModal:c["default"]},props:{taskForms:{type:Array,default:function(){return[]}},workOrderInfo:{type:Object,default:function(){return{}}}},data:function(){return{title:"填写明细",createFaultLoading:!1,switchCheck:!0,visible:!1,confirmLoading:!1,model:{},taskFormItemList:[],formObj:{},checkModalTitle:"自检"}},methods:{add:function(){this.edit({})},showModal:function(e){var t=this;this.formObj=e,this.taskFormItemList=[],this.visible=!0,this.$nextTick((function(){3===e.instType?t.loadRecordFormDetail():4===e.instType&&t.$refs.checkForm.findModelDetaile(e)}))},handleOk:function(){var e="";3===this.formObj.instType?e=this.$refs.recordListTable.getCheckboxRecords().map((function(e){return e.id})).toString():4===this.formObj.instType&&(e=this.$refs.checkForm.getIDRecords()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},onTaskFormNoWork:function(e){},loadRecordFormDetail:function(){var e=this;this.formObj.formInstId,this.formObj.id;Object(i["xb"])({id:this.formObj.formObjId}).then((function(t){var a=[];t.result.categoryList.forEach((function(e){a=[].concat(k(a),k(e.detailList.map((function(t){return t.reguTitle=e.reguTitle,t.recIndex=e.recIndex,t.workRecId=e.workRecId,t}))))})),e.taskFormItemList=a,e.$nextTick((function(){if(e.formObj.recordIds&&e.formObj.recordIds.length){var t=e.formObj.recordIds.split(",");e.$refs.recordListTable.setCheckboxRow(e.taskFormItemList.filter((function(e){return t.find((function(t){return t===e.id}))})),!0)}}))}))},mergeRowMethod:function(e){var t=e.row,a=e._rowIndex,r=e.column,o=e.visibleData,i=["reguTitle"],n=t[r.property];if(n&&i.includes(r.property)){var l=o[a-1],s=o[a+1];if(l&&l[r.property]===n)return{rowspan:0,colspan:0};var c=1;while(s&&s[r.property]===n)s=o[++c+a];if(c>1)return{rowspan:c,colspan:1}}},handleCheck:function(e,t){var a=this.$refs.recordListTable.getCheckboxRecords();if(a.length>0){var r=a.map((function(e,t){return e.id})).join(",");this.checkModalTitle=t,this.$refs.checkModalForm.showModal(r,e)}else this.$message.error("请选择要检查的作业记录明细!")},onCheckRecord:function(e){e.saveSuccess&&this.loadRecordFormDetail()},handleMenuClick:function(e){var t=this,a=e.key,r=this.$refs.recordListTable.getCheckboxRecords();if(r.length>0){var o=r.map((function(e,t){return e.id})).join(",");Object(s["C"])("ids=".concat(o,"&checkType=").concat(a)).then((function(e){e.success?(t.$message.success("清除成功"),t.loadRecordFormDetail()):t.$message.warning(e.message)}))}else this.$message.error("请选择要检查的作业记录明细!")},createFault:function(){var e=this;y(d().m((function t(){var a;return d().w((function(t){while(1)switch(t.n){case 0:e.$refs.breakdownModal.setWorkStations(e.workOrderInfo.staffArranges),a={},e.workOrderInfo.planId&&(a={planName:e.workOrderInfo.planName,planId:e.workOrderInfo.planId,lineId:e.workOrderInfo.lineId,trainNo:e.workOrderInfo.trainNo}),e.$refs.breakdownModal.edit(m({workOrderId:e.workOrderInfo.orderId,formType:2,createType:2,happenTime:e.$moment().format("YYYY-MM-DD"),faultDesc:"",phase:1,status:1},a));case 1:return t.a(2)}}),t)})))()}}},_=I,N=(a("2d1c"),a("2877")),O=Object(N["a"])(_,r,o,!1,null,"adebf282",null);t["default"]=O.exports},4734:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("j-modal",{attrs:{title:e.title,centered:"",width:800,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",fullscreen:"",destroyOnClose:!0,footer:null},on:{cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[e.taskInfo?t("a-form-model",{ref:"form",attrs:{model:e.taskInfo}},[t("a-row",{staticStyle:{width:"100%"}},[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"上级任务",prop:"ParentId"}},[t("a-input",{attrs:{disabled:""},model:{value:e.taskInfo.ParentName,callback:function(t){e.$set(e.taskInfo,"ParentName",t)},expression:"taskInfo.ParentName"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"是否生成工单",prop:"genOrder"}},[t("a-switch",{attrs:{value:!!e.taskInfo.genOrder,disabled:""}})],1)],1),t("a-col",{attrs:{span:4}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"是否委外",prop:"outsource"}},[t("a-switch",{attrs:{value:!!e.taskInfo.outsource,disabled:""}})],1)],1),t("a-col",{attrs:{span:4}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"重要任务",prop:"important"}},[t("a-switch",{attrs:{value:!!e.taskInfo.important,disabled:""}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"任务名称",prop:"taskName"}},[t("a-input",{attrs:{disabled:""},model:{value:e.taskInfo.taskName,callback:function(t){e.$set(e.taskInfo,"taskName",t)},expression:"taskInfo.taskName"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"作业手段",prop:"method"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_regu_method",disabled:""},model:{value:e.taskInfo.method,callback:function(t){e.$set(e.taskInfo,"method",t)},expression:"taskInfo.method"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆停靠",prop:"trackId"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_mtr_track,name,id,status=1",disabled:""},model:{value:e.taskInfo.trackId,callback:function(t){e.$set(e.taskInfo,"trackId",t)},expression:"taskInfo.trackId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"关联系统",prop:"systemId"}},[t("a-input",{attrs:{disabled:""},model:{value:e.taskInfo.systemName,callback:function(t){e.$set(e.taskInfo,"systemName",t)},expression:"taskInfo.systemName"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"关联设备",prop:"assetTypeId"}},[t("a-select",{ref:"assetType",attrs:{placeholder:"请选择关联设备",open:!1,disabled:""},model:{value:e.taskInfo.assetTypeName,callback:function(t){e.$set(e.taskInfo,"assetTypeName",t)},expression:"taskInfo.assetTypeName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所需工时",prop:"workTime"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,disabled:""},model:{value:e.taskInfo.workTime,callback:function(t){e.$set(e.taskInfo,"workTime",t)},expression:"taskInfo.workTime"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"开始日期",prop:"startTime"}},[t("a-input",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:e.taskInfo.startTime,callback:function(t){e.$set(e.taskInfo,"startTime",t)},expression:"taskInfo.startTime"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"结束日期",prop:"finishTime"}},[t("a-input",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:e.taskInfo.finishTime,callback:function(t){e.$set(e.taskInfo,"finishTime",t)},expression:"taskInfo.finishTime"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"工期",prop:"taskDuration"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{disabled:!0,min:0},model:{value:e.taskInfo.taskDuration,callback:function(t){e.$set(e.taskInfo,"taskDuration",t)},expression:"taskInfo.taskDuration"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"作业工班",prop:"workGroupId"}},[t("j-dict-select-tag",{attrs:{dictCode:"sys_depart,depart_name,id,org_category=4",triggerChange:!0,disabled:""},model:{value:e.taskInfo.workGroupId,callback:function(t){e.$set(e.taskInfo,"workGroupId",t)},expression:"taskInfo.workGroupId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"作业工位"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",labelInValue:"",disabled:""},model:{value:e.workStation,callback:function(t){e.workStation=t},expression:"workStation"}},e._l(e.workStationList,(function(a){return t("a-select-option",{key:a.id,attrs:{title:a.name}},[e._v(e._s(a.name))])})),1)],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"第几天",prop:"dayIndex"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{disabled:!0,min:0},model:{value:e.taskInfo.dayIndex,callback:function(t){e.$set(e.taskInfo,"dayIndex",t)},expression:"taskInfo.dayIndex"}})],1)],1),t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"任务描述",prop:"remark"}},[t("a-textarea",{attrs:{placeholder:"请输入内容",disabled:""},model:{value:e.taskInfo.remark,callback:function(t){e.$set(e.taskInfo,"remark",t)},expression:"taskInfo.remark"}})],1)],1),t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"安全预想",prop:"remark"}},[t("div",{domProps:{innerHTML:e._s(e.taskInfo.safeNotice)}})])],1)],1)],1):e._e()],1)],1)},o=[],i=a("3bcd");function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,t,a){return(t=s(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e){var t=c(e,"string");return"symbol"==n(t)?t:t+""}function c(e,t){if("object"!=n(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var u={name:"ViewPlanTaskItemModal",components:{},data:function(){return l(l(l(l(l({title:"操作",visible:!1,taskInfo:{},workStationList:[],workStation:[],labelCol:{xs:{span:24},sm:{span:5}}},"labelCol",{xs:{span:24},sm:{span:6}}),"wrapperCol",{xs:{span:24},sm:{span:18}}),"labelCol1",{xs:{span:24},sm:{span:2}}),"wrapperCol1",{xs:{span:24},sm:{span:22}}),"confirmLoading",!1)},methods:{view:function(e){var t=this,a=this;this.visible=!0,this.confirmLoading=!0,Object(i["I"])(e.taskObjId).then((function(r){t.workStation=[],r.success&&(t.taskInfo=r.result,t.taskInfo.safeNotice=e.safeNotice,t.workStationList=r.result.workstations,t.workStationList.forEach((function(e){a.workStation.push({key:e.id,label:e.name})}))),t.confirmLoading=!1}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},d=u,f=a("2877"),h=Object(f["a"])(d,r,o,!1,null,null,null);t["default"]=h.exports},"4a51":function(e,t,a){"use strict";a("612d")},"4b54":function(e,t,a){},"4e0a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:"车辆设备选择",centered:"",visible:e.visible,bodyStyle:{height:"80vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:8}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{attrs:{placeholder:"名称或编码","allow-clear":""},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:9,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)])],1)],1)],1),t("div",{staticClass:"tableHeight",staticStyle:{height:"calc(80vh - 85px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 85px)"},attrs:{border:"","row-id":"id",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","max-height":"100%","radio-config":{trigger:e.multiple?"default":"row",highlight:!0,checkMethod:e.checkRadioMethod},"checkbox-config":{trigger:e.multiple?"row":"default",highlight:!0,checkStrictly:!0,checkMethod:e.checkRadioMethod},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称","tree-node":"",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"code",title:"编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"structType_dictText",title:"类型",width:"120"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"placeId",title:"位置编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"placeDesc",title:"位置描述",width:"200",align:"left","header-align":"center"}})],1)],1)])},o=[],i=a("8fad"),n={name:"TrainStructureList",props:{multiple:{type:Boolean,default:!1},canSelectType:{type:Array,default:function(){return[1,2,3,4]}},lineId:{type:String,default:""}},data:function(){return{visible:!1,queryParam:{id:"",searchText:"",status:null,trainStructId:""},selectParent:{},labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:19}},allAlign:"center",tableData:[],trainStructId:""}},methods:{showModal:function(e){this.queryParam.trainStructId=e,this.queryParam.lineId=this.lineId,this.trainStructId=e,this.visible=!0,this.findList()},findList:function(){var e=this;Object(i["bc"])(this.queryParam).then((function(t){t.success&&(e.tableData=t.result)}))},loadChildrenMethod:function(e){var t=this,a=e.row,r={trainStructId:this.trainStructId,id:a.id};return new Promise((function(e){Object(i["bc"])(r).then((function(a){a.success?e(a.result):t.$message.error("".concat(a.msg))}))}))},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},checkRadioMethod:function(e){var t=e.row;return this.canSelectType.indexOf(t.structType)>-1}}},l=n,s=a("2877"),c=Object(s["a"])(l,r,o,!1,null,"5f613a8e",null);t["default"]=c.exports},"4fe7e":function(e,t,a){},5126:function(e,t,a){},"51c5":function(e,t,a){"use strict";a("e9d9")},"51cf":function(e,t,a){},"52d1":function(e,t,a){},5315:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("j-modal",{attrs:{title:e.title,centered:"",width:1100,visible:e.visible,confirmLoading:e.confirmLoading,fullscreen:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("div",{staticStyle:{width:"100%",overflow:"hidden"}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:23,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"任务名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["title",e.validatorRules.title],expression:"['title', validatorRules.title]",modifiers:{trim:!0}}],attrs:{allowClear:"",placeholder:"请输入"}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"编码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["rectifyNo",e.validatorRules.rectifyNo],expression:"['rectifyNo', validatorRules.rectifyNo]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改类型"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["rectifyType",e.validatorRules.rectifyType],expression:"['rectifyType', validatorRules.rectifyType]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_work_rectify_type"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"下发日期",width:"40"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["sendDate",e.validatorRules.sendDate],expression:"['sendDate', validatorRules.sendDate]",modifiers:{trim:!0}}],staticStyle:{width:"100%"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"责任班组"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["groupId",e.validatorRules.groupId],expression:"['groupId', validatorRules.groupId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictGroupStr},on:{change:e.changeGroup}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改状态"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["status",e.validatorRules.status],expression:"['status', validatorRules.status]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_work_rectify_status"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆段"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["depotId",e.validatorRules.depotId],expression:"['depotId', validatorRules.depotId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_mtr_depot,name,id"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路"}},[t("line-select-list",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId",e.validatorRules.lineId],expression:"['lineId', validatorRules.lineId]"}],on:{change:e.lineIdChange}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属车辆"}},[t("j-dict-select-seach-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["trainNo",e.validatorRules.trainNo],expression:"['trainNo', validatorRules.trainNo]"}],attrs:{triggerChange:"",dictCode:e.dictTrainStr}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"关联工单"}},[t("span",{on:{click:e.openOrderModel}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderName",e.validatorRules.orderName],expression:"['orderName', validatorRules.orderName]",modifiers:{trim:!0}}],ref:"myOrderSelect",attrs:{"allow-clear":"",placeholder:"请选择工单",open:!1,showArrow:!0},on:{change:e.orderNameChange}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改工位"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workstationId",e.validatorRules.workstationId],expression:"['workstationId', validatorRules.workstationId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictCodeStr}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改工序"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderTaskId",e.validatorRules.orderTaskId],expression:"['orderTaskId', validatorRules.orderTaskId]",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictCodeStrOrder}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:23,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"备注说明"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["remark",e.validatorRules.remark],expression:"['remark', validatorRules.remark]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入"}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:23,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"附件"}},[t("DocUpload",{ref:"upload",attrs:{"default-file-list":e.defaultFileList,"show-upload":!1,isFileEmpty:!0},on:{setBforeUploadStatus:e.setBforeUploadStatus,uploaded:e.successUploadFile,removed:e.onRemoveFile,uploadFail:e.uploadFail,setUpLoadingEndStatus:e.setUpLoadingEndStatus}})],1)],1)],1),t("a-divider",{staticStyle:{"font-size":"14px"},attrs:{orientation:"left"}},[e._v("已上传列表")]),t("vxe-table",{staticStyle:{"margin-top":"12px"},attrs:{border:"",data:e.annexList,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"}}},[t("div",{}),t("vxe-table-column",{attrs:{type:"seq",title:"序号",width:"50px","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"title",title:"文件名","header-align":"left",align:"left"}}),t("vxe-table-column",{attrs:{title:"操作",width:"160px","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row,o=a.rowIndex;return[t("a",{staticStyle:{"margin-right":"12px"},on:{click:function(t){return t.stopPropagation(),e.handleSeeing(r)}}},[e._v("查看")]),t("a",{on:{click:function(t){return t.stopPropagation(),e.handleDelete(r,o)}}},[e._v("删除")])]}}])})],1),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}})],1)],1)]),t("user-list",{ref:"UserModalForm",attrs:{multiple:!0},on:{ok:e.addTarget}}),t("work-order-select",{ref:"orderSelect",attrs:{"order-status":[2]},on:{ok:e.onSelectOrder}})],1)},o=[],i=a("b245"),n=a("c1df"),l=a.n(n),s=a("b7b4"),c=a("8fad"),u=a("ca00"),d=a("5371"),f=a("353a"),h=a("5633"),m=a("673e");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var s=r&&r.prototype instanceof l?r:l,c=Object.create(s.prototype);return b(c,"_invoke",function(a,r,o){var i,l,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,s=e,f.n=a,n}};function h(a,r){for(l=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,l=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(t=l<2?e:s)||!d;){i||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==n)break}catch(t){i=e,l=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function l(){}function s(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(b(t={},r,(function(){return this})),t),d=c.prototype=l.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,b(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=c,b(d,"constructor",c),b(c,"constructor",s),s.displayName="GeneratorFunction",b(c,o,"GeneratorFunction"),b(d),b(d,o,"Generator"),b(d,r,(function(){return this})),b(d,"toString",(function(){return"[object Generator]"})),(p=function(){return{w:i,m:f}})()}function b(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}b=function(e,t,a,r){function i(t,a){b(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},b(e,t,a,r)}function g(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function v(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){g(i,r,o,n,l,"next",e)}function l(e){g(i,r,o,n,l,"throw",e)}n(void 0)}))}}var y={name:"RectifyModal",props:{defaultFileList:{type:Array,default:function(){return[]}}},components:{UserList:i["default"],DocUpload:d["default"],DocPreviewModal:f["default"],LineSelectList:h["default"],WorkOrderSelect:m["default"]},data:function(){return{dictTrainStr:"",dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",fileList:[],annexList:[],rectifyId:"",filePath:"",fileName:"",status:!1,uploading:!1,dictCodeStr:"bu_mtr_workstation,name,id",dictCodeStrOrder:"",title:"整改项信息",visible:!1,model:{},saveFlag:!0,labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:13}},labelCol1:{xs:{span:24},sm:{span:2}},wrapperCol1:{xs:{span:24},sm:{span:22}},labelCol2:{xs:{span:24},sm:{span:2}},wrapperCol2:{xs:{span:24},sm:{span:19}},dutyUsername:"",dutyUserId:"",isClose:!1,confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{rectifyNo:{rules:[{required:!0,message:"请输入编号!"},{max:32,message:"输入长度不能超过32字符!"}]},rectifyType:{rules:[{required:!0,message:"请选择整改类型!"}]},orderName:{rules:[]},groupId:{rules:[{required:!0,message:"请选择责任班组!"}]},workstationId:{rules:[]},sendDate:{rules:[{required:!0,message:"请选择下发日期!"}]},status:{rules:[{required:!0,message:"请选择整改状态!"}]},lineId:{rules:[{required:!0,message:"请选择线路!"}]},trainNo:{rules:[{required:!0,message:"请选择车辆!"}]},depotId:{rules:[]},title:{rules:[{required:!0,message:"请输入整改标题!"},{max:32,message:"输入长度不能超过32字符!"}]},remark:{rules:[{max:255,message:"输入长度不能超过255字符!"}]},orderTaskId:{rules:[]}},workOrderId:"",rectifyNo:""}},created:function(){},methods:{orderNameChange:function(e){e||(this.workOrderId="",this.form.setFieldsValue({orderTaskId:""}),this.changeOrder())},lineIdChange:function(e){this.form.setFieldsValue({trainNo:""}),this.dictTrainStr=e?"bu_train_info,train_no,train_no,line_id="+e:""},openOrderModel:function(){this.$refs.orderSelect.showModal()},onSelectOrder:function(e){Object(u["e"])(e)||(this.form.setFieldsValue({orderName:e[0].orderName}),this.workOrderId=e[0].id,this.changeOrder(e[0].id))},changeGroup:function(e){this.dictCodeStr=e?"bu_mtr_workstation,name,id,id in (select workstation_id from bu_group_workstation where group_id = '"+e+"')":"bu_mtr_workstation,name,id"},changeOrder:function(e){this.dictCodeStrOrder=e?"bu_work_order_task,task_name,id,order_id='"+e+"'":""},changeClose:function(e){this.isClose=e},add:function(){var e=v(p().m((function e(t,a,r,o){return p().w((function(e){while(1)switch(e.n){case 0:return e.n=1,this.getRectifyNo();case 1:t&&this.changeOrder(t),this.lineIdChange(),this.edit({orderId:t,orderTaskId:a,remark:r,rectifyNo:this.rectifyNo});case 2:return e.a(2)}}),e,this)})));function t(t,a,r,o){return e.apply(this,arguments)}return t}(),getRectifyNo:function(){var e=v(p().m((function e(){var t=this;return p().w((function(e){while(1)switch(e.n){case 0:return e.n=1,Object(s["u"])().then((function(e){t.rectifyNo=e.result}));case 1:return e.a(2)}}),e)})));function t(){return e.apply(this,arguments)}return t}(),addByRow:function(e){e.orderId&&(this.workOrderId=e.orderId,this.changeOrder(e.orderId)),this.edit(e)},edit:function(e){var t=this;this.confirmLoading=!1,e.id?(this.isClose=!(!e["close"]||1!=e["close"]),this.workOrderId=e.orderId,this.changeOrder(this.workOrderId),null!=e.annexList&&e.annexList.length>0&&(this.annexList=e.annexList)):this.isClose=!1,this.dutyUserId=e.dutyUserId||"",this.form.resetFields(),this.model=Object.assign({},e),this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue({rectifyNo:t.model.rectifyNo,rectifyType:t.model.rectifyType,groupId:t.model.groupId,workstationId:t.model.workstationId,lineId:t.model.lineId,status:t.model.status,sendDate:l()(t.model.sendDate||new Date,"YYYY-MM-DD"),depotId:t.model.depotId,title:t.model.title,remark:t.model.remark,orderTaskId:t.model.orderTaskId,orderName:t.model.orderName}),t.lineIdChange(t.model.lineId),t.form.setFieldsValue({trainNo:t.model.trainNo})}))},openuserModal:function(){this.$refs.UserModalForm.showModal(),this.$refs.myuserSelect.blur()},addTarget:function(e){e.length&&(this.dutyUsername=e[0].realname,this.dutyUserId=e[0].id),this.form.setFieldsValue({dutyUserName:this.dutyUsername})},successUploadFile:function(e){var t=this;!e||e.length<1||(e.map((function(e){Object.assign(e,{id:Object(u["p"])()})})),Object(c["d"])(e).then((function(a){a.success&&e.map((function(e){t.annexList.push({address:e.savepath,id:e.id,title:e.name,rectifyId:t.rectifyId})}))})))},uploadFail:function(e){this.confirmLoading=!1},onRemoveFile:function(e){},beginUpload:function(){this.confirmLoading=!0,this.$refs.upload.beginUpload()},setBforeUploadStatus:function(e){this.saveFlag=e},setUpLoadingEndStatus:function(e){this.saveFlag=e},handlePrivilege:function(){var e=v(p().m((function e(t,a){var r,o=this;return p().w((function(e){while(1)switch(e.n){case 0:return r={id:t,operation:a},e.n=1,Object(c["uc"])(r).then((function(e){o.status=e.result}));case 1:return e.a(2)}}),e)})));function t(t,a){return e.apply(this,arguments)}return t}(),handleSeeing:function(){var e=v(p().m((function e(t){return p().w((function(e){while(1)switch(e.n){case 0:return e.n=1,this.handlePrivilege(t.id,2);case 1:this.status?(this.fileName=t.title,this.$refs.docPreview.handleFilePath(t.address)):this.$message.error("您没有权限!");case 2:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleDelete:function(){var e=v(p().m((function e(t,a){var r;return p().w((function(e){while(1)switch(e.n){case 0:r=this,r.$confirm({title:"提示",content:"确定删除该条附件吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){r.annexList.splice(a,1)},onCancel:function(){}});case 1:return e.a(2)}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,r){if(!a){t.confirmLoading=!0;var o=Object.assign(t.model,r,{sendDate:l()(r.sendDate).format("YYYY-MM-DD HH:mm:ss"),orderId:e.workOrderId});t.model.id?t.rectifyId=t.model.id:t.rectifyId=null,e.beginUpload();var i=null;clearInterval(i),i=setInterval((function(){var e;t.saveFlag&&(o["annexList"]=t.annexList,o["id"]=t.rectifyId,o["dutyUserId"]=t.dutyUserId,e=t.model.id?Object(s["l"])(o):Object(s["b"])(o),e.then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok")):t.$message.warning(e.message)})).finally((function(){clearInterval(i),t.confirmLoading=!1,t.close()})))}),1e3)}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.fileList=[],this.annexList=[],this.visible=!1}}},k=y,w=a("2877"),T=Object(w["a"])(k,r,o,!1,null,"2bfc6fa6",null);t["default"]=T.exports},5371:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-row",{staticStyle:{"padding-bottom":"10px"},attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-upload",{attrs:{multiple:!0,"file-list":e.fileList,remove:e.handleRemove,"before-upload":e.beforeUpload,"default-file-list":e.defaultFileList}},[t("a-button",{staticClass:"border-primary-4"},[e._v("添加文件")])],1)],1)],1),t("a-row",[e.showUpload?t("a-col",{attrs:{span:5}},[t("a-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.beginUpload}},[e._v("上传至服务器")])],1):e._e(),t("a-col",{staticStyle:{color:"#cccccc"},attrs:{span:19}},[e._v("一次最多上传"+e._s(e.fileSize)+"个文件，且单个文件不能超过10MB")])],1)],1)},o=[],i=a("e2aa");function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var n=r&&r.prototype instanceof c?r:c,u=Object.create(n.prototype);return l(u,"_invoke",function(a,r,o){var i,n,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,n=0,l=e,f.n=a,s}};function h(a,r){for(n=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(l=i[(n=i[4])?5:(n=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(n=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,n=0))}if(o||a>1)return s;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),n=u,l=m;(t=n<2?e:l)||!d;){i||(n?n<3?(n>1&&(f.n=-1),h(n,l)):f.n=l:f.v=l);try{if(c=2,i){if(n||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,n<2&&(n=0)}else 1===n&&(t=i.return)&&t.call(i),n<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),n=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==s)break}catch(t){i=e,n=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),u}var s={};function c(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(l(t={},r,(function(){return this})),t),h=d.prototype=c.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return u.prototype=d,l(h,"constructor",d),l(d,"constructor",u),u.displayName="GeneratorFunction",l(d,o,"GeneratorFunction"),l(h),l(h,o,"Generator"),l(h,r,(function(){return this})),l(h,"toString",(function(){return"[object Generator]"})),(n=function(){return{w:i,m:m}})()}function l(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,a,r){function i(t,a){l(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},l(e,t,a,r)}function s(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function c(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){s(i,r,o,n,l,"next",e)}function l(e){s(i,r,o,n,l,"throw",e)}n(void 0)}))}}var u={name:"DocUpload",props:{path:{type:String,default:""},fileSize:{type:Number,default:5},defaultFileList:{type:Array,default:[]},showUpload:{type:Boolean,default:!0},isFileEmpty:{type:Boolean,default:!1}},watch:{uploadFiles:{immediate:!1,handler:function(){var e=c(n().m((function e(t){return n().w((function(e){while(1)switch(e.n){case 0:if(t.length!==this.fileList.length){e.n=1;break}return e.n=1,this.$emit("uploaded",this.uploadFiles);case 1:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},data:function(){return{fileList:[],uploadFiles:[],isLoading:!1}},methods:{beforeUpload:function(e){var t=e.size/1024/1024<10;return t?(this.fileList.push(e),this.$emit("fileNum",this.fileList.length),this.$emit("setBforeUploadStatus",!1),!1):(this.$message.error("文件不得大于10MB!"),!1)},handleRemove:function(e){var t=this.fileList.indexOf(e),a=this.fileList.slice();a.splice(t,1),this.fileList=a,this.$emit("fileNum",this.fileList.length),this.$emit("removed",e)},beginUpload:function(){var e=this;return new Promise((function(t,a){var r=e.fileList,o=e.fileSize;if(!e.isFileEmpty&&0===r.length)return e.$emit("upLoadingEnd"),e.$message.warning("请选择要上传的文件"),void a();r.length>o?(e.$message.error("一次最多上传"+o+"个文件!"),a()):e.customRequest().then((function(){t()})).catch((function(e){a()}))}))},customRequest:function(){var e=this,t=this.fileList;if(t.length<1)return this.$emit("uploaded",[]),this.$emit("upLoadingEnd"),Promise.resolve();this.isLoading=!0;var a=[];return t.forEach((function(t){var r=new FormData;r.append("file",t),a.push(e.saveFile(r,t))})),Promise.all(a).finally((function(){e.isLoading=!1,e.$emit("upLoadingEnd")}))},saveFile:function(){var e=c(n().m((function e(t,a){var r=this;return n().w((function(e){while(1)switch(e.n){case 0:return e.a(2,Object(i["d"])(t,this.path).then((function(e){e.success?(r.getUploadData(a,e),r.$emit("setUpLoadingEndStatus",!0)):(r.$message.error(e.message),r.$emit("uploadFail",a))})))}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),getUploadData:function(e,t){var a=this.uploadFiles,r={name:e.name,type:this.handleFileName(e),fileSize:Math.round(e.size/1024),savepath:t.result};a.push(r)},handleFileName:function(e){var t=e.name.lastIndexOf("."),a=e.name.length,r=e.name.substring(t+1,a);return r}}},d=u,f=(a("9615"),a("2877")),h=Object(f["a"])(d,r,o,!1,null,"69990be1",null);t["default"]=h.exports},"53e7":function(e,t,a){"use strict";a("d5c3")},"54f6":function(e,t,a){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function n(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e){var t=s(e,"string");return"symbol"==r(t)?t:t+""}function s(e,t){if("object"!=r(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}a.d(t,"a",(function(){return c}));var c=function(){function e(t,a){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o(this,e),this.options={attrs:[]},Object.assign(this.options,i),this.options.attrs.find((function(e){return"edit"===e.key}))||this.options.attrs.push({key:"edit"}),this.options.attrs.forEach((function(e){Object.hasOwnProperty.call(e,"key")&&(r[e.key]=!1),Object.hasOwnProperty.call(e,"judge")||(e["judge"]=function(e){return!0})})),this.del=!1,this.nextTick=t.$nextTick,this.refs=t.$refs,this.refName=a,t.$nextTick((function(){r.vxeTable=t.$refs[a]}))}return n(e,[{key:"editRow",get:function(){if(this.edit){var e=this.vxeTable.getCheckboxRecords();return e.length?e[0]:{}}return{}}},{key:"update",value:function(){var e=this;this.nextTick((function(){e.vxeTable||(e.vxeTable=e.refs[e.refName]);var t=e.vxeTable.getCheckboxRecords();e.del=t.length>0,e.options.attrs.forEach((function(a){for(var r in a)Object.hasOwnProperty.call(a,r)&&(a["isDel"]?t.length?e[a.key]=t.length>0&&a.judge(t[0]):e[a.key]=!1:t.length?e[a.key]=1===t.length&&a.judge(t[0]):e[a.key]=!1)}))}))}}])}()},5577:function(e,t,a){"use strict";a("52d1")},"56ea":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.readOnly?t("div",{staticStyle:{height:"calc(100vh - 160px)"}},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.previewHander}},[e._v("预览")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"xTable",staticStyle:{height:"calc(100vh - 160px)"},attrs:{border:"",resizable:"","show-overflow":"","keep-source":"",align:"center","max-height":"auto",data:e.tableData,"checkbox-config":{highlight:!0,range:!0}},on:{"update:data":function(t){e.tableData=t}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务","edit-render":{name:"input"}},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("span",[e._v(e._s(e.getTaskName(r.taskId)))])]}}])}),t("vxe-table-column",{attrs:{field:"bookStepNo",title:"步骤","edit-render":{name:"input"},width:"120"}}),t("vxe-table-column",{attrs:{field:"bootStepTitle",title:"步骤名称",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("a",{on:{click:function(t){return t.stopPropagation(),e.showSopDeatil(r.bookDetailId)}}},[e._v(" "+e._s(r.bootStepTitle))])]}}])}),t("vxe-table-column",{attrs:{field:"bookName",title:"所属作业指导书","edit-render":{name:"input"}}})],1)],1):t("div",{staticStyle:{height:"calc(100vh - 160px)"}},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),e.tableData.length>0?t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.previewHander}},[e._v("预览")]):e._e(),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1),t("vxe-table",{ref:"xTable",staticStyle:{height:"calc(100vh - 160px)"},attrs:{border:"",resizable:"","show-overflow":"","keep-source":"",align:"center","max-height":"auto",data:e.tableData,"checkbox-config":{highlight:!0,range:!0},"edit-rules":e.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.tableData=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("span",[e._v(e._s(e.getTaskName(r.taskId)))])]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},model:{value:r.taskId,callback:function(t){e.$set(r,"taskId",t)},expression:"row.taskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,3596586730)}):e._e(),t("vxe-table-column",{attrs:{field:"bookStepNo",title:"步骤","edit-render":{name:"input"},width:"120"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{disabled:"",placeholder:"请输入步骤序号"},model:{value:r.bookStepNo,callback:function(t){e.$set(r,"bookStepNo",t)},expression:"row.bookStepNo"}})]}}],null,!1,850517849)}),t("vxe-table-column",{attrs:{field:"bootStepTitle",title:"步骤名称",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("a",{on:{click:function(t){return t.stopPropagation(),e.showSopDeatil(r.bookDetailId)}}},[e._v(" "+e._s(r.bootStepTitle))])]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"trainAssetSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择作业指导书",open:!1},on:{focus:function(t){return e.openAssetSelectModal(r)}},model:{value:r.bootStepTitle,callback:function(t){e.$set(r,"bootStepTitle",t)},expression:"row.bootStepTitle"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openAssetSelectModal(r)}},slot:"suffixIcon"})],1)]}}],null,!1,122876149)}),t("vxe-table-column",{attrs:{field:"bookName",title:"所属作业指导书",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{disabled:"",placeholder:"请输入步骤名称"},model:{value:r.bookName,callback:function(t){e.$set(r,"bookName",t)},expression:"row.bookName"}})]}}],null,!1,3379172200)}),t("vxe-table-column",{attrs:{title:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.xTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,2620488658)})],1)],1),t("SopDetailList",{ref:"modalForm",attrs:{multiple:!1},on:{ok:e.onSelectBookStep}}),t("SopDetailList",{ref:"modalFormMultiple",attrs:{multiple:!0},on:{ok:e.onSelectBookStepMultiple}}),t("WorkSopView",{ref:"workSopViewModal"})],1)},o=[],i=a("85df"),n=a("4501"),l=a("ca00");function s(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var s=r&&r.prototype instanceof l?r:l,u=Object.create(s.prototype);return c(u,"_invoke",function(a,r,o){var i,l,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,s=e,f.n=a,n}};function h(a,r){for(l=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,l=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(t=l<2?e:s)||!d;){i||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==n)break}catch(t){i=e,l=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),u}var n={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(c(t={},r,(function(){return this})),t),h=d.prototype=l.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return u.prototype=d,c(h,"constructor",d),c(d,"constructor",u),u.displayName="GeneratorFunction",c(d,o,"GeneratorFunction"),c(h),c(h,o,"Generator"),c(h,r,(function(){return this})),c(h,"toString",(function(){return"[object Generator]"})),(s=function(){return{w:i,m:m}})()}function c(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,a,r){function i(t,a){c(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},c(e,t,a,r)}function u(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function d(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){u(i,r,o,n,l,"next",e)}function l(e){u(i,r,o,n,l,"throw",e)}n(void 0)}))}}var f={props:{bookSteps:{type:Array,default:[]},businessKey:{type:String,default:null},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1}},watch:{bookSteps:{handler:function(e){this.tableData=e},immediate:!0,deep:!0}},components:{SopDetailList:i["default"],WorkSopView:n["default"]},data:function(){return{isEdit:!1,tableData:[],rowData:null,validRules:{bootStepTitle:[{required:!0,message:"请填写步骤名称",trigger:"manual"}],bookName:[{required:!0,message:"请选择作业指导书",trigger:"manual"}]}}},methods:{previewHander:function(){var e=this.$refs.xTable.getCheckboxRecords().length<=0?this.tableData:this.$refs.xTable.getCheckboxRecords();if(e.length<=0)this.$message.warning("没有可预览的作业指导书");else{var t=e.map((function(e){return e.bookDetailId})).join(",");this.showSopDeatil(t)}},getTaskName:function(e){for(var t,a=0,r=this.tasks.length;a<r;a++)this.tasks[a].id===e&&(t=this.tasks[a].taskName);return t},onSelectBookStep:function(e){if(!(e.length<=0)){var t=e[0];this.tableData.find((function(e){return e.bookDetailId===t.id}))?this.$message.error("".concat(t.stepTitle,"步骤已经添加了")):(this.rowData.bookDetailId=t.id,this.rowData.bookName=t.bookName,this.rowData.bookStepNo=t.stepNum,this.rowData.bootStepContent=t.stepContent,this.rowData.bootStepTitle=t.stepTitle,this.rowData.techBookId=t.bookId)}},showSopDeatil:function(e){this.$refs.workSopViewModal.showSopDetail(e.split(","))},saveRowEvent:function(e){var t=this,a=this.$refs.xTable;a.validate(e,(function(r){if(r)for(var o in r){var i=r[o];i.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else a.clearActived(),t.isEdit||t.tableData.push(e),t.$emit("update:bookSteps",t.tableData)}))},editRowEvent:function(e){this.isEdit=!0,this.$refs.xTable.setActiveCell(e,"bootStepTitle")},cancelRowEvent:function(){var e=d(s().m((function e(t){var a;return s().w((function(e){while(1)switch(e.n){case 0:return a=this.$refs.xTable,e.n=1,a.clearActived();case 1:this.isEdit?a.revertData(t):a.remove(t);case 2:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleAdd:function(){var e=d(s().m((function e(){return s().w((function(e){while(1)switch(e.n){case 0:if(!this.$refs.xTable.getActiveRecord()){e.n=1;break}return this.$message.warning("请先保存数据"),e.a(2);case 1:this.isEdit=!1,this.$refs.modalFormMultiple.showModal();case 2:return e.a(2)}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onSelectBookStepMultiple:function(e){var t=this,a=(this.$refs.xTable,this.tasks.length>0&&this.tasks[0]);e.forEach((function(e,r,o){for(var i=0,n=0,s=t.tableData.length;n<s;n++){var c=t.tableData[n];if(c.bookDetailId==e.id){i=1;break}}if(0===i){var u={id:Object(l["p"])(),belongOrderTask:1,workOrderId:t.businessKey,taskName:a?a.taskName:"",taskId:a?a.id:"",bookDetailId:e.id,bootStepContent:e.stepContent,bookStepNo:e.stepNum,bootStepTitle:e.stepTitle,bookName:e.bookName,techBookId:e.bookId};t.$refs.xTable.insertAt(u,-1),t.tableData.push(u)}}))},openAssetSelectModal:function(e){this.rowData=e,this.$refs.modalForm.showModal(),this.$refs.trainAssetSelect.blur()},handleDel:function(){var e=this,t=this.$refs.xTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.tableData.map((function(a,r){t.id===a.id&&e.tableData.splice(r,1)}))})),e.$emit("update:bookSteps",e.tableData)}}):this.$message.error("尚未选中任何数据!")}}},h=f,m=a("2877"),p=Object(m["a"])(h,r,o,!1,null,"7836274e",null);t["default"]=p.exports},"5bbd":function(e,t,a){},6034:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障原因选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",bodyStyle:{height:"80vh"},destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"请输入故障原因编码或者描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"所属分类"}},[t("a-input",{ref:"categoryIdSelect",attrs:{readonly:"",allowClear:"",placeholder:"请选择所属分类"},on:{click:function(t){return e.openSelectTypeModal(1)}},model:{value:e.categoryCode,callback:function(t){e.categoryCode=t},expression:"categoryCode"}},[t("a-icon",{attrs:{slot:"suffix",type:"ellipsis"},slot:"suffix"})],1)],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"所属故障代码"}},[t("a-input",{ref:"faultCodeIdSelect",attrs:{readonly:"",allowClear:"",placeholder:"请选择所属故障代码"},on:{focus:function(t){return e.openSelectTypeModal(2)}},model:{value:e.faultCode,callback:function(t){e.faultCode=t},expression:"faultCode"}},[t("a-icon",{attrs:{slot:"suffix",type:"ellipsis"},slot:"suffix"})],1)],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:"序号"}}),t("vxe-table-column",{attrs:{field:"reasonCode",title:"故障原因代码",width:"150"}}),t("vxe-table-column",{attrs:{field:"reasonDesc",title:"故障原因描述",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1),t("fault-category-list",{ref:"categorySelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-code-list",{ref:"codeSelect",attrs:{multiple:!1},on:{ok:e.addCodeTarget}})],1)},o=[],i=a("b47d"),n=a("a396"),l=a("0e7b"),s=a("ca00"),c={name:"FaultReasonList",components:{FaultCategoryList:n["default"],FaultCodeList:l["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{categoryCode:"",faultCode:"",queryParam:{searchText:"",categoryId:"",faultCodeId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},watch:{categoryCode:function(e,t){e||(this.queryParam.categoryId=null)},faultCode:function(e,t){e||(this.queryParam.faultCodeId=null)}},methods:{showModal:function(e){this.visible=!0,this.queryParam.faultCodeId=e,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["R"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.categoryCode="",this.faultCode="",this.queryParam.searchText="",this.queryParam.categoryId="",this.queryParam.faultCodeId=""},openSelectTypeModal:function(e){switch(e){case 1:this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur();break;case 2:this.$refs.codeSelect.showModal(),this.$refs.faultCodeIdSelect.blur();break;default:break}},addCategoryTarget:function(e){Object(s["e"])(e)?this.queryParam.categoryId="":(this.queryParam.categoryId=e[0].id,this.categoryCode=e[0].categoryCode)},addCodeTarget:function(e){Object(s["e"])(e)?this.queryParam.faultCodeId="":(this.queryParam.faultCodeId=e[0].id,this.faultCode=e[0].fltCode)}}},u=c,d=(a("ef2b0"),a("2877")),f=Object(d["a"])(u,r,o,!1,null,"ba47c754",null);t["default"]=f.exports},"607e":function(e,t,a){"use strict";a("c95b")},"60c8":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:800,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-form",{ref:"flex",staticStyle:{padding:"15px 24px"},attrs:{form:e.form,labelAlign:"left"}},[t("a-form-item",{attrs:{labelCol:{span:3},wrapperCol:{span:21},label:"模板选择",required:!0}},[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择表单",maxTagTextLength:10,open:!1,optionFilterProp:"formName"},on:{change:e.onFormSelectChange,dropdownVisibleChange:function(t){return e.openFormSelect()}},model:{value:e.queryParam.formName,callback:function(t){e.$set(e.queryParam,"formName",t)},expression:"queryParam.formName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openFormSelect()}},slot:"suffixIcon"})],1)],1),t("a-form-item",{attrs:{label:"设备选择",labelCol:{span:3},wrapperCol:{span:21},required:!0}},[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择设备",open:!1,allowClear:""},on:{dropdownVisibleChange:function(t){return e.openAssetSelectModal()},change:e.onDeviceSelect},model:{value:e.queryParam.assetTypeName,callback:function(t){e.$set(e.queryParam,"assetTypeName",t)},expression:"queryParam.assetTypeName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1),t("a-form-item",{attrs:{label:"表单名称",labelCol:{span:3},wrapperCol:{span:21}}},[t("a-input",{attrs:{placeholder:"请输入表单名称",allowClear:""},model:{value:e.queryParam.title,callback:function(t){e.$set(e.queryParam,"title",t)},expression:"queryParam.title"}})],1)],1),t("FormsList",{ref:"multipleSelect",attrs:{multiple:!1},on:{ok:e.onFormSelect}}),t("CarDeviceSelectNew",{ref:"trainAssetSelectModal",attrs:{trainNo:e.trainNo,lineId:e.lineId,multiple:!1,canSelectType:[2,3,4]},on:{ok:e.onTrainAssetSelect,cancel:e.onCancelTrainAssetSelect}})],1)},o=[],i=a("37582"),n=a("e42a"),l=a("8fad"),s=a("310d"),c={props:{trainNo:{type:String,default:""},lineId:{type:String,default:""},repairId:{type:[Number,String],default:null},checkList:{type:Array,default:function(){return[]}},operator:{type:[String,Number],default:""}},name:"TaskFormModel",components:{FormsList:i["default"],CarDeviceSelect:n["default"],CarDeviceSelectNew:s["default"]},data:function(){return{title:"添加",detailIds:"",checkType:-1,value:1,status:1,confirmLoading:!1,switchCheck:!0,visible:!1,model:{},form:this.$form.createForm(this),queryParam:{assetTypeId:"",assetTypeName:"",code:"",copies:"",formName:"",title:"",formType:"",fromBy:"",id:"",objId:"",planId:"",remark:"",type:"",workRecordType:null}}},methods:{showModal:function(e){this.queryParam.planId=e,this.queryParam.assetTypeId="",this.queryParam.assetTypeName="",this.queryParam.code="",this.queryParam.copies="",this.queryParam.formName="",this.queryParam.title="",this.queryParam.formType="",this.queryParam.fromBy="",this.queryParam.id="",this.queryParam.objId="",this.queryParam.remark="",this.queryParam.type="",this.visible=!0},handleOk:function(){var e=this;this.queryParam.formName?this.queryParam.assetTypeId?this.checkList.find((function(t){return t.objId===e.queryParam.objId}))?this.$message.warn("".concat(this.checkList.find((function(t){return t.objId===e.queryParam.objId})).formName,"已经添加了")):Object(l["e"])(this.queryParam).then((function(t){t.success?(e.$message.success("执行成功"),e.$emit("ok"),e.visible=!1):e.$message.error(t.message)})):this.$message.warn("请选择设备"):this.$message.warn("请选择表单")},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},openFormSelect:function(){this.$refs.multipleSelect.showModal(1===this.operator&&{lineId:this.lineId,repairProgramId:this.repairId})},onFormSelect:function(e){if(e.forms.length){var t=e.forms[0];this.queryParam.code=t.code,this.queryParam.formName=t.title,this.queryParam.title=t.title,this.queryParam.formType=t.formType,this.queryParam.workRecordType=t.workRecordType,this.queryParam.objId=t.id,this.queryParam.fromBy=2}},onFormSelectChange:function(){this.queryParam.code="",this.queryParam.formName="",this.queryParam.formType="",this.queryParam.workRecordType=null,this.queryParam.type="",this.queryParam.objId=""},onDeviceSelect:function(e){e||(this.queryParam.assetTypeId="",this.queryParam.assetTypeName="",this.queryParam.trainStructId="",this.queryParam.trainStructName="",this.queryParam.assetId="",this.queryParam.assetName="")},openAssetSelectModal:function(){this.$refs.trainAssetSelectModal.showModal()},onTrainAssetSelect:function(e){if(e.length){var t=e[0];this.queryParam.assetTypeId=t.id,this.queryParam.assetTypeName=t.assetName,this.queryParam.trainStructId=t.id,this.queryParam.trainStructName=t.assetName,this.queryParam.assetId=t.id,this.queryParam.assetName=t.assetName}},onCancelTrainAssetSelect:function(){}}},u=c,d=(a("4a51"),a("2877")),f=Object(d["a"])(u,r,o,!1,null,"6a9b84db",null);t["default"]=f.exports},"60e2":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",title:"列计划选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"70vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"计划名称"}},[t("a-input",{attrs:{placeholder:"请输入计划名称或列车序号"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{label:"线路"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId"],expression:"['lineId']"}],staticStyle:{width:"100%"},attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:4}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(100% - 55px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100% - 55px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"manual",mode:"row"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"planName",title:"计划名称",align:"left"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"所属线路",align:"left"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"车号",align:"left"}}),t("vxe-table-column",{attrs:{field:"startDate",title:"开始日期",align:"left"}}),t("vxe-table-column",{attrs:{field:"finishDate",title:"完成日期",align:"left"}}),t("vxe-table-column",{attrs:{field:"progressStatus_dictText",title:"进度状态",align:"left"}}),t("vxe-table-column",{attrs:{field:"wfStatus",title:"审批状态",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("b9c3"),n={name:"TrainPlanList",props:{multiple:{type:Boolean,default:!1},trainNo:{type:String,default:""},progressStatusList:{type:Array,default:function(){return[]}}},data:function(){return{queryParam:{searchText:"",lineId:"",trainNo:"",status:"2",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,stationData:[]}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,this.progressStatusList.length&&(this.queryParam.progressStatusList=this.progressStatusList),this.trainNo&&(this.queryParam.trainNo=this.trainNo),Object(i["H"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=n,s=a("2877"),c=Object(s["a"])(l,r,o,!1,null,null,null);t["default"]=c.exports},"612d":function(e,t,a){},"61ca":function(e,t,a){"use strict";a("c35c")},"623c":function(e,t,a){"use strict";a("4227")},"673e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",title:"工单选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",bodyStyle:{height:"70vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"工单搜索"}},[t("a-input",{attrs:{placeholder:"请输入工单名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工单类型"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择工单类型",dictCode:"bu_order_type"},model:{value:e.queryParam.orderType,callback:function(t){e.$set(e.queryParam,"orderType",t)},expression:"queryParam.orderType"}})],1)],1),t("a-col",{attrs:{md:9,sm:24}},[t("a-form-item",{attrs:{label:"工单状态"}},[t("div",{staticClass:"autoWidth"},[t("j-multi-select-tag",{attrs:{placeholder:"请选择工单状态",dictCode:"bu_order_status"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)])],1),t("a-col",{attrs:{md:3,sm:24}},[t("a-form-item",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(70vh - 172px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 172px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"manual",mode:"row"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"trainNo",title:"作业车号",width:"100"}}),t("vxe-table-column",{attrs:{field:"groupName",title:"所属班组",width:"100"}}),t("vxe-table-column",{attrs:{field:"orderCode",title:"工单编号",width:"150"}}),t("vxe-table-column",{attrs:{field:"orderName",title:"工单名称",align:"left","min-width":"150"}}),t("vxe-table-column",{attrs:{field:"startTime",title:"计划开始",width:"150"}}),t("vxe-table-column",{attrs:{field:"finishTime",title:"计划结束",width:"150"}}),t("vxe-table-column",{attrs:{field:"orderStatus_dictText",title:"工单状态",width:"150"}}),t("vxe-table-column",{attrs:{field:"orderType_dictText",title:"工单类型",width:"150"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("f680"),n=a("b9c3"),l=a("c1df"),s=a.n(l),c={name:"WorkOrderSelect",components:{JMultiSelectTag:i["default"]},props:{multiple:{type:Boolean,default:!1},workGroupId:{type:String,default:""},planId:{type:String,default:""},orderType:{type:Number,default:null},orderStatus:{type:Array,default:function(){return[3,4,8]}},selectStatus:{type:Array,default:function(){return[]}}},data:function(){return{dateRange:[s()(new Date,"YYYY-MM-DD"),s()(new Date,"YYYY-MM-DD")],queryParam:{searchText:"",startDate:"",endDate:"",orderType:"",status:this.orderStatus.join(","),pageNo:1,pageSize:10,workGroupId:this.workGroupId,planId:this.planId},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,stationData:[]}},methods:{checkRadioMethod:function(e){var t=e.row;return!(this.selectStatus&&this.selectStatus.length>0)||this.selectStatus.indexOf(t.orderStatus)>-1},onDateChange:function(){this.dateRange[0]?this.queryParam.startDate=this.dateRange[0].format("YYYY-MM-DD"):this.queryParam.startDate=null,this.dateRange[1]?this.queryParam.endDate=this.dateRange[1].format("YYYY-MM-DD"):this.queryParam.endDate=null},showModal:function(){this.visible=!0,this.queryParam.planId=this.planId,this.queryParam.workGroupId=this.workGroupId,this.queryParam.orderType=this.orderType,this.findList()},findList:function(){var e=this;this.loading=!0,Object(n["T"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},u=c,d=(a("607e"),a("2877")),f=Object(d["a"])(u,r,o,!1,null,null,null);t["default"]=f.exports},6971:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:e.files,"edit-rules":e.validRules,"keep-source":!0,"show-overflow":"ellipsis","checkbox-config":{trigger:"row",highlight:e.getButtonShow(),range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.files=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),e.getButtonShow()?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e._e(),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input",enabled:!e.selectTask},width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.taskName)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:!0},on:{change:e.taskSelectChange},model:{value:r.taskId,callback:function(t){e.$set(r,"taskId",t)},expression:"row.taskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,1322267700)}):e._e(),t("vxe-table-column",{attrs:{field:"name",title:"文件名称",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-upload",{staticClass:"attachedUploadBtn",attrs:{"before-upload":e.beforeLedUpload,multiple:!1,"file-list":[],showUploadList:!1},on:{blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("a-select",{ref:"toolSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件",open:!1},model:{value:r.name,callback:function(t){e.$set(r,"name",t)},expression:"row.name"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)]}}])}),t("vxe-table-column",{attrs:{field:"type",title:"扩展名",width:"150px"}}),t("vxe-table-column",{attrs:{field:"fileSize",title:"文件大小(KB)",width:"150px"}}),t("vxe-table-column",{attrs:{field:"uid",title:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[r&&!e.$refs.listTable.isActiveByRow(r)?t("span",[t("a",{on:{click:function(t){return t.stopPropagation(),e.previewImage(r)}}},[e._v("查看")]),t("a",{staticStyle:{"margin-left":"6px"},on:{click:function(t){return t.stopPropagation(),e.handleDownload(r)}}},[e._v("下载")])]):t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]}}])})],1)],1),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.previewFileName}})],1)},o=[],i=a("e2aa"),n=a("b47d"),l=a("353a"),s=a("ca00");function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var s=r&&r.prototype instanceof l?r:l,c=Object.create(s.prototype);return u(c,"_invoke",function(a,r,o){var i,l,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,s=e,f.n=a,n}};function h(a,r){for(l=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,l=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(t=l<2?e:s)||!d;){i||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==n)break}catch(t){i=e,l=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function l(){}function s(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(u(t={},r,(function(){return this})),t),h=d.prototype=l.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return s.prototype=d,u(h,"constructor",d),u(d,"constructor",s),s.displayName="GeneratorFunction",u(d,o,"GeneratorFunction"),u(h),u(h,o,"Generator"),u(h,r,(function(){return this})),u(h,"toString",(function(){return"[object Generator]"})),(c=function(){return{w:i,m:m}})()}function u(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}u=function(e,t,a,r){function i(t,a){u(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},u(e,t,a,r)}function d(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function f(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){d(i,r,o,n,l,"next",e)}function l(e){d(i,r,o,n,l,"throw",e)}n(void 0)}))}}var h={name:"TaskAttached",components:{DocPreviewModal:l["default"]},props:{files:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},workOrderId:{type:String,default:""},operator:{type:Number,default:0}},data:function(){return{curEditMode:1,curRow:null,previewFileName:"",validRules:{name:[{required:!0,message:"请选择文件",trigger:"manual"}]}}},methods:{getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||4===this.operator)},handleAdd:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:Object(s["p"])(),fileId:"",taskId:"",workOrderId:this.workOrderId,name:"",type:"",savepath:"",fileSize:""};this.selectTask?Object.assign(t,{taskId:this.selectTask.id,taskName:this.selectTask.taskName}):this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName,taskId:this.tasks[0].id}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"name")}))}},handleDel:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){var t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){var a=Promise.resolve();t.map((function(t){a.then((function(){return Object(i["a"])(t.savepath).then((function(a){if(a.success){if(Object(s["e"])(t.id))return e.files.splice(e.files.findIndex((function(e){return e.savepath===t.savepath})),1);var r=new FormData;return r.append("ids",t.id),Object(n["A"])(r).then((function(a){a.success?(e.files.splice(e.files.findIndex((function(e){return e.savepath===t.savepath})),1),e.$emit("removeFile",t)):e.$message.error("文件删除失败")}))}return e.$message.error("文件删除失败")}))}))}))}}):this.$message.error("尚未选中任何数据!")}},handleDownload:function(){var e=f(c().m((function e(t){return c().w((function(e){while(1)switch(e.n){case 0:Object(i["b"])(t.savepath);case 1:return e.a(2)}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.files.map((function(a,r){e.id===a.id&&t.files.splice(r,1)}))},beforeLedUpload:function(e){var t=this;if(e.size/1024/1024>10)return this.$message.error("文件不得大于10MB!"),!1;var a=/([^\\/]+)\.([^\\/]+)/i;a.test(e.name);var r=RegExp.$1,o=RegExp.$2,n=new FormData,l=new File([e],"".concat(r).concat(this.$moment().format("YYYYMMDDhhmmss"),".").concat(o),{type:e.type});n.append("file",l);var s=this.$message.loading("文件上传中···",0);return Object(i["d"])(n,"/WorkOrder").then((function(a){t.$refs.listTable.getActiveRecord().row.name=r,t.$refs.listTable.getActiveRecord().row.type=o,t.$refs.listTable.getActiveRecord().row.savepath=a.result,t.$refs.listTable.getActiveRecord().row.fileSize=(e.size/1024).toFixed(0),s()})).catch((function(e){t.$message.error("文件上传失败，请联系管理员"),s()})),!1},previewImage:function(e){return this.previewFileName=e.name,this.$refs.docPreview.handleFilePath(e.savepath),!1},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=e?this.tasks[t.key].taskName:""},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else t.files.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0,t.$emit("addFile",e)}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),this.$refs.listTable.remove(e),this.curEditMode=0},getTaskName:function(e){return this.selectTask?this.selectTask.taskName:this.tasks.find((function(t){return t.id===e.taskId}))?this.tasks.find((function(t){return t.id===e.taskId})).taskName:""},clearValidate:function(){this.$refs.listTable.clearValidate()}}},m=h,p=(a("53e7"),a("2877")),b=Object(p["a"])(m,r,o,!1,null,null,null);t["default"]=b.exports},"6ad7":function(e,t,a){"use strict";a("dc75")},7068:function(e,t,a){"use strict";a("51cf")},7268:function(e,t,a){"use strict";var r=a("b7b4");function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function l(a,r,o,i){var l=r&&r.prototype instanceof c?r:c,u=Object.create(l.prototype);return n(u,"_invoke",function(a,r,o){var i,n,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,n=0,l=e,f.n=a,s}};function h(a,r){for(n=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(l=i[(n=i[4])?5:(n=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(n=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,n=0))}if(o||a>1)return s;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),n=u,l=m;(t=n<2?e:l)||!d;){i||(n?n<3?(n>1&&(f.n=-1),h(n,l)):f.n=l:f.v=l);try{if(c=2,i){if(n||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,n<2&&(n=0)}else 1===n&&(t=i.return)&&t.call(i),n<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),n=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==s)break}catch(t){i=e,n=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),u}var s={};function c(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(n(t={},r,(function(){return this})),t),h=d.prototype=c.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return u.prototype=d,n(h,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,o,"GeneratorFunction"),n(h),n(h,o,"Generator"),n(h,r,(function(){return this})),n(h,"toString",(function(){return"[object Generator]"})),(i=function(){return{w:l,m:m}})()}function n(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}n=function(e,t,a,r){function i(t,a){n(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},n(e,t,a,r)}function l(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function s(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){l(i,r,o,n,s,"next",e)}function s(e){l(i,r,o,n,s,"throw",e)}n(void 0)}))}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function d(e,t,a){return t&&u(e.prototype,t),a&&u(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var t=h(e,"string");return"symbol"==o(t)?t:t+""}function h(e,t){if("object"!=o(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var m=function(){function e(){c(this,e)}return d(e,[{key:"getDefaultOptions",value:function(){return{container:"luckysheet",title:"sheet",column:26,row:150,lang:"zh",allowEdit:!0,showinfobar:!1,sheetFormulaBar:!1,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!0,showtoolbarConfig:{undoRedo:!0,paintFormat:!0,currencyFormat:!0,percentageFormat:!0,numberDecrease:!0,numberIncrease:!0,moreFormats:!0,font:!0,fontSize:!0,bold:!0,italic:!0,strikethrough:!0,underline:!0,textColor:!0,fillColor:!0,border:!0,mergeCell:!0,horizontalAlignMode:!0,verticalAlignMode:!0,textWrapMode:!0,textRotateMode:!1,image:!1,link:!1,chart:!1,postil:!1,pivotTable:!1,function:!1,frozenMode:!1,sortAndFilter:!1,conditionalFormat:!1,dataVerification:!1,splitColumn:!1,screenshot:!1,findAndReplace:!1,protection:!1,print:!1},cellRightClickConfig:{copy:!1,copyAs:!1,paste:!1,insertRow:!1,insertColumn:!1,deleteRow:!1,deleteColumn:!1,deleteCell:!1,hideRow:!1,hideColumn:!1,rowHeight:!1,columnWidth:!1,clear:!1,matrix:!1,sort:!1,filter:!1,chart:!1,image:!1,link:!1,data:!1,cellFormat:!1},hook:{}}}},{key:"getDevlovperOptions",value:function(){return{container:"luckysheet",title:"sheet",column:13,row:30,lang:"zh"}}},{key:"getSelectRange",value:function(){var e=luckysheet.getRange();if(!(e&&e.length>0))return null;e=e[0];var t={r1:e.row[0],r2:e.row[1],c1:e.column[0],c2:e.column[1]};return t}},{key:"checkProperty",value:function(e,t){var a=t in e&&null!=e[t]&&void 0!=e[t];return a}},{key:"getCell",value:function(e,t,a){return a[e][t]}},{key:"getCellText",value:function(e){var t=this,a="";if(this.checkProperty(e,"m"))a=e.m;else if(this.checkProperty(e,"v"))a=e.v;else if(this.checkProperty(e,"ct")&&this.checkProperty(e.ct,"s")){var r=e.ct.s;r.forEach((function(e,r){t.checkProperty(e,"m")?a+=e.m:t.checkProperty(e,"v")&&(a+=e.v)}))}return a}},{key:"searchCellByText",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(!t)return null;if(-1===a)for(var r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++){var i=t[r][o];if(i){var n=this.getCellText(i);if(n&&n.indexOf(e)>-1)return{r:r,c:o,mc:i.mc,cell:i}}}else for(var l=0;l<t[a].length;l++){var s=t[a][l];if(s){var c=this.getCellText(s);if(c&&c.indexOf(e)>-1)return{r:a,c:l,mc:s.mc,cell:s}}}return null}},{key:"findCellRightIndex",value:function(e){if(!this.checkProperty(e,"mc"))return e.c+1;var t=e.mc;return this.checkProperty(t,"r")&&this.checkProperty(t,"c")&&this.checkProperty(t,"rs")&&this.checkProperty(t,"cs")?e.mc.c+e.mc.cs:this.checkProperty(t,"r")&&this.checkProperty(t,"c")?-1:void 0}},{key:"getCellLocation",value:function(e,t,a){var r={rowIndex:e,rowIndexTo:e,colIndex:t,colIndexTo:t};if(this.checkProperty(a,"mc")){var o=a.mc;this.checkProperty(o,"r")&&this.checkProperty(o,"c")&&this.checkProperty(o,"rs")&&this.checkProperty(o,"cs")&&(r.rowIndex=a.mc.r,r.colIndex=a.mc.c,r.rowIndexTo=a.mc.r+a.mc.rs-1,r.colIndexTo=a.mc.c+a.mc.cs-1)}return r}},{key:"char2Index",value:function(e){var t=0;if(e.length<2&&(t=e.charCodeAt()-65),2===e.length){var a=e[0],r=e[1],o=a.charCodeAt()-65;o=25*(o+1),t=o+r.charCodeAt()-64}return t}},{key:"index2Chart",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=e+1;if(t<=26)return String.fromCharCode(64+t);var a=parseInt(t/26),r=parseInt(t%26);0==r&&(a-=1);var o=a+64,i=t-26*a,n=String.fromCharCode(o),l=index2Chart(i);return n+""+l}))},{key:"mcToRange",value:function(e){if(!e)return"";this.checkProperty(e,"rs")&&this.checkProperty(e,"cs")}},{key:"setCellValue",value:function(e,t,a){luckysheet.setCellValue(e,t,a,{success:function(){}})}},{key:"setBorder",value:function(e,t,a,r){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#000000",i=this.char2Index(t),n=this.char2Index(r),l=e;l<=a;l++)for(var s=i;s<=n;s++)luckysheet.setCellFormat(l,s,"bd",{borderType:"border-all",style:"1",color:o}),this.addBorderInfo(l,s)}},{key:"addBorderInfo",value:function(e,t){var a={rangeType:"cell",value:{row_index:e,col_index:t,l:{style:1,color:"#000000"},r:{style:1,color:"#000000"},t:{style:1,color:"#000000"},b:{style:1,color:"#000000"}}};luckysheet.getLuckysheetfile()[0].config.borderInfo.push(a)}},{key:"setRangeFormat",value:function(e,t,a,r,o,i){for(var n=this.char2Index(r),l=this.char2Index(i),s=a;s<=o;s++)for(var c=n;c<=l;c++)try{luckysheet.setCellFormat(s,c,e,t)}catch(u){}}},{key:"setRangeCellValue",value:function(e,t,a,r,o){for(var i=this.char2Index(a),n=this.char2Index(o),l=t;l<=r;l++)for(var s=i;s<=n;s++)try{luckysheet.setCellValue(l,s,e)}catch(c){}}},{key:"setCellValueByTemplate",value:function(e,t,a){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.forEach((function(e){if(1===o){var i=t.replaceAll(a,e.row+1);r.setCellValue(e.row,r.char2Index(e.col),i)}if(2===o){var n=t.replaceAll(a,e.col);r.setCellValue(e.row,r.char2Index(e.col),n)}}))}},{key:"setCellValueByObjectValue",value:function(e,t,a){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.forEach((function(e){1===o&&(e.value[t]=e.value[t].replaceAll(a,e.row+1),r.setCellValue(e.row,r.char2Index(e.col),e.value)),2===o&&(e.value[t]=e.value[t].replaceAll(a,e.col),r.setCellValue(e.row,r.char2Index(e.col),e.value))}))}},{key:"setCellValueByArrayData",value:function(e,t,a,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i={};for(var n in o)i[n]=o[n];return o["ct"]||(i["ct"]={fa:"General",t:"n"}),o["fs"]||(i["fs"]="10"),o["ht"]||(i["ht"]=0),o["vt"]||(i["vt"]=0),i["m"]=r,i["v"]=r,e.push({r:t,c:this.char2Index(a),v:i})}},{key:"setCellMergeByValue",value:function(e,t,a){var r=Number(/[0-9].*/.exec(t)[0]),o=this.char2Index(/^[A-Z]{1,2}/.exec(t)[0]),i=/[0-9].*/.exec(a)[0],n=this.char2Index(/^[A-Z]{1,2}/.exec(a)[0]);(e.config["merge"]||(e.config["merge"]={}))["".concat(r-1,"_").concat(o)]={r:r-1,c:o,rs:i-r+1,cs:n-o+1}}},{key:"setRangeConditionalOncell",value:function(){var e=s(i().m((function e(t){var a,o,n,l=arguments;return i().w((function(e){while(1)switch(e.n){case 0:a=l.length>1&&void 0!==l[1]?l[1]:"",[];try{o=function(e,t,a){var r=[];switch(t){case 1:r=["equal"],n(e,r,a);break;case 2:r=["greaterThan","equal"],n(e,r,a);break;case 3:r=["greaterThan"],n(e,r,a);break;case 4:r=["lessThan","equal"],n(e,r,a);break;case 5:r=["lessThan"],n(e,r,a);break;case 6:luckysheet.setCellFormat(e.row1,e.col1,"bg","#ff0000"),luckysheet.setRangeConditionalFormatDefault("equal",[a],{format:{cellColor:"#ffffff",textColor:null},cellrange:{row:[e.row1,e.row2],column:[e.col1,e.col2]}});break}},n=function(e,t,a){t.forEach((function(t){luckysheet.setRangeConditionalFormatDefault(t,[a],{format:{cellColor:"#ff0000",textColor:null},cellrange:{row:[e.row1,e.row2],column:[e.col1,e.col2]},success:function(e){}})}))},Object(r["p"])(t).then((function(e){if(e.success){var t=e.result;t&&t.length>0&&(t.forEach((function(e){e.operator&&o(e,e.operator,e.threshold),e.operator2&&o(e,e.operator2,e.threshold2)})),Object(r["o"])(a).then((function(e){e.result.forEach((function(e){if(e.fixedValue){var t=e.linkDomain.split("$"),a=t[1],r=t[2];luckysheet.setCellFormat(a,r,"bg","#ffff00"),luckysheet.setCellFormat(a,r,"ps",{left:92,top:0,width:91,height:12,value:"修复前预警值：".concat(e.alertValue),isshow:!1})}}))})))}}))}catch(i){}case 1:return e.a(2)}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getAttrKeyByName",value:function(e){switch(e){case"自检":return"zijian";case"互检":return"hujian";case"专检":return"zhuanjian";default:return""}}}])}();t["a"]=new m},"74e8":function(e,t,a){"use strict";a("b2bb")},7616:function(e,t,a){},"769e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"80%",title:"厂商选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"请输入名称"},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"修程类型"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_repair_program,name,id"},model:{value:e.queryParam.repairProgramId,callback:function(t){e.$set(e.queryParam,"repairProgramId",t)},expression:"queryParam.repairProgramId"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"所属线路"}},[t("line-select-list",{model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_effective"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:4,sm:8}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)])],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"name",title:"厂商名称","min-width":"140","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"shortName",title:"厂商简称","min-width":"120"}}),t("vxe-table-column",{attrs:{field:"category_dictText",title:"厂商类别",width:"80"}}),t("vxe-table-column",{attrs:{field:"repairProgramName",title:"所属修程",width:"8%"}}),t("vxe-table-column",{attrs:{field:"lineName",title:"所属线路",width:"8%"}}),t("vxe-table-column",{attrs:{field:"contactName",title:"联系人员",width:"80"}}),t("vxe-table-column",{attrs:{field:"contactPhone",title:"联系电话",width:"100","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"email",title:"邮箱",width:"100","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"address",title:"地址","min-width":"120","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"appraise",title:"评分",width:"80","header-align":"center",align:"right"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}}),t("vxe-table-column",{attrs:{field:"remarks",title:"备注","min-width":"120","header-align":"center",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("d214"),n=a("5633"),l={name:"SupplierList",components:{LineSelectList:n["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{queryParam:{category:null,name:"",objTypeId:"",status:null,lineId:"",repairProgramId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["eb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.queryParam.searchText=""}}},s=l,c=(a("cc0c"),a("2877")),u=Object(c["a"])(s,r,o,!1,null,"2c33e9dc",null);t["default"]=u.exports},"796c":function(e,t,a){},"7b165":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:500,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"作业时间"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":{format:"HH:mm:ss",hideDisabledOptions:!0}},model:{value:e.workTime,callback:function(t){e.workTime=t},expression:"workTime"}})],1)],1)],1)],1)],1)],1)},o=[],i=a("c1df"),n=a.n(i),l=a("b9c3"),s={name:"WorkTimeModal",data:function(){return{value:1,title:"作业完成",labelText:"作业时间",visible:!1,labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:15}},confirmLoading:!1,form:this.$form.createForm(this),ids:"",workTime:void 0}},created:function(){},methods:{show:function(e){this.form.resetFields(),this.ids=e,this.visible=!0},handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,r){if(!a){t.confirmLoading=!0;var o=new FormData;o.append("itemIds",t.ids),t.workTime&&(t.workTime=n()(t.workTime).format("YYYY-MM-DD HH:mm:ss"),o.append("workTime",t.workTime)),Object(l["ab"])(o).then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok")):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1,t.close()})),e.visible=!1}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},c=s,u=a("2877"),d=Object(u["a"])(c,r,o,!1,null,"3f50fa8e",null);t["default"]=d.exports},"7ba1":function(e,t,a){"use strict";a("5bbd")},"7e9e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,centered:"",width:"100%",dialogClass:"fullDialog no-footer",visible:e.visible,confirmLoading:e.loading,footer:null,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.close,cancel:e.close}},[t("a-button",{attrs:{"na-btn-type":"print",type:"primary"},on:{click:e.print}},[e._v("导出")]),t("RecordSheetTable",{directives:[{name:"show",rawName:"v-show",value:e.recordSheet,expression:"recordSheet"}],ref:"recordTable"}),t("div",{staticStyle:{height:"20px"}}),t("TableExport",{ref:"tablePrintRef"})],1)},o=[],i=a("8fad"),n=a("958d"),l=a("45ff"),s={name:"RecordTableView",components:{RecordSheetTable:n["default"],TableExport:l["default"]},props:{},data:function(){return{title:"记录表查看",visible:!1,loading:!1,recordId:"",recordSheet:{}}},mounted:function(){},methods:{show:function(e){this.recordId=e,this.loadData(),this.visible=!0},close:function(){this.$emit("close"),this.visible=!1},loadData:function(){var e=this;Object(i["xb"])({id:this.recordId}).then((function(t){t.success?(e.recordSheet=t.result,e.$refs.recordTable.loadData(e.recordSheet)):e.$message.error("获取记录表详情失败")})).catch((function(t){e.$message.error("获取记录表详情异常")}))},print:function(){this.$refs.tablePrintRef.printById(this.recordId)}}},c=s,u=a("2877"),d=Object(u["a"])(c,r,o,!1,null,"a8b3abda",null);t["default"]=d.exports},"815e":function(e,t,a){},"842a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100vh - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24}},[t("a-form-item",{attrs:{label:"表单名称:"}},[t("a-input",{attrs:{placeholder:"表单名称",allowClear:""},on:{change:e.sortTable},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),t("a-form-item",{attrs:{label:"表单类型:"}},[t("a-select",{staticStyle:{width:"120px"},attrs:{allowClear:""},on:{change:e.sortTable},model:{value:e.searchCategory,callback:function(t){e.searchCategory=t},expression:"searchCategory"}},[t("a-select-option",{attrs:{value:3}},[e._v(" 作业记录表")]),t("a-select-option",{attrs:{value:1}},[e._v(" 数据记录表")]),t("a-select-option",{attrs:{value:4}},[e._v(" 检查记录表")])],1)],1),t("a-form-item",{},[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed",disabled:"1"===e.displayModel},on:{click:e.handleAdd}},[e._v("关联表单 ")]),t("a-button",{attrs:{type:"dashed",disabled:"1"===e.displayModel},on:{click:e.handleDel}},[e._v("删除关联")])],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},["1"===e.displayModel?t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:e.sumTableDate,"edit-rules":e.validRules,"keep-source":!0,"filter-config":{showIcon:!1},"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"checkbox-change":function(t){return e.btnStatus.update()},"checkbox-all":function(t){return e.btnStatus.update()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange},model:{value:r.workOrderTaskId,callback:function(t){e.$set(r,"workOrderTaskId",t)},expression:"row.workOrderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,3163574811)}):e._e(),t("vxe-table-column",{attrs:{field:"title",title:"表单名称",width:"25%","edit-render":{name:"input"},align:"left",filters:[{data:""}],"filter-method":e.customStringFilterMethod,"header-align":"center"},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择表单",open:!1},on:{focus:function(t){return e.openFormSelectModal(r)}},model:{value:r.formName,callback:function(t){e.$set(r,"formName",t)},expression:"row.formName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openFormSelectModal(r)}},slot:"suffixIcon"})],1)]}},{key:"default",fn:function(a){var r=a.row;return[t("a",{on:{click:function(t){return t.stopPropagation(),e.jumpInfo(r)}}},[e._v(e._s(r.formName))])]}}],null,!1,4164762839)}),t("vxe-table-column",{attrs:{field:"instType_dictText",title:"表单类型",width:"100","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.instType_dictText,callback:function(t){e.$set(r,"instType_dictText",t)},expression:"row.instType_dictText"}})]}}],null,!1,1183295985)}),t("vxe-table-column",{attrs:{field:"reguName",title:"所属规程",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.reguName)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.reguName,callback:function(t){e.$set(r,"reguName",t)},expression:"row.reguName"}})]}}],null,!1,3702729415)}),t("vxe-table-column",{attrs:{field:"reguVersion",title:"规程版本",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.reguVersion)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.reguVersion,callback:function(t){e.$set(r,"reguVersion",t)},expression:"row.reguVersion"}})]}}],null,!1,4216350919)}),t("vxe-table-column",{attrs:{field:"trainAssetName",title:"关联设备","edit-render":{name:"input"},align:"left","header-align":"center",formatter:e.formatterAssetName},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"trainAssetSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择关联设备",open:!1},on:{focus:function(t){return e.openAssetSelectModal(r)}},model:{value:r.trainAssetName,callback:function(t){e.$set(r,"trainAssetName",t)},expression:"row.trainAssetName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openAssetSelectModal(r)}},slot:"suffixIcon"})],1)]}}],null,!1,1688760708)}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"已填写？",width:"100"}}),t("vxe-table-column",{attrs:{field:"checkUserName",title:"检查",width:"100"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"$input",props:{placeholder:"请输入备注"}},align:"left","header-align":"center"}}),6===e.operator?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[[t("a-button",{attrs:{size:"small",disabled:6!==e.operator},on:{click:function(t){return t.stopPropagation(),e.jumpInfo(r)}}},[e._v("检查填写")])]]}}],null,!1,3991836714)}):e._e()],1):e._e(),"0"===e.displayModel?t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:e.taskForms,"edit-rules":e.validRules,"keep-source":!0,"filter-config":{showIcon:!1},"checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.taskForms=t},"checkbox-change":function(t){return e.btnStatus.update()},"checkbox-all":function(t){return e.btnStatus.update()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange},model:{value:r.workOrderTaskId,callback:function(t){e.$set(r,"workOrderTaskId",t)},expression:"row.workOrderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,3163574811)}):e._e(),t("vxe-table-column",{attrs:{field:"formName",title:"表单名称",width:"25%","edit-render":{name:"input"},align:"left","header-align":"center",filters:[{data:""}],"filter-method":e.customStringFilterMethod},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择表单",open:!1},on:{focus:function(t){return e.openFormSelectModal(r)}},model:{value:r.formName,callback:function(t){e.$set(r,"formName",t)},expression:"row.formName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openFormSelectModal(r)}},slot:"suffixIcon"})],1)]}},{key:"default",fn:function(a){var r=a.row;return[t("a",{on:{click:function(t){return t.stopPropagation(),e.jumpInfo(r)}}},[e._v(e._s(r.formName))])]}}],null,!1,4164762839)}),t("vxe-table-column",{attrs:{field:"instType_dictText",title:"表单类型",width:"100","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.instType_dictText,callback:function(t){e.$set(r,"instType_dictText",t)},expression:"row.instType_dictText"}})]}}],null,!1,1183295985)}),t("vxe-table-column",{attrs:{field:"reguName",title:"所属规程",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.reguName)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.reguName,callback:function(t){e.$set(r,"reguName",t)},expression:"row.reguName"}})]}}],null,!1,3702729415)}),t("vxe-table-column",{attrs:{field:"reguVersion",title:"规程版本",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.reguVersion)+" ")]}},{key:"edit",fn:function(a){var r=a.row;return[t("a-input",{attrs:{placeholder:"请选择表单",disabled:""},model:{value:r.reguVersion,callback:function(t){e.$set(r,"reguVersion",t)},expression:"row.reguVersion"}})]}}],null,!1,4216350919)}),t("vxe-table-column",{attrs:{field:"trainAssetName",title:"关联设备","edit-render":{name:"input"},align:"left","header-align":"center",formatter:e.formatterAssetName},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"trainAssetSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择关联设备",open:!1},on:{focus:function(t){return e.openAssetSelectModal(r)}},model:{value:r.trainAssetName,callback:function(t){e.$set(r,"trainAssetName",t)},expression:"row.trainAssetName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.openAssetSelectModal(r)}},slot:"suffixIcon"})],1)]}}],null,!1,1688760708)}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"已填写？",width:"100"}}),t("vxe-table-column",{attrs:{field:"checkUserName",title:"专验",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[3!==r.instType&&4!==r.instType||r.checkUserName?t("span",[e._v(e._s(r.checkUserName))]):t("span",[e._v("未检查")])]}}],null,!1,3387105567)}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"$input",props:{placeholder:"请输入备注"}},align:"left","header-align":"center"}})],1):e._e()],1),t("form-template",{ref:"formTemplate"}),t("FormsList",{ref:"modalForm",attrs:{multiple:!1},on:{ok:e.onSelectForm}}),t("FormsList",{ref:"multipleSelect",attrs:{multiple:!0},on:{ok:e.multipleSelectChange}}),t("CarDeviceSelect",{ref:"trainAssetSelectModal",attrs:{"train-no":e.trainNo,multiple:!1,canSelectType:[3,4]},on:{ok:e.onTrainAssetSelect,cancel:e.onCancelTrainAssetSelect}}),t("ViewWorkForm",{ref:"viewWorkForm",attrs:{operator:e.operator},on:{checkSuccess:e.onCheckSuccess}}),t("FormViewModal",{ref:"formViewModal"}),t("RecordTableView",{ref:"recordTableView"}),t("JobCheckTableView",{ref:"jobCheckTableView"}),t("TaskFormSelectModel",{ref:"formSelectModel",attrs:{"check-list":e.taskForms,"train-no":e.trainNo,lineId:e.workOrderInfo.lineId,repairId:e.repairId,operator:e.operator,workOrderId:e.workOrderInfo.id||e.workOrderInfo.orderId,workOrderTaskId:e.defaultTaskId},on:{ok:e.onAddForm}}),t("TaskFormDetaileModal",{ref:"taskFormDetaileModal",attrs:{workOrderInfo:e.workOrderInfo,tableForm:e.taskForms},on:{ok:e.onSelectFormDetaile}})],1)},o=[],i=a("ca00"),n=a("37582"),l=a("e42a"),s=a("4e0a"),c=a("05d5"),u=a("88da"),d=a("3dbe"),f=a("7e9e"),h=a("aaa8"),m=a("b7b4"),p=a("009c"),b=a("4681"),g=a("54f6"),v={name:"TaskForms",components:{FormsList:n["default"],TrainStructureList:s["default"],FormTemplate:c["default"],ViewWorkForm:u["default"],CarDeviceSelect:l["default"],FormViewModal:d["default"],RecordTableView:f["default"],JobCheckTableView:h["default"],TaskFormSelectModel:p["default"],TaskFormDetaileModal:b["default"]},props:{taskForms:{type:Array,default:function(){return[]}},workOrderInfo:{type:Object,default:function(){return{}}},tasks:{type:Array,default:function(){return[]}},repairId:{type:[Number,String],default:null},trainNo:{type:String,default:""},planId:{type:String,default:""},readOnly:{type:Boolean,default:!1},operator:{type:Number,default:0}},data:function(){return{defaultTaskId:"",displayModel:"0",curEditMode:0,curRow:null,searchText:"",searchCategory:null,validRules:{formName:[{required:!0,message:"表单必须选择",trigger:"manual"}],copies:[{required:!0,message:"数量必须填写",trigger:"manual"}],remark:[{max:200,type:"string",message:"备注不能超过200个字符"}]},sumTableDate:[],btnStatus:new g["a"](this,"listTable",{attrs:[{key:"edit",judge:function(e){return 3===e.instType||4===e.instType}}]})}},watch:{taskForms:function(e,t){(4===this.operator||6===this.operator||this.readOnly)&&(this.sumTableDate=this.taskForms,this.btnStatus.update())}},mounted:function(){(4===this.operator||6===this.operator||this.readOnly)&&(this.sumTableDate=this.taskForms,this.displayModel="1"),this.tasks&&this.tasks.length>0&&(this.defaultTaskId=this.tasks[0].id)},methods:{onCheckSuccess:function(e,t){this.taskForms.forEach((function(a){a.id===e.id&&(a.checkUserName=t.checkUserName)})),this.$forceUpdate()},remarkChange:function(e){var t=e.remark;return!(t.length>200)||(this.$message.error("备注不能超过200个字符"),!1)},handleChange:function(e){"1"===this.displayModel&&(this.sumTableDate=this.groupArr(this.taskForms))},groupArr:function(e){for(var t={},a=0;a<e.length;a++){var r=e[a],o="A"+r.formInstId,i=t[o];i||(i={},i.taskName="",i.instType=r.instType,i.formName=r.formName,i.formInstId=r.formInstId,i.instType_dictText=r.instType_dictText,i.trainAssetName=r.trainAssetName||r.assetTypeName,i.remark=r.remark,i.status_dictText=r.status_dictText,i.checkUserName=r.checkUserName,t[o]=i),i.taskName+=r.taskName}var n=[];for(var l in t)n.push(t[l]);return n},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator)},handleAdd:function(){this.tasks.length?this.$refs.listTable.getActiveRecord()||this.$refs.formSelectModel.showModal(this.planId):this.$message.warning("请先添加任务")},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.taskForms.map((function(a,r){t.id===a.id&&e.taskForms.splice(r,1)}))})),e.btnStatus.update()}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.taskForms.map((function(a,r){e.id===a.id&&t.taskForms.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.taskForms.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openFormSelectModal:function(e){this.curRow=e,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur()},onSelectForm:function(e){if(e&&e.forms.length>0){for(var t=e.forms[0],a=0,r=0,o=this.taskForms.length;r<o;r++){var i=this.taskForms[r];if(i.formObjId==t.id){a=1;break}}if(1===a)return void this.$message.error("你选择的表单已经在列表中存在，请选择其他表单");this.curRow.formName=t.title,this.curRow.formObjId=t.id,this.curRow.formCode=t.code,this.curRow.fromBy=2,this.curRow.formInstId="",this.curRow.instType=e.formType,this.curRow.planFormId="",this.curRow.instType_dictText=e.formTypeName,this.curRow.copies=1,this.curRow.status_dictText="未填写",this.curRow.fromBy=2,t.assetTypeId&&(this.curRow.assetTypeName=t.assetTypeName,this.curRow.assetTypeId=t.assetTypeId),this.curRow.isNew=!0}else this.curRow.formName="",this.curRow.objId="",this.curRow.formType="",this.curRow.formType_dictText="",this.curRow.copies=0,this.curRow.fromBy=2,this.curRow.isNew=!0},openAssetSelectModal:function(e){this.curRow=e,this.$refs.trainAssetSelectModal.showModal(),this.$refs.trainAssetSelect.blur()},onTrainAssetSelect:function(e){if(e.length){var t=e[0];t?(this.curRow.trainStructName=t.assetName,this.curRow.trainStructId=t.structDetailId,this.curRow.trainAssetId=t.id,this.curRow.trainAssetName=t.assetName,this.curRow.assetTypeId=t.assetTypeId):(this.curRow.trainStructName="",this.curRow.trainStructId="",this.curRow.trainAssetId="",this.curRow.trainAssetName="")}else this.curRow.trainStructName="",this.curRow.trainStructId="",this.curRow.trainAssetId="",this.curRow.trainAssetName=""},multipleSelectChange:function(e){for(var t=e.forms.length,a=0;a<t;a++){var r=e.forms[a],o=0;if(1!==o){var n={id:Object(i["p"])(),planId:this.planId,workOrderTaskId:"",formName:r.title,formObjId:r.id,formCode:r.code,fromBy:2,formInstId:"",instType:e.formType,planFormId:"",instType_dictText:e.formTypeName,copies:1,status_dictText:"未填写",trainStructName:"",trainStructId:"",trainAssetId:"",trainAssetName:"",assetTypeId:"",assetTypeName:""};this.tasks.length&&Object.assign(n,{workOrderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName}),r.assetTypeId&&(n.assetTypeName=r.assetTypeName,n.assetTypeId=r.assetTypeId),n.isNew=!0,this.taskForms.push(n),this.$refs.listTable.insertAt(n,-1)}}},onCancelTrainAssetSelect:function(){},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[t.key].taskName},jumpInfo:function(e){var t=this;e.isNew?(1===e.instType&&this.$refs.formViewModal.showModal(e.formObjId),3===e.instType&&(1===e.workRecordType?this.$refs.recordTableView.show(e.formObjId):2===e.workRecordType&&this.$refs.formViewModal.showModal(e.formObjId)),4===e.instType&&Object(m["y"])({id:e.formObjId}).then((function(e){if(e.success&&e.result){var a=e.result;t.$refs.jobCheckTableView.show(a)}else t.$message.error("加载检查记录表明细记录数据异常")}))):this.$refs.viewWorkForm.showModal(e,this.trainNo)},clearValidate:function(){this.$refs.listTable.clearValidate()},sortTable:function(){if(this.$refs.listTable){var e=this.$refs.listTable.getColumnByField("formName"),t=e.filters[0];t.checked=!0,this.$refs.listTable.updateData()}},customStringFilterMethod:function(e){var t=e.row,a=new RegExp(this.searchText);new RegExp(this.searchText);return a.test(t.formName)&&(!this.searchCategory||t.instType===this.searchCategory)},onAddForm:function(e){var t=this;e.length&&(e.forEach((function(e){t.taskForms.push({isNew:!0,id:Object(i["p"])(),planId:t.planId,formName:e.title,title:e.title,workOrderId:t.workOrderInfo.id,workOrderTaskId:t.tasks[0].id,formInstId:e.id,formObjId:e.formObjId,formCode:e.code,fromBy:2,instType:e.type||e.formType,instType_dictText:e.formType_dictText,workRecordType:e.workRecordType,status_dictText:"未填写",recordIds:"",remark:"",assetTypeName:e.assetTypeName,trainStructName:e.trainStructName,trainAssetName:e.assetName,trainStructWbs:e.trainStructWbs})})),this.btnStatus.update())},openFormDetaile:function(){var e=this.$refs.listTable.getCheckboxRecords();e.length?this.$refs.taskFormDetaileModal.showModal(e[0]):this.$message.warn("请勾选填写的数据")},formatterAssetName:function(e){e.cellValue;var t=e.row,a=t.trainAssetName||t.trainStructName||t.assetTypeName;if(t.trainStructWbs){var r=t.trainStructWbs.split(".");a=r[0]+"_"+a}return a},onSelectFormDetaile:function(e){var t=this.$refs.listTable.getCheckboxRecords()[0];t.recordIds=e||null}}},y=v,k=a("2877"),w=Object(k["a"])(y,r,o,!1,null,"410d5550",null);t["default"]=w.exports},8522:function(e,t,a){"use strict";a("f000")},"85df":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",visible:e.visible,title:"作业指导步骤选择",centered:"",bodyStyle:{height:"80vh"},confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("na-splitter",{staticClass:"booksetp-body",staticStyle:{},attrs:{defaultSize:300}},[t("div",{staticStyle:{"overflow-y":"auto","overflow-x":"hidden","padding-right":"2px",height:"100%"},attrs:{slot:"left-panel"},slot:"left-panel"},[t("a-card",{attrs:{id:"bookStepsContent",height:"100%"}},[t("div",{staticClass:"typeTitle"},[e._v("作业指导书")]),t("a-input-search",{staticStyle:{margin:"8px 0",width:"90%"},attrs:{placeholder:"输入名称"},model:{value:e.serchValue,callback:function(t){e.serchValue=t},expression:"serchValue"}}),t("div",{staticStyle:{width:"70%",margin:"0 auto","min-height":"100%"}},[t("a-tree",{attrs:{showLine:"",selectedKeys:e.selectedKeys,"tree-data":e.showTreeData,replaceFields:{title:"fileName",key:"id"}},on:{select:e.onSelect}})],1)],1)],1),t("div",{staticStyle:{"padding-left":"5px","padding-right":"3px"},attrs:{slot:"right-panel"},slot:"right-panel"},[t("div",{staticStyle:{height:"100%"}},[t("vxe-table",{ref:"listTable",staticStyle:{},attrs:{border:"","row-id":"id",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","radio-config":{trigger:"row"},"checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"stepNum",title:"步骤",width:"120px"}}),t("vxe-table-column",{attrs:{field:"stepTitle",title:"标题",align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.stepTitle)+" ")]}}])})],1)],1)])])],1)},o=[],i=a("8fad"),n={name:"SopDetailList",props:{multiple:{type:Boolean,default:!0},id:{type:String,default:""}},data:function(){return{fileType:[],queryParam:{bookId:""},allAlign:"center",totalResult:0,treeKey:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[],showTreeData:[],serchValue:"",selectedKeys:[]}},watch:{serchValue:function(){var e=this;this.showTreeData=this.treeData.map((function(t){return t.fileName.indexOf(e.serchValue)>-1?t:null})).filter((function(e){return e}))}},methods:{selectTree:function(){var e=this;Object(i["Ob"])({pageNo:1,pageSize:1e3,searchText:""}).then((function(t){t.success&&(e.treeData=t.result.records,e.showTreeData=t.result.records,e.treeData.length>0&&(e.queryParam.bookId=e.treeData[0].id,e.selectedKeys[0]=e.treeData[0].id,e.selectData=e.treeData[0],e.findList()))}))},showModal:function(){this.visible=!0,this.selectTree()},onSelect:function(e,t){if(e.length){var a=t.node.dataRef;this.queryParam.bookId=a.id,this.selectedKeys[0]=a.id,this.selectData=a,this.findList()}},findList:function(){var e=this;Object(i["Mb"])(this.queryParam).then((function(t){e.tableData=t.result}))},handleOk:function(){var e=this,t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),Array.from(t,(function(t){t.bookName=e.selectData.fileName})),this.$emit("ok",t),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=n,s=(a("61ca"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,null,null);t["default"]=c.exports},"88c7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","auto-resize":"",data:e.targetDeviceList,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.targetDeviceList=t},blur:function(t){return e.$refs.listTable.clearValidate()}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"orderTaskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange,blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:r.orderTaskId,callback:function(t){e.$set(r,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,2503425894)}):e._e(),t("vxe-table-column",{attrs:{field:"trainAssetName",title:"名称","tree-node":"",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"trainAssetNo",title:"编码",width:"12%"}}),t("vxe-table-column",{attrs:{field:"trainAssetStructType_dictText",title:"类型",width:"10%"}}),e.getButtonShow()&&e.tasks.length>1?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1)],1),t("CarDeviceSelectNew",{ref:"trainAssetSelectModal",attrs:{trainNo:e.trainNo,lineId:e.lineId,multiple:!0},on:{ok:e.onSelectToolMultiple}})],1)},o=[],i=a("310d");function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t,a){return(t=u(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function u(e){var t=d(e,"string");return"symbol"==n(t)?t:t+""}function d(e,t){if("object"!=n(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f={name:"targetDeviceListOrder",components:{CarDeviceSelectNew:i["default"]},props:{lineId:{type:[String,Number],default:""},trainNo:{type:[String,Number],default:""},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},forms:{type:Array,default:function(){return[]}},operator:{type:Number,default:0}},data:function(){return{curEditMode:0,curRow:null,targetDeviceList:[]}},watch:{tasks:{handler:function(e){if(e&&e.length){for(var t=[],a=function(a){e[a].equipments&&e[a].equipments.forEach((function(r){t.push(s(s({},r),{},{orderTaskName:e[a].taskName}))}))},r=0,o=e.length;r<o;r++)a(r);this.targetDeviceList=t}},deep:!0,immediate:!0}},methods:{updateTask:function(){var e=this,t=JSON.parse(JSON.stringify(this.tasks));Array.from(t,(function(t,a){t.equipments=e.targetDeviceList.filter((function(e){return t.id==e.orderTaskId}))})),this.$emit("update:tasks",t)},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||4===this.operator)},handleAdd:function(){this.curEditMode=1,this.$refs.trainAssetSelectModal.showModal()},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.targetDeviceList.map((function(a,r){t._XID===a._XID&&e.targetDeviceList.splice(r,1)}))})),e.updateTask()}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.targetDeviceList.map((function(a,r){e.id===a.id&&t.targetDeviceList.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.targetDeviceList.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0,t.updateTask()}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},onSelectToolMultiple:function(e){var t=this;e.forEach((function(e,a){if(t.targetDeviceList.find((function(t){return t.trainAssetId===e.id})))t.$message.warn("你选择的".concat(e.name,"已经在列表中存在"));else{var r={trainAssetName:e.name,trainAssetId:e.id,trainAssetNo:e.code,trainAssetStructType_dictText:e.maximoAssetType};t.tasks.length&&Object.assign(r,{orderTaskId:t.tasks[0].id,orderTaskName:t.tasks[0].taskName}),t.$refs.listTable.insertAt(r,-1),t.targetDeviceList.push(r),t.updateTask()}}))},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.orderTaskName=this.tasks[t.key].taskName,this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},clearValidate:function(){this.$refs.listTable.clearValidate()}}},h=f,m=a("2877"),p=Object(m["a"])(h,r,o,!1,null,null,null);t["default"]=p.exports},"88da":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,centered:"",visible:e.visible,width:"100%",dialogClass:6===e.operator?"fullDialog":"fullDialog no-footer",destroyOnClose:!0},on:{cancel:function(t){e.visible=!1}}},[t("a-button",{attrs:{"na-btn-type":"print",type:"primary"},on:{click:e.exportPrint}},[e._v("导出打印")]),3===e.formType&&1===e.workRecordType?t("div",{staticClass:"table-page-body",staticStyle:{height:"100%","overflow-y":"auto"}},[t("RecordSheetTable",{directives:[{name:"show",rawName:"v-show",value:e.curRecordData,expression:"curRecordData"}],ref:"recordTable"})],1):e._e(),4===e.formType?t("div",{staticClass:"table-page-body",staticStyle:{height:"100%","overflow-y":"auto"}},[t("JobCheckSheetTable",{ref:"jobCheckTable",attrs:{data:e.sheetData}})],1):e._e(),1===e.formType||3===e.formType&&2===e.workRecordType?t("div",{staticClass:"table-page-body",staticStyle:{height:"100%"}},[t("div",{attrs:{id:"luckysheet"}})]):e._e(),6===e.operator?t("template",{slot:"footer"},[t("a-button",{attrs:{type:"primary"},on:{click:e.confirmForm}},[e._v(" 检查确认")]),t("a-button",{on:{click:function(t){e.visible=!1}}},[e._v(" 关闭")])],1):e._e(),t("ConfirmForm",{ref:"confirmForm",on:{ok:e.handleOk}}),t("WorkRecordPrint",{ref:"workRecordPrint",attrs:{luckySheetId:"luckysheet"},on:{sheetPrintOk:e.onSheetPrintOk}}),t("JobCheckTableExport",{ref:"tablePrintRef"}),t("TableExport",{ref:"tablePrintRef2"})],2)},o=[],i=a("b7b4"),n=a("b9c3"),l=a("958d"),s=a("e0ce"),c=a("3cf2"),u=a("45ff"),d=a("8fad"),f=a("7268"),h=a("25e0"),m=a("10f9"),p=a("e24e"),b={name:"ViewWorkForm",components:{RecordSheetTable:l["default"],ConfirmForm:h["default"],JobCheckSheetTable:s["default"],WorkRecordPrint:m["default"],JobCheckTableExport:c["default"],TableExport:u["default"]},props:{operator:{type:Number,default:0}},data:function(){return{sheetData:{},formType:1,workRecordType:0,formName:"",trainNo:"",groupName:"",visible:!1,fileUrl:"",tableData:[],curRecordData:[],curOnlineForm:null,formSheetId:"",formInfo:{},formInstId:"",onLineInstId:"",defaultOptions:{container:"luckysheet",title:"sheet",column:26,row:50,lang:"zh",allowEdit:!1,showinfobar:!1,sheetFormulaBar:!1,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!1},printType:0,allItems:!0}},computed:{title:function(){return"表单查看-"+this.trainNo+"车 "+this.formName}},beforeDestroy:function(){luckysheet.destroy()},methods:{exportPrint:function(){try{var e="";switch(this.trainNo&&(e="-"+this.trainNo+"车"),this.formType){case 1:Object(p["a"])(luckysheet.getAllSheets(),this.formName+e);break;case 3:1===this.workRecordType?this.$refs.tablePrintRef2.printByData(this.curRecordData):2===this.workRecordType&&Object(p["a"])(luckysheet.getAllSheets(),this.formName+e);break;case 4:this.$refs.tablePrintRef.printByRow(this.sheetData)}}catch(t){}},initSheet:function(e){e.scrollLeft=0,e.scrollTop=0;var t=JSON.parse(JSON.stringify(this.defaultOptions));t.data=[e],luckysheet.destroy(),luckysheet.create(t)},showModal:function(e,t){try{this.formInfo=e,this.formType=e.instType,this.workRecordType=e.workRecordType,this.trainNo=t,this.formName=e.formName,this.formInstId=e.formInstId,this.allItems=!1,this.loadFormDetail(!1)}catch(a){}},showModalAllItem:function(e,t){try{this.formInfo=e,this.formType=e.instType,this.trainNo=t,this.formName=e.formName,this.formInstId=e.formInstId,this.allItems=!0,this.loadFormDetail(!0)}catch(a){}},loadFormDetail:function(e){this.printType=0;try{switch(this.formType){case 1:this.formInfo.formObjId=this.formInfo.id,this.loadOnlineFormDetail(this.formInfo.task2InstId,this.formInfo.formInstId);break;case 3:1===this.workRecordType?this.loadRecordTableDetail(this.formInfo.task2InstId,this.formInfo.formInstId,e):2===this.workRecordType&&this.loadWorkRecordDetail(this.formInfo.formObjId,this.formInfo.formInstId);break;case 4:this.loadWorkCheckFormDetail(this.formInfo.task2InstId,this.formInfo.formInstId,e)}}catch(t){}},loadWorkRecordDetail:function(e,t){var a=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.visible=!0,Object(d["rb"])(e).then((function(e){if(e.success){var o=JSON.parse(e.result);if(!r)return void a.initSheet(o);Object(n["U"])(t).then((function(e){if(e.success){if(e.result){var t=JSON.parse(e.result);o.data=[],o.celldata=luckysheet.transToCellData(t)}a.initSheet(o)}else a.initSheet(o)}))}else a.$message.error("获取作业记录表模板数据失败")}))},loadWorkCheckFormDetail:function(e,t){var a=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(n["P"])({task2InstId:e,formInstId:t,allItems:r}).then((function(e){if(e.success&&e.result){var t=e.result;a.sheetData=t,a.visible=!0}else a.$message.error("加载记录数据异常")}))},loadOnlineFormDetail:function(e,t){var a=this;this.visible=!0,Object(n["Q"])({task2InstId:e,formInstId:t,needValues:!1}).then((function(e){if(e.success){a.curOnlineForm=e.result;var t=null;if(a.curOnlineForm){if(a.curOnlineForm.result)try{t=JSON.parse(a.curOnlineForm.result)}catch(r){return void a.$message.error("转换表单填写结果异常")}Object(d["rb"])(a.curOnlineForm.formObjId).then((function(e){if(e.success){var r=JSON.parse(e.result);t&&(r.data=[],r.celldata=luckysheet.transToCellData(t)),a.initSheet(r)}else a.$message.error("获取表单模板数据失败")}))}else a.$message.error("获取作业表单数据失败")}else a.$message.error("获取记录表内容错误")}))},loadRecordTableDetail:function(e,t){var a=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(n["R"])({task2InstId:e,formInstId:t,needChecks:!0,needCategory:!0,allItems:r}).then((function(e){e.success&&e.result?(a.curRecordData=e.result,a.curRecordData.categoryList&&a.curRecordData.categoryList.sort((function(e,t){return e.recIndex-t.recIndex})),a.$nextTick((function(){a.$refs.recordTable.loadData(a.curRecordData)})),a.visible=!0):a.$message.error("加载记录数据异常")}))},confirmForm:function(){this.$refs.confirmForm.confirm(this.formInstId)},handleOk:function(e){if(3===this.formType&&2===this.workRecordType){var t=f["a"].searchCellByText("检查结果",luckysheet.getAllSheets()[0].data),a=t.c;if(t){var r=f["a"].getCellText(t.cell),o="1"===e.checkResult?"通过":"不通过";r=r.replace("检查结果：","检查结果："+o),f["a"].setCellValue(t.r,t.c,r)}t=f["a"].searchCellByText("检查日期",luckysheet.getAllSheets()[0].data);var i=t.c;if(t){var n=f["a"].getCellText(t.cell);n=n.replace("检查日期：","检查日期："+e.checkDate),f["a"].setCellValue(t.r,t.c,n)}t=f["a"].searchCellByText("质量负责人",luckysheet.getAllSheets()[0].data);var l=t.c;if(t){var s=f["a"].getCellText(t.cell);s=s.replace("质量负责人：","质量负责人："+e.checkUserName),f["a"].setCellValue(t.r,t.c,s)}if(a===i&&i===l){var c="1"===e.checkResult?"通过":"不通过",u="检查结果："+c;u+="          检查日期："+e.checkDate,u+="          质量负责人："+e.checkUserName,f["a"].setCellValue(t.r,t.c,u)}this.saveWorkRecord(!1)}this.$emit("checkSuccess",this.formInfo,e),this.visible=!1},saveWorkRecord:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=JSON.stringify(luckysheet.getAllSheets()[0].data),r={formInstId:this.formInfo.formInstId,xlsJson:a};Object(n["hb"])(r).then((function(a){a.success?t&&e.$message.success("保存作业记录表信息成功"):t&&e.$message.error("保存作业记录表信息失败")}))},print:function(){var e={id:this.formInfo.id,instType:this.formType,formInstId:this.formInfo.formInstId,formObjId:this.formInfo.formObjId,formName:this.formName,workRecordType:this.workRecordType};0===this.printType?this.$refs.workRecordPrint.print(e):1===this.printType&&this.$refs.workRecordPrint.printNoData(e)},onSheetPrintOk:function(){0===this.printType?this.loadFormDetail(this.allItems):1===this.printType&&this.loadFormDetailNoData()},showModalNoData:function(e,t){this.formInfo=e,this.formType=e.instType,this.trainNo=t,this.formName=e.formName,this.formInstId=e.formInstId,this.loadFormDetailNoData()},loadFormDetailNoData:function(){this.printType=1;try{switch(this.formType){case 1:this.formInfo.formObjId=this.formInfo.id,this.loadOnlineDetailNoData(this.formInfo.formInstId);break;case 3:1===this.workRecordType?this.loadRecordDetailNoData(this.formInfo.formInstId):2===this.workRecordType&&this.loadWorkRecordDetail(this.formInfo.formObjId||this.formInfo.id,this.formInfo.formInstId,!1);break;case 4:this.loadCheckDetailNoData(this.formInfo.formInstId)}}catch(e){}},loadRecordDetailNoData:function(e){var t=this;Object(d["xb"])({id:e}).then((function(e){e.success&&e.result?(t.curRecordData=e.result,t.curRecordData.categoryList&&t.curRecordData.categoryList.sort((function(e,t){return e.recIndex-t.recIndex})),t.$nextTick((function(){t.$refs.recordTable.loadData(t.curRecordData)})),t.visible=!0):t.$message.error("加载记录数据异常")}))},loadCheckDetailNoData:function(e){var t=this;Object(i["y"])({id:e}).then((function(e){try{if(e.success&&e.result){var a=e.result;t.sheetData=a,t.visible=!0}else t.$message.error("加载记录数据异常")}catch(r){t.$message.error("加载记录数据异常")}}))},loadOnlineDetailNoData:function(e){var t=this;this.visible=!0,Object(d["rb"])(e).then((function(e){if(e.success){var a=JSON.parse(e.result);t.$nextTick((function(){t.initSheet(a)}))}}))}}},g=b,v=(a("f0c5"),a("8522"),a("2877")),y=Object(v["a"])(g,r,o,!1,null,"a7b5b52c",null);t["default"]=y.exports},8973:function(e,t,a){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function n(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e){var t=s(e,"string");return"symbol"==r(t)?t:t+""}function s(e,t){if("object"!=r(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var c=function(){function e(){o(this,e)}return n(e,[{key:"joinDistributionInfo",value:function(e){!e||e.length<1||Array.from(e,(function(e){e.sourceLocationAndPalletName="",Array.from(e.assignDetailList,(function(t){var a="";a+="".concat(t.ebsWhCode,"=>").concat(t.ebsWhChildCode," | ").concat(t.amount),t.palletName&&(a+=" | "+t.amount),t.tradeNo&&(a+=" ｜ 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=a+" \n"}))}))}}])}();t["a"]=new c},"8cf3":function(e,t,a){"use strict";a("5126")},"8e5e":function(e,t,a){},"90f1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{ref:"tablePrint",attrs:{id:"tablePrintMain"}},[t("table",{staticClass:"table",staticStyle:{"font-size":"5px"}},[t("thead"),t("tr",[t("td",{staticStyle:{padding:"0"},attrs:{colspan:"4",rowspan:"2"},on:{click:e.print}},[e.recordSheet.assetTypeId?e._e():t("span",{staticStyle:{"padding-left":"5px"}},[e._v("车号："+e._s(e.recordSheet.trainNo))]),e.recordSheet.assetTypeId&&0===e.recordSheet.updown?t("table",{staticClass:"innerTable"},[t("tr",[t("td",{staticClass:"bottom"},[e._v("车号："+e._s(e.recordSheet.trainNo))])]),t("tr",[t("td",[e._v("部件号："+e._s(e.recordSheet.manufNo))])])]):e._e(),e.recordSheet.assetTypeId&&1===e.recordSheet.updown?t("table",{staticClass:"innerTable"},[t("tr",[t("td",{staticClass:"bottom"},[e._v("车号："+e._s(e.recordSheet.trainNo))])]),t("tr",[t("td",{staticClass:"bottom"},[e._v("原部件序列号："+e._s(e.recordSheet.manufNo))])]),t("tr",[t("td",[e._v("新部件序列号："+e._s(e.recordSheet.manufNoUp))])])]):e._e()]),t("td",{staticStyle:{"text-align":"center","font-weight":"bold"},attrs:{colspan:"3",rowspan:"2"}},[e._v(" "+e._s(e.recordSheet.title||e.recordSheet.workRecName)+" ")]),t("td",{attrs:{colspan:"3"}},[e._v("作业日期："+e._s(e.recordSheet.workDate)+" 完工日期: "+e._s(e.recordSheet.finishDate))])]),t("tr",[t("td",{attrs:{colspan:"3"}},[e._v("作业班组："+e._s(e.recordSheet.workGroupName))])]),e._m(0),e._l(e.recordSheet.categoryList,(function(a){return t("tbody",{key:a.id},e._l(a.detailList,(function(r,o){return t("tr",{key:r.id},[0===o?t("td",{attrs:{rowspan:a.detailList.length}},[e._v(" "+e._s(a.recIndex)+" ")]):e._e(),0===o?t("td",{attrs:{rowspan:a.detailList.length}},[e._v(" "+e._s(a.reguTitle)+" ")]):e._e(),t("td",[e._v(" "+e._s(r.workContent)+" ")]),t("td",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(r.checkLevel_dictText)+" ")]),t("td",[e._v(" "+e._s(r.techRequire)+" ")]),t("td",[e._v(" "+e._s(0==r.isIgnore?r.workInfo:r.ignoreDesc)+" ")]),t("td",{staticStyle:{"text-align":"center"}},[1===r.result?t("a-checkbox",{attrs:{checked:"",disabled:""}}):e._e(),0===r.result?t("a-checkbox",{attrs:{disabled:""}}):e._e()],1),t("td",[e._v(" "+e._s(r.selfCheck)+" ")]),t("td",[e._v(" "+e._s(r.guarderCheck)+" ")]),t("td",[e._v(" "+e._s(r.monitorCheck)+" ")])])})),0)})),e._l(e.recordSheet.measureToolList,(function(a,r){return t("tr",{key:r},[0===r?t("td",{attrs:{colspan:"2",rowspan:e.recordSheet.measureToolList.length}},[e._v("计量器具使用")]):e._e(),t("td",{attrs:{colspan:"2"}},[e._v("名称: "+e._s(a.name))]),t("td",[e._v("规格型号："+e._s(a.model))]),t("td",[e._v("出厂编号："+e._s(a.serialNo))]),t("td",{attrs:{colspan:"2"}},[e._v("上次检验时间："+e._s(a.lastCheckTime))]),t("td",{attrs:{colspan:"2"}},[e._v("下次检验时间："+e._s(a.nextCheckTime))])])})),t("tr",[t("td",{staticStyle:{height:"80px"},attrs:{colspan:"10"}},[e._v("情况说明："+e._s(e.recordSheet.remark))])]),t("tr",[t("td",{staticStyle:{height:"80px"},attrs:{colspan:"10"}},[t("span",{staticStyle:{"margin-left":"5%"}},[e._v("检查结果："+e._s(0===e.recordSheet.checkResult?"未通过":"通过")+" ")]),t("span",{staticStyle:{"margin-left":"30%"}},[e._v("检查日期："+e._s(e.recordSheet.checkDate)+" ")]),t("span",{staticStyle:{"margin-left":"30%"}},[e._v("质量负责人："+e._s(e.recordSheet.checkUserName)+" ")]),e._m(1)])])],2)])},o=[function(){var e=this,t=e._self._c;return t("tr",[t("th",{staticStyle:{width:"60px"}},[e._v("序号")]),t("th",{staticStyle:{width:"100px"}},[e._v("项目")]),t("th",{staticStyle:{width:"200px"}},[e._v("作业内容")]),t("th",{staticStyle:{width:"60px"}},[e._v("控制点")]),t("th",{staticStyle:{width:"200px"}},[e._v("技术要求")]),t("th",{staticStyle:{width:"200px"}},[e._v("作业情况")]),t("th",{staticStyle:{width:"80px"}},[e._v("结果")]),t("th",{staticStyle:{width:"60px"}},[e._v("自检")]),t("th",{staticStyle:{width:"60px"}},[e._v("互检")]),t("th",{staticStyle:{width:"60px"}},[e._v("专检")])])},function(){var e=this,t=e._self._c;return t("div",{staticStyle:{"padding-top":"15px"}},[e._v(" 说明："),t("br"),e._v(" 1. 控制点分为H点和W点，“H”点为该项工序操作过程必须经过专业工程师现场检查确认的工序，“W”点为班组长可在工序完工后确认的工序。"),t("br"),e._v(" 2. “自检”栏为作业者本人进行签字；“互检”栏由作业监护人员进行检查签字；“专检”栏由班组长进行检查签字。“质量负责人”由相关专业工程师进行签字。"),t("br"),e._v(" 3. “作业情况”需根据实际情况填写。若该项工序无异常则由作业者在框中填入√；若该项工序存在异常，则将实际故障情况填入框内。"),t("br"),e._v(" 4. “结果”栏方框在完成该项作业及检查后，由工班长进行填写。若无异常则在方框内填入√，若有异常，工班长需对故障情况进行确认，在方框内填入×，并将故障在“备注”栏进行汇总。"),t("br"),e._v(" 5. 作业内容中有数据要求的一并填入“作业情况”栏 。 ")])}],i=a("8fad"),n={name:"TablePrint",data:function(){return{recordSheet:{}}},mounted:function(){},methods:{printById:function(e){var t=this;Object(i["xb"])({id:e}).then((function(e){e.success?(t.recordSheet=e.result,t.$nextTick((function(){t.print()}))):t.$message.error("获取记录表详情失败")})).catch((function(e){t.$message.error("获取记录表详情异常")}))},printByData:function(e){var t=this;this.recordSheet=e,this.$nextTick((function(){t.print()}))},print:function(){var e=this.$refs.tablePrint.innerHTML,t=document.getElementById("printDom")||document.createElement("iframe");t.id="printDom",document.body.appendChild(t),this.$nextTick((function(){var t=document.getElementById("printDom");t.contentDocument.write(e);var a=t.contentDocument.getElementsByTagName("head").item(0),r=document.createElement("style");r.innerHTML=l,a.appendChild(r),t.contentWindow.print()}))}}},l=".table {\n        border-collapse: collapse;\n        border-spacing: 0;\n    }\n\n    .table td {\n        border-color: black;\n        border-style: solid;\n        border-width: 1px;\n        font-family: Arial, sans-serif;\n        font-size: 14px;\n        overflow: hidden;\n        padding: 10px 5px;\n        word-break: normal;\n    }\n\n    .table th {\n        border-color: black;\n        border-style: solid;\n        border-width: 1px;\n        font-family: Arial, sans-serif;\n        font-size: 14px;\n        font-weight: normal;\n        overflow: hidden;\n        padding: 10px 5px;\n        word-break: normal;\n    }\n\n    .table .tg-ld8d {\n        background-color: #f1f1f1;\n        border-color: inherit;\n        font-weight: bold;\n        text-align: left;\n        vertical-align: middle;\n    }\n\n    .table .tg-9wq8 {\n        border-color: inherit !important;\n        text-align: center !important;\n        vertical-align: middle !important;\n    }\n\n    .table .tg-87ij {\n        background-color: #f1f1f1;\n        border-color: inherit;\n        font-weight: bold;\n        text-align: center;\n        vertical-align: middle;\n    }\n\n    .table .tg-d1f0 {\n        background-color: #f1f1f1;\n        border-color: inherit;\n        font-size: 18px;\n        text-align: center;\n        vertical-align: top;\n    }\n\n    .table .tg-0pky {\n        border-color: inherit;\n        text-align: left;\n        vertical-align: top;\n    }\n\n    .qualityBox {\n        display: -ms-flexbox;\n        display: flex;\n        -ms-flex-align: end;\n        align-items: flex-end;\n    }\n\n    .qualityBox .flex1 {\n        -ms-flex: 1;\n        flex: 1;\n    }\n\n    .qualityBox .flex1 span {\n        margin-right: 15px;\n    }\n\n    .qualityBox [type='button'] {\n        margin-right: 15px;\n    }\n\n\n    .innerTable {\n        height: 100%;\n        width: 100%;\n        border-collapse: collapse;\n        border: 0;\n\n\n\n    }\n\n    .innerTable td {\n        border: 0;\n    }\n\n    .innerTable .bottom {\n        border-bottom: 1px solid #2d2a2a;\n    }\n\n    #tablePrintMain {\n        position: fixed;\n        background-color: #fff;\n        top: 120%;\n        opacity: 0;\n    }",s=n,c=(a("dc91"),a("2877")),u=Object(c["a"])(s,r,o,!1,null,"2cc9a1e0",null);t["default"]=u.exports},9216:function(e,t,a){"use strict";a("260f")},"92da":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{style:"height: calc(100% - ".concat(e.getButtonShow()?"47px":"4px",");")},[e.getButtonShow()?t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:8}},[t("a-form-item",[t("a-space",[t("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:e.handleAdd}},[e._v("添加")]),t("a-button",{attrs:{type:"dashed"},on:{click:e.handleDel}},[e._v("删除")])],1)],1)],1)],1)],1):e._e(),t("div",{attrs:{"na-flex-height-full":""}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto","keep-source":!0,data:e.stations,"edit-rules":e.validRules,"show-overflow":"ellipsis","checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(t){e.stations=t}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e.tasks&&e.tasks.length>1?t("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",width:"250",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},on:{change:e.taskSelectChange,blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:r.orderTaskId,callback:function(t){e.$set(r,"orderTaskId",t)},expression:"row.orderTaskId"}},e._l(e.tasks,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.id}},[e._v(" "+e._s(a.taskName)+" ")])})),1)]}}],null,!1,2503425894)}):e._e(),t("vxe-table-column",{attrs:{field:"workstationNo",width:"120",title:"工位号","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"stationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工位",open:!1},on:{focus:function(t){return e.openStationSelectModal(r)},blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:r.workstationNo,callback:function(t){e.$set(r,"workstationNo",t)},expression:"row.workstationNo"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}])}),t("vxe-table-column",{attrs:{field:"workstationName",width:"250",title:"工位名称",align:"left"},scopedSlots:e._u([{key:"edit",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.workstationName)+" ")]}}])}),t("vxe-table-column",{attrs:{field:"personNames",title:"安排人员",align:"left","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[1===e.operator?t("a-select",{ref:"userSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择人员",open:!1},on:{dropdownVisibleChange:function(t){return e.openUserModal(r)},blur:function(t){return e.$refs.listTable.clearValidate()}},model:{value:r.personNames,callback:function(t){e.$set(r,"personNames",t)},expression:"row.personNames"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1):t("span",[e._v(e._s(r.personNames))])]}}])}),e.getButtonShow()?t("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[e.$refs.listTable.isActiveByRow(r)?[t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]:[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑")])]]}}],null,!1,1311980394)}):e._e()],1)],1),e._v(" operator "),t("task-select-modal",{ref:"taskSelectModal",on:{ok:e.onSelectTask}}),t("work-station-list",{ref:"stationSelectModal",attrs:{groupId:1==e.operator&&e.groupId,multiple:1===e.curEditMode},on:{ok:e.onSelectStation}}),t("user-list",{ref:"userSelectModal",attrs:{depId:e.groupId},on:{ok:e.onSelectUser}})],1)},o=[],i=a("ca00"),n=a("383b"),l=a("1158"),s=a("b245"),c={name:"TaskStations",components:{TaskSelectModal:n["default"],WorkStationList:l["default"],UserList:s["default"]},props:{stations:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},groupId:{type:String,default:null},operator:{type:Number,default:0}},data:function(){return{curEditMode:0,curRow:null,validRules:{workstationNo:[{required:!0,message:"请选择工位",trigger:"manual"}]}}},methods:{getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator)},handleAdd:function(){var e=this;if(!this.$refs.listTable.getActiveRecord()){this.curEditMode=1;var t={id:Object(i["p"])()};this.selectTask?Object.assign(t,{orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}):this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName}),this.$refs.listTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"workstationNo")}))}},handleDel:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length>0?this.$confirm({content:"是否删除选中".concat(t.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){t.map((function(t){e.stations.map((function(a,r){t.id===a.id&&e.stations.splice(r,1)}))}))}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(e){this.curEditMode=2,this.$refs.listTable.setActiveRow(e)},delRowEvent:function(e){var t=this;this.stations.map((function(a,r){e.id===a.id&&t.stations.splice(r,1)}))},saveRowEvent:function(e){var t=this;this.$refs.listTable.validate(e,(function(a){if(a)for(var r in a){var o=a[r];o.forEach((function(e){e.rule&&t.$message.error(e.rule.message)}))}else 1===t.curEditMode&&t.stations.push(e),t.$refs.listTable.clearActived(),t.curEditMode=0,t.$emit("selectUser"),t.$forceUpdate()}))},cancelRowEvent:function(e){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(e):2===this.curEditMode&&this.$refs.listTable.revertData(e),this.curEditMode=0},openStationSelectModal:function(e){this.curRow=e,this.$refs.stationSelectModal.showModal(),this.$refs.stationSelect.blur(),this.$refs.listTable.clearValidate()},onSelectStation:function(e){var t=this;if(e&&e.length>0){var a=e[0];e.forEach((function(r,o){if(t.stations.find((function(e){return e.workstationId===r.id&&t.curRow.orderTaskId===e.orderTaskId})))t.$message.warn("存在同样的任务及工位数据，无需重复设置");else if(o>0){var n={id:Object(i["p"])(),orderTaskId:t.curRow.orderTaskId,taskName:t.curRow.taskName,workstationId:r.id,workstationName:r.name,workstationNo:r.stationNo,remark:r.remark};t.stations.push(n)}else t.curRow.workstationId=a.id,t.curRow.workstationName=a.name,t.curRow.workstationNo=a.stationNo,t.curRow.remark=a.remark,e.length>1&&(1===t.curEditMode&&t.stations.push(t.curRow),t.curEditMode=0)}))}else this.curRow.workstationId="",this.curRow.workstationName="",this.curRow.workstationNo="",this.curRow.remark="";this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},openTaskSelectModal:function(e){this.curRow=e,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(e){if(e&&e.length>0){var t=e[0];this.curRow.orderTaskId=t.id,this.curRow.taskName=t.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},handleArrange:function(){var e=this.$refs.listTable.getCheckboxRecords();e.length>0?this.$refs.userSelectModal.showModal():this.$message.error("尚未选中要安排人员的工位!")},openUserModal:function(e){this.$refs.userSelectModal.showModal()},onSelectUser:function(e){var t=[];if(e&&e.length>0&&e.forEach((function(e){t.push({userId:e.id,realName:e.realname})})),0===this.curEditMode){var a=this.$refs.listTable.getCheckboxRecords();a.forEach((function(e){e.staffUserIds=t.map((function(e){return e.userId})),e.personNames=t.map((function(e){return e.realName})).join(",")}))}else{var r=this.$refs.listTable.getActiveRecord().row;r.staffUserIds=t.map((function(e){return e.userId})),r.personNames=t.map((function(e){return e.realName})).join(",")}},taskSelectChange:function(e,t){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[t.key].taskName,this.$refs.listTable.validate(this.$refs.listTable.getActiveRecord().row,(function(e){}))},clearValidate:function(){this.$refs.listTable.clearValidate()}}},u=c,d=a("2877"),f=Object(d["a"])(u,r,o,!1,null,"646bee91",null);t["default"]=f.exports},"932f":function(e,t,a){},9424:function(e,t,a){},"94c2d":function(e,t,a){},9527:function(e,t,a){},"958d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("table",{staticClass:"table"},[t("thead",[t("tr",[t("td",{staticStyle:{padding:"0"},attrs:{colspan:"4",rowspan:"2"}},[e.recordSheet.assetTypeId?e._e():t("span",{staticStyle:{"padding-left":"5px"}},[e._v("车号："+e._s(e.recordSheet.trainNo))]),e.recordSheet.assetTypeId&&0===e.recordSheet.updown?t("table",{staticClass:"innerTable"},[t("tr",[t("td",{staticClass:"bottom"},[e._v("车号："+e._s(e.recordSheet.trainNo))])]),t("tr",[t("td",[e._v("部件号："+e._s(e.recordSheet.manufNo))])])]):e._e(),e.recordSheet.assetTypeId&&1===e.recordSheet.updown?t("table",{staticClass:"innerTable"},[t("tr",[t("td",{staticClass:"bottom"},[e._v("车号："+e._s(e.recordSheet.trainNo))])]),t("tr",[t("td",{staticClass:"bottom"},[e._v("原部件序列号："+e._s(e.recordSheet.manufNo))])]),t("tr",[t("td",[e._v("新部件序列号："+e._s(e.recordSheet.manufNoUp))])])]):e._e()]),t("td",{staticStyle:{"text-align":"center","font-weight":"bold"},attrs:{colspan:"3",rowspan:"2"}},[e._v(" "+e._s(e.recordSheet.title||e.recordSheet.workRecName)+" ")]),t("td",{attrs:{colspan:"3"}},[e._v("作业日期："+e._s(e.recordSheet.workDate)+" 完工日期: "+e._s(e.recordSheet.finishDate))])]),t("tr",[t("td",{attrs:{colspan:"3"}},[e._v("作业班组："+e._s(e.recordSheet.workGroupName))])]),e._m(0)]),e._l(e.recordSheet.categoryList,(function(a){return t("tbody",{key:a.id},e._l(a.detailList,(function(r,o){return t("tr",{key:r.id},[0===o?t("td",{attrs:{rowspan:a.detailList.length}},[e._v(" "+e._s(a.recIndex)+" ")]):e._e(),0===o?t("td",{attrs:{rowspan:a.detailList.length}},[e._v(" "+e._s(a.reguTitle)+" ")]):e._e(),t("td",[e._v(" "+e._s(r.workContent)+" ")]),t("td",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(r.checkLevel_dictText)+" ")]),t("td",[e._v(" "+e._s(r.techRequire)+" ")]),t("td",[e._v(" "+e._s(0==r.isIgnore?r.workInfo:r.ignoreDesc)+" ")]),t("td",{staticStyle:{"text-align":"center"}},[1===r.result?t("a-checkbox",{attrs:{checked:"",disabled:""}}):e._e(),0===r.result?t("a-checkbox",{attrs:{disabled:""}}):e._e()],1),t("td",[e._v(" "+e._s(r.selfCheck)+" ")]),t("td",[e._v(" "+e._s(r.guarderCheck)+" ")]),t("td",[e._v(" "+e._s(r.monitorCheck)+" ")])])})),0)})),e._l(e.recordSheet.measureToolList,(function(a,r){return t("tr",{key:r},[0===r?t("td",{attrs:{colspan:"2",rowspan:e.recordSheet.measureToolList.length}},[e._v("计量器具使用")]):e._e(),t("td",{attrs:{colspan:"2"}},[e._v("名称: "+e._s(a.name))]),t("td",[e._v("规格型号："+e._s(a.model))]),t("td",[e._v("出厂编号："+e._s(a.serialNo))]),t("td",{attrs:{colspan:"2"}},[e._v("上次检验时间："+e._s(a.lastCheckTime))]),t("td",{attrs:{colspan:"2"}},[e._v("下次检验时间："+e._s(a.nextCheckTime))])])})),t("tr",[t("td",{staticStyle:{height:"80px"},attrs:{colspan:"10"}},[e._v("情况说明："+e._s(e.recordSheet.remark))])]),t("tr",[t("td",{staticStyle:{height:"80px"},attrs:{colspan:"10"}},[t("span",{staticStyle:{"margin-left":"5%"}},[e._v("检查结果："+e._s(0===e.recordSheet.checkResult?"未通过":"通过")+" ")]),t("span",{staticStyle:{"margin-left":"30%"}},[e._v("检查日期："+e._s(e.recordSheet.checkDate)+" ")]),t("span",{staticStyle:{"margin-left":"30%"}},[e._v("质量负责人："+e._s(e.recordSheet.checkUserName)+" ")]),e._m(1)])])],2)])},o=[function(){var e=this,t=e._self._c;return t("tr",[t("th",{staticStyle:{width:"60px"}},[e._v("序号")]),t("th",{staticStyle:{width:"100px"}},[e._v("项目")]),t("th",{staticStyle:{width:"200px"}},[e._v("作业内容")]),t("th",{staticStyle:{width:"60px"}},[e._v("控制点")]),t("th",{staticStyle:{width:"200px"}},[e._v("技术要求")]),t("th",{staticStyle:{width:"200px"}},[e._v("作业情况")]),t("th",{staticStyle:{width:"80px"}},[e._v("结果")]),t("th",{staticStyle:{width:"60px"}},[e._v("自检")]),t("th",{staticStyle:{width:"60px"}},[e._v("互检")]),t("th",{staticStyle:{width:"60px"}},[e._v("专检")])])},function(){var e=this,t=e._self._c;return t("div",{staticStyle:{"padding-top":"15px"}},[e._v(" 说明："),t("br"),e._v(" 1. 控制点分为H点和W点，“H”点为该项工序操作过程必须经过专业工程师现场检查确认的工序，“W”点为班组长可在工序完工后确认的工序。"),t("br"),e._v(" 2. “自检”栏为作业者本人进行签字；“互检”栏由作业监护人员进行检查签字；“专检”栏由班组长进行检查签字。“质量负责人”由相关专业工程师进行签字。"),t("br"),e._v(" 3. “作业情况”需根据实际情况填写。若该项工序无异常则由作业者在框中填入√；若该项工序存在异常，则将实际故障情况填入框内。"),t("br"),e._v(" 4. “结果”栏方框在完成该项作业及检查后，由工班长进行填写。若无异常则在方框内填入√，若有异常，工班长需对故障情况进行确认，在方框内填入×，并将故障在“备注”栏进行汇总。"),t("br"),e._v(" 5. 作业内容中有数据要求的一并填入“作业情况”栏 。 ")])}],i={name:"RecordSheetTable",data:function(){return{recordSheet:{}}},methods:{loadData:function(e){this.recordSheet=e}}},n=i,l=(a("d88b"),a("2877")),s=Object(l["a"])(n,r,o,!1,null,"197d5722",null);t["default"]=s.exports},9615:function(e,t,a){"use strict";a("94c2d")},9866:function(e,t,a){},"9f49":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{class:{"na-footer-none":2===e.modeType},attrs:{title:"托盘选择",width:"80%",bodyStyle:{height:"70vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,centered:!0,forceRender:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"托盘编码"}},[t("a-input",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"物资类型"}},[t("a-select",{ref:"materialSelect",staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"请选择物料",open:!1},on:{change:e.clearMaterialChange,dropdownVisibleChange:e.openMaterialSelectModal},model:{value:e.materialTypeName,callback:function(t){e.materialTypeName=t},expression:"materialTypeName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){t.stopPropagation(),e.queryParam.typeId=""}},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"使用状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_pallet_use_status"},model:{value:e.queryParam.useStatus,callback:function(t){e.$set(e.queryParam,"useStatus",t)},expression:"queryParam.useStatus"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"托盘状态"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_valid_status"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}})],1)],1),t("a-col",{attrs:{md:4}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),e.loading?t("div",{staticStyle:{height:"calc(100% - 110px)"},attrs:{id:"pallet_table_main"}},[t("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",height:"auto",data:e.tableData,"show-overflow":"tooltip","radio-config":{highlight:!0,trigger:"row"},"row-class-name":e.setRowClass},on:{"cell-click":e.onCurrentChange}},[1===e.modeType?t("vxe-table-column",{attrs:{type:"radio",width:"60px"}}):e._e(),t("vxe-table-column",{attrs:{field:"code",title:"托盘编码"}}),t("vxe-table-column",{attrs:{field:"name",title:"托盘名称"}}),t("vxe-table-column",{attrs:{field:"materialTypeNames",title:"物资类型","min-width":"100",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"size",title:"尺寸"}}),t("vxe-table-column",{attrs:{field:"texture",title:"材质"}}),t("vxe-table-column",{attrs:{field:"useStatus_dictText",title:"使用状态",width:"120"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注"}})],1)],1):e._e(),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.page.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}}),t("material-list",{ref:"materialForm",attrs:{multiple:!1},on:{ok:e.onSelectMaterial}})],1)},o=[],i=a("c54ca"),n=a("7164"),l={name:"PalletList",components:{MaterialList:n["default"]},props:{multiple:{type:Boolean,default:!1},modeType:{type:Number,default:1}},data:function(){return{visible:!1,confirmLoading:!1,loading:!1,tableData:[],selectMaterialTypeId:"",materialTypeName:"",queryParam:{pageNo:1,pageSize:10,searchText:"",typeId:null,useStatus:null,status:null},page:{totalResult:3}}},updated:function(){var e=this;this.$nextTick((function(){e.loading=!0}))},created:function(){},methods:{showModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.visible=!0,this.selectMaterialTypeId=e,this.materialTypeName=t,this.queryParam.typeId=e,this.findList()},findList:function(){var e=this;Object(i["mb"])(this.queryParam).then((function(t){t.success&&(e.tableData=t.result.records,e.page.totalResult=t.result.total)}))},handleOk:function(){var e=this,t=this.$refs.listTable.getRadioRecord();t&&t.useStatus?this.$confirm({content:"该托盘正在使用中，确认继续选择该托盘？",okText:"确定",cancelText:"取消",onOk:function(){e.$emit("ok",t?[t]:[]),e.visible=!1}}):(this.$emit("ok",t?[t]:[]),this.visible=!1)},saveOk:function(){this.close()},saveFail:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},close:function(){this.visible=!1},openMaterialSelectModal:function(e){e&&(this.$refs.materialForm.showModal(),this.$refs.materialSelect.blur())},clearMaterialChange:function(e){e||(this.queryParam.typeId=null,this.materialTypeName=null)},onSelectMaterial:function(e){e.length&&(this.queryParam.typeId=e[0].id,this.materialTypeName=e[0].name)},onCurrentChange:function(e){var t=e.row;e.$event;2===this.modeType&&(this.$emit("ok",[t]),this.visible=!1)},setRowClass:function(){return 2===this.modeType?"mode-type-choose":""}}},s=l,c=(a("b0c8"),a("2877")),u=Object(c["a"])(s,r,o,!1,null,null,null);t["default"]=u.exports},a2a1:function(e,t,a){"use strict";a("4fe7e")},a396:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"70%",title:"故障分类选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:""}},[t("a-input",{attrs:{placeholder:"请输入故障分类编码或者描述"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-form-item",[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:"序号"}}),t("vxe-table-column",{attrs:{field:"categoryCode",title:"故障分类编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"categoryDesc",title:"故障分类描述",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("b47d"),n={name:"FaultCategoryList",props:{multiple:{type:Boolean,default:!0}},data:function(){return{queryParam:{searchText:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["O"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.queryParam.searchText=""}}},l=n,s=(a("2a71"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"124b546c",null);t["default"]=c.exports},a4db:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:e.title,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"搜索"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"分类"}},[t("j-dict-select-tag",{attrs:{dictCode:"bu_tools_type",disabledArray:e.canSelectType},model:{value:e.queryParam.category1,callback:function(t){e.$set(e.queryParam,"category1",t)},expression:"queryParam.category1"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":e.onCellClick}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别",width:"150"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"150"}}),e.batch?t("vxe-table-column",{attrs:{field:"num",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}):e._e()],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("c54ca"),n={name:"ToolTypeSelect",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:function(){return[4,5,6]}},batch:{type:Boolean,default:!1}},data:function(){return{title:"工器具类型选择",queryParam:{type:"2",searchText:"",category1:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.category1=this.canSelectType[0]),this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["Cb"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"num",1)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},checkRadioMethod:function(e){var t=e.row;return!this.canSelectType||-1!==this.canSelectType.indexOf(t.category1)},onCellClick:function(e){var t=e.row,a=e.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([t],!0)}}},l=n,s=(a("7ba1"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"df2d4508",null);t["default"]=c.exports},a6da:function(e,t,a){e.exports=a.p+"img/code.77bdebfa.png"},a9f9:function(e,t,a){"use strict";a("d392")},aaa8:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,centered:"",width:"100%",dialogClass:"fullDialog no-footer",visible:e.visible,confirmLoading:e.loading,footer:null,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.close,cancel:e.close}},[t("a-button",{attrs:{"na-btn-type":"print",type:"primary"},on:{click:e.print}},[e._v("导出打印")]),t("JobCheckSheetTable",{ref:"jobCheckTable",attrs:{fromData:e.fromData,qualityEvaluation:e.qualityEvaluation,data:e.sheetData},on:{brush:function(t){return e.$emit("brush")},judgeChange:e.onJudgeChange}}),t("JobCheckTableExport",{ref:"tablePrintRef"}),t("div",{staticStyle:{height:"20px"}})],1)},o=[],i=a("e0ce"),n=a("3cf2"),l={name:"JobCheckTableView",components:{JobCheckSheetTable:i["default"],JobCheckTableExport:n["default"]},props:{qualityEvaluation:{type:Boolean,default:!1},fromData:{type:Object,default:function(){}}},data:function(){return{title:"作业检查表查看",visible:!1,loading:!1,sheetData:{}}},mounted:function(){},methods:{show:function(e){this.visible=!0,this.sheetData=e},close:function(){this.$emit("close"),this.visible=!1},print:function(){this.$refs.tablePrintRef.printByRow(this.sheetData)},onJudgeChange:function(e){this.sheetData=e}}},s=l,c=a("2877"),u=Object(c["a"])(s,r,o,!1,null,"0613ba03",null);t["default"]=u.exports},ab7d:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"故障编辑",width:"100%",centered:"",visible:e.visible,dialogClass:"fullDialog",confirmLoading:e.confirmLoading,cancelText:"关闭"},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticStyle:{height:"calc(100vh - 5px)","overflow-y":"auto"}},[e.visible?t("BreakdownFormItem",{ref:"breakdownForm",attrs:{fromWriteReport:e.fromWriteReport,workStationsList:e.workStationsList},on:{ok:e.onSaveOk,fail:e.onSaveFail,cancel:e.onSaveCancel}}):e._e()],1)])},o=[],i=a("d0ca"),n={name:"BreakdownModal",components:{BreakdownFormItem:i["default"]},props:{showWorkStation:{type:Boolean,default:!1},fromWriteReport:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,workStationsList:[]}},created:function(){},methods:{setWorkStations:function(e){var t=this;this.workStationsList.length=0,e.forEach((function(e){t.workStationsList.find((function(t){return t.workstationId===e.workstationId}))||t.workStationsList.push(e)}))},add:function(e,t,a){this.edit({workOrderId:e,orderTaskId:t,formType:a,createType:a})},edit:function(e){var t=this;this.visible=!0,this.$nextTick((function(){t.$refs.breakdownForm.edit(e)}))},handleOk:function(){this.confirmLoading=!0,this.$refs.breakdownForm.save()},onSaveOk:function(){this.confirmLoading=!1,this.visible=!1,this.$message.success("保存成功"),this.$emit("ok")},onSaveFail:function(){this.$message.error("保存失败"),this.confirmLoading=!1},onSaveCancel:function(){this.confirmLoading=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.confirmLoading=!1,this.visible=!1}}},l=n,s=(a("7068"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"12e1d6e2",null);t["default"]=c.exports},b0c8:function(e,t,a){"use strict";a("815e")},b245:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"85%",title:"人员选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",bodyStyle:{height:"70vh"},destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-row",[t("a-col",{attrs:{md:4,sm:24}},[t("div",{staticStyle:{height:"calc(70vh - 20px)","border-right":"1px solid #e3e1e1","margin-right":"15px"}},[e.treeData&&e.treeData.length>0?t("a-tree",{staticClass:"limitHeight",attrs:{defaultSelectedKeys:[e.queryParam.depId],defaultExpandAll:!0,"tree-data":e.treeData},on:{select:e.onSelect}}):e._e()],1)]),t("a-col",{attrs:{md:20,sm:24}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"账号"}},[t("a-input",{attrs:{placeholder:"请输入用户账号"},model:{value:e.queryParam.username,callback:function(t){e.$set(e.queryParam,"username",t)},expression:"queryParam.username"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"真实名字"}},[t("a-input",{attrs:{placeholder:"请输入真实名字"},model:{value:e.queryParam.realname,callback:function(t){e.$set(e.queryParam,"realname",t)},expression:"queryParam.realname"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"手机号码"}},[t("a-input",{attrs:{placeholder:"请输入手机号码"},model:{value:e.queryParam.phone,callback:function(t){e.$set(e.queryParam,"phone",t)},expression:"queryParam.phone"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"角色"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"sys_role,role_name,id",placeholder:"选择角色"},model:{value:e.queryParam.roleId,callback:function(t){e.$set(e.queryParam,"roleId",t)},expression:"queryParam.roleId"}})],1)],1),t("a-col",{attrs:{md:2,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(70vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 130px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"100%","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"manual",mode:"row"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"5%"}}):t("vxe-table-column",{attrs:{type:"radio",width:"5%"}}),t("vxe-table-column",{attrs:{field:"workNo",title:"工号",width:"100",align:"center"}}),t("vxe-table-column",{attrs:{field:"username",title:"用户账号",width:"150",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"realname",title:"用户名字",width:"100",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"roleNames",title:"角色","min-width":"180",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"sex_dictText",title:"性别",width:"80"}}),t("vxe-table-column",{attrs:{field:"phone",title:"手机号码",width:"120"}}),t("vxe-table-column",{attrs:{field:"orgCode",title:"部门",width:"120",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"80"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])],1)],1)},o=[],i=a("8fad"),n={name:"UserList",props:{multiple:{type:Boolean,default:!0},depId:{type:String,default:""}},data:function(){return{queryParam:{username:"",realname:"",phone:"",orgCode:"",roleId:void 0,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[]}},watch:{depId:function(e){this.$set(this.queryParam,"depId",e||"")}},mounted:function(){this.$set(this.queryParam,"depId",this.depId||"")},methods:{showModal:function(){this.visible=!0,this.findList(),this.getTreeList()},getTreeList:function(){var e=this;Object(i["mb"])().then((function(t){t.success&&(e.treeData=t.result)}))},onSelect:function(e,t){if(e.length){var a=t.node.dataRef;this.queryParam.depId=a.id,this.findList()}else this.queryParam.orgCode="",this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["gc"])(this.queryParam).then((function(t){e.loading=!1,t.success?(e.totalResult=t.result.total,e.tableData=t.result.records):e.$message.error("加载用户数据失败")})).catch((function(t){e.$message.error("加载用户数据异常")})).finally((function(){}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,Object.assign(this.$data,this.$options.data())}}},l=n,s=(a("f76d"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"4aa7956f",null);t["default"]=c.exports},b2bb:function(e,t,a){},b7b4:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"i",(function(){return i})),a.d(t,"l",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"t",(function(){return c})),a.d(t,"v",(function(){return l})),a.d(t,"n",(function(){return d})),a.d(t,"C",(function(){return f})),a.d(t,"D",(function(){return h})),a.d(t,"p",(function(){return m})),a.d(t,"m",(function(){return b})),a.d(t,"j",(function(){return g})),a.d(t,"w",(function(){return v})),a.d(t,"a",(function(){return y})),a.d(t,"h",(function(){return k})),a.d(t,"k",(function(){return T})),a.d(t,"q",(function(){return x})),a.d(t,"z",(function(){return C})),a.d(t,"r",(function(){return S})),a.d(t,"e",(function(){return I})),a.d(t,"s",(function(){return _})),a.d(t,"B",(function(){return P})),a.d(t,"x",(function(){return N})),a.d(t,"y",(function(){return O})),a.d(t,"d",(function(){return w})),a.d(t,"f",(function(){return $})),a.d(t,"o",(function(){return p})),a.d(t,"A",(function(){return j})),a.d(t,"E",(function(){return D})),a.d(t,"g",(function(){return M})),a.d(t,"u",(function(){return u}));var r=a("0fea"),o=function(e){return Object(r["j"])("/quality/rectify/add",e)},i=function(e){return Object(r["j"])("/quality/rectify/delete",e)},n=function(e){return Object(r["j"])("/quality/rectify/edit",e)},l=function(e){return Object(r["d"])("/quality/rectify/page",e)},s=function(e){return Object(r["j"])("/quality/rectify/close",e)},c=function(e){return Object(r["d"])("/quality/rectify/get",e)},u=function(e){return Object(r["d"])("/quality/rectify/getCode",e)},d=function(e){return Object(r["d"])("/quality/measurealert/page",e)},f=function(e){return Object(r["d"])("/quality/measurethreshold/form/page-data-form",e)},h=function(e){return Object(r["j"])("/quality/measurethreshold/threshold/save",e)},m=function(e){return Object(r["d"])("/quality/measurethreshold/threshold/list/".concat(e))},p=function(e){return Object(r["d"])("/serialPlan/plan/forms/online-form/alert-records",{dataRecordId:e})},b=function(e){return Object(r["j"])("/quality/measurethreshold/threshold/edit",e)},g=function(e){return Object(r["j"])("/quality/measurethreshold/threshold/delete",e)},v=function(e){return Object(r["d"])("/quality/measurethreshold/threshold/get",e)},y=function(e){return Object(r["j"])("/quality/leaverecord/add",e)},k=function(e){return Object(r["j"])("/quality/leaverecord/delete",e)},w=function(e){return Object(r["j"])("/quality/leaverecord/close",e)},T=function(e){return Object(r["j"])("/quality/leaverecord/edit",e)},x=function(e){return Object(r["d"])("/quality/leaverecord/page",e)},C=function(e,t){return Object(r["c"])("/quality/leaverecord/workLeaveRecordExport",e,t)},S=function(e){return Object(r["d"])("/quality/record-confirm/list",e)},I=function(e){return Object(r["j"])("/quality/record-confirm/confirm",e)},_=function(e){return Object(r["d"])("/quality/record-confirm/work-record/get",e)},N=function(e){return Object(r["d"])("/serialPlan/plan/forms/check-record/get",e)},O=function(e){return Object(r["d"])("/workcheck/get",e)},$=function(e){return Object(r["j"])("/quality/record-confirm/confirm",e)},P=function(e){return Object(r["d"])("/quality/record-confirm/page",e)},j=function(e){return Object(r["d"])("/quality/record-confirm/page/check-record",e)},D=function(e){return Object(r["j"])("/serialPlan/plan/forms/judge/save",e)},M=function(e){return Object(r["j"])("/serialPlan/plan/forms/judge/delete",e)}},b8d8:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("j-modal",{attrs:{title:e.title,width:"90%",centered:"",visible:e.visible,footer:null,destroyOnClose:!0,fullscreen:"",cancelText:"关闭"},on:{cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"编码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["rectifyNo"],expression:"['rectifyNo']",modifiers:{trim:!0}}],attrs:{placeholder:"请输入",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改类型"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["rectifyType"],expression:"['rectifyType']",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_work_rectify_type",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"关联工单"}},[t("span",[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderName"],expression:"['orderName']",modifiers:{trim:!0}}],ref:"myOrderSelect",attrs:{"allow-clear":"",placeholder:"请选择工单",open:!1,showArrow:!0,disabled:""}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"责任班组"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["groupId"],expression:"['groupId']",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictGroupStr,disabled:""},on:{change:e.changeGroup}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改状态"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["status"],expression:"['status']",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_work_rectify_status",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改工位"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["workstationId"],expression:"['workstationId']",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictCodeStr,disabled:""}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆段"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["depotId"],expression:"['depotId']",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:"bu_mtr_depot,name,id",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路"}},[t("line-select-list",{directives:[{name:"decorator",rawName:"v-decorator",value:["lineId"],expression:"['lineId']"}],attrs:{disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"整改工序"}},[t("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["orderTaskId"],expression:"['orderTaskId']",modifiers:{trim:!0}}],attrs:{triggerChange:!0,dictCode:e.dictCodeStrOrder,disabled:""}})],1)],1)],1),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:16,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"任务名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["title"],expression:"['title']",modifiers:{trim:!0}}],attrs:{placeholder:"请输入",disabled:""}})],1)],1),t("a-col",{attrs:{md:8,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"下发日期",width:"40"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["sendDate"],expression:"['sendDate']",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{disabled:""}})],1)],1)],1),t("a-row",{attrs:{gutter:24}}),t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:23,sm:24}},[t("a-form-item",{attrs:{labelCol:e.labelCol1,wrapperCol:e.wrapperCol1,label:"备注说明"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["remark"],expression:"['remark']",modifiers:{trim:!0}}],attrs:{placeholder:"请输入",disabled:""}})],1)],1)],1),t("a-divider",{staticStyle:{"font-size":"14px"},attrs:{orientation:"left"}},[e._v("已上传列表")]),t("vxe-table",{staticStyle:{"margin-top":"12px"},attrs:{border:"",data:e.annexList,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"}}},[t("div",{}),t("vxe-table-column",{attrs:{type:"seq",title:"序号",width:"50px","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"title",title:"文件名","header-align":"left",align:"left"}}),t("vxe-table-column",{attrs:{title:"操作",width:"160px","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("a",{staticStyle:{"margin-right":"12px"},on:{click:function(t){return t.stopPropagation(),e.handleSeeing(r)}}},[e._v("查看")])]}}])})],1),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}})],1)],1)],1)},o=[],i=a("c1df"),n=a.n(i),l=a("353a"),s=a("b7b4"),c=a("5633");function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(e,t,a){return(t=f(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function f(e){var t=h(e,"string");return"symbol"==u(t)?t:t+""}function h(e,t){if("object"!=u(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var m={name:"ViewFaultTaskItem",components:{DocPreviewModal:l["default"],LineSelectList:c["default"]},data:function(){var e;return e={title:"操作",dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",fileList:[],annexList:[],rectifyId:"",filePath:"",fileName:"",status:!1,uploading:!1,dictCodeStr:"bu_mtr_workstation,name,id",dictCodeStrOrder:""},d(d(d(d(d(d(d(d(d(d(e,"title","整改项信息"),"visible",!1),"model",{}),"labelCol",{xs:{span:24},sm:{span:7}}),"wrapperCol",{xs:{span:24},sm:{span:13}}),"labelCol1",{xs:{span:24},sm:{span:2}}),"wrapperCol1",{xs:{span:24},sm:{span:22}}),"labelCol2",{xs:{span:24},sm:{span:3}}),"wrapperCol2",{xs:{span:24},sm:{span:19}}),"dutyUsername",""),d(d(d(d(d(e,"dutyUserId",""),"isClose",!1),"confirmLoading",!1),"form",this.$form.createForm(this)),"workOrderId","")},created:function(){},methods:{view:function(e){var t=this;this.visible=!0,this.confirmLoading=!0,Object(s["t"])({id:e.taskObjId}).then((function(e){t.confirmLoading=!1,e.success&&(t.model=e.result,t.$nextTick((function(){t.form.setFieldsValue({rectifyNo:t.model.rectifyNo,rectifyType:t.model.rectifyType,groupId:t.model.groupId,workstationId:t.model.workstationId,lineId:t.model.lineId,status:t.model.status,sendDate:n()(t.model.sendDate||new Date,"YYYY-MM-DD"),depotId:t.model.depotId,title:t.model.title,remark:t.model.remark,orderTaskId:t.model.orderTaskId,orderName:t.model.orderName}),t.annexList=t.model.annexList||[]})))}))},changeGroup:function(e){this.dictCodeStr=e?"bu_mtr_workstation,name,id,id in (select workstation_id from bu_group_workstation where group_id = '"+e+"')":"bu_mtr_workstation,name,id"},handleSeeing:function(e){this.fileName=e.title,this.$refs.docPreview.handleFilePath(e.address)},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.handleModel={}}}},p=m,b=(a("a2a1"),a("2877")),g=Object(b["a"])(p,r,o,!1,null,"415219de",null);t["default"]=g.exports},b9c3:function(e,t,a){"use strict";a.d(t,"lb",(function(){return n})),a.d(t,"f",(function(){return l})),a.d(t,"i",(function(){return s})),a.d(t,"v",(function(){return c})),a.d(t,"b",(function(){return f})),a.d(t,"l",(function(){return h})),a.d(t,"p",(function(){return m})),a.d(t,"G",(function(){return p})),a.d(t,"c",(function(){return d})),a.d(t,"B",(function(){return g})),a.d(t,"k",(function(){return y})),a.d(t,"A",(function(){return v})),a.d(t,"x",(function(){return k})),a.d(t,"g",(function(){return w})),a.d(t,"E",(function(){return T})),a.d(t,"C",(function(){return x})),a.d(t,"M",(function(){return S})),a.d(t,"kb",(function(){return I})),a.d(t,"O",(function(){return N})),a.d(t,"N",(function(){return O})),a.d(t,"jb",(function(){return $})),a.d(t,"t",(function(){return j})),a.d(t,"d",(function(){return D})),a.d(t,"W",(function(){return M})),a.d(t,"X",(function(){return R})),a.d(t,"e",(function(){return L})),a.d(t,"o",(function(){return A})),a.d(t,"V",(function(){return E})),a.d(t,"R",(function(){return U})),a.d(t,"Q",(function(){return z})),a.d(t,"K",(function(){return Y})),a.d(t,"L",(function(){return J})),a.d(t,"fb",(function(){return ge})),a.d(t,"bb",(function(){return H})),a.d(t,"Y",(function(){return Q})),a.d(t,"J",(function(){return K})),a.d(t,"hb",(function(){return ie})),a.d(t,"U",(function(){return ne})),a.d(t,"eb",(function(){return Z})),a.d(t,"cb",(function(){return X})),a.d(t,"a",(function(){return ee})),a.d(t,"j",(function(){return ue})),a.d(t,"nb",(function(){return de})),a.d(t,"gb",(function(){return fe})),a.d(t,"m",(function(){return he})),a.d(t,"H",(function(){return ve})),a.d(t,"T",(function(){return V})),a.d(t,"S",(function(){return q})),a.d(t,"mb",(function(){return F})),a.d(t,"z",(function(){return me})),a.d(t,"db",(function(){return pe})),a.d(t,"y",(function(){return be})),a.d(t,"u",(function(){return u})),a.d(t,"F",(function(){return b})),a.d(t,"ob",(function(){return P})),a.d(t,"q",(function(){return _})),a.d(t,"D",(function(){return C})),a.d(t,"ib",(function(){return te})),a.d(t,"n",(function(){return ae})),a.d(t,"I",(function(){return W})),a.d(t,"P",(function(){return B})),a.d(t,"s",(function(){return le})),a.d(t,"Z",(function(){return se})),a.d(t,"ab",(function(){return ce})),a.d(t,"h",(function(){return re})),a.d(t,"w",(function(){return oe})),a.d(t,"r",(function(){return G}));var r=a("0fea"),o=a("4328"),i=a.n(o),n=function(e){return Object(r["j"])("/group/fault/info/submit",e)},l=function(e){return Object(r["j"])("/group/fault/info/cancel",e)},s=function(e){return Object(r["j"])("/group/fault/info/delete",e)},c=function(e){return Object(r["d"])("/group/fault/info/page",e)},u=function(e){return Object(r["d"])("/group/fault/info/get",e)},d=function(e){return Object(r["j"])("/group/safeassume/read/add",e)},f=function(e){return Object(r["j"])("/group/safeassume/add",e)},h=function(e){return Object(r["j"])("/group/safeassume/delete",e)},m=function(e){return Object(r["j"])("/group/safeassume/edit",e)},p=function(e){return Object(r["d"])("/group/safeassume/page",e)},b=function(e){return Object(r["d"])("/group/safeassume/get",e)},g=function(e){return Object(r["d"])("/group/turnoverchange/page",e)},v=function(e){return Object(r["d"])("/material/spare-part/get",e)},y=function(e){return Object(r["j"])("/group/turnoverchange/delete",e)},k=function(e){return Object(r["d"])("/group/measurealert/page",e)},w=function(e){return Object(r["j"])("/group/measurealert/close",e)},T=function(e){return Object(r["d"])("/group/spare-part/page",e)},x=function(e){return Object(r["d"])("/group/spare-part/get",e)},C=function(e){return Object(r["d"])("/produce/train/history/asset/use/page",e)},S=function(e){return Object(r["d"])("/group/toolequipment/page",e)},I=function(e){return Object(r["j"])("/group/toolequipment/setStatus",e)},_=function(e){return Object(r["d"])("/group/toolequipment/usage",e)},N=function(e){return Object(r["d"])("/group/tool/page",e)},O=function(e){return Object(r["d"])("/group/tool/get",e)},$=function(e){return Object(r["j"])("/group/tool/setDutyUser",e)},P=function(e){return Object(r["d"])("/group/tool/usage",e)},j=function(e){return Object(r["d"])("/group/information/basic",e)},D=function(e){return Object(r["j"])("/group/information/tools/add",e)},M=function(e){return Object(r["d"])("/group/information/workstation/page-related",e)},R=function(e){return Object(r["d"])("/group/information/workstation/page-unrelated",e)},L=function(e){return Object(r["j"])("/group/information/workstation/add",e)},A=function(e){return Object(r["j"])("/group/information/workstation/delete",e)},q=function(e){return Object(r["d"])("/workGroup/workOrder/relevanceInfo/".concat(e))},F=function(e){return Object(r["j"])("/workGroup/workOrder/submit-to-dispatcher",i.a.stringify(e))},E=function(e){return Object(r["d"])("/workGroup/workRecord/list",e)},z=function(e){return Object(r["d"])("/serialPlan/plan/forms/online-form/get",e)},U=function(e){return Object(r["d"])("/serialPlan/plan/forms/work-record/get",e)},B=function(e){return Object(r["d"])("/serialPlan/plan/forms/check-record/get",e)},V=function(e){return Object(r["d"])("/workGroup/workOrder/page",e)},G=function(e){return Object(r["d"])("/workGroup/workOrder/apply/page",e)},Y=function(e){return Object(r["d"])("/workGroup/workRecord/recordForm",e)},J=function(e){return Object(r["d"])("/workGroup/workRecord/relevanceInfo/".concat(e))},W=function(e){return Object(r["d"])("/workGroup/workRecord/relevanceInfo/bookSteps/".concat(e))},H=function(e){return Object(r["j"])("/workGroup/workRecord/save/form-result",e)},Q=function(e){return Object(r["j"])("/workGroup/workRecord/check",e)},K=function(e){return Object(r["j"])("/workGroup/workRecord/getTaskQRCode",e)},Z=function(e){return Object(r["j"])("/workGroup/workRecord/work-record/save-manufNo",i.a.stringify(e))},X=function(e){return Object(r["j"])("/workGroup/workRecord/save/material",e)},ee=function(e){return Object(r["j"])("/workGroup/workRecord/save/actMaterial",e)},te=function(e){return Object(r["j"])("/workGroup/workRecord/save/work-time",e)},ae=function(e){return Object(r["j"])("/workGroup/workRecord/arrange/delete",e)},re=function(e){return Object(r["j"])("/workGroup/workOrder/material/commit-temp-apply",e)},oe=function(e){return Object(r["d"])("/workGroup/workOrder/material/apply/list",e)},ie=function(e){return Object(r["j"])("/workGroup/workRecord/check/saveExcelData",e)},ne=function(e){return Object(r["d"])("/workGroup/workRecord/get/excelData/".concat(e))},le=function(e){return Object(r["d"])("/serialPlan/plan/forms/check-record/item/list",e)},se=function(e){return Object(r["j"])("/workGroup/workRecord/check-record/set-check",e)},ce=function(e){return Object(r["j"])("/workGroup/workRecord/check-record/set-time",e)},ue=function(e){return Object(r["j"])("/workGroup/workRecord/delete/material",i.a.stringify(e))},de=function(e){return Object(r["j"])("/workGroup/workRecord/submit-task",e)},fe=function(e){return Object(r["j"])("/workGroup/workRecord/save/tool",e)},he=function(e){return Object(r["j"])("/workGroup/workRecord/delete/tool",i.a.stringify(e))},me=function(e){return Object(r["d"])("/workGroup/workRecord/outsourceOutin",e)},pe=function(e){return Object(r["j"])("/workGroup/workRecord/save/outsourceOutin",e)},be=function(e){return Object(r["d"])("/workGroup/workRecord/outin/not-returns",e)},ge=function(e){return Object(r["j"])("/group/safeassume/read/add",i.a.stringify(e))},ve=function(e){return Object(r["d"])("/serialPlan/plan/page",e)}},bca7:function(e,t,a){"use strict";a("39ff7")},bd18:function(e,t,a){"use strict";a("3ab9")},c0a8:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"监修详情",width:"80%",visible:e.visible,footer:null,destroyOnClose:!0,dialogClass:"fullDialog no-footer",cancelText:"关闭"},on:{cancel:e.handleCancel}},[t("div",{staticStyle:{"overflow-y":"auto"}},[t("div",{staticClass:"info-wrapper info-top-wrapper",staticStyle:{"margin-top":"10px"}},[t("h4",[e._v("基本信息")]),t("a-descriptions",{attrs:{bordered:"",column:4}},[t("a-descriptions-item",{attrs:{label:"任务名称"}},[e._v(" "+e._s(e.detail.taskContent)+" ")]),t("a-descriptions-item",{attrs:{label:"所属线路"}},[e._v(" "+e._s(e.detail.lineName)+" ")]),t("a-descriptions-item",{attrs:{label:"派遣工班"}},[e._v(" "+e._s(e.detail.dispatchGroupName)+" ")]),t("a-descriptions-item",{attrs:{label:"派遣人员"}},[e._v(" "+e._s(e.detail.dispatchUserName)+" ")]),t("a-descriptions-item",{attrs:{label:"联系方式"}},[e._v(" "+e._s(e.detail.userPhone)+" ")]),t("a-descriptions-item",{attrs:{label:"派往公司"}},[e._v(" "+e._s(e.detail.supplierName)+" ")]),t("a-descriptions-item",{attrs:{label:"联系方式"}},[e._v(" "+e._s(e.detail.supplierPhone)+" ")]),t("a-descriptions-item",{attrs:{label:"联系地址"}},[e._v(" "+e._s(e.detail.supplierAddress)+" ")]),t("a-descriptions-item",{attrs:{label:"出派时间"}},[e._v(" "+e._s(e.detail.dispatchDate)+" ")]),t("a-descriptions-item",{attrs:{label:"返回时间"}},[e._v(" "+e._s(e.detail.returnDate)+" ")]),t("a-descriptions-item",{attrs:{label:"所属合同"}},[e._v(" "+e._s(e.detail.contractNo)+" ")]),t("a-descriptions-item",{attrs:{label:"设备项目"}},[e._v(" "+e._s(e.detail.assetTypeName)+" ")]),t("a-descriptions-item",{attrs:{label:"申请时间"}},[e._v(" "+e._s(e.detail.createTime)+" ")]),t("a-descriptions-item",{attrs:{label:"当前审批"}},[e._v(" "+e._s(e.detail.wfStatus)+" ")])],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("附件信息")]),t("div",{staticStyle:{height:"calc(100vh - 380px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(100vh - 430px)"},attrs:{border:"",align:e.allAlign,data:e.tableData,"max-height":"90%","show-overflow":"tooltip","checkbox-config":{trigger:"row",highlight:!0,range:!0},"edit-config":{trigger:"manual",mode:"row"}}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{title:"-",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("span",[t("a-space",[t("a",{on:{click:function(t){return t.stopPropagation(),e.handleSeeing(r)}}},[e._v("查看")]),t("a",{on:{click:function(t){return t.stopPropagation(),e.handleDownload(r)}}},[e._v("下载")])])],1)]}}])}),t("vxe-table-column",{attrs:{field:"name",title:"资料名称","min-width":"180","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"type",title:"文件类型",width:"100"}}),t("vxe-table-column",{attrs:{field:"fileSize",title:"大小(KB)",width:"120","header-align":"center",align:"right"}}),t("vxe-table-column",{attrs:{field:"uploadDate",title:"上传日期",width:"120"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注","header-align":"center",align:"left"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)]),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}})],1)])},o=[],i=a("353a"),n=a("d214"),l=a("e2aa"),s={name:"SuperviseItemDetailModal",components:{DocPreviewModal:i["default"]},data:function(){return{detail:{},annexList:[],visible:!1,handleModel:{},fileName:"",queryParam:{fileType:null,outinDetailId:"",pageNo:1,pageSize:10},totalResult:0,allAlign:"center",tableData:[]}},methods:{findList:function(){var e=this;this.queryParam.outinDetailId=this.detail.outinDetailId,Object(n["O"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},show:function(e){this.visible=!0,this.detail=e,this.findList()},showByTask:function(e){var t=this,a={orderTaskId:e.id,workOrderId:e.orderId};Object(n["cb"])(a).then((function(e){e.success?t.show(e.result):t.$message.warn(e.message)}))},handleSeeing:function(e){this.fileName=e.name,this.$refs.docPreview.handleFilePath(e.savepath)},handleDownload:function(e){Object(l["b"])(e.savepath)},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},c=s,u=(a("0d5f"),a("2877")),d=Object(u["a"])(c,r,o,!1,null,"773e8586",null);t["default"]=d.exports},c35c:function(e,t,a){},c95b:function(e,t,a){},c984:function(e,t,a){},cc0c:function(e,t,a){"use strict";a("cdfd")},ccb3:function(e,t,a){},cdfd:function(e,t,a){},d0ca:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{height:"calc(100% - 0px)","overflow-y":"auto"}},[t("a-form-model",{ref:"form",staticStyle:{"margin-top":"10px"},attrs:{model:e.faultModel,rules:e.formRules}},[t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("故障信息")]),t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"列计划",prop:"planName"}},[t("div",{on:{click:e.openPlanModel}},[t("a-select",{ref:"myPlanSelect",attrs:{"allow-clear":"",placeholder:"请选择列计划",open:!1,showArrow:!0,triggerChange:!0},on:{change:e.changePlanSelect},model:{value:e.faultModel.planName,callback:function(t){e.$set(e.faultModel,"planName",t)},expression:"faultModel.planName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)])],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路",prop:"lineId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},on:{change:e.changeLine},model:{value:e.faultModel.lineId,callback:function(t){e.$set(e.faultModel,"lineId",t)},expression:"faultModel.lineId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"车辆",prop:"trainNo"}},[t("j-dict-select-seach-tag",{attrs:{triggerChange:!0,dictCode:e.dictTrainStr},on:{focus:e.handleSysFocus,change:e.handleTrainNo},model:{value:e.faultModel.trainNo,callback:function(t){e.$set(e.faultModel,"trainNo",t)},expression:"faultModel.trainNo"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"发现阶段",prop:"phase"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_fault_phase"},model:{value:e.faultModel.phase,callback:function(t){e.$set(e.faultModel,"phase",t)},expression:"faultModel.phase"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"发现时间",prop:"happenTime"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm","show-time":{format:"HH:mm",hideDisabledOptions:!0}},on:{change:function(t){e.faultModel.reportTime=void 0,e.handleModel.solutionTime=void 0,e.faultModel.solutionTime=void 0,e.reportTimeKey++,e.solutionTimeKey++}},model:{value:e.faultModel.happenTime,callback:function(t){e.$set(e.faultModel,"happenTime",t)},expression:"faultModel.happenTime"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障工位",prop:"workStationName"}},[t("a-select",{ref:"workStationSelect",attrs:{placeholder:"请选择故障工位",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(5)}},model:{value:e.faultModel.workStationName,callback:function(t){e.$set(e.faultModel,"workStationName",t)},expression:"faultModel.workStationName"}},[t("div",{attrs:{slot:"suffixIcon"},slot:"suffixIcon"},[e.faultModel.workStationName?t("a-icon",{staticStyle:{"padding-right":"3px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.clearValue(5)}}}):e._e(),t("a-icon",{attrs:{type:"ellipsis"}})],1)])],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"系统",prop:"sysId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,"dict-code":e.dictTrainSys},on:{change:e.changeLinesubsys,focus:e.handleSysFocus},model:{value:e.faultModel.sysId,callback:function(t){e.$set(e.faultModel,"sysId",t)},expression:"faultModel.sysId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障部件",prop:"faultAssetName"}},[t("a-select",{ref:"faultAssetSelect",attrs:{placeholder:"请选择",open:!1,showArrow:!0},on:{focus:e.showAssetModal},model:{value:e.faultModel.faultAssetName,callback:function(t){e.$set(e.faultModel,"faultAssetName",t)},expression:"faultModel.faultAssetName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"故障描述",prop:"faultDesc"}},[t("a-textarea",{attrs:{placeholder:"请输入内容"},model:{value:e.faultModel.faultDesc,callback:function(t){e.$set(e.faultModel,"faultDesc",t)},expression:"faultModel.faultDesc"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:{span:6},wrapperCol:{span:18},label:"其他属性"}},[t("a-row",[t("a-col",{attrs:{span:8}},[e._v(" 是否正线: "),t("a-switch",{model:{value:e.faultModel.faultOnline,callback:function(t){e.$set(e.faultModel,"faultOnline",t)},expression:"faultModel.faultOnline"}})],1),t("a-col",{attrs:{span:8}},[e._v(" 是否委外: "),t("a-switch",{model:{value:e.faultModel.outsource,callback:function(t){e.$set(e.faultModel,"outsource",t)},expression:"faultModel.outsource"}})],1)],1)],1)],1),e.faultModel.outsource?t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属厂商",prop:"outSupplierName"}},[t("a-select",{ref:"mySupplierSelect",attrs:{placeholder:"请选择厂商",triggerChange:!0,open:!1,showArrow:!0},on:{focus:e.openSupplierModal},model:{value:e.faultModel.outSupplierName,callback:function(t){e.$set(e.faultModel,"outSupplierName",t)},expression:"faultModel.outSupplierName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1):e._e()],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("提报信息")]),t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{ref:"reportGroupTag",attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"提报班组",prop:"reportGroupId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:e.dictGroupStr},model:{value:e.faultModel.reportGroupId,callback:function(t){e.$set(e.faultModel,"reportGroupId",t)},expression:"faultModel.reportGroupId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"提报人员",prop:"reportUserId"}},[t("a-select",{ref:"tmyuserSelect1",attrs:{placeholder:"请选择人员",open:!1},on:{focus:function(t){return e.showUserModal(1)}},model:{value:e.faultModel.reportUserName,callback:function(t){e.$set(e.faultModel,"reportUserName",t)},expression:"faultModel.reportUserName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(t){return e.showUserModal(1)}},slot:"suffixIcon"})],1)],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"责任工程师",prop:"dutyEngineer"}},[t("a-select",{ref:"tmyuserSelect2",attrs:{placeholder:"请选择责任工程师",open:!1,showArrow:!0},on:{focus:function(t){return e.showUserModal(2)}},model:{value:e.faultModel.dutyEngineerName,callback:function(t){e.$set(e.faultModel,"dutyEngineerName",t)},expression:"faultModel.dutyEngineerName"}},[t("div",{attrs:{slot:"suffixIcon"},slot:"suffixIcon"},[e.faultModel.dutyEngineerName?t("a-icon",{staticStyle:{"padding-right":"3px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.clearValue(6)}}}):e._e(),t("a-icon",{attrs:{type:"ellipsis"}})],1)])],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{key:"reportTime"+e.reportTimeKey,attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"提报时间",prop:"reportTime"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{disabledDate:e.dateTimeDisabled1,disabledTime:e.disabledDateTime1,format:"YYYY-MM-DD HH:mm","show-time":!!e.faultModel.happenTime&&{format:"HH:mm",hideDisabledOptions:!0}},on:{change:function(t){e.handleModel.solutionTime=void 0,e.faultModel.solutionTime=void 0,e.solutionTimeKey++}},model:{value:e.faultModel.reportTime,callback:function(t){e.$set(e.faultModel,"reportTime",t)},expression:"faultModel.reportTime"}})],1)],1)],1)],1),t("div",{staticClass:"info-wrapper info-top-wrapper"},[t("h4",[e._v("处理信息")]),t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理状态",prop:"status"}},[t("a-radio-group",{attrs:{name:"radioGroup",disabled:e.fromWriteReport},on:{change:e.changeFaultStatus},model:{value:e.faultModel.status,callback:function(t){e.$set(e.faultModel,"status",t)},expression:"faultModel.status"}},[t("a-radio",{attrs:{value:0}},[e._v(" 未处理")]),t("a-radio",{attrs:{value:1}},[e._v(" 已处理")]),t("a-radio",{attrs:{value:3}},[e._v(" 遗留故障")])],1)],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障代码",prop:"faultCodeId"}},[t("a-select",{ref:"faultCodeIdSelect",attrs:{placeholder:"请选择所属故障代码",open:!1,showArrow:!0},on:{focus:function(t){return e.openSelectTypeModal(2)}},model:{value:e.faultModel.faultCodeCodeDes,callback:function(t){e.$set(e.faultModel,"faultCodeCodeDes",t)},expression:"faultModel.faultCodeCodeDes"}},[t("div",{attrs:{slot:"suffixIcon"},slot:"suffixIcon"},[e.faultModel.faultCodeId?t("a-icon",{staticStyle:{"padding-right":"3px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.clearValue(2)}}}):e._e(),t("a-icon",{attrs:{type:"ellipsis"}})],1)])],1)],1),e.faultModel.status>0&&4!==e.faultModel.status?t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"故障等级",prop:"faultLevel"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_fault_level"},model:{value:e.faultModel.faultLevel,callback:function(t){e.$set(e.faultModel,"faultLevel",t)},expression:"faultModel.faultLevel"}})],1)],1):e._e()],1),e.faultModel.status>0&&4!==e.faultModel.status?t("a-row",[t("a-col",{directives:[{name:"show",rawName:"v-show",value:e.faultModel.faultCodeId,expression:"faultModel.faultCodeId"}],attrs:{span:24}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"代码详情"}},[e.getFaultdetailLoading?t("a-icon",{attrs:{type:"loading"}}):t("a-space",[e._l(e.getFaultdetailList,(function(a,r){return t("span",{key:r,staticStyle:{color:"#c1c1c1"}},[e._v("故障"+e._s(a.fltLevel_dictText)+"："+e._s(a.fltCode)+"-"+e._s(a.fltName)+"；")])})),t("span",{staticStyle:{color:"#c1c1c1"}},[e._v("故障部件："+e._s(e.faultModel.faultCodeCode)+"-"+e._s(e.faultModel.faultCodeCodeDes)+"；")])],2)],1)],1)],1):e._e(),e.faultModel.status>0&&4!==e.faultModel.status?t("a-row",[t("a-col",{attrs:{span:8}},[t("a-form-model-item",{key:"solutionTime"+e.solutionTimeKey+e.reportTimeKey,attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理时间",prop:"solutionTime"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{disabledDate:e.dateTimeDisabled2,disabledTime:e.disabledDateTime2,format:"YYYY-MM-DD HH:mm","show-time":!!e.faultModel.reportTime&&{format:"HH:mm",hideDisabledOptions:!0}},on:{change:e.datePickerChange},model:{value:e.handleModel.solutionTime,callback:function(t){e.$set(e.handleModel,"solutionTime",t)},expression:"handleModel.solutionTime"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"原因描述",prop:"reasonDesc"}},[t("a-textarea",{attrs:{placeholder:"请输入内容"},model:{value:e.faultModel.reasonDesc,callback:function(t){e.$set(e.faultModel,"reasonDesc",t)},expression:"faultModel.reasonDesc"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"措施描述",prop:"solutionDesc"}},[t("a-textarea",{attrs:{placeholder:"请输入内容"},model:{value:e.faultModel.solutionDesc,callback:function(t){e.$set(e.faultModel,"solutionDesc",t)},expression:"faultModel.solutionDesc"}})],1)],1)],1):e._e(),e.faultModel.status>0&&4!==e.faultModel.status?t("a-row",[t("a-col",{attrs:{span:8}},[e.faultModel.status>0&&4!==e.faultModel.status?t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理结果",prop:"handleStatus"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_handlestatus"},model:{value:e.faultModel.handleStatus,callback:function(t){e.$set(e.faultModel,"handleStatus",t)},expression:"faultModel.handleStatus"}})],1):e._e()],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理班组",prop:"solutionGroupId"}},[t("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:e.dictGroupStr},model:{value:e.faultModel.solutionGroupId,callback:function(t){e.$set(e.faultModel,"solutionGroupId",t)},expression:"faultModel.solutionGroupId"}})],1)],1),t("a-col",{attrs:{span:8}},[t("a-form-model-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"处理人员",prop:"solutionUserId"}},[t("a-select",{ref:"tmyuserSelect3",attrs:{placeholder:"请选择处理人员",open:!1},on:{focus:function(t){return e.showUserModal(3)}},model:{value:e.handleModel.solutionUserName,callback:function(t){e.$set(e.handleModel,"solutionUserName",t)},expression:"handleModel.solutionUserName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1)],1)],1):e._e()],1),t("div",{staticClass:"clearfix"},[t("a-row",[t("a-col",{attrs:{span:12}},[t("DocUpload",{ref:"upload",attrs:{"default-file-list":e.defaultFileList,"show-upload":!1,isFileEmpty:!0},on:{uploaded:e.successUploadFile,removed:e.onRemoveFile,uploadFail:e.uploadFail}})],1)],1),t("a-row",[t("a-divider",{staticStyle:{"font-size":"14px"},attrs:{orientation:"left"}},[e._v("已上传列表")]),t("vxe-table",{staticStyle:{"margin-top":"12px"},attrs:{data:e.annexList,"show-overflow":"tooltip","show-header":!1,"edit-config":{trigger:"manual",mode:"row"}}},[t("div",{}),t("vxe-table-column",{attrs:{type:"index",title:"序号",width:"50px","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{field:"name",title:"文件名","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"annexType_dictText",title:"附件类型",width:"120px","header-align":"center",align:"center"}}),t("vxe-table-column",{attrs:{title:"操作",width:"160px","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row,o=a.rowIndex;return[t("a",{staticStyle:{"margin-right":"12px"},on:{click:function(t){return t.stopPropagation(),e.handleSeeing(r)}}},[e._v("查看")]),t("a",{on:{click:function(t){return t.stopPropagation(),e.handleDelete(r,o)}}},[e._v("删除")])]}}])})],1)],1)],1)]),t("train-plan-list",{ref:"planModalForm",on:{ok:e.onSelectPlan}}),t("doc-preview-modal",{ref:"docPreview",attrs:{title:e.fileName}}),t("user-list",{ref:"tUserModalForm",attrs:{"dep-id":1===e.userSelectType?e.faultModel.reportGroupId:3===e.userSelectType?e.faultModel.solutionGroupId:"",multiple:!1},on:{ok:e.onUserSelect}}),t("fault-category-list",{ref:"categorySelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-code-list",{ref:"codeSelect",attrs:{type:"unit",multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-reason-list",{ref:"reasonSelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("fault-solution-list",{ref:"solutionSelect",attrs:{multiple:!1},on:{ok:e.addCategoryTarget}}),t("work-station-list",{ref:"stationSelectModal",on:{ok:e.onSelectStation}}),t("CarDeviceSelectNew",{ref:"assetSelect",attrs:{canSelectType:[3,4],trainNo:e.faultModel.trainNo,lineId:e.faultModel.lineId,multiple:!1},on:{ok:e.addFaultAsset}}),t("supplier-list",{ref:"supplierModal",attrs:{multiple:!1},on:{ok:e.supplierSelect}})],1)},o=[],i=a("c1df"),n=a.n(i),l=a("8fad"),s=a("b245"),c=a("b47d"),u=a("ca00"),d=a("5371"),f=a("a396"),h=a("0e7b"),m=a("6034"),p=a("3cb5"),b=a("769e"),g=a("1158"),v=a("353a"),y=a("310d"),k=a("60e2"),w=a("2f62");function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function x(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var s=r&&r.prototype instanceof l?r:l,c=Object.create(s.prototype);return C(c,"_invoke",function(a,r,o){var i,l,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,s=e,f.n=a,n}};function h(a,r){for(l=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,l=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(t=l<2?e:s)||!d;){i||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==n)break}catch(t){i=e,l=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function l(){}function s(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(C(t={},r,(function(){return this})),t),d=c.prototype=l.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,C(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=c,C(d,"constructor",c),C(c,"constructor",s),s.displayName="GeneratorFunction",C(c,o,"GeneratorFunction"),C(d),C(d,o,"Generator"),C(d,r,(function(){return this})),C(d,"toString",(function(){return"[object Generator]"})),(x=function(){return{w:i,m:f}})()}function C(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}C=function(e,t,a,r){function i(t,a){C(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},C(e,t,a,r)}function S(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function I(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){S(i,r,o,n,l,"next",e)}function l(e){S(i,r,o,n,l,"throw",e)}n(void 0)}))}}function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach((function(t){O(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function O(e,t,a){return(t=$(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $(e){var t=P(e,"string");return"symbol"==T(t)?t:t+""}function P(e,t){if("object"!=T(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var j={name:"BreakdownFormItem",components:{UserList:s["default"],DocUpload:d["default"],FaultCategoryList:f["default"],FaultCodeList:h["default"],FaultReasonList:m["default"],FaultSolutionList:p["default"],SupplierList:b["default"],DocPreviewModal:v["default"],WorkStationList:g["default"],CarDeviceSelectNew:y["default"],TrainPlanList:k["default"]},props:{workStationsList:{type:Array,default:function(){return[]}},fromWriteReport:{type:Boolean,default:!1}},data:function(){return{getFaultdetailLoading:!1,getFaultdetailList:[],solutionTimeKey:0,reportTimeKey:0,dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",defaultFileList:[],annexList:[],fileList:[],filePath:"",fileName:"",status:!1,saveFlag:!0,uploading:!1,value:1,faultModel:{planName:void 0,planId:void 0,reportTime:void 0,happenTime:void 0,solutionTime:void 0,reasonDesc:void 0,solutionDesc:void 0,workStationName:void 0},handleModel:{solutionTime:void 0},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}},labelCol2:{xs:{span:24},sm:{span:2}},wrapperCol2:{xs:{span:24},sm:{span:21}},labelCol3:{xs:{span:24},sm:{span:13}},wrapperCol3:{xs:{span:24},sm:{span:11}},userSelectType:1,dictTrainStr:"",dictCodefaultcode:"bu_fault_code,fault_code,id",dictCodesubsys:"",dictTrainSys:"",confirmLoading:!1,trainStructId:"",faultCodeLevelList:[],formRules:{faultSn:[],categoryId:[{required:!1,message:"请选择故障分类!",trigger:"change"}],faultCodeId:[{required:!0,message:"请选择故障代码!",trigger:"change"}],faultLevel:[{required:!0,message:"请选择故障等级!",trigger:"change"}],workStationName:[{required:!1,message:"请选择故障工位!",trigger:"change"}],happenTime:[{required:!0,message:"请选择故障发现时间!"}],lineId:[{required:!0,message:"请选择所属线路!",trigger:"change"}],trainNo:[{required:!0,message:"请选择车辆!",trigger:"change"}],sysId:[{required:!0,message:"请选择所属系统!",trigger:"change"}],faultAssetName:[{required:!0,message:"请选择部件!",trigger:"change"}],faultDesc:[{required:!0,message:"请填写故障描述!",trigger:"change"},{max:249,message:"输入长度不能超过249字符!"}],phase:[{required:!0,message:"请选择发现阶段!"}],outSupplierName:[{required:!0,message:"请选择厂商!",trigger:"change"}],planName:[{required:!0,message:"请选择列计划!",trigger:"change"}],faultOnline:[],hasDuty:[],outsource:[],reportGroupId:[{required:!0,message:"请选择提报班组!",trigger:"change"}],reportUserId:[{required:!0,message:"请选择提报人员",trigger:"change"}],dutyEngineer:[],status:[],closeTime:[],handleStatus:[{required:!0,message:"请选择处理结果!",trigger:"change"}],faultReasonId:[{required:!0,message:"请选择故障原因!",trigger:"change"}],faultSolutionId:[{required:!0,message:"请选择处理措施!",trigger:"change"}],reasonDesc:[{required:!0,message:"请输入原因描述!",trigger:"change"},{max:249,message:"输入长度不能超过249字符!"}],solutionDesc:[{required:!0,message:"请输入措施描述!",trigger:"change"},{max:249,message:"输入长度不能超过249字符!"}],reportTime:[{required:!0,message:"请选择提报时间!",trigger:"change"}],solutionTime:[{required:!0,message:"请选择故障处理时间!",trigger:"change"}],solutionGroupId:[{required:!0,message:"请选择处理班组!",trigger:"change"}],solutionUserId:[{required:!0,message:"请选择处理人员!",trigger:"change"}],closeUserId:[]},reason:{categoryId:"",faultCodeId:""},solution:{categoryId:"",faultCodeId:"",faultReasonId:""},reasonList:[],solutionList:[],faultId:"",formType:"",faultType:"",assetTypeData:[],isWriteSave:!1}},computed:N({},Object(w["d"])(["user"])),created:function(){this.fromWriteReport&&(this.formRules.categoryId[0].required=!0,this.formRules.faultCodeId[0].required=!0,this.formRules.faultLevel[0].required=!0,this.formRules.workStationName[0].required=!0)},methods:{onSelectPlan:function(e){this.faultModel.planName=e[0].planName,this.faultModel.planId=e[0].id,this.faultModel.lineId=e[0].lineId,this.faultModel.trainNo=e[0].trainNo,this.changeLine(e[0].lineId),this.$refs.form.validateField("planName"),this.$refs.form.validateField("lineId"),this.$refs.form.validateField("trainNo")},changePlanSelect:function(e){e||(this.faultModel.planName="",this.faultModel.planId="",this.$refs.form.validateField("planName"))},openPlanModel:function(){this.$refs.planModalForm.showModal()},getFaultCodeLevel:function(e){var t=this;Object(c["ab"])({id:e}).then((function(e){e.success&&e.result&&t.$set(t.faultModel,"faultLevel",e.result.levelValue)}))},getFaultdetail:function(e){var t=this;this.getFaultdetailLoading=!0,Object(c["db"])({code:e}).then((function(e){e.success&&e.result.length&&(t.getFaultdetailList=e.result.filter((function(e){return 0!==e.fltLevel&&3!==e.fltLevel}))),t.getFaultdetailLoading=!1})).catch((function(e){t.getFaultdetailLoading=!1}))},range:function(e,t){for(var a=[],r=e;r<t;r++)a.push(r);return a},dateTimeDisabled1:function(e){var t=n()(this.faultModel.happenTime).format("YYYY-MM-DD");return!this.faultModel.happenTime||e<=n()(t)},dateTimeDisabled2:function(e){var t=n()(this.faultModel.reportTime).format("YYYY-MM-DD");return!this.faultModel.reportTime||e<=n()(t)},disabledDateTime1:function(){var e,t,a=this,r=n()(this.faultModel.happenTime),o=n()(this.faultModel.reportTime);return r.format("YYYY-MM-DD")!==o.format("YYYY-MM-DD")?(e=0,t=0):(e=this.faultModel.happenTime?n()(r).get("hours"):0,t=this.faultModel.happenTime?n()(r).get("minutes")+1:0),{disabledHours:function(){return a.range(0,e)},disabledMinutes:function(){return a.range(0,t)}}},disabledDateTime2:function(){var e,t,a=this,r=n()(this.faultModel.reportTime),o=n()(this.handleModel.solutionTime);return r.format("YYYY-MM-DD")!==o.format("YYYY-MM-DD")?(e=0,t=0):(e=this.faultModel.reportTime?n()(r).get("hours"):0,t=this.faultModel.reportTime?n()(r).get("minutes")+1:0),{disabledHours:function(){return a.range(0,e)},disabledMinutes:function(){return a.range(0,t)}}},handleSysFocus:function(){this.faultModel.lineId||this.$message.warn("请先选择线路!")},handleAssetFocus:function(){this.faultModel.trainNo||this.$message.warn("请先选择车辆!")},handleTrainNo:function(e,t){t.extFields&&(this.trainStructId=t.extFields[0].train_struct_id)},showAssetModal:function(){this.faultModel.trainNo?(this.$refs.assetSelect.showModal(),this.$refs.faultAssetSelect.blur()):this.$message.warn("请先选择车辆!")},openSelectTypeModal:function(e){switch(this.faultType=e,e){case 1:this.$refs.categorySelect.showModal(),this.$refs.categoryIdSelect.blur();break;case 2:this.$refs.codeSelect.showModal(),this.$refs.faultCodeIdSelect.blur();break;case 3:this.$refs.reasonSelect.showModal(),this.$refs.faultReasonIdSelect.blur();break;case 4:this.$refs.solutionSelect.showModal(),this.$refs.faultSolutionIdSelect.blur();break;case 5:this.$refs.stationSelectModal.showModal(),this.$refs.workStationSelect.blur();break}},addFaultAsset:function(e){Object(u["e"])(e)||(this.faultModel.trainStructureId=e[0].structDetailId,this.faultModel.faultAssetName=e[0].assetName,this.faultModel.faultAssetId=e[0].id,this.$refs.form.validateField("faultAssetName"))},addCategoryTarget:function(e){e.length&&(1===this.faultType&&(this.faultModel.categoryId=e[0].id,this.faultModel.categoryCode=e[0].categoryCode,this.faultModel.categoryCodeDes=e[0].categoryDesc,this.faultModel.faultLevel&&(this.faultModel.faultLevel=""),this.$refs.form.validateField("categoryId")),2===this.faultType&&(this.faultModel.faultCodeId=e[0].id,this.faultModel.faultCodeCode=e[0].fltCode,this.faultModel.faultCodeCodeDes=e[0].fltName,this.faultModel.faultLevel&&(this.faultModel.faultLevel=""),this.$refs.form.validateField("faultCodeId"),this.getFaultCodeLevel(this.faultModel.faultCodeId),this.getFaultdetail(this.faultModel.faultCodeId)),3===this.faultType&&(this.faultModel.faultReasonId=e[0].id,this.faultModel.faultReasonCode=e[0].reasonCode,this.$set(this.faultModel,"reasonDesc",e[0].reasonDesc),this.$refs.form.validateField("faultReasonId"),this.$refs.form.validateField("reasonDesc")),4===this.faultType&&(this.faultModel.faultSolutionId=e[0].id,this.faultModel.faultSolutionCode=e[0].solutionCode,this.$set(this.faultModel,"solutionDesc",e[0].solutionDesc),this.$refs.form.validateField("faultSolutionId"),this.$refs.form.validateField("solutionDesc")))},clearValue:function(e){1===e&&(this.faultModel.categoryId="",this.faultModel.categoryCode="",this.faultModel.categoryCodeDes=""),2===e&&(this.faultModel.faultCodeId="",this.faultModel.faultCodeCode="",this.faultModel.faultCodeCodeDes=""),5===e&&(this.faultModel.workStationId="",this.faultModel.workStationName=""),6===e&&(this.faultModel.dutyEngineerName="",this.faultModel.dutyEngineer="")},successUploadFile:function(e){var t=this;e.map((function(e){Object.assign(e,{id:Object(u["p"])()})})),e&&e.length>0?(e.map((function(e){var a={annexType:1,fileId:e.id,type:e.type,fileSize:e.fileSize,name:e.name,savepath:e.savepath};t.annexList.push(a)})),this.saveFaultInfo()):this.saveFaultInfo()},saveFaultInfo:function(){var e=this,t=Object.assign({},this.faultModel,{happenTime:n()(this.faultModel.happenTime).format("YYYY-MM-DD HH:mm:ss"),reportTime:n()(this.faultModel.reportTime).format("YYYY-MM-DD HH:mm:ss"),closeTime:this.faultModel.closeTime?n()(this.faultModel.closeTime).format("YYYY-MM-DD HH:mm:ss"):null,faultOnline:this.faultModel.faultOnline?1:0,hasDuty:0,outsource:this.faultModel.outsource?1:0});this.handleModel.solutionTime=n()(this.handleModel.solutionTime).format("YYYY-MM-DD HH:mm:ss"),t.status>0&&4!==t.status?t.handleRecordList=[Object.assign({},this.handleModel,{faultReasonId:this.faultModel.faultReasonId,faultSolutionId:this.faultModel.faultSolutionId,reasonDesc:this.faultModel.reasonDesc,solutionDesc:this.faultModel.solutionDesc,solutionGroupId:this.faultModel.solutionGroupId})]:t.handleRecordList=[];var a=null;t["annexList"]=this.annexList,this.faultModel.id?a=Object(c["F"])(t):(t["id"]=this.faultId,a=Object(c["b"])(t)),a.then((function(t){t.success?(e.isWriteSave=!0,e.$emit("ok")):e.$emit("fail")})).catch((function(t){e.$emit("fail")})).finally((function(){}))},setBforeUploadStatus:function(e){this.saveFlag=e},setUpLoadingEndStatus:function(e){this.saveFlag=e},uploadFail:function(e){this.$emit("fail")},onRemoveFile:function(e){},beginUpload:function(){this.confirmLoading=!0,this.$refs.upload.beginUpload()},handlePrivilege:function(){var e=I(x().m((function e(t,a){var r,o=this;return x().w((function(e){while(1)switch(e.n){case 0:return r={id:t,operation:a},e.n=1,Object(l["uc"])(r).then((function(e){o.status=e.result}));case 1:return e.a(2)}}),e)})));function t(t,a){return e.apply(this,arguments)}return t}(),handleSeeing:function(){var e=I(x().m((function e(t){return x().w((function(e){while(1)switch(e.n){case 0:this.fileName=t.name,this.$refs.docPreview.handleFilePath(t.savepath);case 1:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleDelete:function(){var e=I(x().m((function e(t,a){var r;return x().w((function(e){while(1)switch(e.n){case 0:r=this,r.$confirm({title:"提示",content:"确定删除该条附件吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){r.annexList.splice(a,1)},onCancel:function(){}});case 1:return e.a(2)}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),add:function(e,t,a){this.edit({workOrderId:e,orderTaskId:t,formType:a,createType:a})},edit:function(e){var t={faultOnline:!1,hasDuty:!1,outsource:!1,status:0,reportUserName:"",reportUserId:"",dutyEngineer:"",dutyEngineerName:"",closeUserId:"",closeUserName:"",categoryId:"",categoryCode:"",categoryCodeDes:"",faultCodeId:"",faultCodeCode:"",faultReasonId:"",faultReasonCode:"",faultSolutionId:"",faultSolutionCode:"",solutionUserId:"",solutionUserName:"",faultAssetId:"",reportGroupId:"",outSupplierId:"",outSupplierName:"",sysId:"",subSysId:"",trainNo:"",lineId:"",faultAssetName:"",trainStructureId:"",happenTime:"",workStationId:"",workStationName:"",solutionTime:"",solutionGroupId:"",solutionDesc:"",reasonDesc:"",reportTime:"",planName:"",planId:""};e.workStationName=e.workstationName,this.faultModel=Object.assign(t,e),this.faultModel.categoryCode&&(this.isWriteSave=!0),this.faultModel.reportTime&&(this.faultModel.reportTime=this.$moment(this.faultModel.reportTime)),this.faultModel.faultCodeId&&this.getFaultdetail(this.faultModel.faultCodeId),this.faultModel.happenTime&&(this.faultModel.happenTime=this.$moment(this.faultModel.happenTime)),Object(u["e"])(this.faultModel.handleRecordList)||(this.handleModel=this.faultModel.handleRecordList[0],this.faultModel=Object.assign(this.faultModel,{faultReasonId:this.handleModel.faultReasonId,faultSolutionId:this.handleModel.faultSolutionId,reasonDesc:this.handleModel.reasonDesc,solutionDesc:this.handleModel.solutionDesc,solutionGroupId:this.handleModel.solutionGroupId,faultSolutionCode:this.handleModel.faultSolutionCode,faultReasonCode:this.handleModel.faultReasonCode,solutionUserId:this.handleModel.solutionUserId,solutionUserName:this.handleModel.solutionUserName,solutionTime:this.handleModel.solutionTime})),Object(u["e"])(e)||(this.faultModel=Object.assign(this.faultModel,{faultOnline:1===e.faultOnline,hasDuty:1===e.hasDuty,outsource:1===e.outsource}),e.annexList&&(this.annexList=e.annexList)),2===e.formType&&(""===this.faultModel.reportUserName&&""===this.faultModel.reportUserId&&this.$store.getters.userInfo.departIsGroup&&(this.faultModel.reportUserName=this.$store.getters.userInfo.realname,this.faultModel.reportUserId=this.$store.getters.userInfo.id),Object(u["e"])(this.faultModel.reportGroupId)&&this.$store.getters.userInfo.departIsGroup&&this.$set(this.faultModel,"reportGroupId",this.$store.getters.userInfo.departId)),this.workStationsList.length>0&&(this.faultModel.workStationId=this.workStationsList[0].workstationId,this.faultModel.workStationName=this.workStationsList[0].workstationName),this.formType=e.formType,this.faultModel.submitStatus||(this.faultModel.submitStatus=1===this.formType?1:0),this.changeFaultStatus()},handleChange:function(e){var t=e.file;t.status},changeFaultStatus:function(){(2===this.formType&&0!==this.faultModel.status||this.fromWriteReport)&&(this.faultModel.solutionGroupId&&""!==this.faultModel.solutionGroupId||!this.$store.getters.userInfo.departIsGroup||(this.faultModel.solutionGroupId=this.$store.getters.userInfo.departId),this.handleModel.solutionUserId&&this.faultModel.solutionUserName||!this.$store.getters.userInfo.departIsGroup||(this.faultModel.solutionUserName=this.$store.getters.userInfo.realname,this.faultModel.solutionUserId=this.$store.getters.userInfo.id,this.handleModel.solutionUserName=this.$store.getters.userInfo.realname,this.handleModel.solutionUserId=this.$store.getters.userInfo.id))},changeClose:function(e){this.isClose=e},showUserModal:function(e){switch(this.userSelectType=e,this.$refs.tUserModalForm.showModal(),e){case 1:this.$refs.tmyuserSelect1.blur();break;case 2:this.$refs.tmyuserSelect2.blur();break;case 3:this.$refs.tmyuserSelect3.blur();break;case 4:this.$refs.tmyuserSelect4.blur();break}},onUserSelect:function(e){e.length&&(1===this.userSelectType&&(this.faultModel.reportUserName=e[0].realname,this.faultModel.reportUserId=e[0].id,this.$refs.form.validateField("reportUserId")),2===this.userSelectType&&(this.faultModel.dutyEngineerName=e[0].realname,this.faultModel.dutyEngineer=e[0].id,this.$refs.form.validateField("dutyEngineer")),3===this.userSelectType&&(this.handleModel.solutionUserName=e[0].realname,this.handleModel.solutionUserId=e[0].id,this.faultModel.solutionUserName=e[0].realname,this.faultModel.solutionUserId=e[0].id,this.$refs.form.validateField("solutionUserId")),4===this.userSelectType&&(this.faultModel.closeUserName=e[0].realname,this.faultModel.closeUserId=e[0].id,this.$forceUpdate(),this.$refs.form.validateField("closeUserId")),this.$forceUpdate())},datePickerChange:function(e){this.handleModel.solutionTime=e,this.faultModel.solutionTime=e,this.$refs.form.validateField("solutionTime")},openSupplierModal:function(){this.$refs.supplierModal.showModal(),this.$refs.mySupplierSelect.blur()},supplierSelect:function(e){Object(u["e"])(e)||(this.faultModel.outSupplierName=e[0].name,this.faultModel.outSupplierId=e[0].id,this.$refs.form.validateField("outSupplierName"))},changeLine:function(e,t){this.dictTrainStr="",e&&(this.dictTrainStr="bu_train_info,train_no,train_no,line_id="+e+"|train_struct_id",this.dictTrainSys="bu_train_asset_type,name,id,struct_type=1 and parent_id is null and train_type_id=(select train_type_id from bu_mtr_line where line_id="+e+" )")},changeLinesubsys:function(e,t){this.dictCodesubsys="",!0!==t&&(this.faultModel.subSysId=null,this.faultModel.faultAssetId=null),e&&(this.dictCodesubsys="bu_train_asset_type,name,id,struct_type=2 and parent_id='"+e+"'")},save:function(){var e=this,t=this;this.$refs.form.validate((function(a){a?(t.faultModel.id?t.faultId=t.faultModel.id:t.faultId=Object(u["p"])(),e.beginUpload()):(e.$message.warn("请填写必须填写的信息"),e.$emit("cancel"))}))},check:function(){var e=this;return new Promise((function(t,a){e.$refs.form.validate((function(r){r?e.isWriteSave?t(!0):a("你还有没有保存故障信息, 请先保存故障信息"):a("请填写必须填写的信息")}))}))},onSelectStation:function(e){e&&e.length>0&&(this.faultModel.workStationId=e[0].id,this.faultModel.workStationName=e[0].name,this.$refs.form.validateField("workStationName"))}}},D=j,M=(a("d6d3"),a("2877")),R=Object(M["a"])(D,r,o,!1,null,"0aeefc58",null);t["default"]=R.exports},d0f9:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:800,visible:e.visible,confirmLoading:e.confirmLoading,centered:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-row",[t("a-col",{attrs:{md:18}},[t("div",[t("a-form",{ref:"initForm",attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录名称"}},[t("a-row",{attrs:{gutter:10}},[t("a-col",{attrs:{span:14}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserName",e.validatorRules.checkUserName],expression:"['checkUserName', validatorRules.checkUserName]",modifiers:{trim:!0}}]})],1),t("a-col",{attrs:{span:10}},[t("a-button",{attrs:{type:"link"},on:{click:e.useCurrentUser}},[e._v("使用当前账号和密码")])],1)],1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"登录密码"}},[t("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["checkUserPwd",e.validatorRules.checkUserPwd],expression:"['checkUserPwd', validatorRules.checkUserPwd]",modifiers:{trim:!0}}]})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"检查结果"}},[t("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["exp",{initialValue:!1}],expression:"['exp', { initialValue: false }]",modifiers:{trim:!0}}]},[e._v(" 异常")]),t("a-checkbox",{on:{change:e.onIgnoreChange},model:{value:e.isIgnore,callback:function(t){e.isIgnore=t},expression:"isIgnore"}},[e._v(" 忽略")])],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"同检人员"}},[t("a-select",{ref:"userSelect",attrs:{placeholder:"请选择人员",open:!1,showArrow:!0,allowClear:""},on:{change:e.clearTogetherCheckUserNames,dropdownVisibleChange:function(t){return e.openSelectUser()}},model:{value:e.togetherCheckUserNames,callback:function(t){e.togetherCheckUserNames=t},expression:"togetherCheckUserNames"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"结果描述"}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["resultDesc",{initialValue:"",rules:[{required:e.isIgnore,message:"请输入忽略原因!"}]}],expression:"[\n                'resultDesc',\n                { initialValue: '', rules: [{ required: isIgnore, message: '请输入忽略原因!' }] },\n              ]",modifiers:{trim:!0}}],attrs:{"auto-size":{minRows:8,maxRows:8}}})],1)],1)],1)]),t("a-col",{attrs:{md:6}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("div",{staticStyle:{margin:"30px 10px 20px","text-align":"center"}},[t("a-spin",{attrs:{spinning:e.qrLoading}},[e.imageBase64Url?t("img",{staticClass:"QRcode",attrs:{src:e.imageBase64Url,alt:""}}):t("img",{staticClass:"QRcode",attrs:{src:a("a6da"),alt:""}})])],1),t("div",{staticStyle:{"text-align":"center"}},[e._v("通过APP扫码确认")])])],1)],1),t("UserList",{ref:"userSelectModal",attrs:{multiple:!0},on:{ok:e.onSelectUser}})],1)},o=[],i=a("b9c3"),n=a("b245"),l=a("986e"),s={name:"SheetItemModal",components:{UserList:n["default"]},props:["title","formInstId","workRecordType"],data:function(){return{detailIds:"",checkType:-1,colIndex:0,value:1,status:1,switchCheck:!0,visible:!1,model:{},labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:18}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{checkUserName:{rules:[{required:!0,message:"请输入登录名称!"}]},checkUserPwd:{rules:[{required:!0,message:"请输入密码!"}]},checkResult:{rules:[{required:!0,message:"选择检查结果!"}]}},isIgnore:!1,qrLoading:!1,imageBase64Url:"",togetherCheckUserIds:"",togetherCheckUserNames:""}},mounted:function(){var e=this;l["a"].$on("topic",(function(t){e.$message.success(t.msgTxt);var a=Object.assign(e.model);a.detailIds=1===e.workRecordType?e.detailIds:e.detailIds.join(","),a.result=a.exp?0:1,a.isIgnore=e.isIgnore?1:0,a.type=e.checkType,a.workRecordId=e.formInstId,a.colIndex=e.colIndex,a.workRecordType=e.workRecordType,a.detailIds=e.detailIds,e.$emit("scan",{saveSuccess:!0,data:a}),e.close()}))},methods:{add:function(){this.edit({})},getTaskQRCode:function(e){var t=this;this.qrLoading=!0,Object(i["J"])({formDetails:"string"===typeof this.detailIds?this.detailIds:this.detailIds.join(","),checkType:this.checkType,colIndex:this.colIndex,formInstId:e.formInstId,formType:e.instType,fromBy:"PC",orderId:e.workOrderId,targetType:"TASK",taskId:e.workOrderTaskId,workRecordType:e.workRecordType}).then((function(e){t.qrLoading=!1,e.success&&(t.imageBase64Url=e.result.base64)}))},showModal:function(e,t){var a=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;this.imageBase64Url="",this.detailIds=e,this.checkType=t,this.colIndex=r,this.getTaskQRCode(o),this.form.resetFields(),this.isIgnore=!1,this.visible=!0,1===this.checkType&&this.$nextTick((function(){a.form.setFieldsValue({checkUserName:a.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~"})})),this.$nextTick((function(){a.form.setFieldsValue({exp:"",resultDesc:""})}))},useCurrentUser:function(){var e=this;this.$nextTick((function(){e.form.setFieldsValue({checkUserName:e.$store.getters.userInfo.username,checkUserPwd:"~**&&##@@$$%%^^~"})}))},clearTogetherCheckUserNames:function(e){e||(this.togetherCheckUserIds="",this.togetherCheckUserNames="")},openSelectUser:function(){this.$refs.userSelectModal.showModal(),this.$refs.userSelect.blur()},onSelectUser:function(e){if(e.length){var t="",a="";e.forEach((function(e,r,o){t+=e.realname,a+=e.id,r<o.length-1&&(t+=",",a+=",")})),this.togetherCheckUserIds=a,this.togetherCheckUserNames=t}},handleOk:function(){var e=this,t=this;t.form.validateFields((function(a,r){if(!a){var o=Object.assign(t.model,r);o.detailIds=1===e.workRecordType?e.detailIds:e.detailIds.join(","),o.result=o.exp?0:1,o.isIgnore=e.isIgnore?1:0,o.type=e.checkType,o.workRecordId=e.formInstId,o.colIndex=e.colIndex,o.workRecordType=e.workRecordType,o.togetherCheckUserIds=e.togetherCheckUserIds,o.togetherCheckUserNames=e.togetherCheckUserNames,Object(i["Y"])(o).then((function(a){a.success?(t.$message.success(a.message),o.detailIds=e.detailIds,a.result&&(o.checkUserInfo=a.result),t.$emit("ok",{saveSuccess:!0,data:o}),t.close()):t.$message.error(a.message)})).finally((function(){}))}}))},handleCancel:function(){this.close()},onIgnoreChange:function(){var e=this;this.$nextTick((function(){e.form.resetFields("resultDesc")}))},close:function(){this.$emit("close"),this.visible=!1}}},c=s,u=(a("fb4f"),a("2877")),d=Object(u["a"])(c,r,o,!1,null,"0804228c",null);t["default"]=d.exports},d1e3:function(e,t,a){"use strict";a("9866")},d214:function(e,t,a){"use strict";a.d(t,"h",(function(){return o})),a.d(t,"D",(function(){return i})),a.d(t,"eb",(function(){return n})),a.d(t,"r",(function(){return l})),a.d(t,"b",(function(){return s})),a.d(t,"w",(function(){return c})),a.d(t,"H",(function(){return u})),a.d(t,"I",(function(){return p})),a.d(t,"k",(function(){return d})),a.d(t,"c",(function(){return b})),a.d(t,"x",(function(){return g})),a.d(t,"l",(function(){return y})),a.d(t,"K",(function(){return v})),a.d(t,"a",(function(){return k})),a.d(t,"v",(function(){return w})),a.d(t,"j",(function(){return x})),a.d(t,"F",(function(){return T})),a.d(t,"J",(function(){return f})),a.d(t,"G",(function(){return h})),a.d(t,"t",(function(){return m})),a.d(t,"Q",(function(){return C})),a.d(t,"u",(function(){return S})),a.d(t,"db",(function(){return O})),a.d(t,"q",(function(){return $})),a.d(t,"bb",(function(){return P})),a.d(t,"cb",(function(){return j})),a.d(t,"C",(function(){return N})),a.d(t,"g",(function(){return _})),a.d(t,"P",(function(){return I})),a.d(t,"X",(function(){return R})),a.d(t,"ab",(function(){return A})),a.d(t,"f",(function(){return q})),a.d(t,"p",(function(){return L})),a.d(t,"jb",(function(){return M})),a.d(t,"kb",(function(){return D})),a.d(t,"Z",(function(){return E})),a.d(t,"e",(function(){return z})),a.d(t,"A",(function(){return U})),a.d(t,"n",(function(){return B})),a.d(t,"m",(function(){return G})),a.d(t,"O",(function(){return W})),a.d(t,"Y",(function(){return H})),a.d(t,"V",(function(){return K})),a.d(t,"gb",(function(){return Z})),a.d(t,"hb",(function(){return X})),a.d(t,"L",(function(){return ee})),a.d(t,"ib",(function(){return te})),a.d(t,"B",(function(){return F})),a.d(t,"y",(function(){return Y})),a.d(t,"d",(function(){return J})),a.d(t,"z",(function(){return Q})),a.d(t,"W",(function(){return ae})),a.d(t,"o",(function(){return V})),a.d(t,"fb",(function(){return re})),a.d(t,"i",(function(){return oe})),a.d(t,"E",(function(){return ie})),a.d(t,"s",(function(){return ne})),a.d(t,"M",(function(){return le})),a.d(t,"N",(function(){return se})),a.d(t,"S",(function(){return ce})),a.d(t,"T",(function(){return ue})),a.d(t,"U",(function(){return de})),a.d(t,"R",(function(){return fe}));var r=a("0fea"),o=function(e){return Object(r["j"])("/outsource/supplier/add",e)},i=function(e){return Object(r["j"])("/outsource/supplier/edit",e)},n=function(e){return Object(r["d"])("/outsource/supplier/page",e)},l=function(e){return Object(r["j"])("/outsource/supplier/delete",e)},s=function(e){return Object(r["j"])("/outsource/contractInfo/add",e)},c=function(e){return Object(r["j"])("/outsource/contractInfo/edit",e)},u=function(e){return Object(r["d"])("/outsource/contractInfo/page",e)},d=function(e){return Object(r["j"])("/outsource/contractInfo/delete",e)},f=function(e){return Object(r["d"])("/outsource/contractInfo/monitor",e)},h=function(e){return Object(r["d"])("/outsource/contract/annex/list",e)},m=function(e){return Object(r["j"])("/outsource/contract/annex/delete",e)},p=function(e){return Object(r["d"])("/outsource/contractInfo/price",e)},b=function(e){return Object(r["j"])("/outsource/contractPay/add",e)},g=function(e){return Object(r["j"])("/outsource/contractPay/edit",e)},v=function(e){return Object(r["d"])("/outsource/contractPay/page",e)},y=function(e){return Object(r["j"])("/outsource/contractPay/delete",e)},k=function(e){return Object(r["j"])("/outsource/contractBakMoney/add",e)},w=function(e){return Object(r["j"])("/outsource/contractBakMoney/edit",e)},T=function(e){return Object(r["d"])("/outsource/contractBakMoney/page",e)},x=function(e){return Object(r["j"])("/outsource/contractBakMoney/delete",e)},C=function(e){return Object(r["d"])("/outsource/outin/page",e)},S=function(e){return Object(r["j"])("/outsource/outin/delete",e)},I=function(e){return Object(r["d"])("/outsource/outin/page/detail",e)},_=function(e){return Object(r["j"])("/outsource/supervise/add",e)},N=function(e){return Object(r["j"])("/outsource/supervise/edit",e)},O=function(e){return Object(r["d"])("/outsource/supervise/page",e)},$=function(e){return Object(r["j"])("/outsource/supervise/delete",e)},P=function(e){return Object(r["d"])("/outsource/supervise/get",{id:e})},j=function(e){return Object(r["d"])("/outsource/supervise/get-by-order",e)},D=function(e){return Object(r["d"])("/outsource/perform/vendor/tree",e)},M=function(e){return Object(r["j"])("/outsource/perform/delayReason",e)},R=function(e){return Object(r["d"])("/outsource/perform/page",e)},L=function(e){return Object(r["j"])("/outsource/perform/delete/resource",e)},A=function(e){return Object(r["d"])("/outsource/perform/resource",e)},q=function(e){return Object(r["j"])("/outsource/perform/resource/add",e)},F=function(e){return Object(r["j"])("/outsource/perform/resource/edit",e)},E=function(e){return Object(r["d"])("/outsource/rateing/page",e)},z=function(e){return Object(r["j"])("/outsource/rateing/add",e)},U=function(e){return Object(r["j"])("/outsource/rateing/edit",e)},B=function(e){return Object(r["j"])("/outsource/rateing/delete",e)},V=function(e){return Object(r["j"])("/outsource/rateing/delete/attachment",e)},G=function(e){return Object(r["j"])("/outsource/otherSource/delete",e)},Y=function(e){return Object(r["j"])("/outsource/otherSource/edit",e)},J=function(e){return Object(r["j"])("/outsource/otherSource/add",e)},W=function(e){return Object(r["d"])("/outsource/otherSource/page",e)},H=function(e){return Object(r["d"])("/outsource/quality/page",e)},Q=function(e){return Object(r["j"])("/outsource/quality/edit",e)},K=function(e){return Object(r["d"])("/outsource/part/page",e)},Z=function(e){return Object(r["d"])("/outsource/fault/countFault",e)},X=function(e){return Object(r["d"])("/outsource/fault/countFaultGroupBySystem",e)},ee=function(e){return Object(r["d"])("/outsource/fault/page",e)},te=function(e){return Object(r["j"])("/outsource/fault/countFaultGroupByPhaseAndSystem",e)},ae=function(e){return Object(r["d"])("/outsource/contractPay/page",e)},re=function(e){return Object(r["d"])("/training/record/page",e)},oe=function(e){return Object(r["j"])("/training/record/add",e)},ie=function(e){return Object(r["j"])("/training/record/edit",e)},ne=function(e){return Object(r["j"])("/training/record/delete",e)},le=function(e){return Object(r["d"])("/base/finance/project/list",e)},se=function(e){return Object(r["d"])("/base/finance/task/list",e)},ce=function(e){return Object(r["d"])("/outsource/cost/listCost",e)},ue=function(e){return Object(r["d"])("/outsource/cost/detail",e)},de=function(e){return Object(r["d"])("/outsource/cost/part",e)},fe=function(e){return Object(r["d"])("/outsource/cost/asset",e)}},d392:function(e,t,a){},d425:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",title:"工器具选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工器具名称"}},[t("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:e.queryParam.searchText,callback:function(t){e.$set(e.queryParam,"searchText",t)},expression:"queryParam.searchText"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工器具分类"}},[t("j-dict-select-tag",{attrs:{placeholder:"请选择工器具分类",dictCode:"bu_tools_type",disabled:e.canSelectType&&1===e.canSelectType.length},model:{value:e.queryParam.toolType,callback:function(t){e.$set(e.queryParam,"toolType",t)},expression:"queryParam.toolType"}})],1)],1),t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"工班"}},[t("j-dict-select-tag",{attrs:{dictCode:"sys_depart,depart_name,id,org_category=4",placeholder:"请选择工班"},model:{value:e.queryParam.groupId,callback:function(t){e.$set(e.queryParam,"groupId",t)},expression:"queryParam.groupId"}})],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","cell-class-name":e.cellClassName,"radio-config":e.multiple?{}:{trigger:"row",checkMethod:e.checkRadioMethod},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:e.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"code",title:"工器具类型编码"}}),t("vxe-table-column",{attrs:{field:"name",title:"工器具名称"}}),t("vxe-table-column",{attrs:{field:"model",title:"规格型号"}}),t("vxe-table-column",{attrs:{field:"assetCode",title:"资产编码"}}),t("vxe-table-column",{attrs:{field:"serialNo",title:"出厂编号"}}),t("vxe-table-column",{attrs:{field:"toolType_dictText",title:"类别"}}),t("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),t("vxe-table-column",{attrs:{field:"groupName",title:"所属班组"}}),t("vxe-table-column",{attrs:{field:"nextCheckTime",title:"下次送检",width:"100"}}),t("vxe-table-column",{attrs:{field:"isOverTime",title:"是否逾期",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getIsOverTimeStatus(a))+" ")]}}])}),t("vxe-table-column",{attrs:{field:"isOverTimeDays",title:"逾期天数",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getIsOverTimeDays(a))+" ")]}}])})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])},o=[],i=a("c54ca"),n={name:"ToolsList",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:null},groupId:{type:String,default:null}},data:function(){return{queryParam:{searchText:"",toolType:"6",groupId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.toolType=this.canSelectType[0]+""),this.groupId&&(this.queryParam.groupId=this.groupId),e&&(this.queryParam.materialTypeId=e),this.findList()},findList:function(){var e=this;this.loading=!0,Object(i["Db"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records,e.tableData.forEach((function(t){e.$set(t,"num",1)}))}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.queryParam.materialTypeId=this.$options.data().queryParam.materialTypeId,this.visible=!1},checkRadioMethod:function(e){var t=e.row;return!this.canSelectType||this.canSelectType.indexOf(t.toolType)>-1},getIsOverTimeStatus:function(e){if(e.nextCheckTime){var t=this.$moment(new Date).format("YYYY-MM-DD"),a=this.$moment(e.nextCheckTime).diff(t,"day");return a<0?"是":"否"}return"否"},cellClassName:function(e){var t=e.row,a=(e.rowIndex,e.column),r=(e.columnIndex,["nextCheckTime","isOverTime","isOverTimeDays"]);if(r.includes(a.property)&&t.nextCheckTime){var o=this.$moment(new Date).format("YYYY-MM-DD"),i=this.$moment(t.nextCheckTime).diff(o,"day");if("nextCheckTime"===a.property){if(i<=0)return"table-cell-bg-red";if(i>0&&i<=15)return"table-cell-bg-yellow"}if("isOverTime"===a.property&&i<0)return"table-cell-bg-red";if("isOverTimeDays"===a.property&&i<0)return"table-cell-bg-red"}},getIsOverTimeDays:function(e){if(e.nextCheckTime){var t=this.$moment(new Date).format("YYYY-MM-DD"),a=this.$moment(e.nextCheckTime).diff(t,"day");if(a<0)return Math.abs(a)}return""}}},l=n,s=(a("623c"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"8f25e80a",null);t["default"]=c.exports},d4ad:function(e,t,a){},d5c3:function(e,t,a){},d6d3:function(e,t,a){"use strict";a("ccb3")},d88b:function(e,t,a){"use strict";a("3ff1")},da42:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"90%",visible:e.visible,title:"文件选择",centered:"",bodyStyle:{height:"80vh"},confirmLoading:e.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("na-splitter",{staticStyle:{height:"calc(80vh - 15px)"},attrs:{defaultSize:300}},[t("div",{staticStyle:{"overflow-y":"auto","overflow-x":"hidden","padding-right":"2px"},attrs:{slot:"left-panel"},slot:"left-panel"},[t("a-directory-tree",{attrs:{defaultExpandAll:"","tree-data":e.treeData,replaceFields:{title:"name",key:"id"}},on:{select:e.onSelect}})],1),t("div",{staticStyle:{"padding-left":"5px","padding-right":"3px"},attrs:{slot:"right-panel"},slot:"right-panel"},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.findList.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"文件名称"}},[t("a-input",{attrs:{placeholder:"请输入文件名称",allowClear:!0},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1)],1),t("a-col",{attrs:{md:7,sm:24}},[t("a-form-item",{attrs:{label:"文件类型"}},[t("a-select",{attrs:{placeholder:"请选择",allowClear:!0},model:{value:e.queryParam.type,callback:function(t){e.$set(e.queryParam,"type",t)},expression:"queryParam.type"}},[t("a-select-option",{attrs:{value:void 0}},[e._v("请选择")]),t("a-select-option",{attrs:{value:""}},[e._v("所有文件")]),e._l(e.fileType,(function(a){return t("a-select-option",{key:a,attrs:{alue:a}},[e._v(" "+e._s(a)+" ")])}))],2)],1)],1),t("a-col",{attrs:{md:3,sm:8}},[t("a-button",{on:{click:e.findList}},[e._v("查询")])],1)],1)],1)],1),t("div",{staticStyle:{height:"calc(80vh - 130px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","row-id":"id",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"},"radio-config":{trigger:"row"},"checkbox-config":{trigger:"row",highlight:!0,range:!0}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"type",title:"类型",width:"150",align:"center"}}),t("vxe-table-column",{attrs:{field:"size",title:"大小(kb)",width:"180",align:"right","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"uploadDate",title:"上传日期",width:"150"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"200",align:"left","header-align":"center"}})],1),t("vxe-pager",{attrs:{perfect:"","current-page":e.queryParam.pageNo,"page-size":e.queryParam.pageSize,total:e.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:current-page":function(t){return e.$set(e.queryParam,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.queryParam,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryParam,"pageSize",t)},"page-change":e.handlePageChange}})],1)])])],1)},o=[],i=a("8fad"),n={name:"TechFileList",props:{multiple:{type:Boolean,default:!0},id:{type:String,default:""}},data:function(){return{fileType:[],queryParam:{id:"",name:"",showType:2,type:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,treeData:[]}},methods:{getFileType:function(){var e=this;Object(i["qb"])().then((function(t){e.fileType=t.result}))},selectTree:function(){var e=this;Object(i["pb"])({id:this.id}).then((function(t){t.success&&(e.treeData=t.result)}))},showModal:function(){this.visible=!0,this.selectTree(),this.getFileType(),this.findList()},onSelect:function(e,t){if(e.length){var a=t.node.dataRef;this.queryParam.id=a.id}this.findList()},findList:function(){var e=this;Object(i["ob"])(this.queryParam).then((function(t){e.totalResult=t.result.total,e.loading=!1,e.tableData=t.result.records}))},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.queryParam.pageNo=t,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},l=n,s=a("2877"),c=Object(s["a"])(l,r,o,!1,null,null,null);t["default"]=c.exports},dc75:function(e,t,a){},dc91:function(e,t,a){"use strict";a("ed25")},de37:function(e,t,a){},e0ce:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("table",{staticClass:"table"},[t("thead",[t("tr",[t("th",{staticClass:"tg-d1f0",attrs:{colspan:"10"}},[e._v(e._s(e.sheetData.title))])])]),t("tbody",[t("tr",[t("td",{staticClass:"tg-ld8d",attrs:{colspan:"3"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("车号："+e._s(e.sheetData.trainNo))])]),t("td",{staticClass:"tg-ld8d",attrs:{colspan:"3"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("部件名称："+e._s(e.sheetData.assetName))])]),t("td",{staticClass:"tg-ld8d",attrs:{colspan:"4"}},[e._v("作业周期："+e._s(e.sheetData.period))])]),t("tr",[t("td",{staticClass:"tg-ld8d",attrs:{colspan:"3"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("部件编号："+e._s(e.sheetData.assetNo))])]),t("td",{staticClass:"tg-ld8d",attrs:{colspan:"3"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("作业位置："+e._s(e.sheetData.location))])]),t("td",{staticClass:"tg-ld8d",attrs:{colspan:"4"}},[e._v("作业班组："+e._s(e.sheetData.groupName))])]),e._m(0),e._l(e.sheetData.itemList,(function(a,r){return t("tr",{key:r},[t("td",{staticClass:"tg-0pky tg-9wq8"},[e._v(e._s(a.sortNo))]),t("td",{staticClass:"tg-0pky"},[e._v(e._s(a.title))]),t("td",{staticClass:"tg-0pky"},[e._v(e._s(a.content))]),t("td",{staticClass:"tg-0pky tg-9wq8"},[t("a-rate",{attrs:{disabled:"",count:3},model:{value:a.checkLevel,callback:function(t){e.$set(a,"checkLevel",t)},expression:"item.checkLevel"}})],1),t("td",{staticClass:"tg-0pky"},[e._v(e._s(a.checkDesc))]),t("td",{staticClass:"tg-0pky tg-9wq8"},[e._v(e._s(a.checkUserName?a.checkResult_dictText:""))]),t("td",{staticClass:"tg-0pky tg-9wq8"},[e._v(e._s(a.workTime))]),t("td",{staticClass:"tg-0pky tg-9wq8"},[e._v(e._s(a.checkMethod_dictText))]),t("td",{staticClass:"tg-0pky tg-9wq8"},[e._v(e._s(a.checkUserName))]),t("td",{staticClass:"tg-0pky tg-9wq8"},[e._v(e._s(a.checkTime))])])})),e._m(1),t("tr",[t("td",{staticClass:"tg-9wq8",attrs:{colspan:"2"}},[e._v("参考工艺文件")]),t("td",{staticClass:"tg-0pky",attrs:{colspan:"8"}},e._l(e.sheetData.techLinkList,(function(a,r){return t("p",{key:r,staticStyle:{margin:"0","font-size":"12px","line-height":"18px"}},[e._v(" "+e._s(a.teckBookName)+" ")])})),0)]),e._m(2),e._m(3),e._l(e.sheetData.rectifyList,(function(a,r){return t("tr",{key:r},[t("td",{staticClass:"tg-0pky",attrs:{colspan:"7"}},[e._v(e._s(a.itemInfo))]),t("td",{staticClass:"tg-0pky"},[e._v(e._s(a.rectifyDesc))]),t("td",{staticClass:"tg-0pky"},[e._v(e._s(a.reviewTime))]),t("td",{staticClass:"tg-0pky"},[e._v(e._s(a.reviewUserName))])])})),e._m(4),t("tr",[t("td",{staticClass:"tg-9wq8",attrs:{colspan:"2"}},[e._v("评定：")]),t("td",{staticClass:"tg-0pky",attrs:{colspan:"8"}},[e._l(e.sheetData.judgeList,(function(a){return t("div",{key:a.id,staticClass:"qualityBox"},[t("div",{staticClass:"flex1",style:e.qualityEvaluation&&"padding-right: 20px;"},[t("span",[e._v(e._s("评定人：".concat(a.jdUserName)))]),t("span",[e._v(e._s("评定时间：".concat(a.jdTime)))]),t("span",[e._v(e._s("评定内容：".concat(a.jdContent)))])]),e.qualityEvaluation&&a.jdUserId===e.$store.getters.userInfo.id?t("div",[t("a-button",{directives:[{name:"has",rawName:"v-has",value:"jobchekc:evaluation:add",expression:"'jobchekc:evaluation:add'"}],attrs:{type:"link"},on:{click:e.openJudgeModal}},[e._v("质量评定")]),t("a-button",{directives:[{name:"has",rawName:"v-has",value:"jobchekc:evaluation:del",expression:"'jobchekc:evaluation:del'"}],attrs:{type:"link"},on:{click:function(t){return e.delJudge(a.id)}}},[e._v("删除")])],1):e._e()])})),e.sheetData.judgeList&&0!==e.sheetData.judgeList.length&&e.isJudge?e._e():t("div",{staticClass:"qualityBox"},[t("div",{staticClass:"flex1",style:e.qualityEvaluation&&"padding-right: 20px;"}),t("div",[e.fromData?t("a-button",{directives:[{name:"has",rawName:"v-has",value:"jobchekc:evaluation:add",expression:"'jobchekc:evaluation:add'"}],attrs:{type:"link"},on:{click:e.openJudgeModal}},[e._v("质量评定")]):e._e()],1)])],2)]),e._m(5),t("tr",[t("td",{staticClass:"tg-9wq8",attrs:{colspan:"2"}},[e._v("说明："+e._s(e.sheetData.remark))]),e._m(6)])],2),t("a-modal",{attrs:{title:"作业质量评定",width:800,visible:e.visible,centered:"",cancelText:"关闭",destroyOnClose:!0},on:{ok:e.handleOk,cancel:function(t){e.visible=!1}}},[t("a-form",{ref:"initForm",attrs:{form:e.form}},[t("a-form-item",[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["jdContent",e.validatorRules.jdContent],expression:"['jdContent', validatorRules.jdContent]"}],attrs:{"auto-size":{minRows:8,maxRows:8}}})],1)],1)],1)],1)},o=[function(){var e=this,t=e._self._c;return t("tr",[t("td",{staticClass:"tg-87ij",staticStyle:{width:"6%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("序号")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"12%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("项点")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"18%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("检查内容")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"8%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("等级")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"8%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("检查情况")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"8%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("结果")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"10%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("作业时间")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"10%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("检查方式")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"10%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("检查人")])]),t("td",{staticClass:"tg-87ij",staticStyle:{width:"10%"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("检查时间")])])])},function(){var e=this,t=e._self._c;return t("tr",[t("td",{staticClass:"tg-0pky",attrs:{colspan:"10"}})])},function(){var e=this,t=e._self._c;return t("tr",[t("td",{staticClass:"tg-0pky",attrs:{colspan:"10"}})])},function(){var e=this,t=e._self._c;return t("tr",[t("td",{staticClass:"tg-87ij",attrs:{colspan:"7"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("不合格项汇总")])]),t("td",{staticClass:"tg-87ij"},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("整改情况")])]),t("td",{staticClass:"tg-87ij"},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("复查时间")])]),t("td",{staticClass:"tg-87ij"},[t("span",{staticStyle:{"font-weight":"bold",color:"#000"}},[e._v("复查人")])])])},function(){var e=this,t=e._self._c;return t("tr",[t("td",{staticClass:"tg-0pky",attrs:{colspan:"10"}})])},function(){var e=this,t=e._self._c;return t("tr",[t("td",{staticClass:"tg-0pky",attrs:{colspan:"10"}})])},function(){var e=this,t=e._self._c;return t("td",{staticClass:"tg-0pky",attrs:{colspan:"8"}},[e._v(" 1、表中只列出关键项点，检查人员在检查时参照工艺文件标准执行。"),t("br"),e._v(" 2、检查人员必须对当天作业内容进行检查。"),t("br"),e._v(" 3、表中所有内容全部现场检查时填写完成，并悬挂于部件上，随部件流转。"),t("br"),e._v(" 4、作业时间由作业班组填写，其余由检查人员填写。“检查情况”一栏详细记录检查情况；“结果”一栏对检查合格的画“√”不合格的画“×”；“检查方式”一栏写明检查手段，如：目视、测量、操作等。"),t("br"),e._v(" 5、检查人员对不合格项视情节严重情况开具整改单，及时提出整改意见，并督促整改，整改完成后及时进行复查。"),t("br"),e._v(" 6、由检查人员、质量工程师及专业工程师对整体作业质量做出最终判定。 ")])}],i=a("b7b4");function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var n=r&&r.prototype instanceof c?r:c,u=Object.create(n.prototype);return l(u,"_invoke",function(a,r,o){var i,n,l,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,n=0,l=e,f.n=a,s}};function h(a,r){for(n=a,l=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(l=i[(n=i[4])?5:(n=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(n=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,n=0))}if(o||a>1)return s;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),n=u,l=m;(t=n<2?e:l)||!d;){i||(n?n<3?(n>1&&(f.n=-1),h(n,l)):f.n=l:f.v=l);try{if(c=2,i){if(n||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,n<2&&(n=0)}else 1===n&&(t=i.return)&&t.call(i),n<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),n=1);i=e}else if((t=(d=f.n<0)?l:a.call(r,f))!==s)break}catch(t){i=e,n=1,l=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),u}var s={};function c(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(l(t={},r,(function(){return this})),t),h=d.prototype=c.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return u.prototype=d,l(h,"constructor",d),l(d,"constructor",u),u.displayName="GeneratorFunction",l(d,o,"GeneratorFunction"),l(h),l(h,o,"Generator"),l(h,r,(function(){return this})),l(h,"toString",(function(){return"[object Generator]"})),(n=function(){return{w:i,m:m}})()}function l(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,a,r){function i(t,a){l(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},l(e,t,a,r)}function s(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function c(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){s(i,r,o,n,l,"next",e)}function l(e){s(i,r,o,n,l,"throw",e)}n(void 0)}))}}var u={name:"JobCheckSheetTable",data:function(){return{jdContentText:"",form:this.$form.createForm(this),validatorRules:{jdContent:{rules:[{required:!0,message:"请输入评定内容!"}]}},judgeQueryParam:{id:null,checkInstId:"",checkInstName:"",jdContent:"",jdTime:null,jdUserId:this.$store.getters.userInfo.id,jdUserName:this.$store.getters.userInfo.username},visible:!1,sheetData:{}}},props:{data:{type:Object,default:function(){return{}}},qualityEvaluation:{type:Boolean,default:!1},fromData:{type:Object,default:function(){}}},created:function(){this.sheetData=Object.assign({},this.data),this.sheetData.itemList=this.sortArray(this.sheetData.itemList)},mounted:function(){},computed:{isJudge:function(){var e=this;return!(!this.sheetData||!this.sheetData.judgeList||this.sheetData.judgeList.length<1)&&!!this.sheetData.judgeList.find((function(t){return t.jdUserId===e.$store.getters.userInfo.id}))}},methods:{getWorkCheckForm:function(){var e=c(n().m((function e(){var t,a=this;return n().w((function(e){while(1)switch(e.n){case 0:return t=this.fromData,e.a(2,Object(i["x"])({task2InstId:t.task2InstId,formInstId:t.id}).then((function(e){return e.success&&e.result&&(e.result.itemList=a.sortArray(e.result.itemList),a.sheetData=e.result),a.sheetData})))}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),openJudgeModal:function(){var e=this,t=this.fromData;this.judgeQueryParam.checkInstId=t.id,this.judgeQueryParam.checkInstName=t.name,this.visible=!0;var a=t.judgeList.find((function(t){return t.jdUserId===e.$store.getters.userInfo.id}));a?(this.judgeQueryParam.jdContent=a.jdContent,this.judgeQueryParam.id=a.id,this.form.getFieldDecorator("jdContent"),this.$nextTick((function(){e.form.setFieldsValue({jdContent:e.jdContentText||e.judgeQueryParam.jdContent})}))):(this.judgeQueryParam.jdContent="",this.judgeQueryParam.id=null,this.form.getFieldDecorator("jdContent"),this.$nextTick((function(){e.form.setFieldsValue({jdContent:""})})))},handleOk:function(){var e=this;this.form.validateFields((function(t,a){t||(Object.assign(e.judgeQueryParam,a),Object(i["E"])(e.judgeQueryParam).then((function(t){t.success?(e.jdContentText=a.jdContent,e.$message.success("保存成功"),e.$emit("brush"),e.getWorkCheckForm().then((function(t){e.$emit("judgeChange",e.sheetData)}))):e.$message.error(t.message)})),e.visible=!1)}))},sortArray:function(e){return e.sort(this.compare("sortNo")),e},compare:function(e){return function(t,a){return t[e]-a[e]}},delJudge:function(e){var t=this;this.$confirm({content:"是否删除作业质量评定？",okText:"确定",cancelText:"取消",onOk:function(){var a=new FormData;a.append("ids",e),Object(i["g"])(a).then((function(e){e.success?(t.$message.success("执行成功"),t.$emit("brush"),t.getWorkCheckForm().then((function(e){t.$emit("judgeChange",t.sheetData)}))):t.$message.error(e.message)}))}})}}},d=u,f=(a("bd18"),a("2877")),h=Object(f["a"])(d,r,o,!1,null,"3c8c4fbe",null);t["default"]=h.exports},e24e:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a("e8ae"),o=a.n(r),i=a("21a6"),n=a.n(i),l=(a("7268"),"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"),s=function(e,t){var a=new o.a.Workbook;"[object Object]"===Object.prototype.toString.call(e)&&(e=[e]),e.forEach((function(e){if(0===e.data.length)return!0;var t=a.addWorksheet(e.name),r=e.config&&e.config.merge||{},o=e.config&&e.config.borderInfo||{},i=e.config&&e.config.columnlen||{},n=e.images||{};return d(n,a,t),u(i,t),c(e.config,t),m(e.data,t),f(r,t),h(o,t),!0}));var r=a.xlsx.writeBuffer().then((function(e){var a=new Blob([e],{type:l});n.a.saveAs(a,"".concat(t,".xlsx"))}));return r},c=function(e,t){if(e&&e.rowlen)for(var a in e.rowlen){var r=parseInt(a),o=parseInt(e.rowlen[a]),i=t.getRow(r+1);i.height=o}},u=function(e,t){for(var a in e){var r=parseInt(a),o=parseInt(e[a]);t.getColumn(r+1).width=parseInt(o/7)}},d=function(e,t,a){for(var r in e){var o=e[r],i=o.src.split(";base64,"),n=i[0].replaceAll("data:image/",""),l=t.addImage({base64:o.src,extension:n}),s=luckysheet.location(o.default.left,o.default.top);a.addImage(l,{tl:{col:s.col,row:s.row},ext:{width:o.default.width,height:o.default.height}})}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=Object.values(e);a.forEach((function(e){t.mergeCells(e.r+1,e.c+1,e.r+e.rs,e.c+e.cs)}))},h=function(e,t){Array.isArray(e)&&e.forEach((function(e){if("range"===e.rangeType)for(var a=v(e.borderType,e.style,e.color),r=e.range[0],o=r.row,i=r.column,n=o[0]+1;n<o[1]+2;n++)for(var l=i[0]+1;l<i[1]+2;l++)t.getCell(n,l).border=a;if("cell"===e.rangeType){var s=e.value,c=s.col_index,u=s.row_index,d=Object.assign({},e.value);delete d.col_index,delete d.row_index;var f=y(d,u,c);t.getCell(u+1,c+1).border=f}}))},m=function(e,t){Array.isArray(e)&&e.forEach((function(e,a){e.every((function(e,r){if(!e)return!0;var o=p(e.bg),i=b(e.ff,e.fc,e.bl,e.it,e.fs,e.cl,e.ul),n=g(e.vt,e.ht,e.tb,e.tr),l="";e.f?l={formula:e.f,result:e.v}:!e.v&&e.ct&&e.ct.s?e.ct.s.forEach((function(e){l+=e.v})):l=e.v;var s=k(r),c=t.getCell(s+(a+1));for(var u in o){c.fill=o;break}return c.font=i,c.alignment=n,c.value=l,!0}))}))},p=function(e){if(!e)return{};var t={type:"pattern",pattern:"solid",fgColor:{argb:e.replace("#","")}};return t},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l={0:"微软雅黑",1:"宋体（Song）",2:"黑体（ST Heiti）",3:"楷体（ST Kaiti）",4:"仿宋（ST FangSong）",5:"新宋体（ST Song）",6:"华文新魏",7:"华文行楷",8:"华文隶书",9:"Arial",10:"Times New Roman ",11:"Tahoma ",12:"Verdana",num2bl:function(e){return 0!==e}},s={name:"number"===typeof e?l[e]:e,family:1,size:o,color:{argb:t.replace("#","")},bold:l.num2bl(a),italic:l.num2bl(r),underline:l.num2bl(n),strike:l.num2bl(i)};return s},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",o={vertical:{0:"middle",1:"top",2:"bottom",default:"top"},horizontal:{0:"center",1:"left",2:"right",default:"left"},wrapText:{0:!1,1:!1,2:!0,default:!1},textRotation:{0:0,1:45,2:-45,3:"vertical",4:90,5:-90,default:0}},i={vertical:o.vertical[e],horizontal:o.horizontal[t],wrapText:o.wrapText[a],textRotation:o.textRotation[r]};return i},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#000";if(!e)return{};var r={type:{"border-all":"all","border-top":"top","border-right":"right","border-bottom":"bottom","border-left":"left"},style:{0:"none",1:"thin",2:"hair",3:"dotted",4:"dashDot",5:"dashDot",6:"dashDotDot",7:"double",8:"medium",9:"mediumDashed",10:"mediumDashDot",11:"mediumDashDotDot",12:"slantDashDot",13:"thick"}},o={style:r.style[t],color:{argb:a.replace("#","")}},i={};return"all"===r.type[e]?(i["top"]=o,i["right"]=o,i["bottom"]=o,i["left"]=o):i[r.type[e]]=o,i};function y(e,t,a){var r={},o={type:{l:"left",r:"right",b:"bottom",t:"top"},style:{0:"none",1:"thin",2:"hair",3:"dotted",4:"dashDot",5:"dashDot",6:"dashDotDot",7:"double",8:"medium",9:"mediumDashed",10:"mediumDashDot",11:"mediumDashDotDot",12:"slantDashDot",13:"thick"}};for(var i in e)-1===e[i].color.indexOf("rgb")?r[o.type[i]]={style:o.style[e[i].style],color:{argb:e[i].color.replace("#","")}}:r[o.type[i]]={style:o.style[e[i].style],color:{argb:e[i].color}};return r}function k(e){var t="A".charCodeAt(0),a="Z".charCodeAt(0),r=a-t+1,o="";while(e>=0)o=String.fromCharCode(e%r+t)+o,e=Math.floor(e/r)-1;return o}},e42a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{title:"车辆设备选择",width:"80%",bodyStyle:{height:"60vh"},visible:e.visible,confirmLoading:e.confirmLoading,closable:!0,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.close}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchQuery.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:5,sm:24}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"名称或编码"},model:{value:e.queryParam.title,callback:function(t){e.$set(e.queryParam,"title",t)},expression:"queryParam.title"}})],1)],1),t("a-col",{attrs:{md:10,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-space",[t("a-button",{on:{click:e.searchQuery}},[e._v("查询")])],1)],1)])],1)],1)],1),t("div",{staticClass:"tableHeight"},[t("vxe-table",{ref:"listTable",attrs:{border:"",resizable:"","row-id":"id",align:e.allAlign,height:"auto",data:e.tableData,"show-overflow":"tooltip","max-height":"100%","radio-config":{trigger:e.multiple?"default":"row",highlight:!0,checkMethod:e.checkRadioMethod},"checkbox-config":{trigger:e.multiple?"row":"default",highlight:!0,checkStrictly:!0,checkMethod:e.checkRadioMethod},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:e.loadChildrenMethod}}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"assetName",title:"名称","tree-node":"",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{align:"left","header-align":"center",field:"assetNo",title:"编码",width:"12%"}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"structType_dictText",title:"类型",width:"10%"}}),t("vxe-table-column",{attrs:{field:"assetTypeName",title:"设备类型",width:"13%",align:"left","header-align":"center"}})],1)],1)])],1)},o=[],i=a("8fad"),n={props:{multiple:{type:Boolean,default:!0},trainNo:{required:!0},canSelectType:{type:Array,default:function(){return[1,2,3,4]}}},data:function(){return{allAlign:"center",tableData:[],visible:!1,confirmLoading:!1,queryParam:{code:"",title:""}}},created:function(){},methods:{checkRadioMethod:function(e){var t=e.row;return this.canSelectType.indexOf(t.structType)>-1},searchQuery:function(){this.findList()},loadChildrenMethod:function(e){var t=this,a=e.row,r={code:this.trainNo,id:a.id,searchText:this.queryParam.searchText};return new Promise((function(e){Object(i["Ub"])(r).then((function(a){a.success?e(a.result):t.$message.error("".concat(a.msg))}))}))},handleOk:function(){var e=[];this.multiple?e=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&e.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",e),this.visible=!1},showModal:function(){this.visible=!0,this.queryParam.code=this.trainNo,this.findList()},close:function(){this.visible=!1},findList:function(){var e=this;this.loading=!0,Object(i["Ub"])(this.queryParam).then((function(t){t.success&&(e.loading=!1,e.tableData=t.result)}))}}},l=n,s=(a("14d0"),a("2877")),c=Object(s["a"])(l,r,o,!1,null,"0f6e3f94",null);t["default"]=c.exports},e89a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"luckySheetPringContent"}},[t("div",{staticClass:"table-page-body",staticStyle:{position:"relative"}},[t("div",{ref:"printDom",staticClass:"ls-print",style:{height:e.lHeight},attrs:{id:e.luckySheetId}})])])},o=[],i=a("8fad"),n=(a("2410"),a("7268")),l={name:"LuckySheetPrint",props:{luckySheetId:{type:String,default:"luckySheetPring"}},data:function(){return{recordSheet:{},lHeight:"calc(100% - 0)"}},mounted:function(){},methods:{printById:function(e){var t=this;i["rb"].call(this,e).then((function(e){e.success&&t.printBySheet(JSON.parse(e.result))})).catch((function(e){t.$message.error("加载表单内容异常")}))},printByData:function(e){var t=this;this.recordSheet=e,this.$nextTick((function(){t.print()}))},printBySheet:function(e){var t=this,a=Object.assign({},n["a"].getDefaultOptions());a.container=this.luckySheetId;var r=0,o=0,i=0;e.celldata.forEach((function(e){e.c>r&&(r=e.c),e.r>o&&(o=e.r)})),r++,o++,i=e.visibledatarow[e.visibledatarow.length-1],a.column=r,a.row=o,delete e.luckysheet_select_save,a.data=[e],this.lHeight="".concat(i+40,"px"),luckysheet.destroy(),luckysheet.create(a),setTimeout((function(){var e=document.getElementById("luckysheet-sheettable_0"),a=document.getElementById("luckysheetTableContent"),r=a.getContext("2d").getImageData(42,17,e.offsetWidth,e.offsetHeight+10),o=document.createElement("canvas");o.width=e.offsetWidth,o.height=e.offsetHeight;var i=o.getContext("2d");i.putImageData(r,0,0);var n=o.toDataURL("image/png");t.print('<img id="printImage" src="'.concat(n,'">'))}),500)},print:function(e){var t=this,a=document.getElementById("printDom")||document.createElement("iframe");a.id="printDom",document.body.appendChild(a),this.$nextTick((function(){var r=document.getElementById("printDom");r.contentDocument.write(e),r.contentDocument.getElementById("printImage").onload=function(){r.contentWindow.print(),luckysheet.destroy(),t.$emit("sheetPrintOk"),document.body.removeChild(a)}}))}}},s=l,c=(a("d1e3"),a("2877")),u=Object(c["a"])(s,r,o,!1,null,"4cc670b2",null);t["default"]=u.exports},e9d9:function(e,t,a){},ed25:function(e,t,a){},ee46:function(e,t,a){},ef2b0:function(e,t,a){"use strict";a("7616")},f000:function(e,t,a){},f02c:function(e,t,a){"use strict";a("ee46")},f0c5:function(e,t,a){"use strict";a("4b54")},f680:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return"checkbox"==e.tagType?t("a-checkbox-group",{attrs:{value:e.arrayValue,disabled:e.disabled},on:{change:e.onChange}},e._l(e.dictOptions,(function(a,r){return t("a-checkbox",{key:r,attrs:{value:a.value}},[e._v(e._s(a.text||a.label))])})),1):"select"==e.tagType?t("a-select",{attrs:{value:e.arrayValue,disabled:e.disabled,mode:"multiple",placeholder:e.placeholder,getPopupContainer:function(e){return e.parentNode},allowClear:""},on:{change:e.onChange}},e._l(e.dictOptions,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.value}},[t("span",{staticStyle:{display:"inline-block",width:"100%"},attrs:{title:a.text||a.label}},[e._v(" "+e._s(a.text||a.label)+" ")])])})),1):e._e()},o=[],i=a("4ec3");function n(e){return u(e)||c(e)||s(e)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return d(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,t):void 0}}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function u(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var f={name:"JMultiSelectTag",props:{dictCode:String,placeholder:String,disabled:Boolean,value:String,type:String,options:Array},data:function(){return{dictOptions:[],tagType:"",arrayValue:this.value?this.value.split(","):[]}},created:function(){this.type&&"list_multi"!==this.type?this.tagType=this.type:this.tagType="select"},watch:{options:function(e){this.setCurrentDictOptions(e)},dictCode:{immediate:!0,handler:function(){this.initDictData()}},value:function(e){this.arrayValue=e?this.value.split(","):[]}},methods:{initDictData:function(){var e=this;if(this.options&&this.options.length>0)this.dictOptions=n(this.options);else{if(Object(i["u"])(this.dictCode))return void(this.dictOptions=Object(i["u"])(this.dictCode));Object(i["f"])(this.dictCode,null).then((function(t){t.success&&(e.dictOptions=t.result)}))}},onChange:function(e){this.$emit("change",e.join(","))},setCurrentDictOptions:function(e){this.dictOptions=e},getCurrentDictOptions:function(){return this.dictOptions}},model:{prop:"value",event:"change"}},h=f,m=a("2877"),p=Object(m["a"])(h,r,o,!1,null,null,null);t["default"]=p.exports},f6d0:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.fromFlow?e._e():t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:12,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden","margin-bottom":"8px"}},[t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:e.save}},[e._v("确认领用")]),t("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.close}},[e._v("关闭")])],1)])],1),t("div",{staticStyle:{height:"calc(70vh - 45px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,range:!0}}},[t("vxe-table-column",{attrs:{type:"seq",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),t("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),t("vxe-table-column",{attrs:{field:"status_dictText",title:"确认状态",width:"100"}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}})],1)],1),t("ApplyDistributionModal",{ref:"distributionModal",attrs:{dataList:e.distributionTableList},on:{ok:e.onSuccess}})],1)},o=[],i=a("c54ca"),n=a("2eb4"),l=a("8973");function s(e){return f(e)||d(e)||u(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){if(e){if("string"==typeof e)return h(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(e,t):void 0}}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e){if(Array.isArray(e))return h(e)}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var m={name:"ApplyConfirmComponent",components:{ApplyDistributionModal:n["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:null}},data:function(){return{tableData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{orderId:"",status:[1]}}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:{edit:function(e){this.queryParam.orderId=e,this.findList()},findList:function(){var e=this;this.tableData=[],Object(i["bb"])(this.queryParam).then((function(t){t.success?(e.tableData=[].concat(s(e.tableData),s(t.result)),l["a"].joinDistributionInfo(e.tableData)):e.$message.error("加载数据失败"),e.$emit("loaded")}))},save:function(e){var t=this;if(this.tableData&&this.tableData.length>0){var a=this.tableData.map((function(e,t){return e.id}));if(0===a.length)return this.$message.warn("没有要确认领料的物资，无法继续！"),void this.$emit("fail",{message:"没有要确认领料的物资，无法继续！"});var r={fromType:2,ids:a.join(",")};Object(i["j"])(r).then((function(e){e.success?t.$emit("ok"):t.$emit("fail",e)})).catch((function(e){t.$message.error("保存异常"),t.$emit("fail",{message:"保存异常！"})}))}else this.$emit("ok")},close:function(){this.$emit("close")},openDistribution:function(e){this.$refs.distributionModal.showModal(e)},onSuccess:function(){var e=this;this.tableData.forEach((function(t){t.receive=0,e.distributionTableList.forEach((function(e){e.applyDetailId===t.id&&(t.receive+=Number(e.amount))}))}))}}},p=m,b=a("2877"),g=Object(b["a"])(p,r,o,!1,null,"1c988508",null);t["default"]=g.exports},f76d:function(e,t,a){"use strict";a("9527")},f9cc:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{width:"97%",title:"物料选择",visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticStyle:{height:"calc(80vh - 186px)"}},[t("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 186px)"},attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":e.multiple?{}:{trigger:"row"},"checkbox-config":e.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":e.onCellClick}},[e.multiple?t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):t("vxe-table-column",{attrs:{type:"radio",width:"40"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物料编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物料名称",align:"left","header-align":"center"}}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"150"}}),t("vxe-table-column",{attrs:{field:"receive",title:"领用数量",width:"150"}}),t("vxe-table-column",{attrs:{field:"num",title:"退还数量",width:"200","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入数量",min:1,max:r.receive},model:{value:r.num,callback:function(t){e.$set(r,"num",t)},expression:"row.num"}})]}}])})],1)],1)])},o=[],i=a("b098"),n=a("5633"),l=a("b9c3");function s(e){return f(e)||d(e)||u(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){if(e){if("string"==typeof e)return h(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(e,t):void 0}}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e){if(Array.isArray(e))return h(e)}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var m={name:"ReturnMaterialModal",components:{JTreeSelect:i["default"],LineSelectList:n["default"]},props:{multiple:{type:Boolean,default:!0}},data:function(){return{hiddenType:[],dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",dictCodeStrWork:"bu_mtr_workstation,name,id",queryParam:{type:"1",category1:"",searchText:"",attr:null,warehouseId:"",materialTypeCodeList:[],pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},created:function(){},methods:{showModal:function(e){var t=this;this.loading=!0,this.tableData=[],Object(l["w"])({orderId:e}).then((function(e){e.success?(e.result.forEach((function(e){e.detailList.map((function(e){return e.num=1,e})),t.tableData=[].concat(s(t.tableData),s(e.detailList))})),t.loading=!1,t.visible=!0):t.$message.error("读取领用明细失败")}))},handleOk:function(){var e=[];e=this.$refs.listTable.getCheckboxRecords(),this.$emit("ok",e),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.tabIndex="1"},onCellClick:function(e){var t=e.row,a=e.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([t],!0)}}},p=m,b=(a("190e"),a("2877")),g=Object(b["a"])(p,r,o,!1,null,"63189a6c",null);t["default"]=g.exports},fb4f:function(e,t,a){"use strict";a("0743")},ff09:function(e,t,a){"use strict";a.r(t);var r,o=function(){var e=this,t=e._self._c;return t("div",[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:24,sm:24}},[t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"right",overflow:"hidden","margin-bottom":"8px"}},[t("a-space",[e.isDistribution?e._e():t("a-button",{staticClass:"iconBtn",attrs:{loading:e.confirmLoading,disabled:e.records.length<1},on:{click:e.autoArrange}},[e._v("自动安排库位")]),e.isDistribution?e._e():t("a-button",{staticClass:"iconBtn",attrs:{loading:e.confirmLoading,disabled:e.records.length<1},on:{click:e.arrangePan}},[e._v("批量设置托盘")])],1)],1)])],1),e.isDistribution?e._e():t("div",{staticStyle:{height:"calc(70vh - 45px)"}},[t("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:e.allAlign,data:e.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,trigger:"row",range:!0}},on:{"checkbox-change":e.checkboxChange,"checkbox-all":e.checkboxChange}},[t("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),t("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180",align:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),t("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),t("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),t("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),t("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}}),t("vxe-table-column",{attrs:{title:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("a",{on:{click:function(t){return t.stopPropagation(),e.openDistribution(r)}}},[e._v("发放管理")])]}}],null,!1,768125003)})],1)],1),e.isDistribution?t("div",{staticClass:"panel-main",staticStyle:{height:"calc(70vh - 45px)"}},[t("div",{staticClass:"panel-left"},[t("vxe-table",{ref:"materialTable",attrs:{border:"",height:"auto","keep-source":"",data:e.tableData,"radio-config":{highlight:!0,trigger:"row",range:!0,checkMethod:function(){return 0===e.curEditMode}}},on:{"radio-change":e.onRadioChange,"cell-click":e.onMaterialCellClick}},[t("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),t("vxe-table-column",{attrs:{field:"materialTypeCode",width:"160",title:"物资编码"}}),t("vxe-table-column",{attrs:{field:"materialTypeName",title:"名称"}}),t("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格"}}),t("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"80"}}),t("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"80"}})],1)],1),t("div",{staticClass:"panel-right"},[t("div",{staticClass:"ant-alert ant-alert-info",staticStyle:{"margin-bottom":"16px"}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.addDetail}},[e._v("添加发放库位")]),t("a-button",{on:{click:e.closeDistribution}},[e._v("关闭")]),t("span",{staticStyle:{color:"red","margin-left":"15px"}},[e._v(e._s("总量: ".concat(e.selectInfo?e.selectInfo.amount:0,";")))]),t("span",{staticStyle:{color:"red","margin-left":"5px"}},[e._v(e._s("差额：".concat(e.calcAmount)))])],1)],1),t("div",{staticStyle:{height:"calc(100% - 62px)"}},[t("vxe-table",{ref:"distributionTable",attrs:{border:"",height:"auto","keep-source":"",data:e.tableDistributionData,"edit-rules":e.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[t("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{ref:"locationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:function(t){return e.openlocationModal(r)}},model:{value:r.sourceLocationName,callback:function(t){e.$set(r,"sourceLocationName",t)},expression:"row.sourceLocationName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,325071706)}),t("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择托盘",open:!1},on:{dropdownVisibleChange:function(t){return e.openPalletModal()}},model:{value:r.palletName,callback:function(t){e.$set(r,"palletName",t)},expression:"row.palletName"}},[t("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,3015230497)}),t("vxe-table-column",{attrs:{field:"tradeNo",title:"所属批次",width:"270","edit-render":{name:"input"}},scopedSlots:e._u([{key:"edit",fn:function(a){var r=a.row;return[r.needChooseTradeNo?t("div",[t("a-select",{staticStyle:{width:"100%"},on:{change:function(t){return e.tradeNoCHange(r)}},model:{value:r.tradeNo,callback:function(t){e.$set(r,"tradeNo",t)},expression:"row.tradeNo"}},e._l(r.tradeNoChoiceList,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.tradeNo}},[e._v(" "+e._s(a.tradeNo)+"    "+e._s(a.price)+" ")])})),1)],1):t("div",[e._v(" "+e._s(r.tradeNo)+" ")])]}}],null,!1,2270284966)}),t("vxe-table-column",{attrs:{field:"amount",title:"发放数量",width:"120",align:"center","edit-render":{name:"$input",props:{type:"number",min:0}}}}),t("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center","show-overflow":!1},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[r&&!e.$refs.distributionTable.isActiveByRow(r)?t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.editRowEvent(r)}}},[e._v("编辑 ")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.handleDel(r)}}},[e._v("删除")])],1):t("a-space",[t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveRowEvent(r)}}},[e._v("保存")]),t("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){return t.stopPropagation(),e.cancelRowEvent(r)}}},[e._v("取消")])],1)]}}],null,!1,743031837)})],1)],1)])]):e._e(),t("ApplyDistributionModal",{ref:"distributionModal",on:{ok:e.onSuccess}}),t("PalletList",{ref:"palletModal",attrs:{modeType:2},on:{ok:e.onSelectPallet}}),t("PalletList",{ref:"palletModal2",attrs:{modeType:2},on:{ok:e.onChoosePallet}}),t("LocationList",{ref:"locationModal",attrs:{modeType:2},on:{ok:e.onSelectLocation}})],1)},i=[],n=a("c54ca"),l=a("2eb4"),s=a("4ec3"),c=a("9f49"),u=a("13f1"),d=a("8973");function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function h(e,t,a){return(t=m(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function m(e){var t=p(e,"string");return"symbol"==f(t)?t:t+""}function p(e,t){if("object"!=f(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,r,o,i){var s=r&&r.prototype instanceof l?r:l,c=Object.create(s.prototype);return g(c,"_invoke",function(a,r,o){var i,l,s,c=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,s=e,f.n=a,n}};function h(a,r){for(l=a,s=r,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],h=f.p,m=i[2];a>3?(o=m===r)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,f.v=r,f.n=i[1]):h<m&&(o=a<3||i[0]>r||r>m)&&(i[4]=a,i[5]=r,f.n=m,l=0))}if(o||a>1)return n;throw d=!0,r}return function(o,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),l=u,s=m;(t=l<2?e:s)||!d;){i||(l?l<3?(l>1&&(f.n=-1),h(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(d=f.n<0)?s:a.call(r,f))!==n)break}catch(t){i=e,l=1,s=t}finally{c=1}}return{value:t,done:d}}}(a,o,i),!0),c}var n={};function l(){}function s(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(g(t={},r,(function(){return this})),t),d=c.prototype=l.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,g(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=c,g(d,"constructor",c),g(c,"constructor",s),s.displayName="GeneratorFunction",g(c,o,"GeneratorFunction"),g(d),g(d,o,"Generator"),g(d,r,(function(){return this})),g(d,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:i,m:f}})()}function g(e,t,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}g=function(e,t,a,r){function i(t,a){g(e,t,(function(e){return this._invoke(t,a,e)}))}t?o?o(e,t,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},g(e,t,a,r)}function v(e,t,a,r,o,i,n){try{var l=e[i](n),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function y(e){return function(){var t=this,a=arguments;return new Promise((function(r,o){var i=e.apply(t,a);function n(e){v(i,r,o,n,l,"next",e)}function l(e){v(i,r,o,n,l,"throw",e)}n(void 0)}))}}function k(e){return C(e)||x(e)||T(e)||w()}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){if(e){if("string"==typeof e)return S(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?S(e,t):void 0}}function x(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function C(e){if(Array.isArray(e))return S(e)}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var I={name:"ApplyReadyComponent",components:{ApplyDistributionModal:l["default"],PalletList:c["default"],LocationList:u["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!1},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:""}},data:function(){return{records:[],confirmLoading:!1,tableData:[],tableDistributionData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{status:[0],orderId:""},curRow:null,isDistribution:!1,selectInfo:{},addParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},curEditMode:0,validRules:{sourceLocationName:[{required:!0,message:"请选择库位",trigger:"manual"}],tradeNo:[{required:!0,message:"批次号不能为空",trigger:"manual"}],amount:[{required:!0,message:"请输入数量",trigger:"manual"}]}}},computed:{hasActiveRow:function(){return!!this.$refs.distributionTable.getActiveRecord()},calcAmount:function(){return this.getAmount()}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:(r={tradeNoCHange:function(e){var t=e.tradeNoChoiceList.filter((function(t){return t.tradeNo==e.tradeNo}));e.price=t[0].price},checkboxChange:function(e){this.records=e.records},edit:function(e){this.initDictData(),this.queryParam.orderId=e,this.findList()},findList:function(){var e=this;this.tableData=[],this.records=[],Object(n["bb"])(this.queryParam).then((function(t){t.success?(e.tableData=[].concat(k(e.tableData),k(t.result)),d["a"].joinDistributionInfo(e.tableData),e.distributionTableList=[]):e.$message.error("加载数据失败"),e.$emit("loaded")}))},autoArrange:function(){var e=this,t=this.$refs.listTable.getCheckboxRecords();t.length<=0?this.$message.warn("请先选择要进行自动安排的记录！"):this.$confirm({content:"将根据现有库存情况自动安排库位，并覆盖原有数据？",okText:"确定",cancelText:"取消",onOk:function(){var a={applyDetailIdList:[],type:0};t.forEach((function(e){a.applyDetailIdList.push(e.id)})),e.confirmLoading=!0,Object(n["k"])(a).then((function(a){if(a.success){var r=a.result.applyDetailList;e.$message.success(a.result.assignResultMessage),t.forEach((function(e){var t=r.find((function(t){return t.id===e.id}));t&&(t.sourceLocationAndPalletName="",t.assignDetailList.forEach((function(e){var a=e.sourceLocationName+" | "+e.amount;e.palletName&&(a+=" | ".concat(e.palletName)),e.tradeNo&&(a+=" | 第".concat(e.tradeNo,"批次")),t.sourceLocationAndPalletName+=a+" \n"})),Object.assign(e,t))}))}else e.$message.error(a.message);e.confirmLoading=!1}))},onCancel:function(){}})},arrangePan:function(){var e=this.$refs.listTable.getCheckboxRecords();if(e.length<=0)this.$message.warn("请先选择要进行自动安排的记录！");else{var t=e.filter((function(e){return e.assignDetailList.length<=0}));t.length>0?this.$message.warning("请先安排库位信息"):this.$refs.palletModal.showModal()}},onSelectPallet:function(e){var t=this.$refs.listTable.getCheckboxRecords();try{Array.from(t,(function(t){Array.from(t.assignDetailList,(function(t){t.palletId=e[0].id,t.palletName=e[0].name}))})),this.updateAssignInfo(),this.$message.success("设置成功")}catch(a){this.$message.error("设置失败")}},save:function(){var e=y(b().m((function e(t){var a,r,o,i,l=this;return b().w((function(e){while(1)switch(e.n){case 0:if(this.fromFlow){e.n=1;break}a=this.$refs.listTable.getCheckboxRecords(),a.length>0?this.$confirm({content:"是否确认发放选中".concat(a.length,"数据？"),onOk:function(){var e=a.map((function(e,t){return{id:e.id,palletId:e.palletName,receive:e.receive}})),t={id:l.queryParam.orderId,detailList:e};Object(n["i"])(t).then((function(e){e.success?l.$emit("ok"):l.$emit("fail",e)})).catch((function(e){l.$message.error("保存异常"),l.$emit("fail")}))}}):this.$message.error("尚未选中任何数据!"),e.n=6;break;case 1:if(!(this.tableData&&this.tableData.length>0)){e.n=5;break}if(r={id:this.queryParam.orderId,onlySave:t,detailList:this.tableData.filter((function(e){return!e.noSave}))},o=!0,i=this.tableData.filter((function(e){return 0===e.receive})),t||!i.length){e.n=3;break}return e.n=2,new Promise((function(e,t){var a=i.map((function(e){return"["+e.materialTypeName+"-"+e.materialTypeCode+"]缺少"+(e.amount-e.receive)})).join("；");l.$confirm({content:"数量不匹配提醒：  ".concat(a,"  ;  是否继续提交？"),onOk:function(){e(!0)},onCancel:function(){e(!1)}})}));case 2:o=e.v;case 3:if(o){e.n=4;break}return this.$emit("cancel"),e.a(2);case 4:n["i"].call(this,r).then((function(e){e.success?l.$emit("ok"):l.$emit("fail",e)})).catch((function(e){l.$message.error("备料保存异常"),l.$emit("fail",e)})),e.n=6;break;case 5:this.$emit("ok");case 6:return e.a(2)}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),close:function(){this.$emit("close")},initDictData:function(){var e=this;Object(s["f"])(this.dictCode,null).then((function(t){t.success&&t.result&&t.result.map((function(t){e.palletList=e.palletList.concat({label:t.text,value:t.value})}))}))},openDistribution:function(e){this.curRow=e,this.openDistribution(e)},onSuccess:function(e){var t=this;e.forEach((function(a){var r=t.tableData.find((function(e){return e.id===a.applyDetailId}));r.assignDetailList=JSON.parse(JSON.stringify(e)),r.receive=0,r.assignDetailList.forEach((function(e){r.receive+=Number(e.amount);var t=e.sourceLocationName+" | "+e.amount;e.palletName&&(t+=" | ".concat(e.palletName)),e.tradeNo&&(t+=" | 第".concat(e.tradeNo,"批次")),r.sourceLocationAndPalletName+=t+" \n"}))}))},updateAssignInfo:function(){this.tableData.forEach((function(e){e.sourceLocationAndPalletName="",e.assignDetailList.forEach((function(t){var a=t.sourceLocationName+" | "+t.amount;t.palletName&&(a+=" | ".concat(t.palletName)),t.tradeNo&&(a+=" | 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=a+" \n"}))}))}},h(h(h(h(h(h(h(h(h(h(r,"openDistribution",(function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isDistribution=!0,this.curEditMode=0,this.$nextTick((function(){e.$refs.materialTable.setRadioRow(t||e.tableData[0]||{}),e.setActiveRow(t||e.tableData[0])}))})),"closeDistribution",(function(){this.hasActiveRow?this.$message.warn("存在未保存数据，请先保存"):(this.isDistribution=!1,this.curEditMode=0)})),"setActiveRow",(function(e){var t=this;this.tableDistributionData=[],this.selectInfo={},this.selectInfo=this.tableData.find((function(t){return t.id===e.id})),this.selectInfo.assignDetailList.forEach((function(e){t.tableDistributionData.push(JSON.parse(JSON.stringify(e)))}))})),"onRadioChange",(function(e){var t=e.row;t&&!this.hasActiveRow&&this.setActiveRow(t)})),"onMaterialCellClick",(function(e){var t=e.$event;t.stopPropagation()})),"addDetail",(function(){var e=this;if(!this.$refs.distributionTable.getActiveRecord()){this.curEditMode=1;var t={applyDetailId:this.selectInfo.id,materialTypeId:this.selectInfo.materialTypeId,amount:this.getAmount()};this.$refs.distributionTable.insertAt(t,-1).then((function(t){var a=t.row;e.$refs.distributionTable.setActiveRow(a)}))}})),"editRowEvent",(function(e){this.$refs.distributionTable.getActiveRecord()||(this.curEditMode=2,this.$refs.distributionTable.setActiveRow(e))})),"getAmount",(function(){if(!this.selectInfo)return 0;var e=0;return this.tableDistributionData.forEach((function(t){e+=Number(t.amount)})),this.selectInfo.amount-e})),"openlocationModal",(function(e){this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,e.applyDetailId,e.id)})),"onSelectLocation",(function(e){if(e.length>0){var t=this.$refs.distributionTable.getActiveRecord(),a=t.row;a&&(a.locationName=e[0].warehouseName,a.locationWbs=e[0].warehouseWbs,a.sourceLocationName=e[0].sourceLocationName,a.tradeNo=e[0].tradeNo,a.price=e[0].price,a.needChooseTradeNo=e[0].needChooseTradeNo,a.tradeNoChoiceList=e[0].tradeNoChoiceList,a.locationNum=e[0].usableAmount,this.calcAmount>a.locationNum?a.amount=a.locationNum:this.calcAmount>0&&this.calcAmount<=a.locationNum?a.amount=this.calcAmount:a.amount=0)}})),h(h(h(h(h(r,"saveRowEvent",(function(e){var t=this;this.$refs.distributionTable.validate(e,(function(a){if(!a){if(t.tableDistributionData.find((function(t){return t.sourceLocationName===e.sourceLocationName&&t.tradeNo===e.tradeNo}))&&1===t.curEditMode)return void t.$message.warn("该仓库该批次的物资记录已存在");if("number"===typeof e.locationNum&&e.amount>e.locationNum)return void t.$message.warn("该仓库该批次的物资库存量不足");var r=0;if(t.tableDistributionData.forEach((function(t){t.sourceLocationName,e.sourceLocationName,t.tradeNo!==e.tradeNo&&(r+=Number(t.amount))})),r+Number(e.amount)>Number(t.selectInfo.amount))return void t.$message.warn("选择的实际数量超过了发放数量");1===t.curEditMode&&(e.isNew=!0,t.tableDistributionData.push(JSON.parse(JSON.stringify(e)))),t.$refs.distributionTable.clearActived(),t.onSuccess(t.tableDistributionData),t.curEditMode=0}}))})),"cancelRowEvent",(function(e){this.$refs.distributionTable.clearActived(),1===this.curEditMode?this.$refs.distributionTable.remove(e):2===this.curEditMode&&this.$refs.distributionTable.revertData(e),this.curEditMode=0})),"handleDel",(function(e){var t=this;this.$refs.distributionTable.getActiveRecord()||(this.$confirm({content:"是否删除选中的数据？",okText:"确定",cancelText:"取消",onOk:function(){t.tableDistributionData.splice(t.tableDistributionData.findIndex((function(t){return t.sourceLocationName===e.sourceLocationName})),1);var a=t.tableData.find((function(t){return t.id===e.applyDetailId}));a.assignDetailList.find((function(t){return t.sourceLocationName===e.sourceLocationName}))&&(a.receive-=a.assignDetailList.find((function(t){return t.sourceLocationName===e.sourceLocationName})).amount,a.assignDetailList.splice(a.assignDetailList.findIndex((function(t){return t.sourceLocationName===e.sourceLocationName})),1)),t.$nextTick((function(){t.locationMaxAmount=t.calcAmount}))}}),this.curEditMode=0)})),"openPalletModal",(function(){this.$refs.palletModal2.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName)})),"onChoosePallet",(function(e){if(e.length>0){var t=this.$refs.distributionTable.getActiveRecord(),a=t.row;a&&(a.palletId=e[0].id,a.palletName=e[0].name)}})))},_=I,N=(a("51c5"),a("2877")),O=Object(N["a"])(_,o,i,!1,null,"efd43ef8",null);t["default"]=O.exports}}]);