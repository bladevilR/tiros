(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-688a532a","chunk-aceff70c","chunk-15c678cd","chunk-4c7abdf2","chunk-2d238a23","chunk-2d21d872","chunk-2d238054"],{"060d":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?t._e():e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"listTable",attrs:{border:"",align:t.allAlign,"show-overflow":"tooltip",data:t.taskRegulations,"checkbox-config":{trigger:"row",highlight:!0}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"title",title:"名称",align:"left","header-align":"center",width:"25%","tree-node":""}}),e("vxe-table-column",{attrs:{field:"type_dictText",title:"类型",width:"8%"}}),e("vxe-table-column",{attrs:{field:"method_dictText",title:"维保手段",width:"8%"}}),e("vxe-table-column",{attrs:{field:"qualityLevel",title:"质保等级",width:"8%"}}),e("vxe-table-column",{attrs:{field:"outsource_dictText",title:"是否委外",width:"6%"}}),e("vxe-table-column",{attrs:{field:"safeNotice",title:"安全提示",align:"left","header-align":"center",width:"25%"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left","header-align":"center"}})],1),e("regulation-list",{ref:"modalForm",attrs:{multiple:!0,"check-strictly":!1,"regu-id":t.reguId,"plan-id":t.planId,trainTypeId:t.trainTypeId},on:{ok:t.addRegulation}})],1)},n=[],i=a("500a"),s=a("ca00"),o=a("8fad"),l={name:"TaskRegulations",components:{RegulationList:i["default"]},props:{reguId:{type:String,default:""},planId:{type:String,default:""},trainTypeId:{type:String,default:""},taskRegulations:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{allAlign:"center"}},computed:{plan:function(){return this.$store.getters.taskForm}},methods:{handleAdd:function(){this.$refs.modalForm.showModal()},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){e.map((function(e){t.taskRegulations.map((function(a,r){e.id===a.id&&t.taskRegulations.splice(r,1)})),e.reguMaterials&&e.reguMaterials.length>0&&t.$emit("removeMaterials",e.reguMaterials),e.reguPersons&&e.reguPersons.length>0&&t.$emit("removePersons",e.reguPersons),e.reguTools&&e.reguTools.length>0&&t.$emit("removeTools",e.reguTools),1===e.mustReplace&&t.$emit("removeMustReplaces",e)}))}})},addRegulation:function(t){var e=this;t.map((function(t){if(2===t.type){var a=e.taskRegulations.findIndex((function(e){return e.reguDetailId===t.id}));a<0&&(t.reguDetailId=t.id,t.id=Object(s["p"])(),e.taskRegulations.push(t),e.$emit("change"),1===t.mustReplace&&e.$emit("addMustReplaces",t),Object(o["Jb"])({id:t.reguDetailId}).then((function(t){if(t.success){var a=t.result;a.reguMaterials&&a.reguMaterials.length>0&&e.$emit("addMaterials",a.reguMaterials),a.reguPersons&&a.reguPersons.length>0&&e.$emit("addPersons",a.reguPersons),a.reguTools&&a.reguTools.length>0&&e.$emit("addTools",a.reguTools),a.techBookDetails&&a.techBookDetails.length>0&&e.$emit("addTools",a.techBookDetails),a.techBookDetails&&a.techBookDetails.length>0&&e.$emit("addBookDetails",a.techBookDetails)}})))}}))}}},c=l,u=a("2877"),d=Object(u["a"])(c,r,n,!1,null,null,null);e["default"]=d.exports},"0db6":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?t._e():e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:t.taskTools,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(e){t.taskTools=e}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{type:"seq",width:"40"}}),e("vxe-table-column",{attrs:{field:"code",title:"编码","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择工器具",open:!1},on:{focus:function(e){return t.openToolSelectModal(r)}},model:{value:r.code,callback:function(e){t.$set(r,"code",e)},expression:"row.code"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(e){return t.openToolSelectModal(r)}},slot:"suffixIcon"})],1)]}}])}),e("vxe-table-column",{attrs:{field:"name",title:"工器具名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.name)+" ")]}}])}),e("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.category1_dictText)+" ")]}}])}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:999999},model:{value:r.amount,callback:function(e){t.$set(r,"amount",e)},expression:"row.amount"}})]}}])}),e("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.unit)+" ")]}}])}),e("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input",{attrs:{maxLength:201,placeholder:"请输入备注"},on:{change:function(e){return t.remarkChangeValue(r)}},model:{value:r.remark,callback:function(e){t.$set(r,"remark",e)},expression:"row.remark"}})]}}])}),t.readOnly?t._e():e("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.row;return[t.$refs.listTable.isActiveByRow(r)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(r)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(r)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(r)}}},[t._v("编辑")])]]}}],null,!1,1311980394)})],1),e("ToolTypeSelect",{ref:"modalForm",attrs:{multiple:!1},on:{ok:t.onSelectTool}}),e("ToolTypeSelect",{ref:"modalFormMultiple",attrs:{multiple:!0,batch:!0},on:{ok:t.onSelectToolMultiple}})],1)},n=[],i=a("a4db"),s=a("ca00"),o={name:"TaskTools",components:{ToolTypeSelect:i["default"]},props:{taskTools:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择工器具"}],amount:[{required:!0,message:"数量必须填写"}],remark:[{max:200,type:"string",message:"备注不能超过200个字符"}]}}},methods:{remarkChangeValue:function(t){var e=t.remark;e.length>200&&this.$message.error("备注不能超过200个字符")},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){e.map((function(e){t.taskTools.map((function(a,r){e.id===a.id&&t.taskTools.splice(r,1)}))}))}})},editRowEvent:function(t){this.curEditMode=2,this.$refs.listTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.taskTools.map((function(a,r){t.id===a.id&&e.taskTools.splice(r,1)}))},saveRowEvent:function(t){var e=this;this.$refs.listTable.validate(t,(function(a){if(a)for(var r in a){var n=a[r];n.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 1===e.curEditMode&&e.taskTools.push(t),e.$refs.listTable.clearActived(),e.curEditMode=0}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},openToolSelectModal:function(t){this.curRow=t,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur()},onSelectToolMultiple:function(t){var e=this;t.forEach((function(a,r){if(e.taskTools.find((function(t){return t.toolTypeId===a.id})))e.$message.warn("你选择的".concat(a.name,"已经在列表中存在"));else{var n={id:Object(s["p"])(),code:a.code,toolTypeId:a.toolTypeId||a.id,name:a.name,kind:a.kind,unit:a.unit,kind_dictText:a.kind_dictText,category1:a.category1,category1_dictText:a.category1_dictText,amount:a.num};1==t.length?e.$refs.listTable.insertAt(n,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"amount")})):(e.$refs.listTable.insertAt(n,-1),e.taskTools.push(n))}}))},onSelectTool:function(t){if(t&&t.length>0){var e=t[0],a=0;if(this.taskTools.map((function(t){if(t.toolTypeId===e.id)return a=1,!1})),1===a)return void this.$message.error("你选择的工器具已经在列表中存在，请选择其他工器具");this.curRow.code=e.code,this.curRow.toolTypeId=e.id,this.curRow.name=e.name,this.curRow.kind=e.kind,this.curRow.unit=e.unit,this.curRow.kind_dictText=e.kind_dictText,this.curRow.category1=e.category1,this.curRow.category1_dictText=e.category1_dictText,this.curRow.amount=e.num}else this.curRow.code="",this.curRow.toolTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.category1="",this.curRow.category1_dictText="",this.curRow.unit="",this.curRow.amount=0}}},l=o,c=a("2877"),u=Object(c["a"])(l,r,n,!1,null,null,null);e["default"]=u.exports},1998:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container",staticStyle:{height:"calc(100vh - 213px)",overflow:"auto"}},[e("a-table",{attrs:{size:"middle",columns:t.columns,"data-source":t.data,rowKey:function(t){return t.id},bordered:"",pagination:!1},scopedSlots:t._u([{key:"progress",fn:function(a){return e("span",{},[t._v(" "+t._s(a<0?"无工单":a+"%")+" ")])}}])}),e("a-drawer",{attrs:{title:"工单列表",width:"44%",placement:"right",visible:t.visible},on:{close:t.onClose}},[e("a-table",{attrs:{size:"middle",columns:t.orderColumns,"data-source":t.orderList,rowKey:function(t,e){return e},bordered:"",pagination:!1}})],1)],1)},n=[],i=a("3bcd"),s={name:"VehicleStructureTable",props:{data:{type:Array,default:[]}},data:function(){return{visible:!1,orderList:[]}},computed:{columns:function(){return[{title:"设备结构",dataIndex:"name",key:"name"},{title:"完成进度",dataIndex:"progress",key:"progress",scopedSlots:{customRender:"progress"},customCell:this.renderTdBackground,align:"center"},{title:"发现故障数",dataIndex:"faultCount",key:"faultCount",customCell:this.renderFaultBackground,align:"center"},{title:"当前工单",key:"currentOrderCount",dataIndex:"currentOrderCount",align:"center"},{title:"工单总数",key:"orderCount",dataIndex:"orderCount",customCell:this.renderEvent,align:"center"}]},orderColumns:function(){return[{title:"工单编号",dataIndex:"orderCode",key:"orderCode"},{title:"工单名称",dataIndex:"orderName",key:"orderName"},{title:"作业班组",dataIndex:"groupName",key:"groupName"},{title:"工单状态",dataIndex:"orderStatus_dictText",key:"orderStatus_dictText"},{title:"开始日期",dataIndex:"actStart",key:"actStart"},{title:"结束日期",dataIndex:"actFinish",key:"actFinish"}]}},methods:{renderFaultBackground:function(t){var e="";return e=t.faultCount?"#ec808d":"none",{style:{"background-color":e+"!important"}}},renderTdBackground:function(t){var e="#f2f2f2",a="#333";switch(t.progressStatus){case 0:e="#f2f2f2",a="#333";break;case 1:e="#0000ff",a="#fff";break;case 2:e="#ff0000",a="#fff";break;case 3:e="#0000ff",a="#fff";break;case 4:e="#ff0000",a="#fff";break;case 5:e="#008000",a="#fff";break;default:break}return{style:{"background-color":e+"!important",color:a+"!important"}}},renderEvent:function(t){var e=this;return{style:{cursor:"pointer"},on:{click:function(a){e.getPlanTrainStructOrdersList(t.orderIds)}}}},getPlanTrainStructOrdersList:function(t){var e=this;Object(i["B"])(t).then((function(t){t.success&&(e.orderList=t.result,e.visible=!0)}))},onClose:function(){this.visible=!1}}},o=s,l=a("2877"),c=Object(l["a"])(o,r,n,!1,null,null,null);e["default"]=c.exports},"3bcd":function(t,e,a){"use strict";a.d(e,"P",(function(){return n})),a.d(e,"N",(function(){return i})),a.d(e,"F",(function(){return s})),a.d(e,"J",(function(){return o})),a.d(e,"t",(function(){return l})),a.d(e,"i",(function(){return v})),a.d(e,"j",(function(){return b})),a.d(e,"h",(function(){return k})),a.d(e,"g",(function(){return w})),a.d(e,"l",(function(){return y})),a.d(e,"c",(function(){return x})),a.d(e,"e",(function(){return _})),a.d(e,"f",(function(){return T})),a.d(e,"d",(function(){return C})),a.d(e,"b",(function(){return I})),a.d(e,"x",(function(){return R})),a.d(e,"z",(function(){return P})),a.d(e,"w",(function(){return S})),a.d(e,"H",(function(){return $})),a.d(e,"I",(function(){return M})),a.d(e,"y",(function(){return j})),a.d(e,"A",(function(){return O})),a.d(e,"B",(function(){return D})),a.d(e,"M",(function(){return A})),a.d(e,"r",(function(){return L})),a.d(e,"E",(function(){return E})),a.d(e,"k",(function(){return d})),a.d(e,"D",(function(){return f})),a.d(e,"u",(function(){return u})),a.d(e,"L",(function(){return c})),a.d(e,"a",(function(){return p})),a.d(e,"K",(function(){return N})),a.d(e,"m",(function(){return q})),a.d(e,"p",(function(){return B})),a.d(e,"o",(function(){return V})),a.d(e,"G",(function(){return h})),a.d(e,"v",(function(){return m})),a.d(e,"C",(function(){return g})),a.d(e,"n",(function(){return z})),a.d(e,"q",(function(){return F})),a.d(e,"s",(function(){return Q})),a.d(e,"O",(function(){return Y}));var r=a("0fea"),n=function(t){return Object(r["d"])("/produce/train/history/tree/line-train",t)},i=function(t){return Object(r["d"])("/produce/train/history/maximo-asset/list-child",t)},s=function(t){return Object(r["d"])("/produce/train/history/train/get",t)},o=function(t){return Object(r["d"])("/produce/train/history/train/period",t)},l=function(t){return Object(r["d"])("/produce/train/history/maximo-asset/get",t)},c=function(t){return Object(r["d"])("/produce/train/history/work/page",t)},u=function(t){return Object(r["d"])("/produce/train/history/measure/page",t)},d=function(t){return Object(r["d"])("/produce/train/history/fault/page",t)},f=function(t){return Object(r["d"])("/produce/train/history/forms/page",t)},p=function(t){return Object(r["d"])("/produce/train/history/change/page",t)},h=function(t){return Object(r["d"])("/produce/train/history/train/period",t)},m=function(t){return Object(r["d"])("/produce/train/history/workLeaveRecord/page",t)},g=function(t){return Object(r["d"])("/produce/train/history/workRectify/page",t)},v=function(t){return Object(r["d"])("/produce/fault/detail/count",t)},b=function(t){return Object(r["d"])("/produce/fault/detail/page",t)},y=function(t){return Object(r["d"])("/produce/fault/statistics",t)},k=function(t){return Object(r["j"])("/produce/fault/compare",t)},w=function(t){return Object(r["d"])("/produce/fault/time-effect/data",t)},x=function(t){return Object(r["d"])("/produce/cost/detail/count",t)},_=function(t){return Object(r["d"])("/produce/cost/detail/page",t)},T=function(t){return Object(r["j"])("/produce/cost/statistics",t)},C=function(t){return Object(r["d"])("/produce/cost/compare/count-6year",t)},I=function(t){return Object(r["j"])("/produce/cost/compare",t)},R=function(t){return Object(r["d"])("/produce/plan/list",t)},P=function(t){return Object(r["d"])("/produce/plan/task/listByPlanId/".concat(t))},S=function(t){return Object(r["d"])("/produce/plan/get/".concat(t))},$=function(t){return Object(r["d"])("/serialPlan/plan/get/".concat(t))},M=function(t){return Object(r["d"])("/produce/plan/task/get/".concat(t))},j=function(t){return Object(r["d"])("/produce/plan/regu/list/".concat(t))},O=function(t){return Object(r["d"])("/produce/plan/train-struct/list/".concat(t))},D=function(t){return Object(r["d"])("/produce/plan/train-struct/orders/".concat(t))},A=function(t){return Object(r["d"])("/workshop/list",t)},L=function(t){return Object(r["d"])("/produce/workshop/fault/latest",t)},E=function(t){return Object(r["d"])("/produce/workshop/workstation/list",t)},N=function(t){return Object(r["d"])("/produce/workshop/train-track",t)},q=function(t){return Object(r["d"])("/produce/kpi/group",t)},B=function(t){return Object(r["d"])("/produce/kpi/user",t)},V=function(t){return Object(r["d"])("/produce/kpi/plan/list",t)},z=function(t){return Object(r["d"])("/produce/kpi/plan/get",t)},F=function(t){return Object(r["d"])("/serialPlan/plan/material/lack",t)},Q=function(t){return Object(r["d"])("/board/plan-group-statistic/get-last-working-plan",t)},Y=function(t){return Object(r["d"])("/board/plan-group-statistic/list",t)}},"500a":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"90%",title:"选择规程",centered:"",visible:t.visible,bodyStyle:{height:"70vh"},confirmLoading:t.confirmLoading,cancelText:"关闭",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-row",[e("a-col",{staticStyle:{"border-right":"1px dotted #D3E1F1",height:"calc(70vh - 20px)","margin-right":"8px",padding:"0px"},attrs:{md:4,sm:24}},[e("a-menu",{attrs:{mode:"inline","default-selected-keys":t.defaultKey},on:{click:t.handleMenuClick}},t._l(t.treeData,(function(a){return e("a-menu-item",{key:a.id},[e("a-icon",{attrs:{type:"container"}}),e("span",[t._v(t._s(a.name))])],1)})),1)],1),e("a-col",{attrs:{md:19,sm:24}},[this.planId?e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.findList.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:4,sm:24}},[e("a-form-item",{attrs:{label:"是否已关联"}},[e("j-dict-select-tag",{attrs:{dictCode:"bu_state","allow-clear":""},model:{value:t.tpPlanRelated,callback:function(e){t.tpPlanRelated=e},expression:"tpPlanRelated"}})],1)],1),e("a-col",{attrs:{md:3,sm:8}},[e("a-form-item",[e("a-button",{on:{click:t.findList}},[t._v("查询")])],1)],1)],1)],1)],1):t._e(),e("div",{staticStyle:{height:"calc(70vh - 20px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(70vh - 20px)"},attrs:{border:"","row-id":"id","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"manual",mode:"row"},"radio-config":t.multiple?{}:{trigger:"row",checkMethod:t.checkRadioMethod},"checkbox-config":t.multiple?{checkStrictly:t.checkStrictly,trigger:"row",highlight:!0}:{},"tree-config":{lazy:!0,children:"children",hasChild:"hasChildren",loadMethod:t.loadChildrenMethod}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"title",title:"名称","tree-node":"",align:"left"}}),e("vxe-table-column",{attrs:{field:"no",title:"序号",width:"80"}}),e("vxe-table-column",{attrs:{field:"type_dictText",title:"类型",width:"100"}}),e("vxe-table-column",{attrs:{field:"method_dictText",title:"维保手段",width:"120"}}),e("vxe-table-column",{attrs:{field:"qualityLevel",title:"质保等级",width:"80"}}),e("vxe-table-column",{attrs:{field:"safeNotice",title:"安全提示",width:"160"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"120"}}),this.planId?e("vxe-table-column",{attrs:{field:"tpPlanRelatedInfo",title:"模板已关联",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.row;return[e("div",{style:{backgroundColor:t.statusColor[r.tpPlanRelated+""],borderRadius:"4px"}},[t._v(" "+t._s(r.tpPlanRelatedInfo)+" ")])]}}],null,!1,2972306538)}):t._e()],1)],1)])],1)],1)},n=[],i=a("8fad"),s={name:"RegulationList",props:{multiple:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!0},reguId:{type:String,default:""},planId:{type:String,default:""},trainTypeId:{type:String,default:""},onlyProject:{type:Boolean,default:!1}},data:function(){return{visible:!1,confirmLoading:!1,statusColor:{0:"#dedede",1:"#bad795"},treeData:[],curReguId:"",tableData:[],allAlign:"center",defaultKey:[],tpPlanRelated:"",formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.getTreeList()},checkRadioMethod:function(t){var e=t.row;return!this.onlyProject||1===e.type},getTreeList:function(){var t=this;this.reguId?Object(i["Ib"])(this.reguId).then((function(e){e.success?(t.curReguId=t.reguId,t.treeData=[e.result],t.getReguDetailList(t.curReguId)):t.$message.error("获取规程信息失败")})).catch((function(e){t.$message.error("获取规程信息异常")})):Object(i["Lb"])({trainTypeId:this.trainTypeId}).then((function(e){e.success?(t.defaultKey[0]=e.result[0].id,t.curReguId=e.result[0].id,t.treeData=e.result,t.getReguDetailList(t.curReguId)):t.$message.error("获取规程信息失败")})).catch((function(e){t.$message.error("获取规程信息异常")}))},findList:function(){var t=this,e={reguId:this.reguId,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};Object(i["Kb"])(e).then((function(e){t.tableData=e.result}))},getReguDetailList:function(t){var e=this,a={reguId:t,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};Object(i["Kb"])(a).then((function(t){e.tableData=t.result}))},loadChildrenMethod:function(t){var e=this,a={reguId:this.reguId,parentId:t.row.id,tpPlanId:this.planId,tpPlanRelated:this.tpPlanRelated};return new Promise((function(t){Object(i["Kb"])(a).then((function(a){a.success?t(a.result):e.$message.error("".concat(a.msg))}))}))},onSelect:function(t,e){var a=e.node.dataRef;t.length>0&&(this.curReguId=a.id,this.getReguDetailList(a.id))},handleMenuClick:function(t){this.getReguDetailList(t.key)},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.close()},handleCancel:function(){this.close()},close:function(){this.visible=!1}}},o=s,l=(a("5125"),a("2877")),c=Object(l["a"])(o,r,n,!1,null,"210f6b5e",null);e["default"]=c.exports},5125:function(t,e,a){"use strict";a("d059")},5786:function(t,e,a){t.exports=a.p+"img/magic.deee3b0e.svg"},"5bbd":function(t,e,a){},6419:function(t,e,a){},"6bd01":function(t,e,a){"use strict";a("cb75")},"6c57":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("a-tabs",{attrs:{"na-flex-height-full":""}},[e("a-tab-pane",{key:"1",attrs:{tab:"基本信息"}},[e("ViewTaskBasicInfo",{attrs:{taskInfo:t.taskInfo}})],1),e("a-tab-pane",{key:"2",attrs:{tab:"关联规程"}},[e("TaskRegulations",{attrs:{"task-regulations":t.taskInfo.repairPlanReguInfo,"read-only":!0}})],1),e("a-tab-pane",{key:"3",attrs:{tab:"任务必换件"}},[e("TaskMustReplaces",{attrs:{"must-replaces":t.taskInfo.mustReplaces,"read-only":!0}})],1),e("a-tab-pane",{key:"4",attrs:{tab:"任务物料"}},[e("TaskMaterials",{attrs:{"task-materials":t.taskInfo.materials,"read-only":!0}})],1),e("a-tab-pane",{key:"5",attrs:{tab:"任务工器具"}},[e("TaskTools",{attrs:{"task-tools":t.taskInfo.tools,"read-only":!0}})],1),e("a-tab-pane",{key:"6",attrs:{tab:"人员需求"}},[e("TaskPersons",{attrs:{"task-persons":t.taskInfo.persons,"read-only":!0}})],1)],1)},n=[],i=a("fe32"),s=a("060d"),o=a("a051"),l=a("0db6"),c=a("ffe2"),u=a("d24b"),d=a("b47d"),f={name:"ViewTaskComponent",components:{ViewTaskBasicInfo:i["default"],TaskRegulations:s["default"],TaskMustReplaces:o["default"],TaskMaterials:c["default"],TaskTools:l["default"],TaskPersons:u["default"]},props:["taskId"],data:function(){return{taskInfo:{}}},mounted:function(){this.loadTaskInfo()},methods:{loadTaskInfo:function(){var t=this;Object(d["ub"])(this.taskId).then((function(e){e.success&&(t.taskInfo=e.result)}))}}},p=f,h=a("2877"),m=Object(h["a"])(p,r,n,!1,null,"b0dd4ed6",null);e["default"]=m.exports},"7ba1":function(t,e,a){"use strict";a("5bbd")},"9c17":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{ref:"rootWrapper",staticClass:"planmonitor-container"},[0!==t.leftPx?e("div",{style:{position:"absolute",top:1,left:t.leftPx,zIndex:999,cursor:"pointer"}},[e("a-dropdown",{attrs:{trigger:["click"]}},[e("img",{attrs:{src:a("5786")},on:{click:function(t){return t.preventDefault()}}}),e("a-menu",{staticStyle:{"min-width":"110px"},attrs:{slot:"overlay"},slot:"overlay"},t._l(t.plansList,(function(a,r){return e("a-sub-menu",{key:r,attrs:{title:a.lineName}},t._l(a.plans,(function(a,r){return e("a-menu-item",{key:r,on:{click:function(e){return t.selectPlanInfo(a)}}},[t._v(t._s(a.planName)+" ")])})),1)})),1)],1)],1):t._e(),e("div",{staticClass:"header"},[e("table",{staticClass:"tg"},[e("thead",[e("tr",[e("th",{staticClass:"tg-yf16 switch bg-primary-1",staticStyle:{width:"160px"},attrs:{rowspan:"2"}},[t._v(" 当前状态： "),t.planInfo.trainNo?e("span",[0==t.planInfo.progressStatus?e("span",{staticClass:"status unstarted"},[t._v("未开始")]):1==t.planInfo.progressStatus?e("span",{staticClass:"status nor"},[t._v("正常(作业中)")]):2==t.planInfo.progressStatus?e("span",{staticClass:"status overdue"},[t._v("逾期(作业中)")]):3==t.planInfo.progressStatus?e("span",{staticClass:"status nor"},[t._v("正常(完工)")]):e("span",{staticClass:"status overdue"},[t._v("逾期(完工)")])]):e("span",[t._v("无数据")])]),e("th",{staticClass:"tg-yf16",attrs:{colspan:"3"}},[t.planInfo.trainNo?e("span",{staticClass:"title"},[t._v(" "+t._s(t.planInfo.trainNo+""+t.planInfo.planName)+" ")]):e("span",[t._v("暂时无数据")])]),e("th",{staticClass:"tg-yf16",attrs:{colspan:"2"}},[e("div",{staticClass:"type"},[e("a-radio-group",{on:{change:t.onChange},model:{value:t.typeValue,callback:function(e){t.typeValue=e},expression:"typeValue"}},[e("a-radio",{attrs:{value:1}},[t._v(" 列计划方式 ")]),e("a-radio",{attrs:{value:2}},[t._v(" 规程结构方式 ")]),e("a-radio",{attrs:{value:3}},[t._v(" 车辆结构方式 ")])],1)],1)])]),e("tr",[e("td",{staticClass:"tg-co5t",staticStyle:{width:"200px"}},[e("div",{staticClass:"progress_box"},[e("span",{staticClass:"label"},[t._v("当前架修进度："+t._s(t.planInfo.progress||0)+"%")]),e("p",{staticClass:"progress_in",style:{width:t.planInfo.progress||"0%"}})])]),e("td",{staticClass:"tg-co5t"},[t._v("当前工期第： "+t._s(t.planInfo.currentDay||"暂无数据")+" 天")]),e("td",{staticClass:"tg-co5t"},[t._v("计划完工： "+t._s(t.planInfo.finishDate||"暂无数据"))]),t._m(0)])])])]),e("div",{staticClass:"main"},[e("a-spin",{attrs:{spinning:t.loading}},[e("div",{directives:[{name:"show",rawName:"v-show",value:1==t.typeValue,expression:"typeValue == 1"}],staticClass:"plan_cont"},[e("div",{staticStyle:{width:"100%",height:"calc(100vh - 389px)","padding-top":"8px"},attrs:{id:"viewProject"}}),t.chartCountItems.length>0?e("div",{staticClass:"chart_cont"},t._l(t.chartCountItems,(function(a,r){return e("div",{key:r,staticClass:"chart"},[e("p",{staticClass:"title"},[t._v(t._s(a.title))]),e("div",{staticClass:"chartIn",attrs:{id:"chart1"}},[e("v-chart",{attrs:{forceFit:!0,height:127,data:a.chartData,padding:[20,40,20,60]}},[e("v-coord",{attrs:{type:"rect",direction:"LB"}}),e("v-tooltip"),e("v-axis",{attrs:{dataKey:"value",label:""}}),e("v-bar",{attrs:{position:"label*value",label:"value"}})],1)],1)])})),0):t._e()]),e("div",{directives:[{name:"show",rawName:"v-show",value:2==t.typeValue,expression:"typeValue == 2"}],staticClass:"discipline_cont"},[t.planReguList.length?e("discipline",{attrs:{data:t.planReguList}}):t._e()],1),e("div",{directives:[{name:"show",rawName:"v-show",value:3==t.typeValue,expression:"typeValue == 3"}],staticClass:"vehicle_structure_cont"},[e("div",{staticClass:"table_cont"},[t.planTrainStructList.length?e("vehicle-structure-table",{attrs:{data:t.planTrainStructList}}):t._e()],1)])])],1),e("a-modal",{attrs:{centered:"",title:"任务查看",width:"100%",dialogClass:"fullDialog no-footer",visible:t.taskViewVisible,footer:null,destroyOnClose:!0},on:{cancel:function(e){t.taskViewVisible=!1}}},[e("ViewTaskComponent",{attrs:{"task-id":t.taskId}})],1)],1)},n=[function(){var t=this,e=t._self._c;return e("td",{staticClass:"tg-co5t",attrs:{colspan:"2"}},[e("div",{staticClass:"tips_list"},[e("p",{staticClass:"item"},[e("span",{staticClass:"block bg-red"}),e("span",{staticClass:"label"},[t._v("滞后")])]),e("p",{staticClass:"item"},[e("span",{staticClass:"block bg-green"}),e("span",{staticClass:"label"},[t._v("超前")])]),e("p",{staticClass:"item"},[e("span",{staticClass:"block bg-blue"}),e("span",{staticClass:"label"},[t._v("正常")])])])])}],i=a("f1a0"),s=a("dc0e"),o=a("1998"),l=a("6c57"),c=a("3bcd"),u={components:{BarHorizontal:i["default"],Discipline:s["default"],VehicleStructureTable:o["default"],ViewTaskComponent:l["default"]},data:function(){return{loading:!1,leftPx:0,typeValue:1,lineList:[],plansList:[],project:null,projectData:{Tasks:[]},planInfo:{},planTaskInfo:{},parentTask:null,editTask:null,taskViewVisible:!1,dataSourceB:[{label:"总数",value:66},{label:"已完成",value:20}],chartCountItems:[],planReguList:[],planTrainStructList:[],taskId:""}},watch:{typeValue:function(t,e){1==t&&this.getPlanInfo(this.planInfo.id),2==t&&this.getPlanInfoByRegu(this.planInfo.id),3==t&&this.getPlanInfoByTrainStruct(this.planInfo.id)}},mounted:function(){this.getAllPlanList()},methods:{getAllPlanList:function(){var t=this;Object(c["x"])().then((function(e){e.success&&(t.leftPx=t.$refs.rootWrapper.offsetLeft,t.plansList=e.result,t.plansList&&t.plansList.length>0&&(t.planInfo=t.plansList[0].plans[0],t.getPlanInfo(t.planInfo.id),t.loadProject()))})).catch((function(t){}))},getPlanTaskList:function(t){var e=this;Object(c["z"])(t).then((function(t){t.success&&(e.taskList=t.result,e.taskViewVisible=!0)})).catch((function(t){}))},getPlanInfo:function(t){var e=this;this.loading=!0,Object(c["w"])(t).then((function(t){t.success&&(e.planInfo.progress=t.result.progress,e.planInfo.finishDate=t.result.finishDate,e.planInfo.currentDay=t.result.currentDay,e.chartCountItems=e.changeCountItemsFormat(t.result.countItems)),e.loading=!1}))},getPlanInfoByRegu:function(t){var e=this;this.loading=!0,Object(c["y"])(t).then((function(t){t.success&&(e.planReguList=t.result),e.loading=!1}))},getPlanInfoByTrainStruct:function(t){var e=this;this.loading=!0,Object(c["A"])(t).then((function(t){t.success&&(e.planTrainStructList=t.result),e.loading=!1}))},onChange:function(t){},changeCountItemsFormat:function(t){var e=[];if(t.length>0){for(var a=0;a<t.length;a++){var r=t[a];e.push({title:r.title,chartData:[{label:"总数",value:r.count},{label:"已完成",value:r.finish}]})}return e}return[]},loadProject:function(){var t=this;mini.parse(),this.project=new PlusProject,this.project.setStyle("width:100%;height:100%"),this.project.setBorderStyle("border:1px dotted #cdcdcd");var e=[new PlusProject.IDColumn,new PlusProject.NameColumn,new PlusProject.DurationColumn,new PlusProject.StartColumn,new PlusProject.FinishColumn,new PlusProject.WorkColumn,new PlusProject.ActualStartColumn,new PlusProject.ActualFinishColumn,{header:"班组<br/>Multi",field:"workGroupName",width:120},{name:"dayIndex",header:"第几天？<br/>String",field:"dayIndex",width:60},{name:"finishStatus",header:"完成状态<br/>String",field:"status",width:60},{name:"creatStatus",header:"已生成?<br/>String",field:"hasGen",width:80}];this.project.setColumns(e),this.project.render(document.getElementById("viewProject")),this.project.enableManualSchedule=!0,this.project.setReadOnly(!0),this.project.setShowDirty(!1),this.project.allowOrderProject=!1,this.project.setTimeLines([{date:new Date,text:"",position:"bottom",style:"width:2px;background:red;"}]),this.project.setTopTimeScale("month"),this.project.setBottomTimeScale("day"),this.project.setRowHeight(28),this.project.on("taskdblclick",(function(e){var a=e.task;t.getTrainTaskDetail(a.UID)})),this.customGanttRender(),this.getTemplateInfo()},selectPlanInfo:function(t){this.planInfo=t,this.typeValue=1,this.getPlanInfo(this.planInfo.id),this.getTemplateInfo()},getTemplateInfo:function(){var t=this;this.parentTask=null,this.editTask=null,Object(c["H"])(this.planInfo.id).then((function(e){e.success&&(t.projectData=e.result,t.projectData.StartDate=new Date(t.projectData.StartDate),t.projectData.FinishDate=new Date(t.projectData.FinishDate),t.projectData.Tasks.forEach((function(t){t.ActualStart&&(t.ActualStart=new Date(t.ActualStart)),t.ActualFinish&&(t.ActualFinish=new Date(t.ActualFinish))})),t.projectData.Tasks=mini.arrayToTree(t.projectData.Tasks,"children","UID","ParentId"),t.project.loadData(t.projectData))}))},customGanttRender:function(){this.project.on("drawcell",(function(t){var e=t.record,a=t.column;t.field;"Name"==a.name&&(t.cellCls="name-col-cls"),1==e.Summary&&(t.rowCls="summary-row-cls"),"finishStatus"==a.name&&(1==e.status&&(t.cellHtml="未开始"),2==e.status&&(t.cellHtml="已开始"),3==e.status&&(t.cellHtml="已暂停")),"creatStatus"==a.name&&(0==e.hasGen&&(t.cellHtml="未生成工单"),1==e.hasGen&&(t.cellHtml="已生成工单")),1==e.Summary&&"Name"!=a.name&&(t.cellHtml="")}));var t=this;this.project.on("drawitem",(function(e){var a=e.item,r=e.itemBox.left,n=e.itemBox.top,i=e.itemBox.width,s=e.itemBox.height;if(a.Summary||a.Milestone)a.Summary;else if(e.baseline);else{var o=t.$moment(a.Finish).format("YYYY-MM-DD"),l=t.$moment(a.Start).format("YYYY-MM-DD"),c=a.ActualFinish?t.$moment(a.ActualFinish).format("YYYY-MM-DD"):"",u=a.ActualStart?t.$moment(a.ActualStart).format("YYYY-MM-DD"):"",d=t.$moment().format("YYYY-MM-DD"),f="base-item";c?c>o?f="delay-finish-item bg-red":c===o?f="normal-finish-item bg-blue":c<o&&(f="before-finish-item bg-green"):u?d>o&&(f="delay-finish-item bg-red"):f=d>l?"delay-finish-item bg-red":"no-start-item";var p=i*(a.PercentComplete/100);e.itemHtml='<div id="'+a._id+'" class="'+f+'" style="left:'+r+"px;top:"+n+"px;width:"+i+"px;height:"+s+'px;">',e.itemHtml+='<div style="width:'+p+'px;" class="finish-progress-item"></div>',e.itemHtml+="</div>"}})),this.project.on("itemtooltipneeded",(function(t){var e=t.task;t.baseline||(t.tooltip="<div>计划名称："+e.Name+"</div><div ><div style='float:left;'>进度：<b>"+e.PercentComplete+"%</b></div><div style='float:right;'>工期："+e.Duration+"日</div></div><div style='clear:both;'>计划开始："+mini.formatDate(e.Start,"yyyy-MM-dd")+"</div><div>计划完成："+mini.formatDate(e.Finish,"yyyy-MM-dd")+"</div><div>实际开始："+mini.formatDate(e.ActualStart,"yyyy-MM-dd")+"</div><div>实际完成："+mini.formatDate(e.ActualFinish,"yyyy-MM-dd")+"</div>")})),this.project.on("drawitem",(function(t){var e=t.item;t.label=e.Name+" "+t.task["PercentComplete"]+"%",t.labelAlign="left"}))},getTrainTaskDetail:function(t){this.taskId=t,this.taskViewVisible=!0}}},d=u,f=(a("6bd01"),a("2877")),p=Object(f["a"])(d,r,n,!1,null,"78878358",null);e["default"]=p.exports},a051:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?t._e():e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"listTable",attrs:{border:"",align:t.allAlign,"keep-source":!0,data:t.mustReplaces,"edit-rules":t.validRules,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"checkbox-config":{trigger:"row",highlight:!0}},on:{"update:data":function(e){t.mustReplaces=e}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150",align:"left","edit-render":{name:"input"},"header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择必换件",open:!1},on:{focus:function(e){return t.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(e){t.$set(r,"code",e)},expression:"row.code"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(e){return t.openMaterialSelectModal(r)}},slot:"suffixIcon"})],1)]}}])}),e("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{"edit-render":{name:"$input",props:{type:"number"}},field:"amount",title:"数量",width:"150"}}),e("vxe-table-column",{attrs:{field:"unit",title:"单位"}}),e("vxe-table-column",{attrs:{field:"spec",title:"必换件描述",align:"left","header-align":"center"}}),t.readOnly?t._e():e("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.row;return[t.$refs.listTable.isActiveByRow(r)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(r)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(r)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(r)}}},[t._v("编辑")])]]}}],null,!1,1311980394)})],1),e("must-material",{ref:"modalFormRadio",attrs:{lineId:t.lineId,repairProId:t.repairProId,multiple:!1},on:{ok:t.addMustReplacesRadio}}),e("must-material",{ref:"modalForm",attrs:{lineId:t.lineId,repairProId:t.repairProId,multiple:!0},on:{ok:t.addMustReplaces}})],1)},n=[],i=a("de56"),s=a("ca00"),o={name:"TaskMustReplace",components:{MustMaterial:i["default"]},props:{repairProId:{default:""},lineId:{default:""},mustReplaces:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,allAlign:"center",validRules:{code:[{required:!0,message:"请选必换件"}],name:[{required:!0,message:"请选择必换件"}],amount:[{required:!0,message:"数量必须填写"}]}}},computed:{plan:function(){return this.$store.getters.planForm}},methods:{saveRowEvent:function(t){var e=this;this.$refs.listTable.validate(t,(function(a){if(a)for(var r in a){var n=a[r];n.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 1===e.curEditMode&&e.mustReplaces.push(t),e.$refs.listTable.clearActived(),e.curEditMode=0}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},editRowEvent:function(t){this.curEditMode=2,this.$refs.listTable.setActiveRow(t)},handleAdd:function(){this.curEditMode=1,this.$refs.modalForm.showModal()},openMaterialSelectModal:function(t){this.curRow=t,this.$refs.modalFormRadio.showModal(),this.$refs.formSelect.blur()},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<1?this.$message.warning("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){e.map((function(e){t.mustReplaces.map((function(a,r){e.id===a.id&&t.mustReplaces.splice(r,1)}))}))}})},addMustReplacesRadio:function(t){if(t&&t.length){var e=t[0],a=0;if(this.mustReplaces.map((function(t){if(t.mustReplaceId===e.id)return a=1,!1})),1===a)return void this.$message.warning("你选择的物料已经在列表中存在，请选择其他物料");var r=JSON.parse(JSON.stringify(e));r.mustReplaceId=r.id,r.id=Object(s["p"])(),r.amount=r.needAmount,Object.assign(this.curRow,r)}},addMustReplaces:function(t){var e=this;t.map((function(a){var r=e.mustReplaces.findIndex((function(t){return t.mustReplaceId===a.id}));if(r<0){var n=JSON.parse(JSON.stringify(a));n.mustReplaceId=n.id,n.id=Object(s["p"])(),n.amount=n.needAmount,1==t.length?e.$refs.listTable.insertAt(n,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"code")})):(e.$refs.listTable.insertAt(n,-1),e.mustReplaces.push(n))}else e.$message.warning("你选择的".concat(a.name,"已经在列表中存在，请选择其他物料"))}))}}},l=o,c=a("2877"),u=Object(c["a"])(l,r,n,!1,null,null,null);e["default"]=u.exports},a4db:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"90%",title:t.title,visible:t.visible,confirmLoading:t.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.findList.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:7,sm:24}},[e("a-form-item",{attrs:{label:"搜索"}},[e("a-input",{attrs:{placeholder:"请输入工器具名称或编码"},model:{value:t.queryParam.searchText,callback:function(e){t.$set(t.queryParam,"searchText",e)},expression:"queryParam.searchText"}})],1)],1),e("a-col",{attrs:{md:7,sm:24}},[e("a-form-item",{attrs:{label:"分类"}},[e("j-dict-select-tag",{attrs:{dictCode:"bu_tools_type",disabledArray:t.canSelectType},model:{value:t.queryParam.category1,callback:function(e){t.$set(t.queryParam,"category1",e)},expression:"queryParam.category1"}})],1)],1),e("a-col",{attrs:{md:3,sm:8}},[e("a-button",{on:{click:t.findList}},[t._v("查询")])],1)],1)],1)],1),e("div",{staticStyle:{height:"calc(80vh - 130px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","radio-config":t.multiple?{}:{trigger:"row",checkMethod:t.checkRadioMethod},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0,checkMethod:t.checkRadioMethod}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}},on:{"cell-click":t.onCellClick}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"code",title:"编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"name",title:"名称",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"category1_dictText",title:"类别",width:"150"}}),e("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"150"}}),t.batch?e("vxe-table-column",{attrs:{field:"num",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}):t._e()],1),e("vxe-pager",{attrs:{perfect:"","current-page":t.queryParam.pageNo,"page-size":t.queryParam.pageSize,total:t.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:current-page":function(e){return t.$set(t.queryParam,"pageNo",e)},"update:pageSize":function(e){return t.$set(t.queryParam,"pageSize",e)},"update:page-size":function(e){return t.$set(t.queryParam,"pageSize",e)},"page-change":t.handlePageChange}})],1)])},n=[],i=a("c54ca"),s={name:"ToolTypeSelect",props:{multiple:{type:Boolean,default:!0},canSelectType:{type:Array,default:function(){return[4,5,6]}},batch:{type:Boolean,default:!1}},data:function(){return{title:"工器具类型选择",queryParam:{type:"2",searchText:"",category1:null,pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1}},methods:{showModal:function(){this.visible=!0,this.canSelectType&&this.canSelectType.length>0&&(this.queryParam.category1=this.canSelectType[0]),this.findList()},findList:function(){var t=this;this.loading=!0,Object(i["Cb"])(this.queryParam).then((function(e){t.totalResult=e.result.total,t.loading=!1,t.tableData=e.result.records,t.tableData.forEach((function(e){t.$set(e,"num",1)}))}))},handlePageChange:function(t){var e=t.currentPage,a=t.pageSize;this.queryParam.pageNo=e,this.queryParam.pageSize=a,this.findList()},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},checkRadioMethod:function(t){var e=t.row;return!this.canSelectType||-1!==this.canSelectType.indexOf(e.category1)},onCellClick:function(t){var e=t.row,a=t.column;"num"===a.property&&this.$refs.listTable.setCheckboxRow([e],!0)}}},o=s,l=(a("7ba1"),a("2877")),c=Object(l["a"])(o,r,n,!1,null,"df2d4508",null);e["default"]=c.exports},ad26:function(t,e,a){"use strict";a("f1c7")},b209:function(t,e,a){"use strict";a("6419")},cb75:function(t,e,a){},d059:function(t,e,a){},d24b:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?t._e():e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"personsTable",attrs:{border:"",align:"center",data:t.taskPersons,"keep-source":!0,"checkbox-config":{trigger:"row",highlight:!0},"edit-rules":t.validRules,"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(e){t.taskPersons=e}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需人数",width:"150","edit-render":{name:"input"},align:"right","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:1,max:100},model:{value:r.amount,callback:function(e){t.$set(r,"amount",e)},expression:"row.amount"}})]}}])}),e("vxe-table-column",{attrs:{field:"requirePostion",title:"岗位要求",width:"300","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input",{attrs:{placeholder:"请输入岗位需求",maxLength:201},on:{change:function(e){return t.remarkChangeValue(r)}},model:{value:r.requirePostion,callback:function(e){t.$set(r,"requirePostion",e)},expression:"row.requirePostion"}})]}}])}),e("vxe-table-column",{attrs:{field:"requireTech",title:"技能要求",width:"300","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input",{attrs:{placeholder:"请输入技能要求",maxLength:201},on:{change:function(e){return t.remarkChangeValue(r)}},model:{value:r.requireTech,callback:function(e){t.$set(r,"requireTech",e)},expression:"row.requireTech"}})]}}])}),e("vxe-table-column",{attrs:{field:"requireCertificate",title:"证书要求",width:"300","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input",{attrs:{placeholder:"请输入证书要求",maxLength:201},on:{change:function(e){return t.remarkChangeValue(r)}},model:{value:r.requireCertificate,callback:function(e){t.$set(r,"requireCertificate",e)},expression:"row.requireCertificate"}})]}}])}),e("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input",{attrs:{maxLength:201,placeholder:"请输入备注"},on:{change:function(e){return t.remarkChangeValue(r)}},model:{value:r.remark,callback:function(e){t.$set(r,"remark",e)},expression:"row.remark"}})]}}])}),t.readOnly?t._e():e("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.row;return[t.$refs.personsTable.isActiveByRow(r)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(r)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(r)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(r)}}},[t._v("编辑")])]]}}],null,!1,1754853870)})],1)],1)},n=[],i=a("ca00"),s={name:"TaskPersons",props:{taskPersons:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,validRules:{amount:[{required:!0,message:"数量必须填写",trigger:"blur"}],requirePostion:[{max:200,type:"string",message:"不能超过200个字符"}],requireTech:[{max:200,type:"string",message:"不能超过200个字符"}],requireCertificate:[{max:200,type:"string",message:"不能超过200个字符"}],remark:[{max:200,type:"string",message:"不能超过200个字符"}]}}},methods:{remarkChangeValue:function(t){var e=t.remark;e.length>200&&this.$message.error("备注不能超过200个字符")},handleAdd:function(){var t=this;if(!this.$refs.personsTable.getActiveRecord()){this.curEditMode=1;var e={id:Object(i["p"])()};this.$refs.personsTable.insertAt(e,-1).then((function(e){var a=e.row;return t.$refs.personsTable.setActiveCell(a,"amount")}))}},handleDel:function(){var t=this,e=this.$refs.personsTable.getCheckboxRecords();e.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){e.map((function(e){t.taskPersons.map((function(a,r){e.id===a.id&&t.taskPersons.splice(r,1)}))}))}})},editRowEvent:function(t){this.curEditMode=2,this.$refs.personsTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.taskPersons.map((function(a,r){t.id===a.id&&e.taskPersons.splice(r,1)}))},saveRowEvent:function(t){var e=this;this.$refs.personsTable.validate(t,(function(a){if(a)for(var r in a){var n=a[r];n.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 1===e.curEditMode&&e.taskPersons.push(t),e.$refs.personsTable.clearActived(),e.curEditMode=0}))},cancelRowEvent:function(t){this.$refs.personsTable.clearActived(),1===this.curEditMode?this.$refs.personsTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0}}},o=s,l=a("2877"),c=Object(l["a"])(o,r,n,!1,null,"2d8bdafd",null);e["default"]=c.exports},dc0e:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"progress_list_cont"},[e("div",{staticClass:"start_step"},[t._v(" 开始 ")]),e("a-row",{staticStyle:{width:"100%"},attrs:{type:"flex"}},t._l(t.data,(function(a,r){return e("a-col",{key:r,staticClass:"item_step"},[e("p",{class:5===a.progressStatus?"label green":2===a.progressStatus||4===a.progressStatus?"label red":1===a.progressStatus||3===a.progressStatus?"label blue":"label"},[t._v(" "+t._s(a.no)+"、"+t._s(a.title)+" ")]),e("p",{staticClass:"value"},[t._v(t._s(a.progress<0?"无计划任务":a.progress+"%"))])])})),1),e("div",{staticClass:"end_step"},[t._v(" 结束 ")])],1)},n=[],i={name:"VehicleStructureTable",props:{data:{type:Array,default:[]}},data:function(){return{}},methods:{}},s=i,o=(a("ad26"),a("2877")),l=Object(o["a"])(s,r,n,!1,null,"31345a70",null);e["default"]=l.exports},de56:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"90%",title:"必换件选择",visible:t.visible,confirmLoading:t.confirmLoading,cancelText:"关闭",centered:"",destroyOnClose:!0,bodyStyle:{height:"80vh"}},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.findList.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:4,sm:12}},[e("a-form-item",{attrs:{label:"必换件"}},[e("a-input",{attrs:{allowClear:"",placeholder:"必换件编码或者名称"},model:{value:t.willChangeQueryParam.searchText,callback:function(e){t.$set(t.willChangeQueryParam,"searchText",e)},expression:"willChangeQueryParam.searchText"}})],1)],1),e("a-col",{attrs:{md:3,sm:24}},[e("a-form-item",{attrs:{label:"所属线路"}},[e("line-select-list",{model:{value:t.willChangeQueryParam.lineId,callback:function(e){t.$set(t.willChangeQueryParam,"lineId",e)},expression:"willChangeQueryParam.lineId"}})],1)],1),e("a-col",{attrs:{md:4,sm:24}},[e("a-form-item",{attrs:{label:"所属修程"}},[e("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_repair_program,name,id"},model:{value:t.willChangeQueryParam.repairProgramId,callback:function(e){t.$set(t.willChangeQueryParam,"repairProgramId",e)},expression:"willChangeQueryParam.repairProgramId"}})],1)],1),e("a-col",{attrs:{md:4,sm:24}},[e("a-form-item",{attrs:{label:"所属系统"}},[e("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:"bu_train_asset_type,name,id,struct_type=1 and parent_id is null"},model:{value:t.willChangeQueryParam.sysId,callback:function(e){t.$set(t.willChangeQueryParam,"sysId",e)},expression:"willChangeQueryParam.sysId"}})],1)],1),e("a-col",{attrs:{md:3,sm:24}},[e("a-form-item",{attrs:{label:"班组"}},[e("j-dict-select-tag",{attrs:{placeholder:"请选择班组",dictCode:t.dictGroupStr},model:{value:t.willChangeQueryParam.groupId,callback:function(e){t.$set(t.willChangeQueryParam,"groupId",e)},expression:"willChangeQueryParam.groupId"}})],1)],1),e("a-col",{attrs:{md:3,sm:24}},[e("a-form-item",{attrs:{label:"工位"}},[e("j-dict-select-tag",{attrs:{placeholder:"请选择",dictCode:t.dictCodeStrWork},model:{value:t.willChangeQueryParam.workstationId,callback:function(e){t.$set(t.willChangeQueryParam,"workstationId",e)},expression:"willChangeQueryParam.workstationId"}})],1)],1),e("a-col",{attrs:{md:2,sm:8}},[e("a-form-item",[e("a-button",{on:{click:t.findList}},[t._v("查询")])],1)],1)],1)],1)],1),e("div",{staticStyle:{height:"calc(80vh - 80px)"}},[e("vxe-table",{ref:"listTable",staticStyle:{height:"calc(80vh - 130px)"},attrs:{border:"",align:t.allAlign,data:t.tableData,"highlight-current-row":"","show-overflow":"tooltip","radio-config":t.multiple?{}:{trigger:"row"},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{field:"code",title:"必换件编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"name",title:"必换件名称",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"spec",title:"必换件描述",align:"left","header-align":"center"}}),e("vxe-table-column",{attrs:{field:"groupName",title:"所属班组",width:"150"}}),e("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150"}}),e("vxe-table-column",{attrs:{field:"lineName",title:"线路",width:"150"}}),e("vxe-table-column",{attrs:{field:"repairProgramName",title:"修程",width:"150"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"200","edit-render":{name:"$input",immediate:!0,props:{type:"number",Min:0}}}}),e("vxe-table-column",{attrs:{field:"amount",title:"当前库存",width:"150"}})],1),e("vxe-pager",{attrs:{perfect:"","current-page":t.willChangeQueryParam.pageNo,"page-size":t.willChangeQueryParam.pageSize,total:t.totalResult,layouts:["PrevJump","PrevPage","Number","NextPage","NextJump","Sizes","FullJump","Total"]},on:{"update:currentPage":function(e){return t.$set(t.willChangeQueryParam,"pageNo",e)},"update:current-page":function(e){return t.$set(t.willChangeQueryParam,"pageNo",e)},"update:pageSize":function(e){return t.$set(t.willChangeQueryParam,"pageSize",e)},"update:page-size":function(e){return t.$set(t.willChangeQueryParam,"pageSize",e)},"page-change":t.handlePageChange}})],1)])},n=[],i=a("c54ca"),s=a("b098"),o=a("5633"),l={name:"MaterialList",components:{JTreeSelect:s["default"],LineSelectList:o["default"]},props:{repairProId:{default:""},lineId:{default:""},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1,required:!1},defaultCheckedKeys:{type:String,default:""}},watch:{repairProId:{handler:function(t){this.willChangeQueryParam.repairProgramId=t},immediate:!0},lineId:{handler:function(t){this.willChangeQueryParam.lineId=t},immediate:!0},defaultCheckedKeys:{immediate:!0,handler:function(t){this.queryParam.warehouseId=t}},"willChangeQueryParam.groupId":function(t,e){this.dictCodeStrWork=t?"bu_mtr_workstation,name,id,id in (select workstation_id from bu_group_workstation where group_id='".concat(t,"')"):"bu_mtr_workstation,name,id"}},data:function(){return{dictGroupStr:"bu_mtr_workshop_group,group_name,id,workshop_id='"+this.$store.getters.userInfo.workshopId+"'|workshop_id",dictCodeStrWork:"bu_mtr_workstation,name,id",queryParam:{type:"1",category1:"",searchText:"",attr:null,warehouseId:"",pageNo:1,pageSize:10},willChangeQueryParam:{searchText:"",lineId:"",repairProgramId:"",sysId:"",groupId:"",workstationId:"",pageNo:1,pageSize:10},allAlign:"center",totalResult:0,tableData:[],visible:!1,confirmLoading:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}},methods:{showModal:function(){this.visible=!0,this.findList()},findList:function(){var t=this;this.loading=!0;var e="";e=Object(i["Hb"])(this.willChangeQueryParam),e.then((function(e){t.totalResult=e.result.total,t.loading=!1,t.tableData=e.result.records,t.tableData.forEach((function(e){t.$set(e,"amount",e.needAmount)}))}))},handlePageChange:function(t){var e=t.currentPage,a=t.pageSize;this.willChangeQueryParam.pageNo=e,this.willChangeQueryParam.pageSize=a,this.findList()},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.visible=!1},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},c=l,u=(a("b209"),a("2877")),d=Object(u["a"])(c,r,n,!1,null,"5e23c825",null);e["default"]=d.exports},f1a0:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{style:{padding:"10px 0 32px 32px"}},[e("h4",[t._v(t._s(t.title))]),e("p",{style:{color:"#CCCCCC",marginBottom:"20px"}},[t._v(t._s(t.subTitle))]),e("v-chart",{attrs:{forceFit:!0,height:t.height,data:t.dataSource}},[e("v-coord",{attrs:{type:"rect",direction:"LB"}}),e("v-tooltip"),e("v-axis",{attrs:{dataKey:"item",label:t.label}}),e("v-bar",{attrs:{position:"item*count"}})],1)],1)},n=[],i={props:{title:{type:String,default:""},subTitle:{type:String,default:""},dataSource:{type:Array,required:!0},height:{type:Number,default:400}},data:function(){return{label:{offset:6,formatter:function(t){var e;return t.length<=5?(e=t,e):(e=t.slice(0,5)+"...",e)}}}}},s=i,o=a("2877"),l=Object(o["a"])(s,r,n,!1,null,null,null);e["default"]=l.exports},f1c7:function(t,e,a){},fe32:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("a-descriptions",[e("a-descriptions-item",{attrs:{label:"任务名称"}},[t._v(t._s(t.taskInfo.taskName))]),e("a-descriptions-item",{attrs:{label:"作业手段"}},[t._v(t._s(t.taskInfo.method_dictText))]),e("a-descriptions-item",{attrs:{label:"作业工时"}},[t._v(t._s(t.taskInfo.workTime))]),e("a-descriptions-item",{attrs:{label:"作业系统"}},[t._v(t._s(t.taskInfo.systemName))]),e("a-descriptions-item",{attrs:{label:"作业设备"}},[t._v(t._s(t.taskInfo.assetTypeName))]),e("a-descriptions-item",{attrs:{label:"开始日期"}},[t._v(t._s(t.taskInfo.startTime))]),e("a-descriptions-item",{attrs:{label:"结束日期"}},[t._v(t._s(t.taskInfo.finishTime))]),e("a-descriptions-item",{attrs:{label:"作业工班"}},[t._v(t._s(t.taskInfo.workGroupName))]),e("a-descriptions-item",{attrs:{label:"作业工位"}},[t._v(t._s(t.taskInfo.workStations))]),e("a-descriptions-item",{attrs:{label:"备注"}},[t._v(t._s(t.taskInfo.remark))])],1)},n=[],i={name:"ViewTaskBasicInfo",props:["taskInfo"]},s=i,o=a("2877"),l=Object(o["a"])(s,r,n,!1,null,"cb5a7436",null);e["default"]=l.exports},ffe2:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",[t.readOnly?t._e():e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:6,sm:8}},[e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")])],1)],1)],1)],1)],1),e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:t.taskMaterials,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{trigger:"cell",highlight:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}},on:{"update:data":function(e){t.taskMaterials=e}}},[e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),e("vxe-table-column",{attrs:{field:"code",title:"编码","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{focus:function(e){return t.openMaterialSelectModal(r)}},model:{value:r.code,callback:function(e){t.$set(r,"code",e)},expression:"row.code"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},on:{click:function(e){return t.openMaterialSelectModal(r)}},slot:"suffixIcon"})],1)]}}])}),e("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.name)+" ")]}}])}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type",hiddenArray:[-1],allowClear:!1},on:{select:t.onCategoryChange,blur:function(e){return t.$refs.listTable.clearValidate()}},model:{value:r.useCategory,callback:function(e){t.$set(r,"useCategory",e)},expression:"row.useCategory"}})]}}])}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:999999},model:{value:r.amount,callback:function(e){t.$set(r,"amount",e)},expression:"row.amount"}})]}}])}),e("vxe-table-column",{attrs:{field:"unit",title:"单位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.unit)+" ")]}}])}),e("vxe-table-column",{attrs:{field:"remark",title:"备注","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(a){var r=a.row;return[e("a-input",{attrs:{maxLength:201,placeholder:"请输入备注"},on:{change:function(e){return t.remarkChangeValue(r)}},model:{value:r.remark,callback:function(e){t.$set(r,"remark",e)},expression:"row.remark"}})]}}])}),t.readOnly?t._e():e("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.row;return[t.$refs.listTable.isActiveByRow(r)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(r)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(r)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(r)}}},[t._v("编辑")])]]}}],null,!1,1311980394)})],1),e("material-list",{ref:"modalForm",attrs:{typeCodeList:[2,3],multiple:!1},on:{ok:t.onSelectMaterial}}),e("material-list",{ref:"modalFormMultiple",attrs:{typeCodeList:[2,3],multiple:!0},on:{ok:t.onSelectMaterialMultiple}})],1)},n=[],i=a("7164"),s=a("ca00"),o={name:"TaskMaterials",components:{MaterialList:i["default"]},props:{taskMaterials:{type:Array,default:[]},readOnly:{type:Boolean,default:!1}},data:function(){return{curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择物料"}],useCategory_dictText:[{required:!0,message:"请选择类别"}],amount:[{required:!0,message:"数量必须填写"}],remark:[{max:200,type:"string",message:"备注不能超过200个字符"}]},isvalid:!1}},methods:{validAllEvent:function(){var t=this;return new Promise((function(e,a){t.$refs.listTable.validate(!0).then((function(t){e(!0)})).catch((function(a){e(!1),t.curEditMode=2}))}))},onCategoryChange:function(t,e){var a=this.$refs.listTable.getActiveRecord();a.row.useCategory_dictText=e?e.title:void 0,this.$forceUpdate()},remarkChangeValue:function(t){var e=t.remark;e.length>200&&this.$message.error("备注不能超过200个字符")},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<1?this.$message.warn("请选择要删除的数据"):this.$confirm({content:"确认删除选中的数据？",onOk:function(){e.map((function(e){t.taskMaterials.map((function(a,r){e.id===a.id&&t.taskMaterials.splice(r,1)}))}))}})},editRowEvent:function(t){this.curEditMode=2,this.$refs.listTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.taskMaterials.map((function(a,r){t.id===a.id&&e.taskMaterials.splice(r,1)}))},saveRowEvent:function(t){var e=this;this.$refs.listTable.validate(t,(function(a){if(a)for(var r in a){var n=a[r];n.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else 1===e.curEditMode&&e.taskMaterials.push(t),e.$refs.listTable.clearActived(),e.curEditMode=0}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},openMaterialSelectModal:function(t){this.curRow=t,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur()},onSelectMaterialMultiple:function(t){var e=this;if(t&&t.length>0){var a=this.taskMaterials;t.forEach((function(r,n){if(a.find((function(t){return t.materialTypeId===r.id})))e.$message.warn("你选择的".concat(r.name,"已经在列表中存在"));else{var i={id:Object(s["p"])(),code:r.code,materialTypeId:r.id,name:r.name,kind:r.kind,unit:r.unit,kind_dictText:r.kind_dictText,useCategory:-1==r.useCategory?"":r.useCategory,useCategory_dictText:-1==r.useCategory?"":r.useCategory_dictText,amount:r.num};1==t.length?e.$refs.listTable.insertAt(i,-1).then((function(t){var a=t.row;e.$refs.listTable.setActiveCell(a,"amount")})):(e.$refs.listTable.insertAt(i,-1),e.taskMaterials.push(i))}}))}},onSelectMaterial:function(t){if(t&&t.length>0){var e=t[0],a=0;if(this.taskMaterials.map((function(t){if(t.materialTypeId===e.id)return a=1,!1})),1===a)return void this.$message.error("你选择的物料已经在列表中存在，请选择其他物料");this.curRow.code=e.code,this.curRow.materialTypeId=e.id,this.curRow.name=e.name,this.curRow.kind=e.kind,this.curRow.unit=e.unit,this.curRow.kind_dictText=e.kind_dictText,this.curRow.useCategory=-1==e.useCategory?"":e.useCategory,this.curRow.useCategory_dictText=-1==e.useCategory?"":e.useCategory_dictText,this.curRow.amount=e.num}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory=-1==material.useCategory?"":material.useCategory,this.curRow.useCategory_dictText=-1==material.useCategory?"":material.useCategory_dictText,this.curRow.unit="",this.curRow.amount=0}}},l=o,c=a("2877"),u=Object(c["a"])(l,r,n,!1,null,null,null);e["default"]=u.exports}}]);