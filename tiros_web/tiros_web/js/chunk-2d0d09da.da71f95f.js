(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d09da"],{6978:function(e,a,r){"use strict";r.r(a);var t=function(){var e=this,a=e._self._c;return a("a-modal",{attrs:{title:e.title,width:"32%",visible:e.visible,confirmLoading:e.confirmLoading,bodyStyle:{minHeight:"50px"},destroyOnClose:!0,cancelText:"关闭"},on:{ok:e.handleOk,cancel:e.handleCancel}},[a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"选择年份"}},[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["sbYear",e.validatorRules.sbYear],expression:"['sbYear', validatorRules.sbYear]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{mode:"year",placeholder:"请选择年份",format:"YYYY",open:e.yearPickShow},on:{panelChange:e.handlePanelChange,openChange:e.handleOpenChange}})],1)],1)],1),a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物资类型选择"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["materialTypeName",e.validatorRules.materialTypeName],expression:"['materialTypeName', validatorRules.materialTypeName]",modifiers:{trim:!0}}],ref:"mySelect",attrs:{allowClear:"",placeholder:"请选择",open:!1,showArrow:!0},on:{focus:e.openModal}},[a("a-icon",{attrs:{slot:"suffix",type:"ellipsis"},slot:"suffix"})],1)],1)],1)],1),a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"物料类别"}},[a("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["sbType",e.validatorRules.sbType],expression:"['sbType', validatorRules.sbType]",modifiers:{trim:!0}}],attrs:{triggerChange:"",placeholder:"请选择",dictCode:"bu_material_type"}})],1)],1)],1),a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"线路"}},[a("line-select-list",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["lineId",e.validatorRules.lineId],expression:"['lineId', validatorRules.lineId]",modifiers:{trim:!0}}]})],1)],1)],1),a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"修程"}},[a("j-dict-select-tag",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["repairProgramId",e.validatorRules.repairProgramId],expression:"['repairProgramId', validatorRules.repairProgramId]",modifiers:{trim:!0}}],attrs:{triggerChange:"",placeholder:"请选择",dictCode:"bu_repair_program,name,id"},on:{change:e.sumRepairPlanYearDetailAmount}})],1)],1)],1),a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所需数量"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["sbAmount",e.validatorRules.sbAmount],expression:"['sbAmount', validatorRules.sbAmount]",modifiers:{trim:!0}}],staticStyle:{width:"100%"},attrs:{min:1,placeholder:"请输入所需数量"}}),e._v(" 所需数量= 单列所需量 * 年度维修车辆数 ")],1)],1)],1)],1)],1),a("material-list",{ref:"MaterialModalForm",attrs:{multiple:!1},on:{ok:e.addTarget}})],1)},i=[],l=r("c1df"),s=r.n(l),o=(r("5c3a"),r("5633")),n=r("c54ca"),m=r("7164"),d={name:"MaterialPlanItemModal.vue",components:{LineSelectList:o["default"],MaterialList:m["default"]},data:function(){return{title:"操作",visible:!1,yearPickShow:!1,model:{},labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:14}},confirmLoading:!1,form:this.$form.createForm(this),rowNum:0,trainTotal:0,validatorRules:{sbYear:{rules:[{required:!0,message:"请选择年份!"}]},materialTypeName:{rules:[{required:!0,message:"请选择物资类型!"}]},sbAmount:{rules:[{required:!0,message:"请输入所需数量!"}]},sbType:{rules:[{required:!0,message:"请选择物料类别!"}]},lineId:{rules:[{required:!0,message:"请选择线路!"}]},repairProgramId:{rules:[{required:!0,message:"请选择修程!"}]}}}},watch:{rowNum:function(e){e&&this.trainTotal&&this.form.setFieldsValue({sbAmount:e*this.trainTotal})},trainTotal:function(e){e&&this.rowNum&&this.form.setFieldsValue({sbAmount:e*this.rowNum})}},created:function(){},methods:{handleOpenChange:function(e){this.yearPickShow=e},handlePanelChange:function(e){this.form.setFieldsValue({sbYear:s()(e).format("YYYY")}),this.sumRepairPlanYearDetailAmount(),this.yearPickShow=!1},openModal:function(){this.$refs.MaterialModalForm.showModal(),this.$refs.mySelect.blur()},addTarget:function(e){e&&1===e.length&&null!=e[0]&&(this.form.setFieldsValue({materialTypeName:e[0].name}),this.rowNum=e[0].num,this.materialTypeId=e[0].id)},sumRepairPlanYearDetailAmount:function(e){var a=this;e&&(this.form.setFieldsValue({repairProgramId:e}),this.$forceUpdate()),this.form.getFieldsValue().sbYear&&this.form.getFieldsValue().repairProgramId&&Object(n["nc"])({year:this.form.getFieldsValue().sbYear,programId:this.form.getFieldsValue().repairProgramId}).then((function(e){e.success&&(a.trainTotal=e.result)}))},add:function(){this.edit({})},edit:function(e){var a=this;this.form.resetFields(),this.visible=!0,this.model=Object.assign({},e),e.id?this.$nextTick((function(){a.form.setFieldsValue({sbYear:a.model.sbYear.toString(),materialTypeName:a.model.name,sbAmount:a.model.sbAmount})})):this.$nextTick((function(){a.form.setFieldsValue({sbYear:s()(new Date).format("YYYY")})}))},handleOk:function(){var e=this,a=this;a.form.validateFields((function(r,t){if(!r){a.confirmLoading=!0;var i,l=Object.assign(a.model,t,{sbYear:s()(t.sbYear).format("YYYY")});l.materialTypeId=e.materialTypeId,i=a.model.id?Object(n["H"])(l):Object(n["d"])(l),i.then((function(e){e.success?(a.$message.success(e.message),a.$emit("ok"),a.close()):a.$message.warning(e.message)})).finally((function(){a.confirmLoading=!1}))}}))},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},u=d,c=r("2877"),p=Object(c["a"])(u,t,i,!1,null,null,null);a["default"]=p.exports}}]);