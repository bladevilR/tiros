(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6ab2ad72"],{"43f7":function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return i})),r.d(t,"v",(function(){return s})),r.d(t,"e",(function(){return a})),r.d(t,"q",(function(){return l})),r.d(t,"m",(function(){return u})),r.d(t,"d",(function(){return p})),r.d(t,"t",(function(){return y})),r.d(t,"r",(function(){return c})),r.d(t,"p",(function(){return d})),r.d(t,"u",(function(){return f})),r.d(t,"o",(function(){return g})),r.d(t,"b",(function(){return m})),r.d(t,"n",(function(){return C})),r.d(t,"s",(function(){return h})),r.d(t,"f",(function(){return v})),r.d(t,"h",(function(){return b})),r.d(t,"g",(function(){return I})),r.d(t,"l",(function(){return x})),r.d(t,"j",(function(){return k})),r.d(t,"i",(function(){return w})),r.d(t,"k",(function(){return D}));var n=r("0fea"),a=function(e){return Object(n["d"])("/report/excel/get",{tempCode:e})},o=function(e){return Object(n["d"])("/report/daily/get",e)},i=function(e){return Object(n["d"])("/report/daily/generate",e)},s=function(e){return Object(n["j"])("/report/daily/save",e)},l=function(e){return Object(n["d"])("/report/fault/count/trains",e)},u=function(e){return Object(n["d"])("/report/fault/count/systems",e)},d=function(e){return Object(n["d"])("/report/fault/detail/list",e)},c=function(e){return Object(n["d"])("/report/cost/detail/statistic-consume",e)},h=function(e){return Object(n["d"])("/report/cost/detail/statistic-must-random",e)},f=function(e){return Object(n["d"])("/report/turnover/detail/page",e)},g=function(e){return Object(n["d"])("/report/cost/kpi/page",e)},m=function(e,t){return Object(n["c"])("/report/cost/kpi/export",e,t)},p=function(e){return Object(n["d"])("/report/fault/train-count/sys",e)},y=function(e){return Object(n["d"])("/report/cost/train/statistic",e)},C=function(e){return Object(n["d"])("/report/cost/train/get-cars-number",e)},v=function(e){return Object(n["d"])("/produce/plan/summary/cost",e)},b=function(e){return Object(n["d"])("/produce/plan/summary/fault",e)},I=function(e){return Object(n["d"])("/produce/plan/summary/total",e)},x=function(e){return Object(n["d"])("/produce/plan/summary/work-time",e)},k=function(e){return Object(n["d"])("/produce/plan/summary/period",e)},w=function(e){return Object(n["d"])("/produce/plan/summary/outsource",e)},D=function(e){return Object(n["d"])("/produce/plan/summary/progress",e)}},e24e:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r("e8ae"),a=r.n(n),o=r("21a6"),i=r.n(o),s=(r("7268"),"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"),l=function(e,t){var r=new a.a.Workbook;"[object Object]"===Object.prototype.toString.call(e)&&(e=[e]),e.forEach((function(e){if(0===e.data.length)return!0;var t=r.addWorksheet(e.name),n=e.config&&e.config.merge||{},a=e.config&&e.config.borderInfo||{},o=e.config&&e.config.columnlen||{},i=e.images||{};return c(i,r,t),d(o,t),u(e.config,t),g(e.data,t),h(n,t),f(a,t),!0}));var n=r.xlsx.writeBuffer().then((function(e){var r=new Blob([e],{type:s});i.a.saveAs(r,"".concat(t,".xlsx"))}));return n},u=function(e,t){if(e&&e.rowlen)for(var r in e.rowlen){var n=parseInt(r),a=parseInt(e.rowlen[r]),o=t.getRow(n+1);o.height=a}},d=function(e,t){for(var r in e){var n=parseInt(r),a=parseInt(e[r]);t.getColumn(n+1).width=parseInt(a/7)}},c=function(e,t,r){for(var n in e){var a=e[n],o=a.src.split(";base64,"),i=o[0].replaceAll("data:image/",""),s=t.addImage({base64:a.src,extension:i}),l=luckysheet.location(a.default.left,a.default.top);r.addImage(s,{tl:{col:l.col,row:l.row},ext:{width:a.default.width,height:a.default.height}})}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=Object.values(e);r.forEach((function(e){t.mergeCells(e.r+1,e.c+1,e.r+e.rs,e.c+e.cs)}))},f=function(e,t){Array.isArray(e)&&e.forEach((function(e){if("range"===e.rangeType)for(var r=C(e.borderType,e.style,e.color),n=e.range[0],a=n.row,o=n.column,i=a[0]+1;i<a[1]+2;i++)for(var s=o[0]+1;s<o[1]+2;s++)t.getCell(i,s).border=r;if("cell"===e.rangeType){var l=e.value,u=l.col_index,d=l.row_index,c=Object.assign({},e.value);delete c.col_index,delete c.row_index;var h=v(c,d,u);t.getCell(d+1,u+1).border=h}}))},g=function(e,t){Array.isArray(e)&&e.forEach((function(e,r){e.every((function(e,n){if(!e)return!0;var a=m(e.bg),o=p(e.ff,e.fc,e.bl,e.it,e.fs,e.cl,e.ul),i=y(e.vt,e.ht,e.tb,e.tr),s="";e.f?s={formula:e.f,result:e.v}:!e.v&&e.ct&&e.ct.s?e.ct.s.forEach((function(e){s+=e.v})):s=e.v;var l=b(n),u=t.getCell(l+(r+1));for(var d in a){u.fill=a;break}return u.font=o,u.alignment=i,u.value=s,!0}))}))},m=function(e){if(!e)return{};var t={type:"pattern",pattern:"solid",fgColor:{argb:e.replace("#","")}};return t},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s={0:"微软雅黑",1:"宋体（Song）",2:"黑体（ST Heiti）",3:"楷体（ST Kaiti）",4:"仿宋（ST FangSong）",5:"新宋体（ST Song）",6:"华文新魏",7:"华文行楷",8:"华文隶书",9:"Arial",10:"Times New Roman ",11:"Tahoma ",12:"Verdana",num2bl:function(e){return 0!==e}},l={name:"number"===typeof e?s[e]:e,family:1,size:a,color:{argb:t.replace("#","")},bold:s.num2bl(r),italic:s.num2bl(n),underline:s.num2bl(i),strike:s.num2bl(o)};return l},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",a={vertical:{0:"middle",1:"top",2:"bottom",default:"top"},horizontal:{0:"center",1:"left",2:"right",default:"left"},wrapText:{0:!1,1:!1,2:!0,default:!1},textRotation:{0:0,1:45,2:-45,3:"vertical",4:90,5:-90,default:0}},o={vertical:a.vertical[e],horizontal:a.horizontal[t],wrapText:a.wrapText[r],textRotation:a.textRotation[n]};return o},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#000";if(!e)return{};var n={type:{"border-all":"all","border-top":"top","border-right":"right","border-bottom":"bottom","border-left":"left"},style:{0:"none",1:"thin",2:"hair",3:"dotted",4:"dashDot",5:"dashDot",6:"dashDotDot",7:"double",8:"medium",9:"mediumDashed",10:"mediumDashDot",11:"mediumDashDotDot",12:"slantDashDot",13:"thick"}},a={style:n.style[t],color:{argb:r.replace("#","")}},o={};return"all"===n.type[e]?(o["top"]=a,o["right"]=a,o["bottom"]=a,o["left"]=a):o[n.type[e]]=a,o};function v(e,t,r){var n={},a={type:{l:"left",r:"right",b:"bottom",t:"top"},style:{0:"none",1:"thin",2:"hair",3:"dotted",4:"dashDot",5:"dashDot",6:"dashDotDot",7:"double",8:"medium",9:"mediumDashed",10:"mediumDashDot",11:"mediumDashDotDot",12:"slantDashDot",13:"thick"}};for(var o in e)-1===e[o].color.indexOf("rgb")?n[a.type[o]]={style:a.style[e[o].style],color:{argb:e[o].color.replace("#","")}}:n[a.type[o]]={style:a.style[e[o].style],color:{argb:e[o].color}};return n}function b(e){var t="A".charCodeAt(0),r="Z".charCodeAt(0),n=r-t+1,a="";while(e>=0)a=String.fromCharCode(e%n+t)+a,e=Math.floor(e/n)-1;return a}},fe3b:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bodyWrapper",staticStyle:{padding:"8px"}},[t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.loadData.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"日期"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",allowClear:!1},model:{value:e.queryParam.day,callback:function(t){e.$set(e.queryParam,"day",t)},expression:"queryParam.day"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"线路"}},[t("line-select-list",{on:{change:e.onLineChange},model:{value:e.queryParam.lineId,callback:function(t){e.$set(e.queryParam,"lineId",t)},expression:"queryParam.lineId"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-form-item",{attrs:{label:"车辆"}},[t("j-dict-select-seach-tag",{attrs:{dictCode:e.dictTrainStr},on:{focus:e.handleSysFocus},model:{value:e.queryParam.trainNo,callback:function(t){e.$set(e.queryParam,"trainNo",t)},expression:"queryParam.trainNo"}})],1)],1),t("a-col",{attrs:{md:4,sm:24}},[t("a-space",[t("a-button",{attrs:{loading:e.loading},on:{click:e.loadData}},[e._v("查询")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.createDailyReport}},[e._v("重新生成")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.saveDayReport}},[e._v("保存日报")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.downloadExcel}},[e._v("导出")])],1)],1)],1)],1)],1),e._m(0)])},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-page-body"},[t("div",{staticStyle:{height:"calc(100% - 0px)",width:"100%"},attrs:{id:"luckysheet"}})])}],o=r("43f7"),i=(r("2410"),r("e24e")),s=r("5633"),l={name:"report_day",components:{LineSelectList:s["default"]},data:function(){var e=this;return{loading:!1,queryParam:{day:this.$moment(new Date).format("YYYY-MM-DD"),trainNo:"",depotId:this.$store.getters.userInfo.depotId,lineId:"",workshopId:this.$store.getters.userInfo.workshopId},dictTrainStr:"",dailyInfo:null,defaultOptions:{container:"luckysheet",title:"sheet",column:26,row:50,lang:"zh",allowEdit:!0,showinfobar:!1,showsheetbar:!1,showstatisticBar:!0,enableAddRow:!1,enableAddCol:!1,showtoolbar:!0,hook:{workbookCreateAfter:function(t){e.dailyInfo&&!e.dailyInfo.reportContent&&(e.loadHeaderInfo(e.dailyInfo),e.loadCurDayTask(e.dailyInfo.workPlanList),e.loadNexDayTask(e.dailyInfo.nextWorkList),e.loadOutInfo(e.dailyInfo.outinList),e.loadDailyFault(e.dailyInfo.faultList))}}}}},watch:{"queryParam.lineId":{handler:function(e){this.onLineChange(e)},deep:!0}},created:function(){this.$set(this.queryParam,"lineId",this.$store.getters.userInfo.lineId)},beforeDestroy:function(){luckysheet.destroy()},methods:{handleSysFocus:function(){this.queryParam.lineId||this.$message.warn("请先选择线路!")},onLineChange:function(e,t){this.dictTrainStr="bu_train_info,train_no,train_no,status=1 and line_id='"+e+"'"},check:function(){return this.queryParam.day?this.queryParam.trainNo?!!this.queryParam.workshopId||(this.$message.warn("当前人员没有车间"),!1):(this.$message.warn("请选择日报所属车辆"),!1):(this.$message.warn("请选择日报日期"),!1)},createDailyReport:function(){var e=this;this.check()&&(this.loading=!0,Object(o["a"])(this.queryParam).then((function(t){if(t.success){var r=t.result;e.inti_dayReport(r)}else e.$message.error("生成日报错误：",t.message)})))},loadData:function(){var e=this;this.check()&&(this.dailyInfo=null,this.loading=!0,Object(o["c"])(this.queryParam).then((function(t){if(t.success){var r=t.result;e.inti_dayReport(r)}else e.loading=!1,e.$message.error("查询日报错误：",t.message),e.dailyInfo=null})))},inti_dayReport:function(e){var t=this;if(this.dailyInfo=e,null!=this.dailyInfo.reportContent&&void 0!=this.dailyInfo.reportContent&&""!=this.dailyInfo.reportContent){var r=JSON.parse(this.dailyInfo.reportContent);this.init_sheet(r)}else Object(o["e"])("day_report").then((function(e){if(e.success)if(e.result&&e.result.tempContent){var r=JSON.parse(e.result.tempContent);t.init_sheet(r)}else t.$message.error("报表模板内容为空，请定义模板");else t.$message.error("报表模板查询失败：",e.message),t.dailyInfo=null}))},init_sheet:function(e){var t=Object.assign({},this.defaultOptions);t.data=[e],luckysheet.destroy(),luckysheet.create(t),this.loading=!1,luckysheet.setRangeShow("A1",{show:!1})},saveDayReport:function(){var e=this;if(this.dailyInfo){var t=Object.assign({},this.dailyInfo);t.userName||(t.userName=this.$store.getters.userInfo.realname),t.reportContent=JSON.stringify(luckysheet.getAllSheets()[0]),Object(o["v"])(t).then((function(t){t.success?e.$message.success("保存成功"):e.$message.error("保存失败")}))}else this.$message.warn("当前没有要保存的日报信息")},getCharIndex:function(e){var t=0;if(e.length<2&&(t=e.charCodeAt()-65),2===e.length){var r=e[0],n=e[1],a=r.charCodeAt()-65;a=25*(a+1),t=a+n.charCodeAt()-64}return t},loadHeaderInfo:function(e){this.setCellValue(0,this.getCharIndex("A"),e.title);var t=3;this.setCellValue(t,this.getCharIndex("C"),e.period),this.setCellValue(t,this.getCharIndex("F"),"日期："+e.reportDate),this.setCellValue(t,this.getCharIndex("G"),"作业天数："+e.dayIndex),this.setCellValue(t,this.getCharIndex("K"),e.trainNo),this.setCellValue(t,this.getCharIndex("O"),e.mileage+"km"),this.setCellValue(t,this.getCharIndex("U"),e.workshop),this.setCellValue(t,this.getCharIndex("AA"),e.userName),this.setCellValue(32,this.getCharIndex("B"),e.toolFault),this.setCellValue(32,this.getCharIndex("R"),e.assetFault)},loadCurDayTask:function(e){if(e)for(var t=5,r=9,n=e.length,a=0;a<r;a++){var o={actContent:"",finished:!1,finished_dictText:"",group:"",id:"",peoples:0,planContent:"",remark:"",reportId:"",workTime:0};a<n&&(o=e[a]),this.setCellValue(t,this.getCharIndex("C"),o.groupName),this.setCellValue(t,this.getCharIndex("F"),o.planContent||"无"),this.setCellValue(t,this.getCharIndex("I"),o.actContent||"无"),this.setCellValue(t,this.getCharIndex("P"),o.finished_dictText),this.setCellValue(t,this.getCharIndex("T"),o.peoples>0?o.peoples+"人/"+o.workTime+"小时":""),this.setCellValue(t,this.getCharIndex("X"),o.remark||"-"),t+=1}},setCellValue:function(e,t,r){luckysheet.setCellValue(e,t,r,{success:function(){}})},loadNexDayTask:function(e){for(var t=15,r=9,n=e.length,a=0;a<r;a++){var o={group:"",id:"",remark:"",reportId:"",tempWork:"",trackContent:"",workContent:""};a<n&&(o=e[a]),this.setCellValue(t,this.getCharIndex("C"),o.groupName),this.setCellValue(t,this.getCharIndex("F"),o.workContent),this.setCellValue(t,this.getCharIndex("M"),o.trackContent+"\n"+o.tempWork),this.setCellValue(t,this.getCharIndex("X"),o.remark),t+=1}},loadOutInfo:function(e){for(var t=25,r=8,n=e.length,a=0;a<r;a++){var o={assetTypeId:"",assetTypeName:"",id:"",receiveDesc:"",reportId:"",sendDesc:""};a<n&&(o=e[a]),4==a&&(t=25),a<4?(this.setCellValue(t,this.getCharIndex("C"),o.assetTypeName),this.setCellValue(t,this.getCharIndex("F"),o.sendDesc),this.setCellValue(t,this.getCharIndex("K"),o.receiveDesc)):(this.setCellValue(t,this.getCharIndex("P"),o.assetTypeName),this.setCellValue(t,this.getCharIndex("U"),o.sendDesc),this.setCellValue(t,this.getCharIndex("Z"),o.receiveDesc)),t+=1}},loadDailyFault:function(e){for(var t=30,r=4,n=e.length-1,a=0;a<r;a++){var o={dutyEngineer:"",faultDesc:"",faultTime:"",handleDesc:"",id:"",isHandle:0,remark:"",reportId:"",reportUser:""};a<=n&&(o=e[a]),this.setCellValue(t,this.getCharIndex("B"),a+1),this.setCellValue(t,this.getCharIndex("C"),o.faultTime),this.setCellValue(t,this.getCharIndex("E"),o.reportUser),this.setCellValue(t,this.getCharIndex("G"),o.faultDesc),o.reportUser?this.setCellValue(t,this.getCharIndex("P"),0==o.isHandle?"否":"是"):this.setCellValue(t,this.getCharIndex("P"),""),this.setCellValue(t,this.getCharIndex("R"),o.dutyEngineer),this.setCellValue(t,this.getCharIndex("T"),o.handleDesc),this.setCellValue(t,this.getCharIndex("Z"),o.remark),t+=1}},downloadExcel:function(){Object(i["a"])(luckysheet.getAllSheets(),this.queryParam.day+"  "+this.queryParam.trainNo+" 生产日报")},setSelectValue:function(){var e=luckysheet.getRange();if(e&&e.length>0){e[0].row[0],e[0].column[0];luckysheet.setCellValue(5,5,"插入",{success:function(){}})}}}},u=l,d=r("2877"),c=Object(d["a"])(u,n,a,!1,null,"4d06ae24",null);t["default"]=c.exports}}]);