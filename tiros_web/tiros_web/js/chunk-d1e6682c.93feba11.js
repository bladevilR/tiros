(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d1e6682c","chunk-4ac1c6e2","chunk-ccd9324a","chunk-5c4c88d1","chunk-2d0ba8aa","chunk-2d22d5d2"],{"0da1":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"test-class",style:"height: calc(100% - ".concat(t.getButtonShow()?"47px":"4px",");")},[2!==t.operator&&3!==t.operator?e("div",{attrs:{"na-flex-height-full":""}},[t.getButtonShow()?e("a-form",{attrs:{layout:"inline"}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:8}},[e("a-form-item",{attrs:{label:"物料:"}},[e("a-input",{attrs:{placeholder:"物资编码或名称",allowClear:""},on:{change:t.sortTable},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),e("a-form-item",{attrs:{label:"物料分类:"}},[e("j-dict-select-tag",{staticStyle:{width:"160px"},attrs:{dictCode:"bu_material_type",triggerChange:"",hiddenArray:[1]},on:{change:t.sortTable},model:{value:t.searchCategory,callback:function(e){t.searchCategory=e},expression:"searchCategory"}})],1),e("a-form-item",[e("a-space",[e("a-button",{staticClass:"primary-color",attrs:{type:"dashed"},on:{click:t.handleAdd}},[t._v("添加")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleDel}},[t._v("删除")]),t._e()],1)],1)],1)],1)],1):t._e(),e("div",{attrs:{"na-flex-height-full":""}},[4!==t.operator?e("vxe-table",{ref:"listTable",staticClass:"mytable-style",attrs:{border:"",align:"center","max-height":"auto","row-class-name":t.rowClassName,data:t.taskMaterials,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"filter-config":{showIcon:!1}},on:{"update:data":function(e){t.taskMaterials=e},blur:function(e){t.$refs.listTable&&t.$refs.listTable.clearValidate()}}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",fixed:"left",width:"40"}}),t.tasks&&t.tasks.length>1&&4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("a-select",{staticStyle:{width:"100%"},on:{change:t.taskSelectChange,blur:function(e){t.$refs.listTable&&t.$refs.listTable.clearValidate()}},model:{value:a.orderTaskId,callback:function(e){t.$set(a,"orderTaskId",e)},expression:"row.orderTaskId"}},t._l(t.tasks,(function(r,a){return e("a-select-option",{key:a,attrs:{value:r.id}},[t._v(" "+t._s(r.taskName)+" ")])})),1)]}}],null,!1,4191658598)}):t._e(),e("vxe-table-column",{attrs:{field:"code",title:"物料编码","edit-render":{name:"input"},filters:[{data:""}],"filter-method":t.customStringFilterMethod,width:"130"},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("a-select",{ref:"formSelect",staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料",open:!1},on:{focus:function(e){return t.openMaterialSelectModal(a)}},model:{value:a.code,callback:function(e){t.$set(a,"code",e)},expression:"row.code"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,2681050691)}),e("vxe-table-column",{attrs:{field:"name",title:"物料名称","edit-render":{name:"input"},align:"left","header-align":"center",width:"200"},scopedSlots:t._u([{key:"edit",fn:function(e){var r=e.row;return[t._v(" "+t._s(r.name)+" ")]}}],null,!1,1805491503)}),e("vxe-table-column",{attrs:{field:"spec",title:"规格",align:"left","header-align":"center"}}),4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"systemName",title:"所属系统",width:"150","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:t.systemDictCode,allowClear:!1},on:{blur:function(e){return t.$refs.listTable.clearValidate()},select:t.onSystemChange},model:{value:a.systemId,callback:function(e){t.$set(a,"systemId",e)},expression:"row.systemId"}})]}}],null,!1,694104271)}):t._e(),4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工位",open:!1},on:{dropdownVisibleChange:function(e){return t.openStationSelectModal()}},model:{value:a.workstationName,callback:function(e){t.$set(a,"workstationName",e)},expression:"row.workstationName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,1073727607)}):t._e(),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别","edit-render":{name:"input"},width:"100"},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("j-dict-select-tag",{staticStyle:{width:"100%"},attrs:{dictCode:"bu_material_type",hiddenArray:[-1],allowClear:!1},on:{blur:function(e){return t.$refs.listTable.clearValidate()},select:t.onCategoryChange},model:{value:a.useCategory,callback:function(e){t.$set(a,"useCategory",e)},expression:"row.useCategory"}})]}}],null,!1,2054472936)}),t._e(),t._e(),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量","edit-render":{name:"input"},width:"120",align:"right","header-align":"center"},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{defaultValue:1,min:0,max:999999},model:{value:a.amount,callback:function(e){t.$set(a,"amount",e)},expression:"row.amount"}})]}}],null,!1,4050415892)}),4===t.orderType&&-1===t.operator?e("vxe-table-column",{attrs:{field:"issueAmount",title:"发放数量",width:"120",align:"right","header-align":"center"}}):t._e(),4===t.orderType||5===t.orderType||-1!==t.operator&&5!==t.operator&&6!==t.operator?t._e():e("vxe-table-column",{attrs:{field:"actAmount",title:"实际消耗",width:"120",align:"right","header-align":"center"}}),1===t.operator&&t.showStock?e("vxe-table-column",{attrs:{field:"stock",title:"当前库存",width:"120",align:"right","header-align":"center"}}):t._e(),e("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"80"},scopedSlots:t._u([{key:"edit",fn:function(e){var r=e.row;return[t._v(" "+t._s(r.unit)+" ")]}}],null,!1,1773474126)}),4===t.orderType||5===t.orderType||-1!==t.operator&&5!==t.operator&&6!==t.operator?t._e():e("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",width:"120",align:"right","header-align":"center"}}),0===t.operator||1===t.operator||4!==t.orderType&&5!==t.orderType&&1!==t.orderType?t._e():e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380"}}),1===t.operator&&4!==t.orderType&&5!==t.orderType?e("vxe-table-column",{attrs:{field:"canReplace",title:"可替换物资",width:"150"},scopedSlots:t._u([{key:"default",fn:function(r){var a=r.row;return[e("a-tooltip",{attrs:{placement:"top"}},[e("template",{slot:"title"},[e("span",[t._v(t._s(a.canReplaceSpec))])]),e("span",[t._v(t._s(a.canReplace))])],2)]}}],null,!1,3190429626)}):t._e(),t.getButtonShow()?e("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(r){var a=r.row;return[t.$refs.listTable.isActiveByRow(a)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(a)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(a)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(a)}}},[t._v("编辑")])]]}}],null,!1,1311980394)}):t._e()],1):e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center","max-height":"auto",data:t.taskMaterials,"edit-rules":t.validRules,"keep-source":!0,"checkbox-config":{highlight:!0,range:!0},"edit-config":{key:"id",trigger:"manual",mode:"row",autoClear:!1,showStatus:!0},"filter-config":{showIcon:!1}},on:{"update:data":function(e){t.taskMaterials=e},blur:function(e){t.$refs.listTable&&t.$refs.listTable.clearValidate()}}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",fixed:"left",width:"40"}}),t.tasks&&t.tasks.length>1&&4!==t.orderType?e("vxe-table-column",{attrs:{field:"taskName",title:"工单任务",align:"left"}}):t._e(),e("vxe-table-column",{attrs:{field:"code",title:"物料编码",filters:[{data:""}],"filter-method":t.customStringFilterMethod,width:"130"}}),e("vxe-table-column",{attrs:{field:"name",title:"物料名称",align:"left","header-align":"center",width:"200"}}),4!==t.orderType?e("vxe-table-column",{attrs:{field:"opType_dictText",title:"领用类型",width:"100"}}):t._e(),4!==t.orderType?e("vxe-table-column",{attrs:{field:"systemName",title:"所属系统",width:"150"}}):t._e(),4!==t.orderType?e("vxe-table-column",{attrs:{field:"workstationName",title:"所属工位",width:"150"}}):t._e(),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"120",align:"right","header-align":"center"}}),0!==t.operator&&1!==t.operator?e("vxe-table-column",{attrs:{width:"120",field:"actAmount",title:"实际消耗","edit-render":{name:"$input",props:{type:"number",min:0}},align:"right","header-align":"center"}}):t._e(),e("vxe-table-column",{attrs:{field:"unit",title:"单位",width:"80"}}),0!==t.operator&&1!==t.operator?e("vxe-table-column",{attrs:{field:"remark",title:"消耗备注",width:"120"}}):t._e(),e("vxe-table-column",{attrs:{field:"spec",title:"规格",align:"left","header-align":"center"}}),0===t.operator||1===t.operator||4!==t.orderType&&1!==t.orderType?t._e():e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380"}}),t.getButtonShow()||4===t.operator?e("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(r){var a=r.row;return[t.$refs.listTable.isActiveByRow(a)?[e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(a)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(a)}}},[t._v("取消")])],1)]:[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(a)}}},[t._v("编辑")])]]}}],null,!1,1311980394)}):t._e()],1)],1)],1):t._e(),2===t.operator?e("div",[t.workOrderId?e("apply-ready-component",{ref:"applyReady",attrs:{"business-key":t.workOrderId,fromFlow:!0,"order-type":t.orderType},on:{ok:t.saveOk,fail:t.saveFail,cancel:t.onCancel,loaded:t.onLoaded}}):t._e()],1):t._e(),3===t.operator?e("div",[t.workOrderId?e("apply-confirm-component",{ref:"applyConfirm",attrs:{"business-key":t.workOrderId,fromFlow:!0,"order-type":t.orderType},on:{ok:t.saveOk,fail:t.saveFail,cancel:t.onCancel,loaded:t.onLoaded}}):t._e()],1):t._e(),e("material-list",{ref:"modalForm",attrs:{repairProgramId:t.repairProgramId,lineId:t.lineId,multiple:!1,mode:t.selectMode,"group-id":t.groupId,"type-code-list":t.mTypeCode,"show-type-code":t.filterType},on:{ok:t.onSelectMaterial}}),e("material-list",{ref:"modalFormMultiple",attrs:{repairProgramId:t.repairProgramId,lineId:t.lineId,multiple:!0,mode:t.selectMode,"group-id":t.groupId,"type-code-list":t.mTypeCode,"show-type-code":t.filterType},on:{ok:t.onSelectMaterialMultiple}}),e("task-select-modal",{ref:"taskSelectModal",on:{ok:t.onSelectTask}}),e("work-station-list",{ref:"stationSelectModal",attrs:{"group-id":t.groupId},on:{ok:t.onSelectStation}})],1)},i=[],o=r("7164"),n=r("383b"),s=r("ff09"),l=r("f6d0"),c=r("ca00"),u=r("b47d"),d=r("8fad"),f=r("1158");function m(t){return g(t)||b(t)||p(t)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){if(t){if("string"==typeof t)return y(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}function b(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function g(t){if(Array.isArray(t))return y(t)}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=Array(e);r<e;r++)a[r]=t[r];return a}var v={name:"TaskMaterials",components:{TaskSelectModal:n["default"],MaterialList:o["default"],ApplyReadyComponent:s["default"],ApplyConfirmComponent:l["default"],WorkStationList:f["default"]},props:{taskMaterials:{type:Array,default:function(){return[]}},tasks:{type:Array,default:function(){return[]}},readOnly:{type:Boolean,default:!1},selectTask:{type:Object,default:null},operator:{type:Number,default:0},workOrderId:{type:String,default:null},orderType:{type:Number,default:null},lineId:{type:[Number,String],default:null},planId:{type:[Number,String],default:null},repairId:{type:[Number,String],default:null},groupId:{type:[Number,String],default:null}},watch:{orderType:{handler:function(){0!==this.operator&&1!==this.operator||(4===this.orderType||5===this.orderType?(this.selectMode=[1,2],this.mTypeCode=[2,3,-1],this.filterType=!0):(this.selectMode=[1,2],1===this.operator&&(this.selectMode=[3].concat(m(this.selectMode))),this.mTypeCode=[2,3,-1],this.filterType=!0))},immediate:!0},repairId:{immediate:!0,handler:function(t){this.repairProgramId=t}},planId:{immediate:!0,handler:function(t){var e=this;this.selectMode.indexOf(2)>-1&&t&&!this.repairId&&Object(u["rb"])(t).then((function(t){t.success&&t.result&&(e.repairProgramId=t.result.repairProgramId)}))}}},data:function(){return{systemDictCode:"",repairProgramId:"",showStock:!1,curEditMode:0,curRow:null,validRules:{code:[{required:!0,message:"请选择物料",trigger:"manual"}],opType:[{required:!1}],opType_dictText:[{required:!1}],useCategory_dictText:[{required:!0,message:"类别必须选择",trigger:"manual"}],needDispatchin_dictText:[{required:!0,message:"是否发料必须选择",trigger:"manual"}],amount:[{required:!0,message:"数量必须填写",trigger:"manual"}],systemName:[{required:!0,message:"所属系统必须选择",trigger:"manual"}],workstationName:[{required:!0,message:"所属工位必须选择",trigger:"manual"}]},tableHeight:{top:"height:100%",bottom:"height: calc(100vh - 160px)",size:"auto"},searchText:"",searchCategory:null,selectMode:[1,2,3],mTypeCode:[-1],filterType:!1,trainTypeId:""}},mounted:function(){var t=this;2!==this.operator&&3!==this.operator&&(this.$nextTick((function(){t.sortTable()})),this.$emit("loaded")),this.lineId&&Object(d["vb"])({lineId:this.lineId}).then((function(e){e.success?(t.trainTypeId=e.result.trainTypeId,t.systemDictCode="bu_train_asset_type,name,id,train_type_id='"+t.trainTypeId+"' AND struct_type=1"):t.systemDictCode=""}))},methods:{onLoaded:function(t){this.$emit("loaded")},onCategoryChange:function(t,e){var r=this.$refs.listTable.getActiveRecord();r.row.useCategory_dictText=e?e.title:void 0,this.$forceUpdate()},onSystemChange:function(t,e){var r=this.$refs.listTable.getActiveRecord();r.row.systemId=t,r.row.systemName=e?e.title:void 0,this.$forceUpdate()},onDispatchChange:function(t,e){var r=this.$refs.listTable.getActiveRecord();r.row.needDispatchin_dictText=e?e.title:void 0,this.$forceUpdate()},save:function(t){2!==this.operator?3===this.operator?this.$refs.applyConfirm&&this.$refs.applyConfirm.save?this.$refs.applyConfirm.save(t):this.$emit("fail",new Error("数据尚未加载完成，请稍后操作！")):this.$emit("fail",new Error("无效的操作类型，请联系关联员！")):this.$refs.applyReady&&this.$refs.applyReady.save?this.$refs.applyReady.save(t):this.$emit("fail",new Error("数据尚未加载完成，请稍后操作！"))},saveOk:function(){this.$emit("ok")},saveFail:function(t){this.$emit("fail",t)},onCancel:function(){this.$emit("cancel")},getButtonShow:function(){return!this.readOnly&&(0===this.operator||1===this.operator||2===this.operator)},handleAdd:function(){this.$refs.listTable.getActiveRecord()||(this.curEditMode=1,this.$refs.modalFormMultiple.showModal())},handleDel:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.find((function(t){return 1===t.isGenOrder}))?this.$message.warn("已生成单据的临时新增类型数据不能删除"):e.length>0?this.$confirm({content:"是否删除选中".concat(e.length,"条数据？"),okText:"确定",cancelText:"取消",onOk:function(){e.map((function(e){t.taskMaterials.map((function(r,a){e.id===r.id&&t.taskMaterials.splice(a,1)}))}))}}):this.$message.error("尚未选中任何数据!")},editRowEvent:function(t){this.curEditMode=2,this.curRow=t,this.$refs.listTable.setActiveRow(t)},delRowEvent:function(t){var e=this;this.taskMaterials.map((function(r,a){t.id===r.id&&e.taskMaterials.splice(a,1)}))},openStationSelectModal:function(){this.$refs.stationSelectModal.showModal()},onSelectStation:function(t){var e=this.$refs.listTable.getActiveRecord();t.length&&e&&(e.row.workstationId=t[0].id,e.row.workstationName=t[0].name),this.$forceUpdate()},saveRowEvent:function(t){var e=this;this.$refs.listTable.validate(t,(function(r){if(r)for(var a in r){var i=r[a];i.forEach((function(t){t.rule&&e.$message.error(t.rule.message)}))}else{if(t.actAmount>t.amount)return void e.$message.error("实际消耗不能大于所需数量");1===e.curEditMode&&e.taskMaterials.push(t),e.$refs.listTable.clearActived(),e.curEditMode=0}}))},cancelRowEvent:function(t){this.$refs.listTable.clearActived(),1===this.curEditMode?this.$refs.listTable.remove(t):2===this.curEditMode&&this.$refs.listTable.revertData(t),this.curEditMode=0},openMaterialSelectModal:function(t){this.curRow=t,this.$refs.modalForm.showModal(),this.$refs.formSelect.blur(),this.$refs.listTable.clearValidate()},onSelectMaterial:function(t){var e=this;if(t&&t.length>0){var r=t[0];t.forEach((function(a,i){if(e.taskMaterials.find((function(t){return t.materialTypeId===a.id})))e.$message.warn("你选择的".concat(a.name,"已经在列表中存在"));else if(i>0){var o={id:Object(c["p"])(),orderTaskId:e.curRow.orderTaskId,taskName:e.curRow.taskName,opType:2,opType_dictText:"临时新增",needDispatchin:4===e.orderType||5===e.orderType?1:0,needDispatchin_dictText:4===e.orderType||5===e.orderType?"是":"否",code:a.code,materialTypeId:a.id,name:a.name,kind:a.kind,unit:a.unit,kind_dictText:a.kind_dictText,useCategory:a.category1?a.category1:null,useCategory_dictText:a.category1?a.category1_dictText:"",amount:a.num,actAmount:0};e.taskMaterials.push(o)}else e.curRow.code=r.code,e.curRow.name=r.name,e.curRow.materialTypeId=r.id,e.curRow.kind=r.kind,e.curRow.unit=r.unit,e.curRow.kind_dictText=r.kind_dictText,e.curRow.useCategory=r.category1?r.category1:null,e.curRow.useCategory_dictText=r.category1?r.category1_dictText:"",e.curRow.amount=r.num,e.curRow.actAmount=0,t.length>1&&(e.$refs.listTable.clearActived(),1===e.curEditMode&&e.taskMaterials.push(e.curRow),e.curEditMode=0)}))}else this.curRow.code="",this.curRow.materialTypeId="",this.curRow.name="",this.curRow.kind="",this.curRow.kind_dictText="",this.curRow.useCategory="",this.curRow.useCategory_dictText="",this.curRow.unit="",this.curRow.amount=0,this.curRow.actAmount=0,this.curRow.needDispatchin=1,this.needDispatchin_dictText="是"},onSelectMaterialMultiple:function(t){var e=this;if(t&&t.length>0){var r=this.taskMaterials;t.forEach((function(t,a){var i={id:Object(c["p"])(),opType:1,opType_dictText:"额定物资",needDispatchin:4===e.orderType||5===e.orderType?1:0,needDispatchin_dictText:4===e.orderType||5===e.orderType?"是":"否",code:t.code,materialTypeId:t.id,name:t.name,kind:t.kind,unit:t.unit,kind_dictText:t.kind_dictText,useCategory:t.category1?t.category1:null,useCategory_dictText:t.category1?t.category1_dictText:"",amount:t.num,actAmount:0,isGenOrder:0,spec:t.spec};if(r.find((function(e){return e.materialTypeId===t.id}))){if(4===e.orderType||5===e.orderType)return void e.$message.warn("你选择的".concat(t.name,"已经在列表中存在"));e.$confirm({title:"确认添加",content:"你选择的".concat(t.name,"已经在列表中存在，是否重复添加？"),onOk:function(){e.insertNewMaterial(i)}})}else e.insertNewMaterial(i)}))}},insertNewMaterial:function(t){this.selectTask?Object.assign(t,{orderTaskId:this.selectTask.id,taskName:this.selectTask.taskName}):this.tasks.length&&Object.assign(t,{orderTaskId:this.tasks[0].id,taskName:this.tasks[0].taskName}),this.$refs.listTable.insertAt(t,-1),this.taskMaterials.push(t)},openTaskSelectModal:function(t){this.curRow=t,this.$refs.taskSelectModal.showModal(this.tasks),this.$refs.taskSelect.blur()},onSelectTask:function(t){if(t&&t.length>0){var e=t[0];this.curRow.orderTaskId=e.id,this.curRow.taskName=e.taskName}else this.curRow.orderTaskId="",this.curRow.taskName=""},taskSelectChange:function(t,e){this.$refs.listTable.getActiveRecord().row.taskName=this.tasks[e.key].taskName},clearValidate:function(){var t=this;this.$nextTick((function(){t.$refs.listTable&&t.$refs.listTable.clearValidate()}))},checkMaterialShow:function(t){t.row;return""},sortTable:function(){if(this.$refs.listTable){var t=this.$refs.listTable.getColumnByField("code"),e=t.filters[0];e.checked=!0,this.$refs.listTable.updateData()}},customStringFilterMethod:function(t){var e=t.row,r=new RegExp(this.searchText),a=new RegExp(this.searchText);return 0!==this.operator&&1!==this.operator?(r.test(e.code)||a.test(e.name))&&(e.useCategory==this.searchCategory||!this.searchCategory)&&(1===e.opType||2===e.opType&&1===e.isGenOrder):(r.test(e.code)||a.test(e.name))&&(e.useCategory==this.searchCategory||!this.searchCategory)&&(1===e.opType||2===e.opType)},refreshTable:function(){this.showStock=!0,this.$refs.listTable.updateData()},rowClassName:function(t){var e=t.row;t.rowIndex;if(e.noenough&&1===e.noenough)return"row-red"}}},w=v,k=(r("74e8"),r("2877")),T=Object(k["a"])(w,a,i,!1,null,null,null);e["default"]=T.exports},"383b":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{width:"70%",title:"任务选择",centered:"",visible:t.visible,bodyStyle:{height:"70vh"},cancelText:"关闭",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("vxe-table",{ref:"listTable",attrs:{border:"",align:"center",data:t.tasks,"max-height":"100%","show-overflow":"ellipsis","radio-config":t.multiple?{}:{trigger:"row"},"checkbox-config":t.multiple?{trigger:"row",highlight:!0,range:!0}:{},"edit-config":{trigger:"click",mode:"cell",showIcon:"true"}}},[t.multiple?e("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}):e("vxe-table-column",{attrs:{type:"radio",width:"40"}}),e("vxe-table-column",{attrs:{type:"seq",title:"任务编号",width:"100"}}),e("vxe-table-column",{attrs:{field:"taskName",title:"任务名称",align:"left"}}),e("vxe-table-column",{attrs:{field:"workTime",title:"预计工时",align:"right",width:"100"}}),e("vxe-table-column",{attrs:{field:"taskContent",title:"任务要求",align:"left"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",align:"left",width:"200"}})],1)],1)},i=[],o={name:"TaskSelectModal",props:{multiple:{type:Boolean,default:!1}},data:function(){return{visible:!1,tasks:[]}},methods:{showModal:function(t){this.tasks=t,this.visible=!0},handleOk:function(){var t=[];this.multiple?t=this.$refs.listTable.getCheckboxRecords():this.$refs.listTable.getRadioRecord()&&t.push(this.$refs.listTable.getRadioRecord()),this.$emit("ok",t),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1}}},n=o,s=r("2877"),l=Object(s["a"])(n,a,i,!1,null,"161bbc55",null);e["default"]=l.exports},"51c5":function(t,e,r){"use strict";r("e9d9")},"74e8":function(t,e,r){"use strict";r("b2bb")},"9ced":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;return e("div",["project"==t.type||"task"==t.type?e("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"","show-search":"",placeholder:"project"==t.type?"请选择财务项目":"task"==t.type&&"请选择财务任务","option-filter-prop":"children","filter-option":t.filterOption},on:{focus:t.handleFocus,change:t.handleChange},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.selectList,(function(r,a){return e("a-select-option",{key:a,attrs:{value:r.id}},[t._v(" "+t._s(r.name)+" - "+t._s(r.code)+" ")])})),1):e("span",{staticStyle:{color:"red"}},[t._v(" 参数 “type” 不能为空 参数详阅组件 src/components/finance/index.vue ")])],1)},i=[],o=r("d214"),n={name:"finance",model:{prop:"value",event:"change"},props:["value","type","id"],data:function(){return{modelValue:void 0,selectList:[]}},watch:{value:{handler:function(t){this.modelValue=t},immediate:!0},id:{handler:function(t){this.getSelectList()},immediate:!0}},created:function(){this.getSelectList()},methods:{filterOption:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0},handleFocus:function(){"task"!=this.type||this.id||this.$message.warning("请先选择财务项目！")},handleChange:function(t){this.$emit("change",t)},getSelectList:function(){var t=this;this.selectList=[];var e="project"==this.type?o["M"]:"task"==this.type&&o["N"];if(e){if("task"==this.type&&!this.id)return;e("task"==this.type&&{projectId:this.id}).then((function(e){e.success&&e.result.length&&(t.selectList=e.result)}))}}}},s=n,l=r("2877"),c=Object(l["a"])(s,a,i,!1,null,"10418fd5",null);e["default"]=c.exports},b2bb:function(t,e,r){},d214:function(t,e,r){"use strict";r.d(e,"h",(function(){return i})),r.d(e,"D",(function(){return o})),r.d(e,"eb",(function(){return n})),r.d(e,"r",(function(){return s})),r.d(e,"b",(function(){return l})),r.d(e,"w",(function(){return c})),r.d(e,"H",(function(){return u})),r.d(e,"I",(function(){return p})),r.d(e,"k",(function(){return d})),r.d(e,"c",(function(){return b})),r.d(e,"x",(function(){return g})),r.d(e,"l",(function(){return v})),r.d(e,"K",(function(){return y})),r.d(e,"a",(function(){return w})),r.d(e,"v",(function(){return k})),r.d(e,"j",(function(){return x})),r.d(e,"F",(function(){return T})),r.d(e,"J",(function(){return f})),r.d(e,"G",(function(){return m})),r.d(e,"t",(function(){return h})),r.d(e,"Q",(function(){return $})),r.d(e,"u",(function(){return O})),r.d(e,"db",(function(){return _})),r.d(e,"q",(function(){return C})),r.d(e,"bb",(function(){return N})),r.d(e,"cb",(function(){return I})),r.d(e,"C",(function(){return j})),r.d(e,"g",(function(){return S})),r.d(e,"P",(function(){return M})),r.d(e,"X",(function(){return A})),r.d(e,"ab",(function(){return E})),r.d(e,"f",(function(){return P})),r.d(e,"p",(function(){return L})),r.d(e,"jb",(function(){return R})),r.d(e,"kb",(function(){return D})),r.d(e,"Z",(function(){return q})),r.d(e,"e",(function(){return B})),r.d(e,"A",(function(){return V})),r.d(e,"n",(function(){return z})),r.d(e,"m",(function(){return W})),r.d(e,"O",(function(){return J})),r.d(e,"Y",(function(){return Y})),r.d(e,"V",(function(){return Q})),r.d(e,"gb",(function(){return X})),r.d(e,"hb",(function(){return Z})),r.d(e,"L",(function(){return tt})),r.d(e,"ib",(function(){return et})),r.d(e,"B",(function(){return F})),r.d(e,"y",(function(){return K})),r.d(e,"d",(function(){return U})),r.d(e,"z",(function(){return H})),r.d(e,"W",(function(){return rt})),r.d(e,"o",(function(){return G})),r.d(e,"fb",(function(){return at})),r.d(e,"i",(function(){return it})),r.d(e,"E",(function(){return ot})),r.d(e,"s",(function(){return nt})),r.d(e,"M",(function(){return st})),r.d(e,"N",(function(){return lt})),r.d(e,"S",(function(){return ct})),r.d(e,"T",(function(){return ut})),r.d(e,"U",(function(){return dt})),r.d(e,"R",(function(){return ft}));var a=r("0fea"),i=function(t){return Object(a["j"])("/outsource/supplier/add",t)},o=function(t){return Object(a["j"])("/outsource/supplier/edit",t)},n=function(t){return Object(a["d"])("/outsource/supplier/page",t)},s=function(t){return Object(a["j"])("/outsource/supplier/delete",t)},l=function(t){return Object(a["j"])("/outsource/contractInfo/add",t)},c=function(t){return Object(a["j"])("/outsource/contractInfo/edit",t)},u=function(t){return Object(a["d"])("/outsource/contractInfo/page",t)},d=function(t){return Object(a["j"])("/outsource/contractInfo/delete",t)},f=function(t){return Object(a["d"])("/outsource/contractInfo/monitor",t)},m=function(t){return Object(a["d"])("/outsource/contract/annex/list",t)},h=function(t){return Object(a["j"])("/outsource/contract/annex/delete",t)},p=function(t){return Object(a["d"])("/outsource/contractInfo/price",t)},b=function(t){return Object(a["j"])("/outsource/contractPay/add",t)},g=function(t){return Object(a["j"])("/outsource/contractPay/edit",t)},y=function(t){return Object(a["d"])("/outsource/contractPay/page",t)},v=function(t){return Object(a["j"])("/outsource/contractPay/delete",t)},w=function(t){return Object(a["j"])("/outsource/contractBakMoney/add",t)},k=function(t){return Object(a["j"])("/outsource/contractBakMoney/edit",t)},T=function(t){return Object(a["d"])("/outsource/contractBakMoney/page",t)},x=function(t){return Object(a["j"])("/outsource/contractBakMoney/delete",t)},$=function(t){return Object(a["d"])("/outsource/outin/page",t)},O=function(t){return Object(a["j"])("/outsource/outin/delete",t)},M=function(t){return Object(a["d"])("/outsource/outin/page/detail",t)},S=function(t){return Object(a["j"])("/outsource/supervise/add",t)},j=function(t){return Object(a["j"])("/outsource/supervise/edit",t)},_=function(t){return Object(a["d"])("/outsource/supervise/page",t)},C=function(t){return Object(a["j"])("/outsource/supervise/delete",t)},N=function(t){return Object(a["d"])("/outsource/supervise/get",{id:t})},I=function(t){return Object(a["d"])("/outsource/supervise/get-by-order",t)},D=function(t){return Object(a["d"])("/outsource/perform/vendor/tree",t)},R=function(t){return Object(a["j"])("/outsource/perform/delayReason",t)},A=function(t){return Object(a["d"])("/outsource/perform/page",t)},L=function(t){return Object(a["j"])("/outsource/perform/delete/resource",t)},E=function(t){return Object(a["d"])("/outsource/perform/resource",t)},P=function(t){return Object(a["j"])("/outsource/perform/resource/add",t)},F=function(t){return Object(a["j"])("/outsource/perform/resource/edit",t)},q=function(t){return Object(a["d"])("/outsource/rateing/page",t)},B=function(t){return Object(a["j"])("/outsource/rateing/add",t)},V=function(t){return Object(a["j"])("/outsource/rateing/edit",t)},z=function(t){return Object(a["j"])("/outsource/rateing/delete",t)},G=function(t){return Object(a["j"])("/outsource/rateing/delete/attachment",t)},W=function(t){return Object(a["j"])("/outsource/otherSource/delete",t)},K=function(t){return Object(a["j"])("/outsource/otherSource/edit",t)},U=function(t){return Object(a["j"])("/outsource/otherSource/add",t)},J=function(t){return Object(a["d"])("/outsource/otherSource/page",t)},Y=function(t){return Object(a["d"])("/outsource/quality/page",t)},H=function(t){return Object(a["j"])("/outsource/quality/edit",t)},Q=function(t){return Object(a["d"])("/outsource/part/page",t)},X=function(t){return Object(a["d"])("/outsource/fault/countFault",t)},Z=function(t){return Object(a["d"])("/outsource/fault/countFaultGroupBySystem",t)},tt=function(t){return Object(a["d"])("/outsource/fault/page",t)},et=function(t){return Object(a["j"])("/outsource/fault/countFaultGroupByPhaseAndSystem",t)},rt=function(t){return Object(a["d"])("/outsource/contractPay/page",t)},at=function(t){return Object(a["d"])("/training/record/page",t)},it=function(t){return Object(a["j"])("/training/record/add",t)},ot=function(t){return Object(a["j"])("/training/record/edit",t)},nt=function(t){return Object(a["j"])("/training/record/delete",t)},st=function(t){return Object(a["d"])("/base/finance/project/list",t)},lt=function(t){return Object(a["d"])("/base/finance/task/list",t)},ct=function(t){return Object(a["d"])("/outsource/cost/listCost",t)},ut=function(t){return Object(a["d"])("/outsource/cost/detail",t)},dt=function(t){return Object(a["d"])("/outsource/cost/part",t)},ft=function(t){return Object(a["d"])("/outsource/cost/asset",t)}},d567:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"workOrderItemContent","na-flex-height-full":""}},[e("a-tabs",{attrs:{"default-active-key":"1","na-flex-height-full":""},on:{change:t.onTabChange,tabClick:t.onTabClick},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[t.fromFlow?t._e():e("a-space",{attrs:{slot:"tabBarExtraContent","na-flex-height-full":"","na-fd-irow":""},slot:"tabBarExtraContent"},[e("a-button",{staticClass:"iconBtn",attrs:{loading:t.loading,type:"primary"},on:{click:function(e){return t.saveAndStart(!1)}}},[t._v("保存")]),e("a-button",{staticClass:"iconBtn",attrs:{loading:t.loading,title:"保存并下发"},on:{click:function(e){return t.saveAndStart(!0)}}},[t._v("保存并下发")])],1),e("a-tab-pane",{key:"1",attrs:{tab:"基本信息"}},[e("a-form-model",{ref:"form",attrs:{model:t.formModel,rules:t.formRules,"label-col":t.deLayout.labelCol,"wrapper-col":t.deLayout.wrapperCol}},[e("a-row",[e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"工单名称",prop:"orderName"}},[e("a-input",{model:{value:t.formModel.orderName,callback:function(e){t.$set(t.formModel,"orderName",e)},expression:"formModel.orderName"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"工单编号"}},[e("a-input",{attrs:{disabled:"",value:t.formModel.orderCode,placeholder:"自动生成无需填写"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"工单类型"}},[e("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_order_type",disabled:!0},model:{value:t.formModel.orderType,callback:function(e){t.$set(t.formModel,"orderType",e)},expression:"formModel.orderType"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"所属车间",prop:"workshopId"}},[e("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_workshop,name,id"},model:{value:t.formModel.workshopId,callback:function(e){t.$set(t.formModel,"workshopId",e)},expression:"formModel.workshopId"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"所属线路",prop:"lineId"}},[e("j-dict-select-tag",{attrs:{triggerChange:!0,dictCode:"bu_mtr_line,line_name,line_id"},model:{value:t.formModel.lineId,callback:function(e){t.$set(t.formModel,"lineId",e)},expression:"formModel.lineId"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"开始日期",prop:"startTime"}},[e("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},on:{change:t.changeStartDate},model:{value:t.formModel.startTime,callback:function(e){t.$set(t.formModel,"startTime",e)},expression:"formModel.startTime"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"结束日期",prop:"finishTime"}},[e("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","disabled-date":t.disabledEndDate},model:{value:t.formModel.finishTime,callback:function(e){t.$set(t.formModel,"finishTime",e)},expression:"formModel.finishTime"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"财务项目"}},[e("FinanceSelect",{attrs:{type:"project"},on:{change:t.financeSelectChange},model:{value:t.formModel.fdProject,callback:function(e){t.$set(t.formModel,"fdProject",e)},expression:"formModel.fdProject"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"财务任务"}},[e("FinanceSelect",{attrs:{type:"task"},model:{value:t.formModel.fdTask,callback:function(e){t.$set(t.formModel,"fdTask",e)},expression:"formModel.fdTask"}})],1)],1),e("a-col",{attrs:{span:24}},[e("a-form-model-item",{attrs:{label:"备注",prop:"remark",labelCol:{sm:{span:2},xs:{span:24}},wrapperCol:{sm:{span:22},xs:{span:24}}}},[e("a-textarea",{attrs:{"auto-size":{minRows:3}},model:{value:t.formModel.remark,callback:function(e){t.$set(t.formModel,"remark",e)},expression:"formModel.remark"}})],1)],1)],1)],1)],1),e("a-tab-pane",{key:"4",attrs:{tab:"作业物料","na-flex-height-full":""}},[e("TaskMaterials",{ref:"material",attrs:{"work-order-id":t.formModel.id,"task-materials":t.formModel.materials,tasks:t.formModel.tasks,lineId:t.formModel.lineId,"select-task":t.selectTask,operator:t.operator,"order-type":t.numOrderType},on:{"update:taskMaterials":function(e){return t.$set(t.formModel,"materials",e)},"update:task-materials":function(e){return t.$set(t.formModel,"materials",e)},ok:t.materialSaveOk,fail:t.materialSaveFail,cancel:t.onCancel,loaded:t.onLoaded}})],1)],1)],1)},i=[],o=r("9ced"),n=r("0da1"),s=r("b47d"),l={name:"EditOrderComponent",components:{TaskMaterials:n["default"],FinanceSelect:o["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!1},fromFlow:{type:Boolean,default:!1},attributes:{type:Object,default:function(){return{}}},oType:{type:Number,default:5},fromType:{type:[Number,String],default:4}},computed:{numOrderType:function(){return parseInt(this.formModel.orderType)}},data:function(){return{activeTab:"1",operator:0,loading:!1,formModel:{id:"",planId:"",lineId:"1",trainNo:"",orderCode:"",orderName:"",orderType:"5",workshopId:"",groupId:"",startTime:"",finishTime:"",fdProject:"",fdTask:"",remark:"",tasks:[],materials:[],monitor:"",orderStatus:0,fromType:4},formRules:{orderName:[{required:!0,message:"工单名称必须填写!",trigger:"blur"}],workshopId:[{required:!0,message:"车间必须选择!",trigger:"blur"}],lineId:[{required:!0,message:"线路必须选择!",trigger:"blur"}],startTime:[{required:!0,message:"开始日期必须选择!",trigger:"change"}],finishTime:[{required:!0,message:"结束日期必须选择!",trigger:"change"}]},selectTask:null,flwOpts:{vars:{}}}},mounted:function(){this.businessKey?this.edit(this.businessKey):this.edit(null),this.operator=0,this.readOnly=!1,this.attributes&&(this.attributes.isMaterial&&1===this.attributes.isMaterial&&(this.operator=2),this.attributes.isConfirm&&1===this.attributes.isConfirm&&(this.operator=3)),2!==this.operator&&3!==this.operator||(this.activeTab="4")},methods:{onTabChange:function(t){var e=this;this.activeTab="1",this.$refs.form.validate((function(r){if(!r)return e.$message.warning("请先填写完基本信息"),!1;e.activeTab=t}))},onTabClick:function(t){},changeStartDate:function(t){var e=this;t&&this.$nextTick((function(){e.formModel.finishTime=t}))},disabledEndDate:function(t){var e=this.formModel.startTime;return!(!e||!t)&&t<e},financeSelectChange:function(t){this.financeSelectId=t,this.formModel.fdTask=void 0},materialSaveOk:function(){this.$emit("ok",this.flwOpts)},materialSaveFail:function(t){var e=t&&t.message?":"+t.message:"";this.flwOpts.res={message:e},this.$emit("fail",this.flwOpts)},edit:function(t){var e=this;this.activeTab="1",this.selectTask=null,t?Object(s["yb"])(t).then((function(t){if(t.success){var r=t.result;e.formModel.orderType=r.orderType+"",e.formModel.fromType=r.fromType,e.$nextTick((function(){Object.assign(e.formModel,r)}))}else e.$message.warning(t.message);2!==e.operator&&3!==e.operator&&e.$emit("loaded")})):(this.formModel.workshopId=this.$store.getters.userInfo.workshopId,2!==this.operator&&3!==this.operator&&this.$emit("loaded"))},saveAndStart:function(t){var e=this;0===this.operator&&this.$refs.form.validate((function(r){if(r){var a=Object.assign({},e.formModel);if(a=Object.assign(a,{startFlow:t,fromType:e.fromType}),!e.checkWorkOrderInfo(a))return;e.saveWorkOrderInfo(a)}else e.$emit("fail"),e.$message.warning("请填写完整基本信息")}))},checkWorkOrderInfo:function(t){return!(0===this.operator&&"5"===t.orderType&&(!t.materials||t.materials.length<1))||(this.flwOpts.res={message:"车间消耗工单的物料不能为空"},this.$emit("fail",this.flwOpts),this.activeTab="4",!1)},saveWorkOrderInfo:function(t){var e=this;t.materials.forEach((function(t){2===t.opType&&(t.planAmount=t.amount)})),this.loading=!0,t.id?Object(s["M"])(t).then((function(t){e.flwOpts.res=t,e.loading=!1,t.success?e.handleOk():e.$emit("fail",e.flwOpts)})).catch((function(t){e.loading=!1,e.flwOpts.res={message:"保存异常"},e.$emit("fail")})):Object(s["k"])(t).then((function(t){e.flwOpts.res=t,t.success?e.handleOk():(e.loading=!1,e.$emit("fail",e.flwOpts))})).catch((function(t){e.loading=!1,e.flwOpts.res={message:"保存异常"},e.$emit("fail")}))},save:function(t){var e=this;if(this.formModel&&5===this.formModel.orderStatus)return this.flwOpts.res={message:"该工单已暂停，请先激活在进行操作！"},void this.$emit("fail",this.flwOpts);var r=t.onlySave;if(Object.assign(this.flwOpts,t),0!==this.operator)if(2===this.operator||3===this.operator){if(this.$refs.material&&this.$refs.material.save)return void this.$refs.material.save(r);this.flwOpts.res={message:"数据尚未加载完成，请稍后操作！"},this.$emit("fail",this.flwOpts)}else this.flwOpts.res={message:"无效的操作类型，请联系关联员！"},this.$emit("fail",this.flwOpts);else this.$refs.form.validate((function(t){if(t){var r=Object.assign({},e.formModel);if(!e.checkWorkOrderInfo(r))return;e.saveWorkOrderInfo(r)}else e.$emit("fail"),e.$message.warning("请填写完整基本信息")}))},onLoaded:function(t){this.$emit("loaded")},handleOk:function(){this.$emit("ok",this.flwOpts),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close")},onCancel:function(){this.loading=!1,this.$emit("cancel")}}},c=l,u=r("2877"),d=Object(u["a"])(c,a,i,!1,null,"5e4377e8",null);e["default"]=d.exports},e9d9:function(t,e,r){},f6d0:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;return e("div",[t.fromFlow?t._e():e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:12,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden","margin-bottom":"8px"}},[e("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:t.save}},[t._v("确认领用")]),e("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.close}},[t._v("关闭")])],1)])],1),e("div",{staticStyle:{height:"calc(70vh - 45px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,range:!0}}},[e("vxe-table-column",{attrs:{type:"seq",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),e("vxe-table-column",{attrs:{field:"status_dictText",title:"确认状态",width:"100"}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}})],1)],1),e("ApplyDistributionModal",{ref:"distributionModal",attrs:{dataList:t.distributionTableList},on:{ok:t.onSuccess}})],1)},i=[],o=r("c54ca"),n=r("2eb4"),s=r("8973");function l(t){return f(t)||d(t)||u(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"==typeof t)return m(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function d(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function f(t){if(Array.isArray(t))return m(t)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=Array(e);r<e;r++)a[r]=t[r];return a}var h={name:"ApplyConfirmComponent",components:{ApplyDistributionModal:n["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!0},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:null}},data:function(){return{tableData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{orderId:"",status:[1]}}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:{edit:function(t){this.queryParam.orderId=t,this.findList()},findList:function(){var t=this;this.tableData=[],Object(o["bb"])(this.queryParam).then((function(e){e.success?(t.tableData=[].concat(l(t.tableData),l(e.result)),s["a"].joinDistributionInfo(t.tableData)):t.$message.error("加载数据失败"),t.$emit("loaded")}))},save:function(t){var e=this;if(this.tableData&&this.tableData.length>0){var r=this.tableData.map((function(t,e){return t.id}));if(0===r.length)return this.$message.warn("没有要确认领料的物资，无法继续！"),void this.$emit("fail",{message:"没有要确认领料的物资，无法继续！"});var a={fromType:2,ids:r.join(",")};Object(o["j"])(a).then((function(t){t.success?e.$emit("ok"):e.$emit("fail",t)})).catch((function(t){e.$message.error("保存异常"),e.$emit("fail",{message:"保存异常！"})}))}else this.$emit("ok")},close:function(){this.$emit("close")},openDistribution:function(t){this.$refs.distributionModal.showModal(t)},onSuccess:function(){var t=this;this.tableData.forEach((function(e){e.receive=0,t.distributionTableList.forEach((function(t){t.applyDetailId===e.id&&(e.receive+=Number(t.amount))}))}))}}},p=h,b=r("2877"),g=Object(b["a"])(p,a,i,!1,null,"1c988508",null);e["default"]=g.exports},ff09:function(t,e,r){"use strict";r.r(e);var a,i=function(){var t=this,e=t._self._c;return e("div",[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:24,sm:24}},[e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"right",overflow:"hidden","margin-bottom":"8px"}},[e("a-space",[t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.autoArrange}},[t._v("自动安排库位")]),t.isDistribution?t._e():e("a-button",{staticClass:"iconBtn",attrs:{loading:t.confirmLoading,disabled:t.records.length<1},on:{click:t.arrangePan}},[t._v("批量设置托盘")])],1)],1)])],1),t.isDistribution?t._e():e("div",{staticStyle:{height:"calc(70vh - 45px)"}},[e("vxe-table",{ref:"listTable",attrs:{border:"","max-height":"100%",align:t.allAlign,data:t.tableData,"show-overflow":"tooltip","edit-config":{trigger:"click",mode:"row"},"checkbox-config":{highlight:!0,trigger:"row",range:!0}},on:{"checkbox-change":t.checkboxChange,"checkbox-all":t.checkboxChange}},[e("vxe-table-column",{attrs:{type:"seq",fixed:"left",width:"40"}}),e("vxe-table-column",{attrs:{type:"checkbox",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",title:"物资编码",width:"150"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"物资名称","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格型号","min-width":"180",align:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeUnit",title:"单位",width:"100"}}),e("vxe-table-column",{attrs:{field:"useCategory_dictText",title:"类别",width:"100"}}),e("vxe-table-column",{attrs:{field:"amount",title:"申请数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"100"}}),e("vxe-table-column",{attrs:{field:"sourceLocationAndPalletName",title:"发放信息",width:"380","sort-type":"string",sortable:""}}),e("vxe-table-column",{attrs:{field:"remark",title:"备注",width:"150","header-align":"center",align:"left"}}),e("vxe-table-column",{attrs:{title:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(r){var a=r.row;return[e("a",{on:{click:function(e){return e.stopPropagation(),t.openDistribution(a)}}},[t._v("发放管理")])]}}],null,!1,768125003)})],1)],1),t.isDistribution?e("div",{staticClass:"panel-main",staticStyle:{height:"calc(70vh - 45px)"}},[e("div",{staticClass:"panel-left"},[e("vxe-table",{ref:"materialTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableData,"radio-config":{highlight:!0,trigger:"row",range:!0,checkMethod:function(){return 0===t.curEditMode}}},on:{"radio-change":t.onRadioChange,"cell-click":t.onMaterialCellClick}},[e("vxe-table-column",{attrs:{type:"radio",width:"40",fixed:"left"}}),e("vxe-table-column",{attrs:{field:"materialTypeCode",width:"160",title:"物资编码"}}),e("vxe-table-column",{attrs:{field:"materialTypeName",title:"名称"}}),e("vxe-table-column",{attrs:{field:"materialTypeSpec",title:"规格"}}),e("vxe-table-column",{attrs:{field:"amount",title:"所需数量",width:"80"}}),e("vxe-table-column",{attrs:{field:"receive",title:"发料数量",width:"80"}})],1)],1),e("div",{staticClass:"panel-right"},[e("div",{staticClass:"ant-alert ant-alert-info",staticStyle:{"margin-bottom":"16px"}},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:t.addDetail}},[t._v("添加发放库位")]),e("a-button",{on:{click:t.closeDistribution}},[t._v("关闭")]),e("span",{staticStyle:{color:"red","margin-left":"15px"}},[t._v(t._s("总量: ".concat(t.selectInfo?t.selectInfo.amount:0,";")))]),e("span",{staticStyle:{color:"red","margin-left":"5px"}},[t._v(t._s("差额：".concat(t.calcAmount)))])],1)],1),e("div",{staticStyle:{height:"calc(100% - 62px)"}},[e("vxe-table",{ref:"distributionTable",attrs:{border:"",height:"auto","keep-source":"",data:t.tableDistributionData,"edit-rules":t.validRules,"edit-config":{trigger:"manual",mode:"row",autoClear:!1,showStatus:!0}}},[e("vxe-table-column",{attrs:{field:"sourceLocationName",title:"来源库位","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("a-select",{ref:"locationSelect",staticStyle:{width:"100%"},attrs:{placeholder:"选择库位",open:!1},on:{dropdownVisibleChange:function(e){return t.openlocationModal(a)}},model:{value:a.sourceLocationName,callback:function(e){t.$set(a,"sourceLocationName",e)},expression:"row.sourceLocationName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,325071706)}),e("vxe-table-column",{attrs:{field:"palletName",title:"存放托盘","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择托盘",open:!1},on:{dropdownVisibleChange:function(e){return t.openPalletModal()}},model:{value:a.palletName,callback:function(e){t.$set(a,"palletName",e)},expression:"row.palletName"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"ellipsis"},slot:"suffixIcon"})],1)]}}],null,!1,3015230497)}),e("vxe-table-column",{attrs:{field:"tradeNo",title:"所属批次",width:"270","edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(r){var a=r.row;return[a.needChooseTradeNo?e("div",[e("a-select",{staticStyle:{width:"100%"},on:{change:function(e){return t.tradeNoCHange(a)}},model:{value:a.tradeNo,callback:function(e){t.$set(a,"tradeNo",e)},expression:"row.tradeNo"}},t._l(a.tradeNoChoiceList,(function(r,a){return e("a-select-option",{key:a,attrs:{value:r.tradeNo}},[t._v(" "+t._s(r.tradeNo)+"    "+t._s(r.price)+" ")])})),1)],1):e("div",[t._v(" "+t._s(a.tradeNo)+" ")])]}}],null,!1,2270284966)}),e("vxe-table-column",{attrs:{field:"amount",title:"发放数量",width:"120",align:"center","edit-render":{name:"$input",props:{type:"number",min:0}}}}),e("vxe-table-column",{attrs:{title:"操作",width:"120px",align:"center","show-overflow":!1},scopedSlots:t._u([{key:"default",fn:function(r){var a=r.row;return[a&&!t.$refs.distributionTable.isActiveByRow(a)?e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.editRowEvent(a)}}},[t._v("编辑 ")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleDel(a)}}},[t._v("删除")])],1):e("a-space",[e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRowEvent(a)}}},[t._v("保存")]),e("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRowEvent(a)}}},[t._v("取消")])],1)]}}],null,!1,743031837)})],1)],1)])]):t._e(),e("ApplyDistributionModal",{ref:"distributionModal",on:{ok:t.onSuccess}}),e("PalletList",{ref:"palletModal",attrs:{modeType:2},on:{ok:t.onSelectPallet}}),e("PalletList",{ref:"palletModal2",attrs:{modeType:2},on:{ok:t.onChoosePallet}}),e("LocationList",{ref:"locationModal",attrs:{modeType:2},on:{ok:t.onSelectLocation}})],1)},o=[],n=r("c54ca"),s=r("2eb4"),l=r("4ec3"),c=r("9f49"),u=r("13f1"),d=r("8973");function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function m(t,e,r){return(e=h(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h(t){var e=p(t,"string");return"symbol"==f(e)?e:e+""}function p(t,e){if("object"!=f(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,e||"default");if("object"!=f(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,a,i,o){var l=a&&a.prototype instanceof s?a:s,c=Object.create(l.prototype);return g(c,"_invoke",function(r,a,i){var o,s,l,c=0,u=i||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,r){return o=e,s=0,l=t,f.n=r,n}};function m(r,a){for(s=r,l=a,e=0;!d&&c&&!i&&e<u.length;e++){var i,o=u[e],m=f.p,h=o[2];r>3?(i=h===a)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=m&&((i=r<2&&m<o[1])?(s=0,f.v=a,f.n=o[1]):m<h&&(i=r<3||o[0]>a||a>h)&&(o[4]=r,o[5]=a,f.n=h,s=0))}if(i||r>1)return n;throw d=!0,a}return function(i,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),s=u,l=h;(e=s<2?t:l)||!d;){o||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,o){if(s||(i="next"),e=o[i]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=t}else if((e=(d=f.n<0)?l:r.call(a,f))!==n)break}catch(e){o=t,s=1,l=e}finally{c=1}}return{value:e,done:d}}}(r,i,o),!0),c}var n={};function s(){}function l(){}function c(){}e=Object.getPrototypeOf;var u=[][a]?e(e([][a]())):(g(e={},a,(function(){return this})),e),d=c.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,g(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=c,g(d,"constructor",c),g(c,"constructor",l),l.displayName="GeneratorFunction",g(c,i,"GeneratorFunction"),g(d),g(d,i,"Generator"),g(d,a,(function(){return this})),g(d,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:o,m:f}})()}function g(t,e,r,a){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}g=function(t,e,r,a){function o(e,r){g(t,e,(function(t){return this._invoke(e,r,t)}))}e?i?i(t,e,{value:r,enumerable:!a,configurable:!a,writable:!a}):t[e]=r:(o("next",0),o("throw",1),o("return",2))},g(t,e,r,a)}function y(t,e,r,a,i,o,n){try{var s=t[o](n),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function v(t){return function(){var e=this,r=arguments;return new Promise((function(a,i){var o=t.apply(e,r);function n(t){y(o,a,i,n,s,"next",t)}function s(t){y(o,a,i,n,s,"throw",t)}n(void 0)}))}}function w(t){return $(t)||x(t)||T(t)||k()}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(t,e){if(t){if("string"==typeof t)return O(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O(t,e):void 0}}function x(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function $(t){if(Array.isArray(t))return O(t)}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=Array(e);r<e;r++)a[r]=t[r];return a}var M={name:"ApplyReadyComponent",components:{ApplyDistributionModal:s["default"],PalletList:c["default"],LocationList:u["default"]},props:{businessKey:{type:String,default:null},isReadonly:{type:Boolean,default:!1},fromFlow:{type:Boolean,default:!1},orderType:{type:Number,default:""}},data:function(){return{records:[],confirmLoading:!1,tableData:[],tableDistributionData:[],palletList:[],distributionTableList:[],model:{},allAlign:"center",dictCode:"bu_material_pallet,name,id,status=1",queryParam:{status:[0],orderId:""},curRow:null,isDistribution:!1,selectInfo:{},addParam:{amount:"",applyDetailId:"",id:"",locationName:"",locationWbs:"",sourceLocationName:"",materialTypeId:"",palletId:"",palletName:"",stockPrice:"",tradeNo:""},curEditMode:0,validRules:{sourceLocationName:[{required:!0,message:"请选择库位",trigger:"manual"}],tradeNo:[{required:!0,message:"批次号不能为空",trigger:"manual"}],amount:[{required:!0,message:"请输入数量",trigger:"manual"}]}}},computed:{hasActiveRow:function(){return!!this.$refs.distributionTable.getActiveRecord()},calcAmount:function(){return this.getAmount()}},mounted:function(){this.businessKey&&this.edit(this.businessKey)},methods:(a={tradeNoCHange:function(t){var e=t.tradeNoChoiceList.filter((function(e){return e.tradeNo==t.tradeNo}));t.price=e[0].price},checkboxChange:function(t){this.records=t.records},edit:function(t){this.initDictData(),this.queryParam.orderId=t,this.findList()},findList:function(){var t=this;this.tableData=[],this.records=[],Object(n["bb"])(this.queryParam).then((function(e){e.success?(t.tableData=[].concat(w(t.tableData),w(e.result)),d["a"].joinDistributionInfo(t.tableData),t.distributionTableList=[]):t.$message.error("加载数据失败"),t.$emit("loaded")}))},autoArrange:function(){var t=this,e=this.$refs.listTable.getCheckboxRecords();e.length<=0?this.$message.warn("请先选择要进行自动安排的记录！"):this.$confirm({content:"将根据现有库存情况自动安排库位，并覆盖原有数据？",okText:"确定",cancelText:"取消",onOk:function(){var r={applyDetailIdList:[],type:0};e.forEach((function(t){r.applyDetailIdList.push(t.id)})),t.confirmLoading=!0,Object(n["k"])(r).then((function(r){if(r.success){var a=r.result.applyDetailList;t.$message.success(r.result.assignResultMessage),e.forEach((function(t){var e=a.find((function(e){return e.id===t.id}));e&&(e.sourceLocationAndPalletName="",e.assignDetailList.forEach((function(t){var r=t.sourceLocationName+" | "+t.amount;t.palletName&&(r+=" | ".concat(t.palletName)),t.tradeNo&&(r+=" | 第".concat(t.tradeNo,"批次")),e.sourceLocationAndPalletName+=r+" \n"})),Object.assign(t,e))}))}else t.$message.error(r.message);t.confirmLoading=!1}))},onCancel:function(){}})},arrangePan:function(){var t=this.$refs.listTable.getCheckboxRecords();if(t.length<=0)this.$message.warn("请先选择要进行自动安排的记录！");else{var e=t.filter((function(t){return t.assignDetailList.length<=0}));e.length>0?this.$message.warning("请先安排库位信息"):this.$refs.palletModal.showModal()}},onSelectPallet:function(t){var e=this.$refs.listTable.getCheckboxRecords();try{Array.from(e,(function(e){Array.from(e.assignDetailList,(function(e){e.palletId=t[0].id,e.palletName=t[0].name}))})),this.updateAssignInfo(),this.$message.success("设置成功")}catch(r){this.$message.error("设置失败")}},save:function(){var t=v(b().m((function t(e){var r,a,i,o,s=this;return b().w((function(t){while(1)switch(t.n){case 0:if(this.fromFlow){t.n=1;break}r=this.$refs.listTable.getCheckboxRecords(),r.length>0?this.$confirm({content:"是否确认发放选中".concat(r.length,"数据？"),onOk:function(){var t=r.map((function(t,e){return{id:t.id,palletId:t.palletName,receive:t.receive}})),e={id:s.queryParam.orderId,detailList:t};Object(n["i"])(e).then((function(t){t.success?s.$emit("ok"):s.$emit("fail",t)})).catch((function(t){s.$message.error("保存异常"),s.$emit("fail")}))}}):this.$message.error("尚未选中任何数据!"),t.n=6;break;case 1:if(!(this.tableData&&this.tableData.length>0)){t.n=5;break}if(a={id:this.queryParam.orderId,onlySave:e,detailList:this.tableData.filter((function(t){return!t.noSave}))},i=!0,o=this.tableData.filter((function(t){return 0===t.receive})),e||!o.length){t.n=3;break}return t.n=2,new Promise((function(t,e){var r=o.map((function(t){return"["+t.materialTypeName+"-"+t.materialTypeCode+"]缺少"+(t.amount-t.receive)})).join("；");s.$confirm({content:"数量不匹配提醒：  ".concat(r,"  ;  是否继续提交？"),onOk:function(){t(!0)},onCancel:function(){t(!1)}})}));case 2:i=t.v;case 3:if(i){t.n=4;break}return this.$emit("cancel"),t.a(2);case 4:n["i"].call(this,a).then((function(t){t.success?s.$emit("ok"):s.$emit("fail",t)})).catch((function(t){s.$message.error("备料保存异常"),s.$emit("fail",t)})),t.n=6;break;case 5:this.$emit("ok");case 6:return t.a(2)}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),close:function(){this.$emit("close")},initDictData:function(){var t=this;Object(l["f"])(this.dictCode,null).then((function(e){e.success&&e.result&&e.result.map((function(e){t.palletList=t.palletList.concat({label:e.text,value:e.value})}))}))},openDistribution:function(t){this.curRow=t,this.openDistribution(t)},onSuccess:function(t){var e=this;t.forEach((function(r){var a=e.tableData.find((function(t){return t.id===r.applyDetailId}));a.assignDetailList=JSON.parse(JSON.stringify(t)),a.receive=0,a.assignDetailList.forEach((function(t){a.receive+=Number(t.amount);var e=t.sourceLocationName+" | "+t.amount;t.palletName&&(e+=" | ".concat(t.palletName)),t.tradeNo&&(e+=" | 第".concat(t.tradeNo,"批次")),a.sourceLocationAndPalletName+=e+" \n"}))}))},updateAssignInfo:function(){this.tableData.forEach((function(t){t.sourceLocationAndPalletName="",t.assignDetailList.forEach((function(e){var r=e.sourceLocationName+" | "+e.amount;e.palletName&&(r+=" | ".concat(e.palletName)),e.tradeNo&&(r+=" | 第".concat(e.tradeNo,"批次")),t.sourceLocationAndPalletName+=r+" \n"}))}))}},m(m(m(m(m(m(m(m(m(m(a,"openDistribution",(function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isDistribution=!0,this.curEditMode=0,this.$nextTick((function(){t.$refs.materialTable.setRadioRow(e||t.tableData[0]||{}),t.setActiveRow(e||t.tableData[0])}))})),"closeDistribution",(function(){this.hasActiveRow?this.$message.warn("存在未保存数据，请先保存"):(this.isDistribution=!1,this.curEditMode=0)})),"setActiveRow",(function(t){var e=this;this.tableDistributionData=[],this.selectInfo={},this.selectInfo=this.tableData.find((function(e){return e.id===t.id})),this.selectInfo.assignDetailList.forEach((function(t){e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))}))})),"onRadioChange",(function(t){var e=t.row;e&&!this.hasActiveRow&&this.setActiveRow(e)})),"onMaterialCellClick",(function(t){var e=t.$event;e.stopPropagation()})),"addDetail",(function(){var t=this;if(!this.$refs.distributionTable.getActiveRecord()){this.curEditMode=1;var e={applyDetailId:this.selectInfo.id,materialTypeId:this.selectInfo.materialTypeId,amount:this.getAmount()};this.$refs.distributionTable.insertAt(e,-1).then((function(e){var r=e.row;t.$refs.distributionTable.setActiveRow(r)}))}})),"editRowEvent",(function(t){this.$refs.distributionTable.getActiveRecord()||(this.curEditMode=2,this.$refs.distributionTable.setActiveRow(t))})),"getAmount",(function(){if(!this.selectInfo)return 0;var t=0;return this.tableDistributionData.forEach((function(e){t+=Number(e.amount)})),this.selectInfo.amount-t})),"openlocationModal",(function(t){this.$refs.locationModal.showModal(this.selectInfo.materialTypeId,t.applyDetailId,t.id)})),"onSelectLocation",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),r=e.row;r&&(r.locationName=t[0].warehouseName,r.locationWbs=t[0].warehouseWbs,r.sourceLocationName=t[0].sourceLocationName,r.tradeNo=t[0].tradeNo,r.price=t[0].price,r.needChooseTradeNo=t[0].needChooseTradeNo,r.tradeNoChoiceList=t[0].tradeNoChoiceList,r.locationNum=t[0].usableAmount,this.calcAmount>r.locationNum?r.amount=r.locationNum:this.calcAmount>0&&this.calcAmount<=r.locationNum?r.amount=this.calcAmount:r.amount=0)}})),m(m(m(m(m(a,"saveRowEvent",(function(t){var e=this;this.$refs.distributionTable.validate(t,(function(r){if(!r){if(e.tableDistributionData.find((function(e){return e.sourceLocationName===t.sourceLocationName&&e.tradeNo===t.tradeNo}))&&1===e.curEditMode)return void e.$message.warn("该仓库该批次的物资记录已存在");if("number"===typeof t.locationNum&&t.amount>t.locationNum)return void e.$message.warn("该仓库该批次的物资库存量不足");var a=0;if(e.tableDistributionData.forEach((function(e){e.sourceLocationName,t.sourceLocationName,e.tradeNo!==t.tradeNo&&(a+=Number(e.amount))})),a+Number(t.amount)>Number(e.selectInfo.amount))return void e.$message.warn("选择的实际数量超过了发放数量");1===e.curEditMode&&(t.isNew=!0,e.tableDistributionData.push(JSON.parse(JSON.stringify(t)))),e.$refs.distributionTable.clearActived(),e.onSuccess(e.tableDistributionData),e.curEditMode=0}}))})),"cancelRowEvent",(function(t){this.$refs.distributionTable.clearActived(),1===this.curEditMode?this.$refs.distributionTable.remove(t):2===this.curEditMode&&this.$refs.distributionTable.revertData(t),this.curEditMode=0})),"handleDel",(function(t){var e=this;this.$refs.distributionTable.getActiveRecord()||(this.$confirm({content:"是否删除选中的数据？",okText:"确定",cancelText:"取消",onOk:function(){e.tableDistributionData.splice(e.tableDistributionData.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1);var r=e.tableData.find((function(e){return e.id===t.applyDetailId}));r.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName}))&&(r.receive-=r.assignDetailList.find((function(e){return e.sourceLocationName===t.sourceLocationName})).amount,r.assignDetailList.splice(r.assignDetailList.findIndex((function(e){return e.sourceLocationName===t.sourceLocationName})),1)),e.$nextTick((function(){e.locationMaxAmount=e.calcAmount}))}}),this.curEditMode=0)})),"openPalletModal",(function(){this.$refs.palletModal2.showModal(this.selectInfo.materialTypeId,this.selectInfo.materialTypeName)})),"onChoosePallet",(function(t){if(t.length>0){var e=this.$refs.distributionTable.getActiveRecord(),r=e.row;r&&(r.palletId=t[0].id,r.palletName=t[0].name)}})))},S=M,j=(r("51c5"),r("2877")),_=Object(j["a"])(S,i,o,!1,null,"efd43ef8",null);e["default"]=_.exports}}]);