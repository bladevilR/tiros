<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.material.borrow.mapper.BuMaterialBorrowDetailMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.jeecg.modules.material.borrow.bean.BuMaterialBorrowDetail">
        <id column="id" property="id" />
        <result column="borrow_id" property="borrowId" />
        <result column="material_type_id" property="materialTypeId" />
        <result column="amount" property="amount" />
        <result column="reason" property="reason" />
        <result column="return_status" property="returnStatus" />
        <result column="return_date" property="returnDate" />
        <result column="warehouse_location_id" property="warehouseLocationId" />
        <result column="remark" property="remark" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, borrow_id, material_type_id, amount, reason, return_status, return_date, warehouse_location_id, remark
    </sql>
    <select id="selectBorrowDetail"  resultType="org.jeecg.modules.material.borrow.bean.BuMaterialBorrowDetail">
        select t.* , t2.code AS materialTypeCode,
               t2.name AS materialTypeName,
               t2.spec AS materialTypeSpec,
               t2.unit AS materialTypeUnit,
               t3.name AS warehouseName,
               t4.return_type as returnType
        from bu_material_borrow_detail t
                 LEFT JOIN bu_material_type t2 ON t2.id = t.material_type_id
                 LEFT JOIN bu_mtr_warehouse t3 ON t3.id = t.warehouse_location_id
                 Left  Join bu_material_borrow t4 on t4.id=t.borrow_id
        where borrow_id=#{id}
    </select>


    <select id="selectInBorrowDetail"  resultType="org.jeecg.modules.material.borrow.bean.BuMaterialBorrowDetail">
        select t.* , t2.code AS materialTypeCode,
               t2.name AS materialTypeName,
               t2.spec AS materialTypeSpec,
               t2.unit AS materialTypeUnit,
               t3.name AS warehouseName,
               decode(t4.borrow_type,1,t5.depart_name,t6.name)AS deptName
        from bu_material_borrow_detail t
                 LEFT JOIN bu_material_type t2 ON t2.id = t.material_type_id
                 LEFT JOIN bu_mtr_warehouse t3 ON t3.id = t.warehouse_location_id
                 LEFT JOIN bu_material_borrow t4 ON t4.id = t.borrow_id
                 LEFT JOIN sys_depart t5 ON t5.id = t4.borrow_dep
                 LEFT JOIN bu_base_supplier t6 ON t6.id=t4.borrow_dep
        where borrow_id=#{queryVO.id}
            <if test="queryVO.borrowType != null">
                AND t4.borrow_type = #{queryVO.borrowType}
            </if>
    </select>
</mapper>
