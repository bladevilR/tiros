<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.dispatch.workorder.mapper.BuWorkOrderRecordDetailMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.jeecg.modules.dispatch.workorder.bean.BuWorkOrderRecordDetail">
        <id column="id" property="id" />
        <result column="order_record_id" property="orderRecordId" />
        <result column="work_rec_detail_id" property="workRecDetailId" />
        <result column="work_info" property="workInfo" />
        <result column="result" property="result" />
    </resultMap>

    <!-- 工单作业记录明细映射结果 -->
    <resultMap id="WorkOrderRecordDetailResultMap"
               type="org.jeecg.modules.dispatch.workorder.bean.BuWorkOrderRecordDetail">
        <id column="id" property="id"/>
        <result column="order_record_id" property="orderRecordId"/>
        <result column="work_rec_detail_id" property="workRecDetailId"/>
        <result column="work_info" property="workInfo"/>
        <result column="result" property="result"/>
        <collection property="checks"
                    ofType="org.jeecg.modules.dispatch.workorder.bean.BuWorkOrderRecordCheck"
                    select="selectOrderRecordDetailChecks" column="id">
        </collection>
    </resultMap>
    <select id="selectOrderRecordDetailChecks"
            resultType="org.jeecg.modules.dispatch.workorder.bean.BuWorkOrderRecordCheck">
        SELECT
        t1.*,
        t2.realname AS checkUserName
        FROM bu_work_order_record_check t1
        LEFT JOIN sys_user t2 ON t2.id = t1.check_user_id
        WHERE t1.record_detail_id = #{id}
        ORDER BY t1.check_time
    </select>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, order_record_id, work_rec_detail_id, work_info, result
    </sql>

    <select id="selectListByOrderRecordId" resultMap="WorkOrderRecordDetailResultMap">
        SELECT
        t1.*,
        t3.rec_index AS recIndex,
        t2.check_level AS checkLevel,
        t2.work_content AS workContent
        FROM bu_work_order_record_detail t1
        LEFT JOIN bu_work_record_detail t2 ON t2.id = t1.work_rec_detail_id
        LEFT JOIN bu_work_record_category t3 ON t3.id = t2.category_id
        WHERE t1.order_record_id = #{recordId}
        ORDER BY t3.rec_index,t2.item_no
    </select>

</mapper>
