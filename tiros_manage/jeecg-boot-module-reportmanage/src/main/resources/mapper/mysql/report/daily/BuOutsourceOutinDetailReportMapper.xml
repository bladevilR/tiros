<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.report.daily.mapper.BuOutsourceOutinDetailReportMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.jeecg.modules.report.daily.bean.BuOutsourceOutinDetail">
        <id column="id" property="id"/>
        <result column="outin_id" property="outinId"/>
        <result column="asset_no" property="assetNo"/>
        <result column="asset_name" property="assetName"/>
        <result column="amount" property="amount"/>
        <result column="asset_type_id" property="assetTypeId"/>
        <result column="train_no" property="trainNo"/>
        <result column="turnover_asset_id" property="turnoverAssetId"/>
        <result column="facade_status" property="facadeStatus"/>
        <result column="facade_desc" property="facadeDesc"/>
        <result column="mixtool_status" property="mixtoolStatus"/>
        <result column="mixtool_desc" property="mixtoolDesc"/>
        <result column="fault" property="fault"/>
        <result column="return_status" property="returnStatus"/>
        <result column="return_time" property="returnTime"/>
        <result column="delay_reason" property="delayReason"/>
        <result column="remark" property="remark"/>
        <result column="out_detail_id" property="outDetailId"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, outin_id, asset_no, asset_name, amount, asset_type_id, train_no, turnover_asset_id,
        facade_status, facade_desc, mixtool_status, mixtool_desc, fault, return_status, return_time,
        delay_reason, remark, out_detail_id
    </sql>

    <select id="selectListByOrderIdList" resultType="org.jeecg.modules.report.daily.bean.BuOutsourceOutinDetail">
        select t.*,
        t1.bill_type as billType,
        t1.transfer_date as transferDate,
        t2.name as assetTypeName
        from bu_outsource_outin_detail t
        left join bu_outsource_outin t1 on t1.id = t.outin_id
        left join bu_train_asset_type t2 on t2.id = t.asset_type_id
        left join bu_work_order t3 on t3.id = t1.work_order_id
        <where>
            and t1.work_order_id
            <choose>
                <when test="orderIdList != null and orderIdList.size > 0">
                    in
                    <foreach collection="orderIdList" item="orderId" index="index" open="(" separator="," close=")">
                        #{orderId}
                    </foreach>
                </when>
                <otherwise>
                    ='-1'
                </otherwise>
            </choose>
            <if test="trainNo != null and trainNo != ''">
                and t.train_no = #{trainNo}
            </if>
        </where>
        order by t3.group_id, t1.bill_type, t1.bill_no desc, t.asset_no
    </select>

</mapper>
