<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.report.daily.mapper.BuWorkOrderTaskReportMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.jeecg.modules.report.daily.bean.BuWorkOrderTask">
        <id column="id" property="id"/>
        <result column="order_id" property="orderId"/>
        <result column="task_type" property="taskType"/>
        <result column="task_obj_id" property="taskObjId"/>
        <result column="task_no" property="taskNo"/>
        <result column="task_name" property="taskName"/>
        <result column="task_content" property="taskContent"/>
        <result column="work_time" property="workTime"/>
        <result column="remark" property="remark"/>
        <result column="task_start" property="taskStart"/>
        <result column="task_finish" property="taskFinish"/>
        <result column="task_time" property="taskTime"/>
        <result column="report_time" property="reportTime"/>
        <result column="task_status" property="taskStatus"/>
        <result column="out_task" property="outTask"/>
        <result column="asset_type_id" property="assetTypeId"/>
        <result column="struct_detail_id" property="structDetailId"/>
        <result column="train_asset_id" property="trainAssetId"/>
        <result column="important" property="important"/>
        <result column="method" property="method"/>
        <result column="safe_notice" property="safeNotice"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, order_id, task_type, task_obj_id, task_no, task_name, task_content, work_time,
        remark, task_start, task_finish, task_time, report_time, task_status, out_task,
        asset_type_id, struct_detail_id, train_asset_id, important, method, safe_notice
    </sql>

    <select id="selectListByBuDayReportQueryVO" resultType="org.jeecg.modules.report.daily.bean.BuWorkOrderTask">
        select t.*,
               t1.group_id   as groupId,
               t1.order_type as orderType
        from bu_work_order_task t
                 left join bu_work_order t1 on t1.id = t.order_id
        where (to_char(#{queryVO.day}, 'yyyy-mm-dd') = to_char(t1.start_time, 'yyyy-mm-dd') and
               to_char(#{queryVO.day}, 'yyyy-mm-dd') = to_char(t1.finish_time, 'yyyy-mm-dd'))
          and t1.train_no = #{queryVO.trainNo}
          and t1.workshop_id = #{queryVO.workshopId}
        order by t1.order_code, t.task_no
    </select>

    <select id="selectTaskStaffArrangeByTaskIdList" resultType="java.util.Map">
        select t1.order_task_id as "taskId",
        t.user_id as "userId",
        NVL(t.work_time, 0) as "workTime"
        from bu_repair_task_staff_arrange t
        left join bu_work_order_task_workstation t1 on t1.id = t.ord_tsk_wk_station_id
        where t1.order_task_id
        <choose>
            <when test="orderTaskIdList != null and orderTaskIdList.size > 0">
                in
                <foreach collection="orderTaskIdList" item="orderTaskId" separator="," open="(" close=")">
                    #{orderTaskId}
                </foreach>
            </when>
            <otherwise>
                = '-1'
            </otherwise>
        </choose>
    </select>

</mapper>
