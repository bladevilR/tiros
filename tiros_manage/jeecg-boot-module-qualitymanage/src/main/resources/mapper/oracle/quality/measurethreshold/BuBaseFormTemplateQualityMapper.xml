<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.quality.measurethreshold.mapper.BuBaseFormTemplateQualityMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.jeecg.modules.quality.measurethreshold.bean.BuBaseFormTemplate">
        <id column="id" property="id"/>
        <result column="code" property="code"/>
        <result column="name" property="name"/>
        <result column="category" property="category"/>
        <result column="status" property="status"/>
        <result column="type" property="type"/>
        <result column="remark" property="remark"/>
        <result column="content" property="content"/>
        <result column="datajson" property="datajson"/>
        <result column="create_time" property="createTime"/>
        <result column="create_by" property="createBy"/>
        <result column="update_time" property="updateTime"/>
        <result column="update_by" property="updateBy"/>
        <result column="asset_type_id" property="assetTypeId"/>
        <result column="line_id" property="lineId"/>
        <result column="repair_program_id" property="repairProgramId"/>
        <result column="create_group_id" property="createGroupId"/>
        <result column="regu_id" property="reguId"/>
        <result column="company_id" property="companyId"/>
        <result column="workshop_id" property="workshopId"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, code, name, category, status, type, remark, content, datajson, create_time, create_by,
        update_time, update_by, asset_type_id, line_id, repair_program_id, create_group_id, regu_id,
        company_id, workshop_id
    </sql>

    <sql id="Column_List_Alias_t_No_Content">
        t.id, t.code, t.name, t.category, t.status, t.type, t.remark, t.create_time, t.create_by,
        t.update_time, t.update_by, t.asset_type_id, t.line_id, t.repair_program_id, t.create_group_id, t.regu_id,
        t.company_id, t.workshop_id
    </sql>


    <select id="selectDataRecordFormPage"
            resultType="org.jeecg.modules.quality.measurethreshold.bean.BuBaseFormTemplate">
        SELECT
        t1.name AS categoryName,
        t2.name as assetTypeName,
        case when EXISTS(SELECT id from bu_work_measure_item where custom_id = t.id) then 1 else 0 end AS
        thresholdStatus,
        t3.name as repairProgramName,
        t4.name as reguName,
        t5.line_name as lineName,
        <include refid="Column_List_Alias_t_No_Content"/>
        FROM bu_base_form_template t
        LEFT JOIN sys_category t1 ON t1.id = t.category
        LEFT JOIN bu_train_asset_type t2 ON t2.id = t.asset_type_id
        LEFT JOIN bu_repair_program t3 ON t3.id = t.repair_program_id
        LEFT JOIN bu_repair_regu_info t4 ON t4.id = t.regu_id
        LEFT JOIN bu_mtr_line t5 ON t5.line_id = t.line_id
        WHERE t.type = 1
        and t.category = (select id from sys_category where code = #{queryVO.dataRecordFormCategoryCode})
        <if test="queryVO.name != null and queryVO.name != ''">
            AND t.name LIKE '%'||#{queryVO.name}||'%'
        </if>
        <if test="queryVO.formType != null">
            AND t.type = #{queryVO.formType}
        </if>
        <if test="queryVO.lineId != null and queryVO.lineId != ''">
            AND t.line_id = #{queryVO.lineId}
        </if>
        <if test="queryVO.repairProgramId != null and queryVO.repairProgramId != ''">
            AND t.repair_program_id= #{queryVO.repairProgramId}
        </if>
        <if test="queryVO.reguId != null and queryVO.reguId != ''">
            AND t.regu_id = #{queryVO.reguId}
        </if>
        <if test="queryVO.status != null">
            AND t.status = #{queryVO.status}
        </if>
        ORDER BY t.type, t.code
    </select>

</mapper>
